<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Union-Findå¹¶æŸ¥é›†ç®—æ³•ï¼ˆPythonå®ç°ï¼‰</title>
      <link href="/2023/12/24/Union-Find%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%AE%97%E6%B3%95%EF%BC%88Python%E5%AE%9E%E7%8E%B0%EF%BC%89/"/>
      <url>/2023/12/24/Union-Find%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%AE%97%E6%B3%95%EF%BC%88Python%E5%AE%9E%E7%8E%B0%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ˜¯å¹¶æŸ¥é›†ç®—æ³•çš„Pythonå®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UF</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å¹¶æŸ¥é›†ç®—æ³•</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        åˆå§‹åŒ–æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–è¿é€šåˆ†é‡æ•°é‡</span></span><br><span class="line">        self._count = n</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–åŒäº²èŠ‚ç‚¹</span></span><br><span class="line">        self._parent = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="comment"># self.size[x]è¡¨ç¤ºä»¥xä¸ºæ ¹èŠ‚ç‚¹çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">        self._size = [<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">self, x : <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        find root of x</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> self._parent[x] != x:</span><br><span class="line">            <span class="comment"># è·¯ç»å‹ç¼©ï¼Œå°†å½“å‰èŠ‚ç‚¹çš„åŒäº²èŠ‚ç‚¹è®¾ä¸ºå…¶åŒäº²èŠ‚ç‚¹çš„åŒäº²èŠ‚ç‚¹</span></span><br><span class="line">            self._parent[x] = self._parent[self._parent[x]]</span><br><span class="line">            x = self._parent[x]</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">union</span>(<span class="params">self, p: <span class="built_in">int</span>, q: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        union p and q</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># æ‰¾åˆ°på’Œqçš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        rootP = self.find(p)</span><br><span class="line">        rootQ = self.find(q)</span><br><span class="line">        <span class="keyword">if</span> rootP == rootQ:</span><br><span class="line">            <span class="comment"># å¦‚æœæ ¹èŠ‚ç‚¹ç›¸ç­‰ï¼Œåˆ™pqæœ¬å°±è”é€š</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># å°†å°é›†åˆåˆå¹¶åˆ°å¤§é›†åˆä¸­ï¼Œå¹³è¡¡æ€§ä¼˜åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> self._size[rootP] &gt; self._size[rootQ]:</span><br><span class="line"></span><br><span class="line">            self._parent[rootQ] = rootP</span><br><span class="line">            self._size[rootP] += self._size[rootQ]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._parent[rootP] = rootQ</span><br><span class="line">            self._size[rootQ] += self._size[rootP]</span><br><span class="line">        self._count -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">count</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        è¿”å›è”é€šæ•°</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self._count</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">connected</span>(<span class="params">self, p, q</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        åˆ¤æ–­pqæ˜¯å¦è”é€š</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self.find(q) == self.find(p)</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/98406740">https://zhuanlan.zhihu.com/p/98406740</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> å¹¶æŸ¥é›†ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> å¹¶æŸ¥é›† </tag>
            
            <tag> UnionFind </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>subprocessæ‰§è¡Œjavaå‘½ä»¤æ®‹ç•™è¿›ç¨‹è§£å†³</title>
      <link href="/2023/12/07/subprocess%E6%89%A7%E8%A1%8Cjava%E5%91%BD%E4%BB%A4%E6%AE%8B%E7%95%99%E8%BF%9B%E7%A8%8B%E8%A7%A3%E5%86%B3/"/>
      <url>/2023/12/07/subprocess%E6%89%A7%E8%A1%8Cjava%E5%91%BD%E4%BB%A4%E6%AE%8B%E7%95%99%E8%BF%9B%E7%A8%8B%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="é—®é¢˜ç®€è¿°"><a href="#é—®é¢˜ç®€è¿°" class="headerlink" title="é—®é¢˜ç®€è¿°"></a>é—®é¢˜ç®€è¿°</h1><blockquote><p>éœ€æ±‚æ˜¯é€šè¿‡Pythonæ‰§è¡Œå‘½ä»¤java -java springboot-demo.jar</p><p>äºæ˜¯ï¼Œæˆ‘ä½¿ç”¨subprocess.Popen()æ¥å¯åœã€‚ä½†æ˜¯æˆ‘å‘ç°åœ¨å…³é—­å­è¿›ç¨‹åï¼Œjavaè¿›ç¨‹å¹¶æ²¡æœ‰æ­£ç¡®å…³é—­ã€‚</p><p>è¿™æ˜¯ç”±äºä¸Šé¢çš„æ–¹æ³•å®é™…åŸç†æ˜¯å¦å¤–å¼€å¯ä¸€ä¸ªcmdå‘½ä»¤æ¥è¿è¡Œjava -jarå‘½ä»¤ï¼Œåé¢ç”¨popen.terminate()ä¹Ÿåªèƒ½å…³é—­cmdçš„å‘½ä»¤ï¼Œcmdå‘½ä»¤è¢«killæ‰åï¼Œjavaè¿›ç¨‹ç”±ç³»ç»Ÿæ¥æ‰˜ç®¡ï¼Œä»è€Œå¯¼è‡´javaè¿›ç¨‹å¹¶æ²¡æœ‰æ­£ç¡®å…³é—­ã€‚</p></blockquote><h1 id="Bugå¤ç°"><a href="#Bugå¤ç°" class="headerlink" title="Bugå¤ç°"></a>Bugå¤ç°</h1><p>æ‰§è¡Œä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"><span class="comment"># æ‰§è¡Œjava -jar</span></span><br><span class="line">t = subprocess.Popen([<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;springboot-demo.jar&quot;</span>])</span><br><span class="line"><span class="comment"># Popenæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥éœ€è¦ç­‰å¾…å‡ ç§’ï¼Œå†å…³é—­</span></span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br><span class="line"><span class="comment"># å…³é—­å­è¿›ç¨‹</span></span><br><span class="line">t.terminate()</span><br><span class="line"><span class="comment"># ç­‰å¾…å…³é—­ç»“æŸ</span></span><br><span class="line">t.wait()</span><br></pre></td></tr></table></figure><p>å‘ç°æ®‹ç•™çš„javaè¿›ç¨‹</p><p><img src="image.png" alt="image"></p><h1 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æˆ‘çš„è§£å†³æ€è·¯æ˜¯ï¼Œç¨å¾®ä¿®æ”¹javaä»£ç ï¼Œåœ¨æ‰§è¡Œjava -jarå‘½ä»¤åï¼Œå°†javaè¿›ç¨‹idï¼ˆpidï¼‰æš´éœ²å‡ºæ¥ã€‚</p><p>å½“éœ€è¦å…³é—­ç¨‹åºæ—¶ï¼Œè¯»å–æš´éœ²å‡ºæ¥çš„javaè¿›ç¨‹idï¼Œä½¿ç”¨killå‘½ä»¤ï¼Œå°†è¿›ç¨‹æ€æ­»ã€‚</p><h2 id="è¯¦è¿°"><a href="#è¯¦è¿°" class="headerlink" title="è¯¦è¿°"></a>è¯¦è¿°</h2><p>é¦–å…ˆä¿®æ”¹javaä»£ç ï¼Œæˆ‘ä½¿ç”¨çš„ä»£ç æ¡†æ¶æ˜¯springbootï¼Œæ‰€ä»¥åœ¨springbootçš„å¯åŠ¨ç±»ä¸Šä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(SpringbootDemoApplication.class);</span><br><span class="line"><span class="comment">// è·å–jaråŒ…æ‰§è¡Œçš„è·¯å¾„</span></span><br><span class="line"><span class="type">ApplicationHome</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationHome</span>(SpringbootDemoApplication.class);</span><br><span class="line"><span class="type">File</span> <span class="variable">source</span> <span class="operator">=</span> h.getSource();</span><br><span class="line">System.out.println(<span class="string">&quot;&lt;&lt;&lt;&lt;&lt;&lt; jar æ‰§è¡Œç›®å½•ï¼š&quot;</span> + source.getParentFile().toString() + <span class="string">&quot; &gt;&gt;&gt;&gt;&gt;&gt;&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">app_pid_file</span> <span class="operator">=</span> source.getParentFile().toString() + <span class="string">&quot;\\app.pid&quot;</span>;</span><br><span class="line">application.addListeners(<span class="keyword">new</span> <span class="title class_">ApplicationPidFileWriter</span>(app_pid_file)); <span class="comment">// æŠŠè¿›ç¨‹å·æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­</span></span><br><span class="line">application.run();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ</p><ul><li>source.getParentFile().toString()å¯ä»¥è·å¾—jaråŒ…æ‰€åœ¨çš„ç›®å½•ã€‚</li><li>application.addListeners(new ApplicationPidFileWriter(app_pid_file));å°†åœ¨jaråŒ…åŒçº§ç›®å½•ä¸‹ç”Ÿæˆapp.pidçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­å†™å…¥äº†springbootè¿è¡Œçš„è¿›ç¨‹å·</li></ul><p>ç„¶åä¿®æ”¹Pythonä»£ç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">JAR_DIR = <span class="string">&#x27;XXX&#x27;</span> <span class="comment"># jaråŒ…æ‰€åœ¨ç›®å½•</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œjava -jar</span></span><br><span class="line">t = subprocess.Popen([<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, os.path.join(<span class="string">f&quot;<span class="subst">&#123;JAR_DIR&#125;</span>&quot;</span>, <span class="string">&quot;springboot-demo.jar&quot;</span>])</span><br><span class="line"><span class="comment"># Popenæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥éœ€è¦ç­‰å¾…å‡ ç§’ï¼Œå†å…³é—­</span></span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br><span class="line"><span class="comment"># å…³é—­å­è¿›ç¨‹</span></span><br><span class="line">t.terminate()</span><br><span class="line"><span class="comment"># ç­‰å¾…å…³é—­ç»“æŸ</span></span><br><span class="line">t.wait()</span><br><span class="line"><span class="comment"># å…³é—­javaè¿›ç¨‹</span></span><br><span class="line">app_pid_file_path = os.path.join(JAR_DIR, <span class="string">&quot;app.pid&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(app_pid_file_path):</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(app_pid_file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">pid = f.read()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨å…³é—­java è¿›ç¨‹, pidï¼š <span class="subst">&#123;<span class="built_in">int</span>(pid)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># åœ¨windowsç³»ç»Ÿä¸‹æ‰§è¡Œæ€æ­»è¿›ç¨‹çš„å‘½ä»¤ï¼Œå…¶ä»–ç³»ç»Ÿå¯èƒ½å‘½ä»¤ä¸åŒ</span></span><br><span class="line">subprocess.run([<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;/c&quot;</span>, <span class="string">&quot;taskkill&quot;</span>, <span class="string">&quot;/pid&quot;</span>, <span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">int</span>(pid)&#125;</span>&#x27;</span>, <span class="string">&quot;-f&quot;</span>])</span><br><span class="line">os.remove(app_pid_file_path) <span class="comment"># åˆ é™¤app.pidæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ— </p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://blog.csdn.net/skyli114/article/details/127324383">subprocess.Popenæ‰§è¡Œç¨‹åºä»¥åŠå…³é—­è¿›ç¨‹</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CC+Open3dè§£å†³å¤§å‹ç‚¹äº‘æ•°æ®åŠ è½½å’Œè®¡ç®—é—®é¢˜</title>
      <link href="/2023/11/29/CC-Open3d%E8%A7%A3%E5%86%B3%E5%A4%A7%E5%9E%8B%E7%82%B9%E4%BA%91%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E5%92%8C%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98/"/>
      <url>/2023/11/29/CC-Open3d%E8%A7%A3%E5%86%B3%E5%A4%A7%E5%9E%8B%E7%82%B9%E4%BA%91%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E5%92%8C%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é›·è¾¾æ‰«æçš„ç‚¹äº‘æ•°æ®é‡å¾€å¾€å¾ˆå¤§ï¼Œè€Œå…¶ä¸­å­˜åœ¨å¤§é‡ä¸éœ€è¦çš„ç‚¹ã€‚</p><p>ä¾‹å¦‚æˆ‘åªéœ€è¦æŸä¸ªå°æ¨¡å‹çš„ç‚¹äº‘ï¼Œä½†é›·è¾¾å°†å‘¨å›´çš„ç¯å¢ƒä¹Ÿä¸€å¹¶æ‰«æè¿›æ¥äº†ï¼Œè¿™äº›ç¯å¢ƒç‚¹äº‘æˆ‘å¹¶ä¸éœ€è¦ã€‚</p><p>ç°åœ¨æˆ‘éœ€è¦æµ‹é‡è¿™ä¸ªå°æ¨¡å‹çš„æŸäº›å±æ€§ã€‚ï¼ˆæ¯”å¦‚é•¿å®½ï¼‰</p><p>æ­¤æ—¶å¦‚æœç›´æ¥åœ¨å…¨éƒ¨ç‚¹äº‘æ•°æ®ä¸‹è¿›è¡Œæµ‹é‡ï¼Œå°†è¿™äº›ç‚¹äº‘åŠ è½½å‡ºæ¥éƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œä½¿ç”¨Cloud Compareè½½å…¥1.3äº¿æ•°é‡çº§çš„ç‚¹äº‘æ•°æ®ç›´æ¥å¡æ­»ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä½“ç´ é™é‡‡æ ·çš„æ–¹å¼ï¼ˆä¾‹å¦‚ä½“ç´ å€¼ä¸º2dmï¼‰æå¤§ç¼©å°ç‚¹äº‘çš„æ•°é‡ï¼Œä½†æˆ‘çš„éœ€æ±‚æ˜¯å¸Œæœ›è®¡ç®—å°æ¨¡å‹çš„é•¿å®½ï¼Œå…¶è¯¯å·®ä¸è¶…è¿‡5cmã€‚</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>å› æ­¤æˆ‘çš„åšæ³•å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="æœªå‘½åç»˜å›¾.drawio-20231129175149-u5ss8y9.png" alt="æœªå‘½åç»˜å›¾.drawio">â€‹â€‹</p><ol><li>é¦–å…ˆä¸ºäº†èƒ½å¤Ÿå°†ç‚¹äº‘å±•ç¤ºå‡ºæ¥ï¼Œæˆ‘è¦æå¤§çš„ä¸‹é‡‡æ ·ç‚¹äº‘ï¼Œè¿™é‡Œæˆ‘å–å‚æ•°ä¸º0.2ï¼ˆ2dmï¼‰ï¼Œå¾—åˆ°ä¸‹é‡‡æ ·åçš„ç‚¹äº‘1</li><li>ä½¿ç”¨CCåŠ è½½ç‚¹äº‘1ï¼Œå¹¶å¯è§†åŒ–è£å‰ªç‚¹äº‘ï¼Œå¾—åˆ°è£å‰ªç«‹æ–¹ä½“çš„å‚æ•°ï¼ŒåŒ…æ‹¬ç«‹æ–¹ä½“çš„ä¸­å¿ƒï¼Œé•¿å®½é«˜ï¼Œæ—‹è½¬ç­‰</li><li>ä½¿ç”¨ä¸Šä¸€æ­¥çš„å¾—åˆ°çš„å‚æ•°å»è£å‰ªåŸå§‹ç‚¹äº‘ï¼Œæå¤§çš„å‡å°‘äº†ç‚¹äº‘æ•°é‡</li><li>å°†è£å‡åçš„ç‚¹äº‘ä¸‹é‡‡æ ·ï¼Œä¸ºäº†ä¿è¯ç²¾åº¦ï¼Œè¿™æ¬¡ä¸‹é‡‡æ ·ç‡ä¸º0.01ï¼ˆ1cmï¼‰ï¼Œå¾—åˆ°ç‚¹äº‘2</li><li>å¯è§†åŒ–ç‚¹äº‘2ï¼Œå¹¶è¿›è¡Œæµ‹é‡ï¼Œå¾—åˆ°ç»“æœã€‚</li></ol><h1 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h1><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2><p>ç¼–å†™pythonè„šæœ¬å¹¶å¯¼å…¥åˆ°CCï¼Œæ‰§è¡Œè¯¥è„šæœ¬ï¼Œå°†ç‚¹äº‘1åŠ è½½åˆ°CCä¸­</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pycc</span><br><span class="line"><span class="keyword">import</span> cccorelib</span><br><span class="line"></span><br><span class="line">cc = pycc.GetInstance()</span><br><span class="line"><span class="keyword">import</span> open3d <span class="keyword">as</span> o3d</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># open PointCloud with 139032791 points.</span></span><br><span class="line">pcd: o3d.geometry.PointCloud = o3d.io.read_point_cloud(<span class="string">r&quot;origin.pcd&quot;</span>)</span><br><span class="line"><span class="comment"># è°ƒæ•´åˆé€‚çš„é™é‡‡æ ·ç‡</span></span><br><span class="line">pcd = pcd.voxel_down_sample(<span class="number">0.2</span>) <span class="comment">#</span></span><br><span class="line">points = np.asarray(pcd.points)</span><br><span class="line"></span><br><span class="line">xs = points[:, <span class="number">0</span>]</span><br><span class="line">ys = points[:, <span class="number">1</span>]</span><br><span class="line">zs = points[:, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">pc = pycc.ccPointCloud(xs, ys, zs)</span><br><span class="line"><span class="comment"># load</span></span><br><span class="line">cc.addToDB(pc)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p>åœ¨CCä¸­å¯¹ç‚¹äº‘è¿›è¡Œåˆ‡ç‰‡ï¼Œå¾—åˆ°æƒ³è¦çš„éƒ¨åˆ†ç‚¹äº‘çš„è£å‰ªç«‹æ–¹ä½“å‚æ•°ã€‚</p><p><img src="image-20231129175946-c305vb2.png" alt="è£å‰ªå‰"></p><p><img src="image-20231129180213-3vc0ov2.png" alt="è£å‰ªå">â€‹</p><p>å¦‚å›¾åˆ†åˆ«æ˜¯è£å‰ªå‰åçš„æ•ˆæœå›¾ï¼Œè£å‰ªåçš„çº¢æ¡†é‡Œæ˜¯è£å‰ªç«‹æ–¹ä½“çš„å‚æ•°ã€‚å¤åˆ¶ä¸‹æ¥åé¢è¦ç”¨åˆ°ã€‚</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">transformation matrix:</span><br><span class="line">0.987671196461 -0.156546846032 0.000000000000 3.480050563812</span><br><span class="line">0.156546846032 0.987671196461 0.000000000000 -3.573182106018</span><br><span class="line">0.000000000000 0.000000000000 1.000001311302 2.071678161621</span><br><span class="line">0.000000000000 0.000000000000 0.000000000000 1.000000000000</span><br><span class="line"></span><br><span class="line">é•¿å®½é«˜ï¼š</span><br><span class="line">X: 6.21198273</span><br><span class="line">Y: 13.27857590</span><br><span class="line">Z: 9.57320881</span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2><p>ç”±ä¸Šè¿°çš„å‚æ•°å¯ä»¥çŸ¥é“è¯¥ç«‹æ–¹ä½“çš„ä¸­å¿ƒç‚¹æ˜¯<code>(3.480050563812, -3.573182106018, 2.071678161621)</code>â€‹ï¼Œæ—‹è½¬çŸ©é˜µä¸º</p><script type="math/tex; mode=display">\begin{bmatrix}0.987671196461&-0.156546846032&0.000000000000\\0.156546846032&0.987671196461&0.000000000000\\0.000000000000&0.000000000000&1.000001311302\\\end{bmatrix}</script><p>é•¿å®½é«˜ä¸º<code>(6.21198273, 13.27857590, 9.57320881)</code>â€‹</p><p>å› æ­¤å¯ä»¥å†™ä»£ç ä½¿ç”¨open3dæ¥è£å‰ªåŸå§‹ç‚¹äº‘ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pcd: o3d.geometry.PointCloud = o3d.io.read_point_cloud(<span class="string">r&quot;origin.pcd&quot;</span>)</span><br><span class="line">   <span class="comment"># ç”»ä¸€ä¸ª&quot;ç›’å­&quot;ï¼Œå°†ç›’å­å¤–çš„ç‚¹äº‘å»æ‰ï¼Œ</span></span><br><span class="line">   obx = o3d.geometry.OrientedBoundingBox(</span><br><span class="line">       np.array([<span class="number">3.480050563812</span>, -<span class="number">3.573182106018</span>, <span class="number">2.071678161621</span>]), <span class="comment"># center</span></span><br><span class="line">       np.array([</span><br><span class="line">           [<span class="number">0.987671196461</span>, -<span class="number">0.156546846032</span>, <span class="number">0.000000000000</span>],</span><br><span class="line">           [<span class="number">0.156546846032</span>, <span class="number">0.987671196461</span>, <span class="number">0.000000000000</span>],</span><br><span class="line">           [<span class="number">0.000000000000</span>, <span class="number">0.000000000000</span>, <span class="number">1.000001311302</span>]</span><br><span class="line">       ]), <span class="comment"># rotation</span></span><br><span class="line">       np.array([<span class="number">6.21198273</span>, <span class="number">13.27857590</span>, <span class="number">9.57320881</span>]) <span class="comment"># width, depth, height</span></span><br><span class="line">   )</span><br><span class="line">   pcd_cropped = pcd.crop(obx) <span class="comment"># è£å‰ªåçš„ç‚¹äº‘</span></span><br><span class="line">pcd_cropped = pcd_cropped.voxel_down_sample(<span class="number">0.01</span>) <span class="comment"># ç¬¬äºŒæ¬¡é™é‡‡æ ·</span></span><br><span class="line">   o3d.io.write_point_cloud(<span class="string">&#x27;cropped.pcd&#x27;</span>, pcd_cropped) <span class="comment"># save </span></span><br></pre></td></tr></table></figure><h2 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h2><p>ç»è¿‡è¿™äº›æ­¥éª¤åï¼Œç‚¹äº‘æ•°æ®é‡ä»1.3äº¿é™åˆ°äº†840ä¸‡ã€‚å°†è¿™ä¸ª<code>cropped.pcd</code>â€‹æ‹¿åˆ°CCä¸­æ‰“å¼€ï¼Œå¹¶æµ‹é‡ã€‚ï¼ˆå›¾ç•¥ï¼‰</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡æ–¹æ³•æ—¢è§£å†³äº†å¤§è§„æ¨¡ç‚¹äº‘æ•°æ®åŠ è½½å¡æ­»ã€æ“ä½œå›°éš¾çš„é—®é¢˜ï¼Œåˆèƒ½ç²¾ç¡®å¾—åˆ°è®¡ç®—ç»“æœã€‚</p><p>ä¸è¿‡æµç¨‹å¯ä»¥å†ä¼˜åŒ–ï¼Œæ›´è‡ªåŠ¨åŒ–ä¸€äº›ã€‚</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><p>æ— </p>]]></content>
      
      
      <categories>
          
          <category> ç‚¹äº‘æ•°æ®å¤„ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CloudCompare </tag>
            
            <tag> Point Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CloudCompareå¸¸ç”¨æ“ä½œåŠPythonæ’ä»¶</title>
      <link href="/2023/11/28/CloudCompare%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%8F%8APython%E6%8F%92%E4%BB%B6/"/>
      <url>/2023/11/28/CloudCompare%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%8F%8APython%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote><p>æœ€è¿‘åœ¨åšç‚¹äº‘å¤„ç†ç›¸å…³çš„å·¥ä½œï¼Œè¿™é‡Œæ‰¾åˆ°äº†ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å¼€æºè½¯ä»¶CloudCompareï¼ˆä¸‹ç§°CCï¼‰ã€‚è¿™é‡Œå¯¹æˆ‘çš„å¸¸ç”¨æ“ä½œè¿›è¡Œæ€»ç»“ï¼Œå¹¶ä»‹ç»CCçš„Pythonæ’ä»¶ï¼Œè¯¥æ’ä»¶å¯ä»¥å®ç°è‡ªå®šä¹‰çš„ç‚¹äº‘æ“ä½œå®ç°ï¼Œæå¤§åœ°æ‰©å±•äº†CCçš„åŠŸèƒ½ã€‚</p></blockquote><h1 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h1><h2 id="ç‚¹äº‘æŒ‰é«˜ç¨‹èµ‹è‰²"><a href="#ç‚¹äº‘æŒ‰é«˜ç¨‹èµ‹è‰²" class="headerlink" title="ç‚¹äº‘æŒ‰é«˜ç¨‹èµ‹è‰²"></a>ç‚¹äº‘æŒ‰é«˜ç¨‹èµ‹è‰²</h2><p>æ‰“å¼€çš„ç‚¹äº‘æ²¡æœ‰é¢œè‰²ï¼Œå¾ˆéš¾çœ‹ä¸”å¾ˆéš¾æ“ä½œï¼Œä¸ºäº†è®©ç‚¹äº‘æ›´æœ‰ç«‹ä½“æ„Ÿï¼Œå¯ä»¥æŒ‰é«˜ç¨‹å¯¹ç‚¹äº‘è¿›è¡Œèµ‹è‰²ã€‚</p><p><code>Edit -&gt; Colors -&gt; Height Ramp</code></p><p><img src="wps1-20231128113644-3f440qp.jpg" alt="img"></p><p>CCä¹Ÿå¯ä»¥æŒ‰ç…§å…¶ä»–è½´è¿›è¡Œèµ‹è‰²</p><p><code>Edit -&gt; Scalar fields -&gt; export coordinate to SF</code>ï¼Œ é€‰æ‹©x/y/zè½´</p><p><img src="wps2-20231128113644-ecarnyw.jpg" alt="img"></p><p><img src="wps3-20231128113644-ibdm0ik.jpg" alt="img"></p><h2 id="ä½¿ç”¨å¤šè¾¹å½¢å¯¹ç‚¹äº‘è£å‰ª"><a href="#ä½¿ç”¨å¤šè¾¹å½¢å¯¹ç‚¹äº‘è£å‰ª" class="headerlink" title="ä½¿ç”¨å¤šè¾¹å½¢å¯¹ç‚¹äº‘è£å‰ª"></a>ä½¿ç”¨å¤šè¾¹å½¢å¯¹ç‚¹äº‘è£å‰ª</h2><p><a href="https://blog.csdn.net/qq_32867925/article/details/124187166">https://blog.csdn.net/qq_32867925/article/details/124187166</a></p><h2 id="è®¡ç®—ç‚¹äº‘ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»"><a href="#è®¡ç®—ç‚¹äº‘ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»" class="headerlink" title="è®¡ç®—ç‚¹äº‘ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»"></a>è®¡ç®—ç‚¹äº‘ä¸­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»</h2><p><a href="https://blog.csdn.net/qq_36686437/article/details/122224036">https://blog.csdn.net/qq_36686437/article/details/122224036</a></p><h2 id="ä¸‹é‡‡æ ·"><a href="#ä¸‹é‡‡æ ·" class="headerlink" title="ä¸‹é‡‡æ ·"></a>ä¸‹é‡‡æ ·</h2><p><a href="https://blog.csdn.net/qq_27353621/article/details/124008810">https://blog.csdn.net/qq_27353621/article/details/124008810</a></p><h2 id="ç»Ÿè®¡æ»¤æ³¢"><a href="#ç»Ÿè®¡æ»¤æ³¢" class="headerlink" title="ç»Ÿè®¡æ»¤æ³¢"></a>ç»Ÿè®¡æ»¤æ³¢</h2><p><a href="https://blog.csdn.net/qq_36686437/article/details/120011047">https://blog.csdn.net/qq_36686437/article/details/120011047</a></p><p>CCå¥½åƒæ²¡æœ‰å®ç°åŠå¾„æ»¤æ³¢ï¼Œéœ€è¦è‡ªè¡Œå®ç°</p><h2 id="è®¡ç®—ä½“ç§¯"><a href="#è®¡ç®—ä½“ç§¯" class="headerlink" title="è®¡ç®—ä½“ç§¯"></a>è®¡ç®—ä½“ç§¯</h2><p><a href="https://www.cnblogs.com/codeAndlearn/p/12317673.html">https://www.cnblogs.com/codeAndlearn/p/12317673.html</a></p><p>CCè®¡ç®—çš„å¹¶éæ˜¯ç‚¹äº‘çš„å‡¸åŒ…ä½“ç§¯ï¼ŒCCå¥½åƒæ²¡æœ‰å®ç°å‡¸åŒ…ä½“ç§¯è®¡ç®—ï¼Œéœ€è¦è‡ªè¡Œå®ç°</p><h2 id="åˆ›å»ºçƒå¹¶ç§»åŠ¨ï¼Œè®¡ç®—çƒå’Œçƒä¹‹é—´çš„è·ç¦»"><a href="#åˆ›å»ºçƒå¹¶ç§»åŠ¨ï¼Œè®¡ç®—çƒå’Œçƒä¹‹é—´çš„è·ç¦»" class="headerlink" title="åˆ›å»ºçƒå¹¶ç§»åŠ¨ï¼Œè®¡ç®—çƒå’Œçƒä¹‹é—´çš„è·ç¦»"></a>åˆ›å»ºçƒå¹¶ç§»åŠ¨ï¼Œè®¡ç®—çƒå’Œçƒä¹‹é—´çš„è·ç¦»</h2><p>æœ‰æ—¶éœ€è¦è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œä½†æ˜¯è¿™ä¸¤ç‚¹è™½ç„¶ä»£è¡¨ç‚¹äº‘ä½†å¹¶ä¸åœ¨ç‚¹äº‘é›†åˆä¸­ï¼Œéœ€è¦è‡ªå®šä¹‰ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸¤ä¸ªçƒï¼Œç„¶åå°†å®ƒä»¬æ‹–åŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œç„¶åå†è®¡ç®—è·ç¦»ã€‚</p><p>é¦–å…ˆï¼Œåˆ›å»ºçƒ</p><p><code>File -&gt; Primitive Factory</code>ï¼Œé€‰æ‹©sphereï¼Œç¡®å®šä½ç½®å’ŒåŠå¾„</p><p><img src="wps4-20231128113644-n938rmx.jpg?lastModify=1701152207" alt="img"></p><p>ç„¶åæ‹–åŠ¨çƒï¼šé€‰ä¸­çƒï¼Œå¹¶ç‚¹é€‰ä¸‹å›¾å›¾æ ‡ã€‚é¼ æ ‡å³é”®æ‹–åŠ¨ã€‚</p><p><img src="wps5-20231128113644-mbw49ys.jpg" alt="img"></p><p>å°†ä¸¤ä¸ªçƒæ‹–åŠ¨åˆ°åˆé€‚çš„ä½ç½®ï¼Œè®¡ç®—è·ç¦»</p><p><img src="wps6-20231128113644-oc6tpfo.jpg?lastModify=1701152207" alt="img"></p><h2 id="æ›´å¤šæ“ä½œ"><a href="#æ›´å¤šæ“ä½œ" class="headerlink" title="æ›´å¤šæ“ä½œ"></a>æ›´å¤šæ“ä½œ</h2><p>è¿™é‡Œæœ‰äººæ€»ç»“äº†CCçš„æ“ä½œï¼Œéå¸¸å…¨é¢ã€‚</p><p><a href="https://blog.csdn.net/qq_36686437/article/details/120100839">https://blog.csdn.net/qq_36686437/article/details/120100839</a></p><h1 id="CC-Pythonæ’ä»¶"><a href="#CC-Pythonæ’ä»¶" class="headerlink" title="CC-Pythonæ’ä»¶"></a>CC-Pythonæ’ä»¶</h1><h2 id="å‰ç½®æ¡ä»¶-Win10"><a href="#å‰ç½®æ¡ä»¶-Win10" class="headerlink" title="å‰ç½®æ¡ä»¶(Win10)"></a>å‰ç½®æ¡ä»¶(Win10)</h2><p>ä½¿ç”¨è¯¥æ’ä»¶éœ€è¦å®‰è£…æœ€æ–°ç‰ˆçš„CCï¼Œæˆ‘å®‰è£…çš„ç‰ˆæœ¬æ˜¯2.13</p><p><img src="image-20231128114621-bo1kz5e.png" alt="image"></p><p>åœ¨å®‰è£…æ—¶ï¼Œè®°å¾—å‹¾é€‰</p><p><img src="image-20231128114706-bwwrkfk.png" alt="image"></p><blockquote><p>Windowsæ˜¯ç›´æ¥å¸¦æœ‰è¿™ä¸ªæ’ä»¶çš„ï¼Œè€ŒMacOSä¸‹å®‰è£…è¯¥æ’ä»¶éœ€è¦è‡ªå·±å»ç¼–è¯‘æ’ä»¶ä»£ç å¹¶å®‰è£…ã€‚</p><p>è¿™æ˜¯æ’ä»¶ä»£ç çš„æ–‡æ¡£ï¼š<a href="https://tmontaigu.github.io/CloudCompare-PythonPlugin/">https://tmontaigu.github.io/CloudCompare-PythonPlugin/</a></p><p>åŒ…æ‹¬å¦‚ä½•ç¼–è¯‘æºç &amp;Useage</p></blockquote><p>å®‰è£…å®Œæˆåï¼Œè®°å¾—æ›´æ–°ä¸€ä¸‹pipï¼š</p><p>è¿›å…¥å®‰è£…ç›®å½•ä¸‹<code>CloudCompare/plugins/Python</code>ï¼Œæ‰§è¡Œ<code>.\python.exe -m pip install --upgrade pip</code></p><h2 id="ä½¿ç”¨æ’ä»¶ç¤ºä¾‹"><a href="#ä½¿ç”¨æ’ä»¶ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨æ’ä»¶ç¤ºä¾‹"></a>ä½¿ç”¨æ’ä»¶ç¤ºä¾‹</h2><p>æœ‰äº›ç‚¹äº‘æ–‡ä»¶å·¨å¤§ï¼ŒåŠ è½½è¿›æ¥ä¼šå¾ˆæ…¢ï¼Œæˆ‘è¿™é‡Œå…ˆå°†ç‚¹äº‘é™é‡‡æ ·ä¹‹åæ‰æŠŠä»–åŠ è½½åˆ°CCä¸­ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘éœ€è¦å®‰è£…open3d</p><p>æ‰“å¼€Python Managerï¼š <code>Plugins -&gt; Python Plugins -&gt; Package Manager</code></p><p><img src="image-20231128120020-x27frq0.png" alt="image">ç‚¹å‡»installï¼Œè¾“å…¥open3d è¿›è¡Œå®‰è£…ã€‚</p><p><img src="image-20231128120130-6obtvph.png" alt="image"></p><p>æ‰“å¼€Show REPLï¼š <code>Plugins -&gt; Python Plugins -&gt; Show REPL</code></p><p>çº¢æ¡†è¾“å…¥æŒ‡ä»¤</p><p><img src="image-20231128120448-c9cul9e.png" alt="image"></p><p>ä»¥ä¸‹æ˜¯æˆ‘è¾“å…¥çš„æŒ‡ä»¤</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pycc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> cccorelib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cc = pycc.GetInstance()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> open3d <span class="keyword">as</span> o3d</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pcd = o3d.io.read_point_cloud(<span class="string">&#x27;C:/Users/Administrator/Desktop/merged_room.pcd&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pcd = pcd.voxel_down_sample(<span class="number">0.5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>points = np.asarray(pcd.points)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>xs = points[:, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ys = points[:, <span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>zs = points[:, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pc = pycc.ccPointCloud(xs, ys, zs)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cc.addToDB(pc)</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å¯ä»¥çœ‹åˆ°CCåœºæ™¯ä¸­å·²ç»åŠ è½½äº†ç‚¹äº‘</p><p><img src="image-20231128120849-90hz4hw.png" alt="image"></p><p>æˆ‘ä»¬å¯ä»¥ç”¨æ’ä»¶å®ç°å‰é¢CCæœªå®ç°çš„è¯¸å¤šåŠŸèƒ½ã€‚æ›´å¤šç”¨æ³•å¯ä»¥å‚è€ƒå‰æ–‡æåˆ°çš„æ’ä»¶çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1>]]></content>
      
      
      <categories>
          
          <category> ç‚¹äº‘æ•°æ®å¤„ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CloudCompare </tag>
            
            <tag> Point Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPUå¯†é›†å‹ä»»åŠ¡çš„åç«¯å®ç°æ–¹æ³•æ¯”è¾ƒæ€»ç»“</title>
      <link href="/2023/10/19/CPU%E5%AF%86%E9%9B%86%E5%9E%8B%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95%E6%AF%94%E8%BE%83%E6%80%BB%E7%BB%93/"/>
      <url>/2023/10/19/CPU%E5%AF%86%E9%9B%86%E5%9E%8B%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95%E6%AF%94%E8%BE%83%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>å…ˆä»‹ç»ä¸‹æ•´ä½“ç³»ç»Ÿæ¡†æ¶ï¼Œç³»ç»Ÿåˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼ŒäºŒè€…é€šè¿‡websocketåè®®è¿›è¡Œé€šä¿¡ã€‚é€šè¿‡è¯·æ±‚æ•°æ®ä¸­çš„codeå­—æ®µæ¥å“åº”ä¸åŒçš„æ“ä½œã€‚</p><p><img src="å‰åç«¯é€šä¿¡.png" alt="å‰åç«¯é€šä¿¡"></p><p><img src="æ—¶åºå›¾.png" alt="æ—¶åºå›¾"></p><p><img src="åç«¯å¤„ç†ä¸€æ¬¡è¯·æ±‚çš„æµç¨‹å›¾.png" alt="åç«¯å¤„ç†ä¸€æ¬¡è¯·æ±‚çš„æµç¨‹å›¾"></p><p>ä»¥ä¸Šä»‹ç»æ•´ä½“çš„è½¯ä»¶é€»è¾‘ã€‚æ­¤å¤–ï¼Œåç«¯ä½¿ç”¨Pythonçš„asyncioæ¥å®ç°å¼‚æ­¥ç¼–ç¨‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå®ç°å°†æ•°æ®æ’å…¥åˆ°æ•°æ®åº“å¹¶å°†æ•°æ®å‘é€åˆ°å‰ç«¯ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">insert_data2db(data)</span><br><span class="line">ws_send(websocket, data)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç¨‹åºæ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚å¼‚æ­¥ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">await</span> insert_data2db(data)</span><br><span class="line"><span class="keyword">await</span> ws_send(websocket, data)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œç¨‹åºä¸ä¼šç­‰å¾…insert_data2dbå®Œæˆï¼Œç›´æ¥ç»§ç»­æ‰§è¡Œws_sendæ–¹æ³•ã€‚ä¸¤è€…åŒºåˆ«å¦‚ä¸‹è‰å›¾ï¼š</p><p><img src="åŒæ­¥å¼‚æ­¥.png" alt="åŒæ­¥å¼‚æ­¥"></p><p>è¿™ç§å¼‚æ­¥çš„æ–¹å¼åœ¨IO-Bound Taskä¸­å¥½ç”¨ã€‚ä½†æ˜¯å¯¹äºCPU-Bound Taskä¼˜åŒ–æ•ˆæœä¸å¤§ï¼ˆç”šè‡³ä¼šæœ‰åæ•ˆæœï¼‰</p><p>æ­¤å¤–ï¼Œå¦‚æœåä¸€ä¸ªæ“ä½œéœ€è¦ç”¨åˆ°å‰ä¸€ä¸ªæ“ä½œçš„ç»“æœï¼Œè¿™ä¸ªä»£ç å®é™…æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚</p><h1 id="ä¸»è¦ä»£ç ç»“æ„ï¼ˆä¼ªï¼‰"><a href="#ä¸»è¦ä»£ç ç»“æ„ï¼ˆä¼ªï¼‰" class="headerlink" title="ä¸»è¦ä»£ç ç»“æ„ï¼ˆä¼ªï¼‰"></a>ä¸»è¦ä»£ç ç»“æ„ï¼ˆä¼ªï¼‰</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">ws_send</span>(<span class="params">websocket, data</span>)</span><br><span class="line"><span class="keyword">await</span> websocket.send(data)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯é€šè¿‡websocketè¿æ¥å°†æ•°æ®å‘é€å›å‰ç«¯çš„é€šç”¨æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">dealPointCloudData</span>(<span class="params">websocket, request_data</span>):</span><br><span class="line">code = request_data[<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> code == <span class="number">0</span>:</span><br><span class="line"><span class="comment"># å¿ƒè·³</span></span><br><span class="line"><span class="keyword">await</span> ws_send(websocket, response_heartbeat_data)</span><br><span class="line"><span class="keyword">elif</span> code == <span class="number">1</span>:</span><br><span class="line"><span class="keyword">await</span> func1()</span><br><span class="line"><span class="keyword">elif</span> code == <span class="number">2</span>:</span><br><span class="line"><span class="keyword">await</span> func2(websocket, request_data)</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œæ˜¯åˆ†å‘è¯·æ±‚çš„æ–¹æ³•dealPointCloudDataï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œwebsocketè¿æ¥å’Œrequest_dataå‰ç«¯å‘æ¥çš„æ•°æ®ã€‚</p><p>æœ€åï¼Œä¸»ç¨‹åºä¸­ä¼šèµ·ä¸€ä¸ªwebsocketæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šå°†è¿æ¥å‘é€åˆ°dispatchæ–¹æ³•ï¼Œdispatchæ–¹æ³•ä¼šè½®è¯¢æ¯ä¸€ä¸ªwebsocketè¿æ¥çš„æ¶ˆæ¯ï¼Œå¹¶äº¤ç»™dealPointCloudDataå¤„ç†ã€‚ä¼ªä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">server = websockets.serve(dispatch, ip, port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">websocket_conn</span>):</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">for</span> message <span class="keyword">in</span> websocket:  <span class="comment"># recv message from a websocket client.</span></span><br><span class="line">msg_dict = parse_json(message)</span><br><span class="line"><span class="keyword">await</span> dealPointCloudData(websocket, msg_dict)</span><br></pre></td></tr></table></figure><h1 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h1><p>ç›®å‰ï¼Œå½“code==2æ—¶ï¼Œéœ€è¦å¤„ç†ä¸€ä¸ªè®¡ç®—ä»»åŠ¡ã€‚request_dataå‚æ•°ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹è·¯å¾„ï¼Œè¯¥è®¡ç®—ä»»åŠ¡æ˜¯è¯»å–æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å†…å®¹ï¼Œå°†æ–‡ä»¶å†…å®¹è¿›è¡Œmergeï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ã€‚æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="è®¡ç®—æµç¨‹.png" alt="è®¡ç®—æµç¨‹"></p><p>ä¼ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">websocket, request_data</span>):</span><br><span class="line">total = init()</span><br><span class="line">file_list = get_file_list(request_data) <span class="comment"># ä»request_dataä¸­å–å‡ºæ–‡ä»¶å¤¹ï¼Œ</span></span><br><span class="line"><span class="keyword">for</span> i, file_path <span class="keyword">in</span> <span class="built_in">enumerate</span>(file_list):</span><br><span class="line">obj = read_file_as_obj(file_path)</span><br><span class="line">total = merge(total, obj)</span><br><span class="line"><span class="keyword">await</span> ws_send(websocket, <span class="string">&#x27;è¿›åº¦ï¼š...&#x27;</span>) <span class="comment"># æœ¬æ¬¡mergeç»“æŸåå‘å‰ç«¯å‘é€è¿›åº¦</span></span><br><span class="line">save2file(total)</span><br><span class="line"><span class="keyword">await</span> ws_send(websocket, finish_flag)</span><br></pre></td></tr></table></figure><p>ç”±äºfunc2ä¸»è¦æ—¶é—´èŠ±è´¹åœ¨ä¸€ä¸ªforå¾ªç¯ä¸­ï¼Œ æ¯æ¬¡forå¾ªç¯ä¸­éƒ½æœ‰ä¸€ä¸ªè€—æ—¶çš„è®¡ç®—ä»»åŠ¡mergeã€‚mergeæ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•</p><p>æ‰€ä»¥func2ä¸­è™½ç„¶ä½¿ç”¨äº†awaitå¼‚æ­¥ç¼–ç¨‹ï¼Œä½†æ•´ä½“æ¥çœ‹ï¼Œè¿˜æ˜¯ä¸ªåŒæ­¥å¤„ç†ç¨‹åºã€‚</p><p>è¿™å°±å¯¼è‡´ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå°±æ˜¯å½“å•çº¿ç¨‹æ‰§è¡Œfunc2è¿›è¡Œé•¿æ—¶é—´è®¡ç®—çš„æ—¶å€™ï¼Œæ–°çš„å¿ƒè·³åŒ…è¯·æ±‚-å“åº”ä¼šè¢«é˜»å¡æ‰ã€‚å¦‚å›¾</p><p><img src="å¿ƒè·³å“åº”é˜»å¡.png" alt="å¿ƒè·³å“åº”é˜»å¡"></p><p>å¦‚æœé˜»å¡çš„æ—¶é—´è¿‡é•¿ï¼Œå‰åç«¯å°±ä¼šå¤±å»æœ¬æ¬¡è¿æ¥ã€‚</p><p>é’ˆå¯¹è¯¥é—®é¢˜ï¼Œæˆ‘å°è¯•äº†å‡ ç§è§£å†³æ–¹æ³•ã€‚</p><h1 id="å°è¯•"><a href="#å°è¯•" class="headerlink" title="å°è¯•"></a>å°è¯•</h1><h2 id="1-å¼€å¯çº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼ˆmergeï¼‰"><a href="#1-å¼€å¯çº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼ˆmergeï¼‰" class="headerlink" title="1 å¼€å¯çº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼ˆmergeï¼‰"></a>1 å¼€å¯çº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼ˆmergeï¼‰</h2><p>func2å‡½æ•°ä¸­å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼Œå¹¶è¿”å›æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">websocket, request_data</span>):</span><br><span class="line">    t = DealPcdsThread(websocket, other_params)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure><p>DealPcdsThreadçº¿ç¨‹ç±»çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DealPcdsThread</span>(threading.Thread):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¤„ç†pcdæ–‡ä»¶å¤¹çš„çº¿ç¨‹</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, websocket, request_data</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        file_list = get_file_list(request_data)</span><br><span class="line">        self.websocket = websocket</span><br><span class="line">        self.file_list = file_list </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        asyncio.run(self.merge()) <span class="comment"># åœ¨çº¿ç¨‹ä¸­å¼€å¯æ–°çš„äº‹ä»¶å¾ªç¯æ¥æ‰§è¡Œåç¨‹å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">self</span>):</span><br><span class="line">        total = init()</span><br><span class="line">file_list = get_file_list(request_data) <span class="comment"># ä»request_dataä¸­å–å‡ºæ–‡ä»¶å¤¹ï¼Œ</span></span><br><span class="line"><span class="keyword">for</span> i, file_path <span class="keyword">in</span> <span class="built_in">enumerate</span>(file_list):</span><br><span class="line">obj = read_file_as_obj(file_path)</span><br><span class="line">total = merge(total, obj)</span><br><span class="line">log.info(<span class="string">f&#x27;...&#x27;</span>)</span><br><span class="line"><span class="keyword">await</span> ws_send(websocket, <span class="string">&#x27;è¿›åº¦ï¼š...&#x27;</span>) <span class="comment"># æœ¬æ¬¡mergeç»“æŸåå‘å‰ç«¯å‘é€è¿›åº¦</span></span><br><span class="line">save2file(total)</span><br><span class="line"><span class="keyword">await</span> ws_send(websocket, finish_flag)</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—å¦‚å›¾ï¼š</p><p><img src="æ§åˆ¶å°æ—¥å¿—.png" alt="æ§åˆ¶å°æ—¥å¿—"></p><p>è¿™è¯´æ˜åœ¨å¤„ç†è®¡ç®—ä»»åŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹æ²¡æœ‰é˜»å¡ï¼Œå¿ƒè·³åŒ…èƒ½å¤Ÿæ­£å¸¸è¿”å›ï¼Œå’Œé¢„æœŸä¸€è‡´ã€‚</p><p>æœ¬æ¥é—®é¢˜åˆ°è¿™é‡Œå°±è§£å†³äº†ï¼Œä½†æ˜¯åœ¨å®é™…æµ‹è¯•ä¸­åˆå‘ç°äº†å…¶ä»–é—®é¢˜ã€‚</p><h3 id="é—®é¢˜1-å‰ç«¯æ˜¾ç¤ºä¸æµç•…"><a href="#é—®é¢˜1-å‰ç«¯æ˜¾ç¤ºä¸æµç•…" class="headerlink" title="é—®é¢˜1: å‰ç«¯æ˜¾ç¤ºä¸æµç•…"></a>é—®é¢˜1: å‰ç«¯æ˜¾ç¤ºä¸æµç•…</h3><p><img src="åˆæˆè¿›åº¦æ¡.gif" alt="åˆæˆè¿›åº¦æ¡"></p><p>å¦‚å›¾å¯ä»¥çœ‹åˆ°è¿›åº¦æ¡å¡åœ¨2.21%åï¼Œè¿‡äº†å‡ ç§’éå¸¸è¿…é€Ÿçš„è¹¦åˆ°äº†40.79%ã€‚ä½†æ˜¯åå°çš„æ—¥å¿—æ‰“å°æ˜¯â€œæµç•…çš„â€ï¼Œå³æ²¡æœ‰ç±»ä¼¼çš„åœé¡¿ã€‚</p><p>çŒœæµ‹å¯èƒ½æ˜¯å’Œå¼‚æ­¥æœ‰å…³ï¼Œæ¯•ç«Ÿåœ¨<code>await ws_send()</code>â€‹åç›´æ¥è¿”å›äº†ï¼Œäº‹ä»¶å¾ªç¯é€‰æ‹©äº†æŸä¸ªæ—¶é—´ç‚¹ç»Ÿä¸€å‘é€è¿™äº›è¯·æ±‚ã€‚</p><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯è®¡ç®—çº¿ç¨‹å¤±å»äº†CPUçš„æ§åˆ¶æƒå¯¼è‡´çš„ï¼Œåæ¥ä¸€æƒ³å¯èƒ½æ€§ä¸å¤§ï¼Œä¸€æ–¹é¢å ç”¨æ—¶é—´åº”è¯¥åœ¨å¾ˆçŸ­çš„æ—¶é—´ï¼Œæˆ‘åº”è¯¥æ„Ÿè§‰ä¸åˆ°ï¼Œå¦ä¸€æ–¹é¢ï¼Œåå°æ—¥å¿—æ‰“å°æµç•…ã€‚</p><h3 id="é—®é¢˜2-åå°æŠ¥é”™"><a href="#é—®é¢˜2-åå°æŠ¥é”™" class="headerlink" title="é—®é¢˜2: åå°æŠ¥é”™"></a>é—®é¢˜2: åå°æŠ¥é”™</h3><p>åœ¨æ‰§è¡Œè®¡ç®—çš„è¿‡ç¨‹ï¼Œå‡ºç°æŠ¥é”™å¦‚ä¸‹å›¾</p><p><img src="æŠ¥é”™.png" alt="æŠ¥é”™"></p><p>è¯¥æŠ¥é”™æˆ‘æœç´¢äº†å¾ˆä¹…ä¹Ÿæ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œåœ¨åŠ ä¸Šè¯¥æŠ¥é”™ä¸ä¼šå¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼Œä¹Ÿä¸ä¼šæœ‰å…¶ä»–å½±å“ã€‚æ‰€ä»¥æç½®äº†ã€‚</p><p>è¯¥æ–¹æ¡ˆæ˜¯ç›®å‰æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä¹Ÿå°è¯•äº†å¾ˆå¤šå…¶ä»–è§£å†³æ–¹æ¡ˆã€‚è¿™é‡Œä¹Ÿä¸€å¹¶åˆ—å‡ºã€‚</p><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>æ–¹æ¡ˆ2ä¸æ–¹æ¡ˆ1ç›¸åŒï¼ŒåŒæ ·æ˜¯å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œåˆå¹¶ï¼Œåªæ˜¯æ–°çš„äº‹ä»¶å¾ªç¯æœ‰ä¸»çº¿ç¨‹åˆ›å»ºï¼Œè€Œéåœ¨æ–°çº¿ç¨‹ä¸­åˆ›å»ºã€‚æµ‹è¯•è¿™ä¸¤ç§æ–¹æ³•è¡¨ç°ä¸€è‡´ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">websocket, request_data</span>):</span><br><span class="line">new_loop: AbstractEventLoop = asyncio.new_event_loop()</span><br><span class="line">    <span class="comment"># å®šä¹‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_loop</span>(<span class="params">loop: AbstractEventLoop</span>):</span><br><span class="line">        asyncio.set_event_loop(loop)</span><br><span class="line">        loop.run_forever()</span><br><span class="line">    <span class="comment">#é€šè¿‡å½“å‰çº¿ç¨‹å¼€å¯æ–°çš„çº¿ç¨‹å¯åŠ¨äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    t = threading.Thread(target=start_loop, args= (new_loop,))</span><br><span class="line">    t.start()</span><br><span class="line">    asyncio.run_coroutine_threadsafe(</span><br><span class="line">        DealPcdsThread(websocket, request_data).merge(),</span><br><span class="line">        new_loop</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>ä½¿ç”¨asyncio.run_in_executorå°†ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">websocket, request_data</span>):</span><br><span class="line"><span class="comment"># 4.4 ä½¿ç”¨asyncio.run_in_executorå°†ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œã€‚æ•ˆæœå’Œ4.2ä¸€æ ·</span></span><br><span class="line">loop: AbstractEventLoop = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">await</span> loop.run_in_executor(<span class="literal">None</span>, DealPcdsThread(websocket, request_data).run)</span><br><span class="line"><span class="comment"># await asyncio.to_thread(DealPcdsNoThread.run, loop) # new py3.9</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•è¯´æ˜ï¼Œè¿™ç§æ–¹æ³•ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¿ƒè·³åŒ…æ— æ³•åŠæ—¶å“åº”ã€‚ã€‚</p><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>ä¸ºäº†åŠ å¿«è®¡ç®—çš„é€Ÿåº¦ï¼Œæƒ³åˆ°å°è¯•å¼€å¯æ–°çš„è¿›ç¨‹æ‰§è¡Œè®¡ç®—ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Process(target=merge, args=(websocket, request_data)).start()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æƒ³åˆ°ï¼Œè¿›ç¨‹ä¹‹é—´ä¼ é€’çš„Pythonå¯¹è±¡å¿…é¡»å¯ä»¥è¢«åºåˆ—åŒ–ï¼ˆpickleï¼‰æ‰å¯ä»¥ï¼Œè€Œwebsocketå¯¹è±¡ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•æ— æ•ˆã€‚</p><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>æœ€åä¸€ç§ï¼ŒåŒæ ·ä¹Ÿæ˜¯å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä¸è¿‡targetä¼ å…¥çš„æ˜¯å¼‚æ­¥è®¡ç®—æ–¹æ³•ï¼ˆè™½ç„¶æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯å†…éƒ¨ç¡®æ˜¯åŒæ­¥çš„ã€‚ã€‚ã€‚ï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">threading.Thread(target=<span class="keyword">await</span> DealPcdsThread(websocket, request_data).merge()).start()</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ä¹Ÿä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>åœ¨å®éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°å‡¡æ˜¯å¼€å¯æ–°çº¿ç¨‹å¹¶ä¸”æ–°çº¿ç¨‹ä¸­ä½¿ç”¨æ–°çš„äº‹ä»¶å¾ªç¯æ¥å¤„ç†å‘é€è¯·æ±‚éƒ½å¯ä»¥è®©ä¸»çº¿ç¨‹ä¸é˜»å¡ã€‚ä¾‹å¦‚æ–¹æ¡ˆ1ã€2</p><p>ä½†æ˜¯å¦‚æœåªå¼€æ–°çº¿ç¨‹ï¼Œè€Œäº‹ä»¶å¾ªç¯ä¾ç„¶ä½¿ç”¨ä¸»çº¿ç¨‹loopçš„è¯ï¼Œä¸èƒ½è§£å†³ä¸»çº¿ç¨‹é˜»å¡çš„é—®é¢˜ã€‚ä¾‹å¦‚æ–¹æ¡ˆ3ã€5</p><h1 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h1><ol><li>ç”¨<code>concurrent.futures.ThreadPoolExecutor</code>â€‹æ›¿æ¢threadingã€‚<code>concurrent.futures.ThreadPoolExecutor</code>â€‹æä¾›äº†ä¸€ä¸ªé«˜å±‚çº§æ¥å£ç”¨æ¥å‘åå°çº¿ç¨‹æ¨é€ä»»åŠ¡è€Œä¸ä¼šé˜»å¡è°ƒç”¨æ–¹çº¿ç¨‹çš„æ‰§è¡Œï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨éœ€è¦æ—¶è·å–ä»»åŠ¡çš„ç»“æœã€‚</li><li>å…ˆè¯»å‡ºæ‰€æœ‰çš„æ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œå†å¼€å¯å¤šè¿›ç¨‹å¯¹è¿™ä¸ªæ•°ç»„çš„ç‚¹äº‘æ•°æ®è¿›è¡Œreduceã€‚åˆ©ç”¨å¤šæ ¸åŠ å¿«åˆå¹¶é€Ÿåº¦ï¼Ÿ</li><li>å…¶å®æˆ‘è§‰å¾—æœ€å¥½çš„æ–¹å¼æ˜¯ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œçº¿ç¨‹ç±»ä¸­æœ‰ä¸€ä¸ªæŒ‡ç¤ºè¿›åº¦çš„å˜é‡ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªåç¨‹æ¯éš”Xç§’è·å–ä¸€æ¬¡è¿›åº¦å¹¶å°†å…¶å‘é€ç»™å‰ç«¯ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•åšåˆ°å®æ—¶ã€‚</li><li>ä»€ä¹ˆæ—¶å€™Pythonå¯ä»¥å»æ‰GILçš„é™åˆ¶ï¼Œè®©è¿™ç§è®¡ç®—å¯†é›†å‹ä»»åŠ¡èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸CPUã€‚ã€‚ã€‚ğŸ˜¢</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> asyncio </tag>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python é¢è¯•é¢˜</title>
      <link href="/2023/10/07/Python-%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2023/10/07/Python-%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è®°ä¸€æ¬¡Pythoné¢è¯•è¢«é—®åˆ°çš„é¢˜</p></blockquote><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=&#123;<span class="number">1</span>:<span class="number">2</span>,<span class="number">2</span>:<span class="number">3</span>&#125;</span><br><span class="line">b=a</span><br><span class="line">b.pop(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure><p>é—®ï¼šaçš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç­”ï¼š<code>&#123;2:3&#125;</code>â€‹</p><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b=[[]]*<span class="number">2</span>; b[<span class="number">0</span>].append(<span class="number">1</span>); <span class="built_in">print</span>(b)</span><br><span class="line">a=[]; b=[a]*<span class="number">2</span>; b[<span class="number">0</span>].append(<span class="number">1</span>); <span class="built_in">print</span>(b)</span><br><span class="line">a=[]; b=[a, a]; b[<span class="number">0</span>].append(<span class="number">1</span>); <span class="built_in">print</span>(b)</span><br><span class="line">b=[[], []]; b[<span class="number">0</span>].append(<span class="number">1</span>); <span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure><p>é—®ï¼šè¿™å››ä¸ª<code>b</code>â€‹çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç­”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[[1], [1]]</span><br><span class="line">[[1], [1]]</span><br><span class="line">[[1], [1]]</span><br><span class="line">[[1], []]</span><br></pre></td></tr></table></figure><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a=&quot;123&quot;; b=a; b=b[:-1]; </span><br><span class="line">print(a, b)</span><br></pre></td></tr></table></figure><p>é—®ï¼šè¾“å‡ºï¼Ÿ</p><p>ç­”ï¼š<code>123 12</code>â€‹</p><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>æ¯”è¾ƒä»¥ä¸‹ä¸¤æ®µä»£ç çš„æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜å¼€é”€</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resÂ = 1</span><br><span class="line">forÂ numÂ in [1,2,3,4]+[6,7,8,9]:</span><br><span class="line">Â Â Â Â resÂ *=Â num</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">importÂ itertools</span><br><span class="line">resÂ = 1</span><br><span class="line">forÂ numÂ inÂ itertools.chain([1,2,3,4], [6,7,8,9]):</span><br><span class="line">Â Â Â Â resÂ *=Â num</span><br></pre></td></tr></table></figure><p><a href="https://docs.python.org/3/library/itertools.html">https://docs.python.org/3/library/itertools.html</a></p><p>ç­”ï¼šé¦–å…ˆç¬¬ä¸€ä¸ªä»£ç éœ€è¦å°†ä¸¤ä¸ªåˆ—è¡¨å’Œå¹¶ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œç¬¬äºŒæ®µä»£ç æ˜¯ç›´æ¥éå†ä¸¤ä¸ªåˆ—è¡¨ï¼Œå…¶æ¬¡itertools.chainè¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªä»£ç çš„æ‰§è¡Œæ•ˆç‡é«˜ï¼Œå†…å­˜å¼€é”€å°ã€‚</p><h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><p>What is the difference between tuple() and list[]ï¼Ÿloop over tuple and listï¼Œwhich one is more effectiveï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if var in [&quot;xxx&quot;, &quot;yyy&quot;]:</span><br><span class="line">if var in (&quot;xxx&quot;, &quot;yyy&quot;):</span><br><span class="line">if var in &#123;&quot;xxx&quot;, &quot;yyy&quot;&#125;:</span><br></pre></td></tr></table></figure><p>Which one above is more efficitive? Note: The value after â€˜inâ€™ is a constant.</p><p>æ—¶é—´å¤æ‚åº¦ï¼štuple O(?) list O(?) set O(?)</p><p>ç­”ï¼štupleæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œlistæ˜¯å¯å˜å¯¹è±¡ã€‚ç”±äºtupleä¸å¯å˜ï¼Œæ‰€ä»¥ç”³è¯·å†…å­˜ä¸ºè¿ç»­å®šé•¿å†…å­˜ï¼Œè€Œlistç±»ä¼¼äºä¸€ä¸ªé“¾è¡¨ã€‚</p><p>æ‰€ä»¥åœ¨loopä¸­ï¼Œtuple is more effective.</p><p><code>if var in &#123;&quot;xxx&quot;, &quot;yyy&quot;&#125;</code>â€‹ is more effective. å› ä¸ºé›†åˆæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œtupleå’Œlistä¸ºO(N)</p><h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><p>Python classä¸­å˜é‡åå’Œå‡½æ•°åå‰ç¼€å•ä¸‹åˆ’çº¿å’ŒåŒä¸‹åˆ’çº¿(åç¼€æ²¡æœ‰ä¸‹åˆ’çº¿)åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼ŸFor example,</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">   def _method1(): pass   //Â What&#x27;sÂ theÂ meaningÂ ofÂ _</span><br><span class="line">   def __method2(): pass  //Â What&#x27;sÂ theÂ meaningÂ ofÂ __</span><br></pre></td></tr></table></figure><p> Whatâ€™s the difference among the concepts protected, public, and private?</p><p>ç­”ï¼šå˜é‡å‰æ²¡æœ‰ä¸‹åˆ’çº¿çš„ä¸ºpublic<br>å˜é‡å‰æœ‰å•ä¸‹åˆ’çº¿ä¸ºprotectedï¼Œè¿™ç§å˜é‡åªèƒ½åœ¨æœ¬ç±»æˆ–è€…å…¶å­ç±»ä¸­è°ƒç”¨ï¼ˆå¦‚æœä½ æƒ³åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¼šæœ‰è­¦å‘Šï¼‰<br>å˜é‡å‰æœ‰åŒä¸‹åˆ’çº¿ä¸ºprivateï¼Œè¿™ç§å˜é‡åªèƒ½åœ¨æœ¬ç±»ä¸­è°ƒç”¨ï¼ˆåœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ä¼šæŠ¥é”™ï¼‰</p><h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><p>åœ¨ç”¨mongoç­‰éå…³ç³»å‹æ•°æ®åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æŠŠè„æ•°æ®ã€ç©ºæ•°æ®å­˜è¿›æ•°æ®åº“ï¼Œé€ æˆåé¢çš„æ··ä¹±ã€‚å†™ä¸€ä¸ªå‡½æ•°(Python3)ï¼Œåˆ é™¤json dicté‡Œé¢çš„ç©ºæ•°æ®ï¼ŒåŒ…æ‹¬ç©ºdictï¼Œç©ºlistï¼Œç©ºstringï¼ŒNoneã€‚å‡è®¾è¾“å…¥çš„Python dictä»åˆæ³•jsonè¯»å–, å³keyå¿…ä¸ºstring, valueå¯ä»¥æ˜¯number/string/list/dictã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;a&quot;: [1,0,&quot;c&quot;, &#123;&quot;x&quot;:1&#125;]&#125; -&gt; &#123;&quot;a&quot;: [1,0,&quot;c&quot;, &#123;&quot;x&quot;:1&#125;]&#125;</span><br><span class="line">&#123;&quot;a&quot;:[1,None]&#125; -&gt; &#123;&quot;a&quot;: [1]&#125;</span><br><span class="line">&#123;&quot;a&quot;: &#123;&quot;a&quot;:[None, &quot;&quot;, &#123;&#125;,&#123;&quot;x&quot;:None&#125;]&#125;&#125; -&gt; None</span><br></pre></td></tr></table></figure><p>ç­”ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">clean_json</span>(<span class="params">data: (<span class="params"><span class="built_in">dict</span>,<span class="built_in">list</span>,<span class="built_in">int</span>,<span class="built_in">float</span>,<span class="built_in">str</span>,<span class="literal">None</span></span>)</span>):</span><br><span class="line">    <span class="comment"># put your code here</span></span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> data == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> data == <span class="built_in">dict</span>() <span class="keyword">or</span> data == []:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(data) == <span class="built_in">list</span>:</span><br><span class="line">        data1 = [item <span class="keyword">for</span> item <span class="keyword">in</span> data <span class="keyword">if</span> clean_json(item) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>] <span class="comment"># å¤åˆ¶ä¸€ä»½å‡ºæ¥</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data1:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> data1</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(data) == <span class="built_in">dict</span>:</span><br><span class="line">        data1 = &#123;k: clean_json(v) <span class="keyword">for</span> k, v <span class="keyword">in</span> data.items() <span class="keyword">if</span> clean_json(v) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>&#125; <span class="comment"># å¤åˆ¶ä¸€ä»½å‡ºæ¥</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data1:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> data1</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸èƒ½ç›´æ¥å¯¹åŸæ•°ç»„orå­—å…¸ä½œåˆ é™¤æ“ä½œï¼Œä¼šæŠ¥é”™ï¼</p><p>ä¾‹å¦‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">    <span class="keyword">if</span> l[i] == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">del</span> l[i] <span class="comment"># do not do this</span></span><br></pre></td></tr></table></figure><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python open3dç‚¹äº‘ç›¸å…³æ“ä½œï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
      <link href="/2023/09/16/Python-open3d%E7%82%B9%E4%BA%91%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
      <url>/2023/09/16/Python-open3d%E7%82%B9%E4%BA%91%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!pip install open3d</span><br><span class="line">!pip install scipy</span><br><span class="line"><span class="keyword">import</span> open3d <span class="keyword">as</span> o3d</span><br><span class="line"><span class="keyword">from</span> scipy.spatial.transform <span class="keyword">import</span> Rotation <span class="keyword">as</span> R</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h2 id="è¯»å’Œå†™ç‚¹äº‘æ–‡ä»¶"><a href="#è¯»å’Œå†™ç‚¹äº‘æ–‡ä»¶" class="headerlink" title="è¯»å’Œå†™ç‚¹äº‘æ–‡ä»¶"></a>è¯»å’Œå†™ç‚¹äº‘æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">point_cloud = o3d.io.read_point_cloud(file_path) <span class="comment"># æ”¯æŒçš„æ ¼å¼pcdã€ptsç­‰</span></span><br><span class="line"><span class="comment"># type(point_cloud) == open3d.cpu.pybind.geometry.PointCloud</span></span><br><span class="line"></span><br><span class="line">o3d.io.write_point_cloud(point_cloud, file_path) </span><br></pre></td></tr></table></figure><h2 id="è¯»å–ç‚¹äº‘å¯¹è±¡ä¸­ç‚¹çš„åæ ‡"><a href="#è¯»å–ç‚¹äº‘å¯¹è±¡ä¸­ç‚¹çš„åæ ‡" class="headerlink" title="è¯»å–ç‚¹äº‘å¯¹è±¡ä¸­ç‚¹çš„åæ ‡"></a>è¯»å–ç‚¹äº‘å¯¹è±¡ä¸­ç‚¹çš„åæ ‡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">np.asarray(point_cloud.points)</span><br></pre></td></tr></table></figure><h2 id="å°†ç‚¹åæ ‡èµ‹å€¼åˆ°ç‚¹äº‘å¯¹è±¡"><a href="#å°†ç‚¹åæ ‡èµ‹å€¼åˆ°ç‚¹äº‘å¯¹è±¡" class="headerlink" title="å°†ç‚¹åæ ‡èµ‹å€¼åˆ°ç‚¹äº‘å¯¹è±¡"></a>å°†ç‚¹åæ ‡èµ‹å€¼åˆ°ç‚¹äº‘å¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># points = np.array([[...]])</span></span><br><span class="line"></span><br><span class="line">point_cloud.points = o3d.utility.Vector3dVector(points)</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç‚¹äº‘å¯¹è±¡"><a href="#åˆ›å»ºç‚¹äº‘å¯¹è±¡" class="headerlink" title="åˆ›å»ºç‚¹äº‘å¯¹è±¡"></a>åˆ›å»ºç‚¹äº‘å¯¹è±¡</h2><p>åˆ›å»ºä¸€ä¸ªç©ºçš„ç‚¹äº‘å¯¹è±¡</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pc = o3d.geometry.PointCloud()</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶ç‚¹äº‘å¯¹è±¡"><a href="#åˆå¹¶ç‚¹äº‘å¯¹è±¡" class="headerlink" title="åˆå¹¶ç‚¹äº‘å¯¹è±¡"></a>åˆå¹¶ç‚¹äº‘å¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥+</span></span><br><span class="line">pc += point_cloud</span><br></pre></td></tr></table></figure><h2 id="ç‚¹äº‘å¹³ç§»"><a href="#ç‚¹äº‘å¹³ç§»" class="headerlink" title="ç‚¹äº‘å¹³ç§»"></a>ç‚¹äº‘å¹³ç§»</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">point_cloud.translate(translation)  <span class="comment"># åº”ç”¨å¹³ç§»,translation æ˜¯å¹³ç§»å‘é‡</span></span><br></pre></td></tr></table></figure><h2 id="ç‚¹äº‘æ—‹è½¬"><a href="#ç‚¹äº‘æ—‹è½¬" class="headerlink" title="ç‚¹äº‘æ—‹è½¬"></a>ç‚¹äº‘æ—‹è½¬</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">point_cloud.rotate(rotation_matrix, center = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))  <span class="comment"># åº”ç”¨æ—‹è½¬, rotation_matrixæ˜¯æ—‹è½¬çŸ©é˜µ</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ç¬¬äºŒä¸ªå‚æ•°centeræ˜¯æŒ‡å®šæ—‹è½¬ä¸­å¿ƒï¼Œå¦‚æœä¸ä¼ ï¼Œé»˜è®¤æ—‹è½¬ä¸­å¿ƒæ˜¯ç‚¹äº‘çš„è´¨å¿ƒã€‚</p><p>è€Œä¸€èˆ¬æ¥è¯´ï¼Œæ—‹è½¬ä¸­å¿ƒä¸ºåŸç‚¹</p><h2 id="ç‚¹äº‘ä¸Šè‰²"><a href="#ç‚¹äº‘ä¸Šè‰²" class="headerlink" title="ç‚¹äº‘ä¸Šè‰²"></a>ç‚¹äº‘ä¸Šè‰²</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">point_cloud.paint_uniform_color([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1.0</span>]) <span class="comment"># ä¼ å…¥çš„ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯rgb</span></span><br></pre></td></tr></table></figure><h2 id="ç‚¹äº‘å±•ç¤º"><a href="#ç‚¹äº‘å±•ç¤º" class="headerlink" title="ç‚¹äº‘å±•ç¤º"></a>ç‚¹äº‘å±•ç¤º</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">o3d.visualization.draw_geometries([point_cloud])</span><br></pre></td></tr></table></figure><h2 id="å››å…ƒæ•°è½¬æ—‹è½¬çŸ©é˜µ"><a href="#å››å…ƒæ•°è½¬æ—‹è½¬çŸ©é˜µ" class="headerlink" title="å››å…ƒæ•°è½¬æ—‹è½¬çŸ©é˜µ"></a>å››å…ƒæ•°è½¬æ—‹è½¬çŸ©é˜µ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">quaternion = np.array([ori_x, ori_y, ori_z, ori_w])  <span class="comment"># å®šä¹‰å››å…ƒæ•°</span></span><br><span class="line">rotation_matrix = R.from_quat(quaternion).as_matrix()</span><br></pre></td></tr></table></figure><p>æ³¨æ„å››å…ƒæ•°é¡ºåºæ˜¯xyzwï¼Œåœ¨æœ‰äº›åœ°æ–¹é¡ºåºæ˜¯wxyz</p><h2 id="ç‚¹äº‘ä¸‹é‡‡æ ·"><a href="#ç‚¹äº‘ä¸‹é‡‡æ ·" class="headerlink" title="ç‚¹äº‘ä¸‹é‡‡æ ·"></a>ç‚¹äº‘ä¸‹é‡‡æ ·</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">point_cloud = point_cloud.voxel_down_sample()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„</p><ol><li>éœ€è¦æ¥æ”¶è¿”å›å€¼</li><li>ä¸‹é‡‡æ ·æ˜¯æŒ‡åªä¿ç•™æŸä¸€å¤§å°ç«‹æ–¹ä½“å†…çš„ä¸€ä¸ªç‚¹ã€‚voxel_down_sampleæ–¹æ³•æœ‰ä¸ªé»˜è®¤å€¼å‚æ•°ï¼Œä¸º0.05ã€‚è¿™ä¸ªå‚æ•°å°±è¡¨ç¤ºç«‹æ–¹ä½“çš„å¤§å°ï¼Œå› æ­¤è¿™ä¸ªæ•°è¶Šå¤§ï¼Œä¸‹é‡‡æ ·çš„å¼ºåº¦è¶Šå¼ºï¼Œä¿ç•™çš„ç‚¹å°±è¶Šå°‘ã€‚</li></ol><h2 id="ç»Ÿè®¡æ»¤æ³¢"><a href="#ç»Ÿè®¡æ»¤æ³¢" class="headerlink" title="ç»Ÿè®¡æ»¤æ³¢"></a>ç»Ÿè®¡æ»¤æ³¢</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">point_cloud.remove_statistical_outlier(nb_neighbors=<span class="number">20</span>, std_ratio=<span class="number">2.0</span>)</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•å¯ä»¥å»æ‰è·ç¦»ç‚¹äº‘å¯†é›†å¤„å¾ˆè¿œçš„ç‚¹ã€‚è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°</p><ol><li>nb_neighborså…è®¸æŒ‡å®šè¦è€ƒè™‘å¤šå°‘ä¸ªé‚»å±…ï¼Œä»¥ä¾¿è®¡ç®—ç»™å®šç‚¹çš„å¹³å‡è·ç¦»ã€‚</li><li>std_ratioå…è®¸åŸºäºè·¨ç‚¹äº‘çš„å¹³å‡è·ç¦»çš„æ ‡å‡†åå·®æ¥è®¾ç½®é˜ˆå€¼çº§åˆ«ã€‚æ­¤æ•°å­—è¶Šä½ï¼Œè¿‡æ»¤å™¨å°†è¶Šå…·æœ‰æ”»å‡»æ€§ã€‚</li></ol><h2 id="ç­›é€‰ç‚¹äº‘ä¸­çš„ç‚¹"><a href="#ç­›é€‰ç‚¹äº‘ä¸­çš„ç‚¹" class="headerlink" title="ç­›é€‰ç‚¹äº‘ä¸­çš„ç‚¹"></a>ç­›é€‰ç‚¹äº‘ä¸­çš„ç‚¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># indices_to_keep =[0,1,2...] ç‚¹çš„ç´¢å¼•</span></span><br><span class="line">point_cloud = point_cloud.select_by_index(indices_to_keep)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Python numpyå¯¹ä¸‰ç»´ç‚¹çš„æ“ä½œæ±‡æ€»ï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
      <link href="/2023/09/16/Python-numpy%E5%AF%B9%E4%B8%89%E7%BB%B4%E7%82%B9%E7%9A%84%E6%93%8D%E4%BD%9C%E6%B1%87%E6%80%BB%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
      <url>/2023/09/16/Python-numpy%E5%AF%B9%E4%B8%89%E7%BB%B4%E7%82%B9%E7%9A%84%E6%93%8D%E4%BD%9C%E6%B1%87%E6%80%BB%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h2 id="å°†ä¸€ä¸ªåˆ—è¡¨ä¸­çš„ç‚¹æˆ–è€…å…¶ä»–å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªnumpy-ndarrayå¯¹è±¡"><a href="#å°†ä¸€ä¸ªåˆ—è¡¨ä¸­çš„ç‚¹æˆ–è€…å…¶ä»–å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªnumpy-ndarrayå¯¹è±¡" class="headerlink" title="å°†ä¸€ä¸ªåˆ—è¡¨ä¸­çš„ç‚¹æˆ–è€…å…¶ä»–å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªnumpy.ndarrayå¯¹è±¡"></a>å°†ä¸€ä¸ªåˆ—è¡¨ä¸­çš„ç‚¹æˆ–è€…å…¶ä»–å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªnumpy.ndarrayå¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">points = np.asarray([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]])</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹numpy-ndarrayçš„å½¢çŠ¶"><a href="#æŸ¥çœ‹numpy-ndarrayçš„å½¢çŠ¶" class="headerlink" title="æŸ¥çœ‹numpy.ndarrayçš„å½¢çŠ¶"></a>æŸ¥çœ‹numpy.ndarrayçš„å½¢çŠ¶</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">##  n : numpy.ndarray </span></span><br><span class="line">n.shape </span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—ç‚¹åˆ°åŸç‚¹çš„æ¬§å‡ é‡Œå¾—è·ç¦»"><a href="#è®¡ç®—ç‚¹åˆ°åŸç‚¹çš„æ¬§å‡ é‡Œå¾—è·ç¦»" class="headerlink" title="è®¡ç®—ç‚¹åˆ°åŸç‚¹çš„æ¬§å‡ é‡Œå¾—è·ç¦»"></a>è®¡ç®—ç‚¹åˆ°åŸç‚¹çš„æ¬§å‡ é‡Œå¾—è·ç¦»</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># points like array([[x1,y1,z1],[x2,y2,z2],[x3,y3,z3]])</span></span><br><span class="line">distances = np.linalg.norm(points, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><code>np.linalg.norm(x, ord=None, axis=None, keepdims=False)</code>â€‹æ±‚èŒƒæ•°</p><p>xï¼šæ˜¯è¾“å…¥çš„çŸ©é˜µorå‘é‡</p><p>ordï¼šè®¡ç®—çš„èŒƒæ•°ç±»å‹ã€‚ord=2è®¡ç®—L2èŒƒæ•°ï¼Œå³æ¬§å‡ é‡Œå¾—è·ç¦»ï¼Œord=1è®¡ç®—L1èŒƒæ•°ã€‚</p><p>axisï¼šè½´ï¼Œaxis=0æŒ‰åˆ—è®¡ç®—ï¼Œaxis=1æŒ‰è¡Œè®¡ç®—</p><h2 id="é€‰æ‹©æ¬§å‡ é‡Œå¾—è·ç¦»ç¬¦åˆä¸€å®šèŒƒå›´å†…çš„ç‚¹"><a href="#é€‰æ‹©æ¬§å‡ é‡Œå¾—è·ç¦»ç¬¦åˆä¸€å®šèŒƒå›´å†…çš„ç‚¹" class="headerlink" title="é€‰æ‹©æ¬§å‡ é‡Œå¾—è·ç¦»ç¬¦åˆä¸€å®šèŒƒå›´å†…çš„ç‚¹"></a>é€‰æ‹©æ¬§å‡ é‡Œå¾—è·ç¦»ç¬¦åˆä¸€å®šèŒƒå›´å†…çš„ç‚¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è·å¾—ç‚¹è·ç¦»åŸç‚¹çš„æ¬§å‡ é‡Œå¾—è·ç¦»å¤§äº0.1å°äº70çš„ç‚¹ç´¢å¼•</span></span><br><span class="line">np.where((distances &gt;= <span class="number">0.01</span>) &amp; (distances &lt;= <span class="number">70</span>))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç­›é€‰è¿™äº›ç‚¹</span></span><br><span class="line">points[np.where((distances &gt;= <span class="number">0.01</span>) &amp; (distances &lt;= <span class="number">70</span>))]</span><br></pre></td></tr></table></figure><p><a href="https://www.delftstack.com/zh/howto/numpy/python-numpy.where-multiple-conditions/#%e5%9c%a8-python-%e4%b8%ad%e4%bd%bf%e7%94%a8-numpylogical_or-%e5%87%bd%e6%95%b0%e5%ae%9e%e7%8e%b0-numpywhere-%e5%a4%9a%e4%b8%aa%e6%9d%a1%e4%bb%b6">https://www.delftstack.com/zh/howto/numpy/python-numpy.where-multiple-conditions/#%e5%9c%a8-python-%e4%b8%ad%e4%bd%bf%e7%94%a8-numpylogical_or-%e5%87%bd%e6%95%b0%e5%ae%9e%e7%8e%b0-numpywhere-%e5%a4%9a%e4%b8%aa%e6%9d%a1%e4%bb%b6</a></p><h2 id="å¯¹ç‚¹è¿›è¡Œæ—‹è½¬"><a href="#å¯¹ç‚¹è¿›è¡Œæ—‹è½¬" class="headerlink" title="å¯¹ç‚¹è¿›è¡Œæ—‹è½¬"></a>å¯¹ç‚¹è¿›è¡Œæ—‹è½¬</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»™å®šä¸€ä¸ª3*3çš„æ—‹è½¬çŸ©é˜µ rotation_matrixï¼Œ å¯¹ç‚¹pointsè¿›è¡Œæ—‹è½¬ï¼Œè·å¾—æ—‹è½¬åçš„ç‚¹åæ ‡ã€‚</span></span><br><span class="line">np.dot(points, rotation_matrix.T)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œéœ€è¦å¯¹æ—‹è½¬çŸ©é˜µåšäº†è½¬ç½®ï¼Œ<strong><em>æ¨å¯¼ä¸€ä¸‹</em></strong>â€‹<strong>ã€‚</strong></p><p>np.dotçŸ©é˜µä¹˜æ³•ï¼Œä»–çš„ç”¨æ³•æ˜¯ï¼Ÿå’Œnp.<code>matmul</code>â€‹çš„åŒºåˆ«ï¼Ÿ</p><h2 id="å¯¹ç‚¹è¿›è¡Œå¹³ç§»"><a href="#å¯¹ç‚¹è¿›è¡Œå¹³ç§»" class="headerlink" title="å¯¹ç‚¹è¿›è¡Œå¹³ç§»"></a>å¯¹ç‚¹è¿›è¡Œå¹³ç§»</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»™å®šä¸€ä¸ªå¹³ç§»å‘é‡translation_vectorï¼Œ å¯¹ç‚¹pointsè¿›è¡Œå¹³ç§»ï¼Œè·å¾—æ—‹è½¬åçš„ç‚¹åæ ‡ã€‚</span></span><br><span class="line">points + translation_vector</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ çš„é¡¹ç›®ä¸­æœ‰ä»€ä¹ˆäº®ç‚¹ï¼Ÿå¦‚ä½•å›ç­”æ‰èƒ½å¾—åˆ°é¢è¯•å®˜çš„å¥½æ„Ÿ</title>
      <link href="/2023/09/04/%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%9C%89%E4%BB%80%E4%B9%88%E4%BA%AE%E7%82%B9%EF%BC%9F%E5%A6%82%E4%BD%95%E5%9B%9E%E7%AD%94%E6%89%8D%E8%83%BD%E5%BE%97%E5%88%B0%E9%9D%A2%E8%AF%95%E5%AE%98%E7%9A%84%E5%A5%BD%E6%84%9F/"/>
      <url>/2023/09/04/%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%9C%89%E4%BB%80%E4%B9%88%E4%BA%AE%E7%82%B9%EF%BC%9F%E5%A6%82%E4%BD%95%E5%9B%9E%E7%AD%94%E6%89%8D%E8%83%BD%E5%BE%97%E5%88%B0%E9%9D%A2%E8%AF%95%E5%AE%98%E7%9A%84%E5%A5%BD%E6%84%9F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é’ˆå¯¹æœ¬<a href="https://www.bilibili.com/video/BV1DM4y1L7cL/?buvid=9aa5bffff7ad0aee7573c7ed265b7b41&amp;is_story_h5=false&amp;mid=KneIq6dZPkIx5y%2FvWilBwA%3D%3D&amp;p=1&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=iphone&amp;share_plat=ios&amp;share_session_id=B0B2A8E9-DA79-44E5-ADF6-4ECC9B19D812&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1693623913&amp;unique_k=A5vAgCl&amp;up_id=1031543543&amp;vd_source=53d8e50bea64fe70bc50c86af86d28e1">è§†é¢‘</a>åšçš„ç¬”è®°</p></blockquote><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>è¯·ä½ è¯´ä¸€ä¸‹ä½ é¡¹ç›®ä¸­çš„äº®ç‚¹ã€‚å‡ ä¹æ¯ä¸ªå‡†å¤‡å»é¢è¯•çš„åŒå­¦éƒ½ä¼šè¢«è¿™ä¸ªé—®é¢˜å›°æ‰°ï¼Œæˆ‘ç¾¡æ…•ã€‚</p><p>å¾ˆç®€å•ï¼Œå°±æ˜¯ CRUD æ²¡æœ‰äº®ç‚¹æ€ä¹ˆåŠï¼Ÿæ²¡æœ‰åšè¿‡åˆ†å¸ƒå¼çš„é¡¹ç›®ï¼Œå“ªæœ‰ä»€ä¹ˆäº®ç‚¹ï¼Œæˆ‘ä¹‹å‰åšçš„éƒ½æ˜¯å•ä½“é¡¹ç›®ï¼Œå®åœ¨æƒ³ä¸å‡ºæœ‰ä»€ä¹ˆäº®ç‚¹ï¼Œå¤§å®¶å¯¹äºè¿™ä¸ªé—®é¢˜çš„<strong>è¯¯è§£</strong>åœ¨äºï¼Œä¸€å®šè¦é¡¹ç›®è¶³å¤Ÿå¥½æ‰æœ‰äº®ç‚¹ã€‚å…¶å®é¢è¯•å®˜åœ¨é—®è¿™ä¸ªé—®é¢˜çš„æ—¶å€™æ˜¯æƒ³äº†è§£ä½ åœ¨é¡¹ç›®ä¸­çš„æˆæœå’Œèƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªç»´åº¦å»å‡†å¤‡ã€‚</p><ol><li>è§£å†³å¤æ‚é—®é¢˜çš„èƒ½åŠ›ã€‚ä½ å¯ä»¥æè¿°ä½ åœ¨é¡¹ç›®ä¸­è§£å†³è¿‡å“ªä¸€äº›ç‰¹åˆ«å¤æ‚æˆ–è€…æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ï¼Œå¯ä»¥æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸šåŠ¡é—®é¢˜ã€‚æ¯”å¦‚è¯´é€šè¿‡å¼•å…¥ Kafka è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¼˜åŒ–äº†ç¨‹åºçš„æ•ˆç‡ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨é«˜å³°æœŸå¤„ç†ç™¾ä¸‡çº§çš„æ¶ˆæ¯ã€‚</li><li>åšäº†ä¸€äº›æé«˜æ•ˆç‡çš„å·¥ä½œï¼Œæ¯”å¦‚è¯´é‡æ„ä»£ç ï¼Œä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡ã€‚å¼•å…¥å¼‚æ­¥çº¿ç¨‹ï¼Œä¼˜åŒ–äº†ä»£ç çš„æ•ˆç‡ã€‚å¼€å‘äº†ä¸€ä¸ªå…¬å…±ç»„ä»¶ï¼Œæå‡äº†å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ã€‚æ¯”å¦‚ä¼˜åŒ–äº†ä¸€ä¸ªå¤æ‚çš„ MySQL è¯­å¥ï¼Œæé«˜äº†æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œä½¿å¾—æŸ¥è¯¢æ•ˆç‡æ•´ä½“æå‡äº† 10 å€ã€‚</li><li>çªå‡ºå›¢é˜Ÿåä½œå’Œæ²Ÿé€šæ–¹é¢çš„èƒ½åŠ›ã€‚æ¯”å¦‚è¯´åœ¨é¡¹ç›®ä¸­æ‰¿æ‹…çš„æ ¸å¿ƒå¼€å‘æˆ–è€…å›¢é˜Ÿå°ç»„é•¿çš„è§’è‰²ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„ç®¡ç†æ‰‹æ®µï¼ŒæŒ‰æ—¶å®Œæˆäº†é¡¹ç›®äº¤ä»˜å’Œæé«˜äº†è´¨é‡ä¿éšœç­‰ç­‰ã€‚æ¯”å¦‚æˆ‘å¸¦é¢†æˆ‘çš„å›¢é˜Ÿå®Œæˆäº†è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘è´Ÿè´£åˆ†é…ä»»åŠ¡ï¼Œåè°ƒå›¢é˜Ÿçš„æˆå‘˜å·¥ä½œä»¥åŠè§£å†³å›¢é˜Ÿä¸­å‡ºç°çš„é—®é¢˜ã€‚åœ¨æˆ‘çš„ç®¡ç†ä¸‹ï¼Œæˆ‘ä»¬æˆåŠŸçš„æŒ‰æ—¶å®Œæˆäº†é¡¹ç›®ï¼Œå¾—åˆ°äº†å®¢æˆ·çš„é«˜åº¦è¯„ä»·ã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çªå‡ºå­¦ä¹ èƒ½åŠ›ï¼Œæ¯”å¦‚é¡¹ç›®é‡Œé¢è¦ç”¨åˆ°ä¸€ä¸ªæ–°çš„æŠ€æœ¯ï¼Œè¿™ä¸ªæŠ€æœ¯ä¹‹å‰æ²¡æœ‰ç”¨è¿‡ï¼Œä½†æ˜¯é¡¹ç›®äº¤ä»˜çš„æ—¶é—´æ¯”è¾ƒç´§ï¼Œæ‰€ä»¥æˆ‘å¤§æ¦‚èŠ±äº† 3 å¤©æ—¶é—´åœ¨ç½‘ä¸Šæ‰¾äº†å„ç§èµ„æ–™å­¦ä¹ ï¼Œåœ¨å®é™…è½åœ°çš„æ—¶å€™è¿˜é‡åˆ°äº†ä¸€äº›è‡ªå·±è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œåé¢åœ¨ GitHub çš„ issue ä¸Šæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œæœ€åæŒ‰æœŸå®Œæˆäº†é¡¹ç›®çš„äº¤ä»˜ã€‚</li></ol><p>å› æ­¤ï¼Œå¯¹äºé¡¹ç›®ä¸­çš„äº®ç‚¹ï¼Œä½ ä»¬å¯ä»¥ä»å¯¹ä¸šåŠ¡è®¾è®¡çš„æ·±åº¦æ€è€ƒï¼Œé—®é¢˜è§£å†³çš„èƒ½åŠ›ï¼Œæˆ–è€…å¯¹æŸä¸ªç‰¹å®šæŠ€æœ¯çš„æ·±åº¦ç†è§£ï¼Œå›¢é˜Ÿåä½œæ²Ÿé€šç­‰æ–¹é¢å»å‡†å¤‡ï¼Œä»è€Œè®©é¢è¯•å®˜çœ‹åˆ°ä½ åœ¨é¡¹ç›®ä¸­çš„æ€è€ƒå’Œæ€»ç»“ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåªä¼š CRUDçš„å·¥å…·äººã€‚ä»¥ä¸Šå°±æ˜¯æˆ‘çš„ç†è§£ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python asyncioå¼‚æ­¥ç¼–ç¨‹å…¥é—¨</title>
      <link href="/2023/09/03/Python-asyncio%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/"/>
      <url>/2023/09/03/Python-asyncio%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é’ˆå¯¹<a href="https://www.bilibili.com/video/BV1oa411b7c9/?spm_id_from=333.337.search-card.all.click&amp;vd_source=53d8e50bea64fe70bc50c86af86d28e1">è¯¥è§†é¢‘</a>çš„ä¸€ç¯‡ç¬”è®°</p><p>å…ˆå†³æ¡ä»¶ï¼šåç¨‹ã€å¹¶å‘</p></blockquote><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>è¿™æ¬¡è®²çš„æ˜¯asyncioæœ€æ–°çš„ç”¨æ³•ï¼Œç„¶åæ˜¯Python 3. 7 ä»¥ä¸Šæ‰æ”¯æŒçš„ï¼Œä¹Ÿæ˜¯æ¨èå¤§å®¶å­¦æ–°ä¸å­¦æ—§ã€‚</p><p>asyncioå¹¶ä¸èƒ½æå‡ä½ çš„è¿ç®—é€Ÿåº¦ï¼Œå®ƒæ¯”è¾ƒé€‚åˆå¤„ç†é‚£äº›éœ€è¦ç­‰å¾…çš„ä»»åŠ¡^ï¼ˆåº”ç”¨åœºæ™¯ï¼‰^ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ç½‘ç»œçš„é€šè®¯</p><p>é‚£ asyncioçš„<strong>è¿ç®—æ ¸å¿ƒ</strong>å…¶å®å°±æ˜¯ä¸€ä¸ªevent loopï¼Œå®ƒå°±åƒä¸€ä¸ªå¤§è„‘ï¼Œå®ƒé¢å¯¹ç€å¾ˆå¤šå¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åå†³å®šæ‰§è¡Œå“ªä¸ªä»»åŠ¡ã€‚é‚£åœ¨ Python çš„asyncioé‡Œï¼ŒåŒæ—¶æ‰§è¡Œçš„ä»»åŠ¡åªèƒ½æœ‰ä¸€ä¸ªï¼Œå®ƒä¸å­˜åœ¨ç³»ç»Ÿçº§çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå®ƒè·Ÿçº¿ç¨‹ä¸ä¸€æ ·ï¼Œå®ƒéœ€è¦æ¯ä¸€ä¸ªä»»åŠ¡ä¸»åŠ¨å‘Šè¯‰event loopï¼Œæˆ‘è¿™è¾¹ç»“æŸäº†ï¼Œä½ å¯ä»¥è®©åˆ«çš„ä»»åŠ¡å¼€å§‹äº†ã€‚å› æ­¤å®ƒæœ‰ä¸€ä¸ª<strong>å¥½å¤„</strong>ï¼Œå°±æ˜¯ä¸å­˜åœ¨ç«äº‰å†’é™©è¿™æ ·çš„é—®é¢˜ï¼Œä½ å¯ä»¥æ˜ç¡®çš„çŸ¥é“æˆ‘æ¯ä¸€ä¸ªä»»åŠ¡ä»€ä¹ˆæ—¶å€™åœæ­¢è¿ç®—äº†ã€‚</p><p>é‚£æƒ³è¦ä½¿ç”¨asyncioç¬¬ä¸€ä»¶äº‹å°±æ˜¯ç†è§£ä»€ä¹ˆå«coroutineï¼Œä»€ä¹ˆå«taskã€‚</p><p>coroutineåœ¨ Python çš„è¯­å¢ƒé‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŒ‡ä¸¤ç§ä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯coroutine functionï¼Œä¸€ä¸ªæ˜¯coroutine objectã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>( <span class="string">&#x27;world&#x27;</span>)</span><br><span class="line"></span><br><span class="line">coro = main()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª async def main å°±æ˜¯ä¸€ä¸ªcoroutine functionã€‚Python é‡Œé¢æ‰€æœ‰async def mainå¼€å¤´çš„ä¸œè¥¿éƒ½å«coroutine functionï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª coroutine çš„è¿‡ç¨‹ã€‚é‚£ Python ä¸€èˆ¬çš„å‡½æ•°ï¼Œå½“æˆ‘ä»¬è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œå®ƒè¿”å›çš„æ˜¯è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œå¯¹ä¸å¯¹ï¼Ÿä½†æ˜¯æ‰€æœ‰çš„ coroutine functionï¼Œå½“ä½ è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªcoroutine objectï¼Œå®ƒçš„æœ¬è´¨è·Ÿç”Ÿæˆå™¨å‡½æ•°æœ‰äº›åƒã€‚</p><p>å°±æ˜¯å½“ä½ åœ¨è°ƒç”¨mainçš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸ä¼šè¿è¡Œ main é‡Œé¢çš„ç¨‹åºï¼Œå®ƒåªä¼šè¿”å›ä¸€ä¸ªcoroutine objectã€‚</p><p>å¥½ï¼Œé‚£æ€ä¹ˆè¿è¡Œcoroutineçš„ä»£ç ï¼Ÿæˆ‘ä»¬éœ€è¦<strong>ä¸¤ä»¶äº‹</strong>ï¼Œç¬¬ä¸€æ˜¯è¿›å…¥asyncçš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥è¿™ä¸ª event loopï¼Œå¼€å§‹æ§åˆ¶æ•´ä¸ªç¨‹åºçš„çŠ¶æ€ã€‚ç¬¬äºŒå°±æ˜¯æŠŠcoroutineå˜æˆtaskã€‚</p><p>æˆ‘ä»¬å…ˆè¯´å¦‚ä½•è¿›å…¥ async æ¨¡å¼ï¼Œé‚£æˆ‘ä»¬æ­£å¸¸å†™Pythonä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ç®¡å®ƒå« synchronized æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåœ¨ synchronize æ¨¡å¼ä¸‹åˆ‡æ¢åˆ° asynchronized æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°è®©è¿™ä¸ª event loop å¼€å§‹æ§åˆ¶ä¸€åˆ‡ã€‚åŸºæœ¬ä¸Šæˆ‘ä»¬åªç”¨ä¸€ä¸ªå…¥å£å‡½æ•°å«åšasyncio.runï¼Œé‚£ asyncio.runï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªcoroutineï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹å„¿ï¼Œç¬¬ä¸€å®ƒä¼šå»ºç«‹èµ·è¿™ä¸ª event loopï¼Œç¬¬äºŒå®ƒä¼šæŠŠè¿™ä¸ª coroutine å˜æˆè¿™ä¸ª event loop é‡Œé¢çš„ä¸€ä¸ªtaskï¼Œé‚£ event loop å»ºç«‹ä¹‹åï¼Œä»–å°±ä¼šå»æ‰¾å“ªä¸ª task å¯ä»¥æ‰§è¡Œï¼Œé‚£å½“ç„¶åªæœ‰ä¸€ä¸ªtaskï¼Œæ‰€ä»¥å®ƒå°±ä¼šå¼€å§‹è¿è¡Œ run ç»™è¿›æ¥çš„è¿™ä¸ªcoroutineã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>( <span class="string">&#x27;world&#x27;</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¯•ä¸€ä¸‹ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°å®ƒå…ˆ print äº†helloï¼Œç„¶åç­‰äº† 1 ç§’é’Ÿï¼Œç„¶å print äº†worldï¼Œé‚£è¿™ä¸ªasyncio.runå°±æ˜¯æˆ‘ä»¬ä» synchronize æ¨¡å¼å˜åˆ° asynchronize æ¨¡å¼çš„å…¥å£ï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªcoroutineã€‚</p><p>é‚£åªæœ‰ä¸€ä¸ª task æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„æ€çš„ï¼Œå¯¹ä¸å¯¹ï¼Ÿæˆ‘ä»¬åˆšæ‰ä¹Ÿè¯´è¿‡ï¼Œ event loop çš„æ ¸å¿ƒæ˜¯å®ƒæœ‰å¾ˆå¤šå¾ˆå¤šä¸ªtaskï¼Œç„¶åå®ƒæ¥å†³å®šå“ªä¸ª task è¦è¿è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¾ˆé‡è¦çš„ä¸€ä»¶äº‹æƒ…æ˜¯ï¼Œå½“æˆ‘ä»¬å·²ç»å¤„äº async æ¨¡å¼ä¸‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¦‚ä½•å¢åŠ taskï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»‹ç»å‡ ä¸ªæŠŠcoroutineå˜æˆtaskï¼Œè®©å®ƒå¯ä»¥æ’é˜Ÿæ‰§è¡Œçš„æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_after</span>(<span class="params">delay, what</span>):</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)</span><br><span class="line">    <span class="built_in">print</span>(what)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;started at <span class="subst">&#123;time.strftime(<span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> say_after(<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> say_after(<span class="number">2</span>,<span class="string">&quot;world&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;finished at <span class="subst">&#123;time.strftime(<span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p>å¤§å®¶çœ‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª say_after å‡½æ•°ï¼Œå®ƒæ˜¾ç„¶æ˜¯ä¸€ä¸ªcoroutineï¼Œå¯¹ä¸å¯¹ï¼Ÿå®ƒå‰é¢æ˜¯async defï¼Œé‚£å®é™…ä¸Šasyncio.sleepï¼Œå®ƒè¿”å›çš„ä¸œè¥¿ä¹Ÿæ˜¯ä¸€ä¸ª core routineï¼Œé‚£è¿™é‡Œå°±æ¶‰åŠåˆ°äº†<strong>ç¬¬ä¸€ä¸ªæŠŠcoroutineå˜æˆ task çš„æ–¹æ³•</strong>ï¼Œå°±æ˜¯ç”¨awaitã€‚</p><p>é‚£ä¹ˆå½“ä½  await ä¸€ä¸ª<strong>coroutine</strong>çš„æ—¶å€™ï¼ˆä¸Šè¿°ä»£ç ç¬¬8è¡Œï¼‰ï¼Œå‘ç”Ÿäº†å¦‚ä¸‹å‡ ä»¶äº‹ï¼Œç¬¬ä¸€ï¼Œè¿™ä¸ªcoroutineè¢«åŒ…è£…æˆä¸€ä¸ªtaskï¼Œå¹¶ä¸”è¢«å‘Šè¯‰äº† event loopï¼Œè¯´è¿™å—å„¿æœ‰ä¸€ä¸ªæ–°çš„taskã€‚ç¬¬äºŒï¼Œå®ƒä¼šå‘Šè¯‰ event loopï¼Œæˆ‘ç°åœ¨è¿™ä¸ª task ï¼ˆmainï¼‰éœ€è¦ç­‰åˆ°say_after task å®Œæˆä¹‹åï¼Œæˆ‘æ‰èƒ½ç»§ç»­å®ƒï¼Œå»ºç«‹äº†è¿™ä¹ˆä¸€ä¸ªä¾èµ–å…³ç³»ã€‚ç¬¬ä¸‰ï¼Œå®ƒä¼š yield å‡ºå»ï¼Œä¹Ÿå°±æ˜¯å®ƒä¼šå‘Šè¯‰ event loopï¼Œæˆ‘è¿™ä¸ª task ç°åœ¨å¹²ä¸äº†äº†ï¼Œä½ å…ˆè®©åˆ«çš„ task å¹²æ´»å»å§ã€‚æœ€åå½“ event loop å†æ¬¡å®‰æ’å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠ say after è¿™ä¸ªsay_after é‡Œé¢çœŸæ­£çš„è¿”å›å€¼æ‹¿å‡ºæ¥ä¿å­˜èµ·æ¥ã€‚å½“ç„¶ç°åœ¨æˆ‘ä»¬è¿™é‡Œawaitå‰é¢æ²¡æœ‰å†™ï¼Œå› ä¸ºæˆ‘ä»¬çš„ say after æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œå¥½ï¼Œé‚£æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¿™æ®µç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·®ä¸å¤šé—´éš”ä¸€ç§’ print ä¸€ä¸ªhelloï¼Œç„¶ååœ¨ä¸¤ç§’é’Ÿä¹‹å print äº†ä¸€ä¸ªworldã€‚</p><p>æˆ‘ä»¬æ¥è¿˜åŸä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä¸€ä¸ªä»€ä¹ˆäº‹æƒ…ã€‚é¦–å…ˆ asyncio.runæŠŠè¿™ä¸ªmainä½œä¸ºä¸€ä¸ª task ç»™æ”¾åˆ°äº† event loop é‡Œã€‚ event loop å¯»æ‰¾taskï¼Œä»–å‘ç°åªæœ‰ä¸€ä¸ª task mainï¼Œç„¶åä»–å°±å¼€å§‹è®©è¿™ä¸ª task mainè¿è¡Œã€‚may ä½ åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆ print äº†ä¸€ä¸ª start atï¼Œç„¶åå®ƒè¿è¡Œäº† say_after è¿™ä¸ªcoroutine functionï¼Œå¾—åˆ°äº†ä¸€ä¸ªcoroutine objectã€‚await æŠŠè¿™ä¸ªcoroutine objectå˜æˆäº†ä¸€ä¸ªtaskï¼Œæ”¾å›äº† event loop é‡Œï¼ŒåŒæ—¶å‘Šè¯‰ event loop æˆ‘éœ€è¦ç­‰å¾…å®ƒï¼Œç„¶åæŠŠæ§åˆ¶æƒäº¤è¿˜ç»™äº† event loopã€‚</p><p>ç°åœ¨ event loop é‡Œé¢æœ‰ä¸¤ä¸ªtaskï¼Œä¸€ä¸ªæ˜¯mainï¼Œä¸€ä¸ªæ˜¯è¿™ä¸ª say_afterï¼Œä½†æ˜¯mainè¿è¡Œä¸äº†ï¼Œ mainè¯´æˆ‘è¦ç­‰è¿™ä¸ª say afterï¼Œé‚£event loopï¼Œå°±è®©è¿™ä¸ªsay_afterå…ˆè¿è¡Œã€‚</p><p><code>await asyncio.sleep(delay)</code>â€‹ è¿™é‡Œå…¶å®åšäº†ä¸€ä¸ªå¾ˆç›¸ä¼¼çš„äº‹æƒ…ï¼Œä¹Ÿæ˜¯æŠŠå®ƒå˜æˆäº†ä¸€ä¸ªtaskï¼Œç„¶åå‘Šè¯‰ event loop è¯´æˆ‘å¾—ç­‰è¿™ä¸ª sleep å®Œæˆäº†æˆ‘æ‰èƒ½è¿è¡Œã€‚ç„¶å await åˆæŠŠè¿™ä¸ªæ§åˆ¶æƒè½¬å›ç»™äº† event loopã€‚</p><p>event loop ä¸€çœ‹ç°åœ¨æœ‰ä¸‰ä¸ª task å¯¹ä¸å¯¹ï¼Ÿæœ‰ä¸€ä¸ªmainï¼Œæœ‰ä¸€ä¸ª say_afterï¼Œè¿˜æœ‰ä¸€ä¸ªsleepï¼Œé‚£è¿™ä¸ª sleep ä¼šå‘Šè¯‰ event loop è¯´æˆ‘ä¸€ç§’é’Ÿä¹‹åæˆ‘å°±å¥½äº†ï¼Œæ‰€ä»¥è¿™ä¸ª event loop å°±ç­‰äº†ä¸€ç§’é’Ÿã€‚ä¸€ç§’é’Ÿä¹‹åè¿™ä¸ª sleep å°±å®Œæˆäº†ã€‚ç„¶å event loop çœ‹ç°åœ¨æœ‰ä¸¤ä¸ªtaskï¼Œä¸€ä¸ªmainï¼Œä¸€ä¸ª say afterï¼Œè¿™ä¸ª main è¦ç­‰ say_afterï¼Œä½†æ˜¯è¿™ä¸ª say after ç­‰çš„ä¸œè¥¿å·²ç»å®Œæˆäº†ï¼Œäºæ˜¯ event loop å°±è¯´ say_after ä½ æ¥è¿è¡Œå§ï¼Œç„¶å say_after printed ä¸€ä¸ªwhatï¼Œç„¶å say_after ä¹Ÿå®Œæˆäº†ã€‚äºæ˜¯åˆæŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ event loopã€‚</p><p>event loop ä¸€çœ‹ï¼Œå“ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ª task äº†ï¼Œå°±æˆ main äº†ï¼Œç„¶åå†æŠŠæ§åˆ¶æƒç»™mainï¼Œè¿™ä¸ªæ—¶å€™ mainå°±æŠŠç¬¬ä¸€ä¸ª say_after å®Œæˆäº†ï¼Œç„¶åå†åšç¬¬äºŒä¸ª say_after åšåŒæ ·çš„äº‹ï¼Œåˆç­‰äº† 2 ç§’ä¹‹åå®ƒå®Œæˆï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹ç”¨äº† 3 ç§’ã€‚</p><p>é‚£åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ§åˆ¶æƒçš„è¿”å›éƒ½æ˜¯æ˜¾å¼çš„ï¼Œå°±æ˜¯<strong>â€‹ event loop å¹¶æ²¡æœ‰åŠæ³•å¼ºè¡Œçš„ä»ä¸€ä¸ª task é‡Œè¾¹æ‹¿å›æ§åˆ¶æƒï¼Œå¿…é¡»è¦è¿™ä¸ª task ä¸»åŠ¨æŠŠæ§åˆ¶æƒäº¤å›å»ã€‚</strong>äº¤å›å»çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ä¸ªæ˜¯awaitï¼Œä¼šäº¤å›ï¼Œç¬¬äºŒä¸ªï¼Œå½“è¿™ä¸ªå‡½æ•°è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå®ƒä¼šäº¤å›ã€‚æ‰€ä»¥è¯´å¦‚æœä½ æœ‰ä¸€ä¸ª task é‡Œé¢æœ‰ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä½ çš„æ•´ä¸ª event loop å°±å¡æ­»äº†ã€‚</p><p>å¥½ï¼Œé‚£åˆšæ‰çš„è¿è¡Œè¿‡ç¨‹ä¸­ä½ å¯èƒ½å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹ä¸å¯¹ï¼Ÿè¿™ä¸ª hello è¦ç­‰ 1 ç§’ï¼Œè¿™ä¸ª world è¦ç­‰ 2 ç§’ï¼Œå®ƒä¿©ä¸ºå•¥ä¸èƒ½ä¸€èµ·ç­‰å‘¢ï¼Ÿè¿™å°±åº”è¯¥æ˜¯æˆ‘ä»¬åç¨‹çš„æ„ä¹‰ï¼Œå¯¹ä¸å¯¹ï¼Ÿåœ¨ä½ ç¬¬ä¸€ä¸ª hello ç­‰ 1 ç§’çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ª event loop ä¸èƒ½ç›´æ¥è®©è¿™ä¸ª world è¿è¡Œï¼Œç„¶åä½ ä¿©ä¸€èµ·ç­‰ç€ï¼Œ 2 ç§’ä¹‹åä¸å°±ç»“æŸäº†å—ï¼Ÿé‚£è¿™ä¸ªå‘¢ï¼Ÿå°±æ˜¯æˆ‘ä»¬ç›´æ¥ç”¨ await æŠŠä¸€ä¸ª cooutine å˜æˆ task å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå› ä¸º await éœ€è¦åšçš„äº‹å¤ªå¤šäº†ï¼Œå®ƒè¦å˜æˆtaskï¼Œå®ƒå˜æˆ task ä¹‹åä¼šä¸»åŠ¨æŠŠæ§åˆ¶æƒäº¤å‡ºå»ï¼Œè¿˜éœ€è¦ç­‰ï¼Œè¿™æ ·åé¢çš„ä»£ç å¿…é¡»è¦ç­‰åˆ°å®ƒå®Œæˆä¹‹åæ‰èƒ½å˜æˆä¸€ä¸ªtaskã€‚  </p><p>é‚£ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ asyncioç»™æˆ‘ä»¬æä¾›äº† create task å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_after</span>(<span class="params">delay, what</span>):</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)</span><br><span class="line">    <span class="built_in">print</span>(what)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    task1 = asyncio.create_task(say_after(<span class="number">1</span>,<span class="string">&quot;hello&quot;</span>))</span><br><span class="line">    task2 = asyncio.create_task(say_after(<span class="number">2</span>,<span class="string">&#x27;world&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;started at <span class="subst">&#123;time.strftime( <span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> task1</span><br><span class="line">    <span class="keyword">await</span> task2</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;finished at <span class="subst">&#123;time.strftime(<span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹è¿™é‡Œç”¨åˆ°çš„ create_task å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªcoroutineã€‚ä¾ç„¶è®°ä½è¿™ä¸ª say_after è°ƒç”¨ä¹‹åè¿”å›çš„æ˜¯ä¸€ä¸ªcoroutineï¼Œå®ƒä¸ä¼šè¿è¡Œä»»ä½• coroutine é‡Œé¢çš„ä»£ç ï¼Œé‚£è¿™ä¸ª create_task å‡½æ•°ä¼šæŠŠè¿™ä¸ªcoroutineå˜æˆä¸€ä¸ªtaskï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª task æ³¨å†Œåˆ° event loop é‡Œé¢ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒåˆ†æ‹…äº†åˆšæ‰ await çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå®ƒæŠŠå®ƒåŒ…è£…æˆäº†ä¸€ä¸ªtaskï¼Œç„¶åå‘Šè¯‰ event loop è¯´OKï¼Œè¿™ä¸ª task å·²ç»å¯ä»¥å¼€å§‹æ‰§è¡Œäº†ï¼Œä½†æ˜¯ç°åœ¨ event loop å¹¶æ²¡æœ‰åŠæ³•æ‰§è¡Œè¿™ä¸ªtaskï¼Œå› ä¸ºæ§åˆ¶æƒè¿˜åœ¨ main çš„æ‰‹é‡Œï¼Œå¯¹ä¸å¯¹ï¼Ÿé‚£è¿™ä¸ªæ—¶å€™ main è¶ç€è‡ªå·±æœ‰æ§åˆ¶æƒï¼Œä»–å°±åšäº†ç¬¬äºŒä¸ªtaskã€‚</p><p>task 2 ä¹Ÿæ˜¯å‘Šè¯‰ main è¿™è¿˜æœ‰ä¸€ä¸ªæ–°çš„taskï¼Œè¿™å« say_after 2 ä¹Ÿå¯ä»¥è¿è¡Œäº†ï¼Œé‚£åœ¨è¿™å„¿ä¹‹åä»–æ‰å¼€å§‹ await task_1 await task_2 é‚£æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ await åé¢æ˜¯ä¸€ä¸ªcoroutineçš„æ—¶å€™ï¼Œå®ƒæœ‰é‚£ä¹ˆå¤šä¸ªåŠŸèƒ½å¯¹ä¸å¯¹ï¼ŸæŠŠå®ƒå˜æˆä¸€ä¸ªtaskï¼Œç„¶åæŠŠæ§åˆ¶æƒäº¤å‡ºå»ï¼Œç­‰å®ƒæ‹¿è¿”å›å€¼ã€‚é‚£å½“ await åé¢æ˜¯ä¸€ä¸ª task è€Œä¸æ˜¯ä¸€ä¸ªcoroutine çš„æ—¶å€™ï¼Œå®ƒå°±çœç•¥äº†æŠŠ coroutineå˜æˆ task è¿™ä¸€æ­¥ï¼Œå®ƒå°±åªæ˜¯å‘Šè¯‰ event loop æˆ‘éœ€è¦è¿™ä¸ª task å®Œæˆï¼Œæˆ‘æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ä½ ï¼Œå¹¶ä¸”åœ¨æ§åˆ¶æƒå›æ¥çš„æ—¶å€™ï¼Œä»è¿™ä¸ª task é‡Œé¢æå–æ‰€éœ€è¦çš„è¿”å›å€¼ã€‚</p><p>å¥½ï¼Œæˆ‘ä»¬è·‘ä¸€ä¸‹è¿™ä¸ªç¨‹åºè¯•ä¸€ä¸‹ã€‚æˆ‘ä»¬çœ‹è¿™ä¸€æ¬¡è¿™ä¸ªç¨‹åºå°±åªç”¨äº† 2 ç§’é’Ÿï¼Œå› ä¸ºå½“å®ƒ await task 1çš„æ—¶å€™ï¼Œ event loop é‡Œé¢å®é™…ä¸Šå·²ç»æœ‰äº† 3 ä¸ªtaskï¼Œæ˜¯ mainã€task 1å’Œ task 2ã€‚å½“ task 1è·Ÿ event loop è¯´å®Œè¯´æˆ‘è¦ç­‰ä¸€ç§’é’Ÿæ‰èƒ½å®Œæˆï¼Œä¹‹å event loop é—²æ¥æ— äº‹å°±èƒ½å‘ç°ï¼Œè¿™æœ‰ä¸€ä¸ª task 2 è¿˜å¯ä»¥æ‰§è¡Œï¼Œäºæ˜¯ä»–åˆæ‰§è¡Œäº† task 2ï¼Œå†è·Ÿä»–è¯´æˆ‘è¦ä¸¤ç§’é’Ÿä¹‹åæ‰èƒ½ç»“æŸï¼Œè¿™æ ·ä¸¤ä¸ª task å°±å¯ä»¥åŒæ—¶è¿›è¡Œç­‰å¾…äº†ã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆasyncioå¾ˆé€‚åˆè§£å†³ä¸€äº›ç½‘ç»œé€šè®¯çš„é—®é¢˜ï¼Œå› ä¸ºç½‘ç»œé€šè®¯å¾ˆå¤šæ—¶é—´æ˜¯åœ¨ç­‰å¾…ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„IO taskï¼Œå°±æ˜¯æˆ‘çœŸæ­£çš„è¿ç®—æŒºå°‘çš„ï¼Œæˆ‘å°±æ˜¯ç­‰ä»–çš„å›å¤ï¼Œé‚£ç­‰å¾…çš„è¿™ä¸ªæ—¶é—´å°±å¯ä»¥å…¶ä»–çš„ä»»åŠ¡å»å¹²æ´»ã€‚é‚£è¿™ä¸ªå‡½æ•°æˆ‘ä»¬æ²¡æœ‰æ¶‰åŠcoroutineçš„returnï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_after</span>(<span class="params">delay, what</span>):</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;(what) - (delay)&quot;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    task1 = asyncio.create_task(say_after(<span class="number">1</span>, <span class="string">&quot;he11o&quot;</span>))</span><br><span class="line">    task2 = asyncio.create_task(say_after(<span class="number">2</span>, <span class="string">&quot;world&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;started at <span class="subst">&#123;time.strftime( <span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    ret1 = <span class="keyword">await</span> task1</span><br><span class="line">    ret2 = <span class="keyword">await</span> task2</span><br><span class="line">    <span class="built_in">print</span>(ret1)</span><br><span class="line">    <span class="built_in">print</span>(ret2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;finished at <span class="subst">&#123;time.strftime( <span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹æˆ‘ä»¬æŠŠå‡½æ•°ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œä¸»è¦å°±æ˜¯å‘Šè¯‰å¤§å®¶æ€ä¹ˆæ‹¿åˆ°coroutineçš„ returnã€‚é‚£å½“ä½ è¦æ‹¿è¿™ä¸ªè¿”å›å€¼çš„æ—¶å€™ï¼Œä¸€å®šæ˜¯ä¸€ä¸ª variable ç­‰äº await taskï¼Œè€Œä¸æ˜¯ä¸€ä¸ª variable ç­‰äº taskã€‚æˆ‘ä»¬ä¹‹å‰å¼ºè°ƒè¿‡ï¼Œ await æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯æŠŠè¿™ä¸ª task æˆ–è€…coroutineçš„è¿™ä¸ªè¿”å›å€¼æ‹¿å‡ºæ¥ï¼Œå¦‚æœä½ ä¸ç”¨ await æ˜¯æ‹¿ä¸åˆ°è¿™ä¸ªå€¼çš„ã€‚</p><p>é‚£æœ‰çš„äººçœ‹åˆ°è¿™å¯èƒ½è¯´äº†ï¼Œé‚£å¦‚æœæˆ‘æœ‰å¾ˆå¤š task å‘¢ï¼Ÿæˆ‘æœ‰ï¼Œæ¯”å¦‚è¯´ 10 ä¸ªtaskï¼Œæˆ‘å°±å†™ 10 è¡Œ await task å—ï¼Ÿè¿™æ˜¯ä¸æ˜¯å¤ªè ¢äº†ï¼Ÿæ­£å› å¦‚æ­¤ï¼Œ asyncioç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå‡½æ•°å«åšgatherã€‚æˆ‘ä»¬çœ‹ gather è¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªcoroutineï¼Œä½†æ˜¯å®ƒä¼šè¿”å›ä¸€ä¸ªå«åš future çš„ä¸œè¥¿ï¼Œè¿™ä¸ª future ä¹Ÿæ˜¯å¯ä»¥ç”¨ await çš„ï¼Œé‚£ gather è¿™ä¸ªå‡½æ•°ä½œç”¨ï¼Œé¦–å…ˆå®ƒçš„å‚æ•°æ˜¯è‹¥å¹²ä¸ª coroutineæˆ–è€…taskï¼Œè¿™ä¿©éƒ½å¯ä»¥ï¼Œç”šè‡³å¯ä»¥æ˜¯futureï¼Œä¹Ÿå°±æ˜¯ gather çš„ return å€¼ã€‚å®ƒè¿˜å¯ä»¥æ¥ç€gatherï¼Œé‚£å¦‚æœæ˜¯coroutineçš„è¯ï¼Œå®ƒé¦–å…ˆä¼šæŠŠå®ƒåŒ…è£…æˆtaskï¼Œå¹¶ä¸”æ³¨å†Œåˆ° event loop é‡Œï¼Œç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ª future å€¼ã€‚å½“ä½  await è¿™ä¸ª future çš„æ—¶å€™ï¼Œä½ å°±ç›¸å½“äºå‘Šè¯‰ event loopï¼Œæˆ‘è¦ç­‰å¾…è¿™é‡Œé¢æ¯ä¸€ä¸ª task éƒ½å®Œæˆï¼Œæˆ‘æ‰å¯ä»¥ç»§ç»­ï¼ŒåŒæ—¶ä¼šæŠŠè¿™äº› task çš„ return å€¼æ”¾åˆ°ä¸€ä¸ª list é‡Œï¼Œç„¶åè¿”å›æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_after</span>(<span class="params">delay, what</span>):</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;(what) - <span class="subst">&#123;delay&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;started at <span class="subst">&#123;time.strftime( <span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    ret = <span class="keyword">await</span> asyncio.gather(say_after(<span class="number">1</span>, <span class="string">&#x27;hello&#x27;</span>),</span><br><span class="line">                               say_after(<span class="number">2</span>, <span class="string">&quot;world&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;finished at <span class="subst">&#123;time.strftime( <span class="string">&#x27;%x&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ç¨‹åºçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿™æ¬¡çš„è¿™ä¸ª return value æ˜¯ä¸€ä¸ªlistï¼Œé‡Œé¢åˆ†åˆ«æ˜¯ helloå’Œworldï¼Œ<strong>é‚£ä¹ˆè¿™ä¸ª list é¡ºåºå’Œé‡Œé¢ task çš„é¡ºåºæ˜¯ä¸€è‡´çš„</strong>ï¼Œè¿™æ ·å‘¢ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ä¸€ä¸ªä¸ª task await äº†ã€‚</p><p>é‚£ gather è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¦‚æœä½ ç»™çš„æ˜¯coroutineçš„è¯ï¼Œå®ƒä¼šæŠŠæ¯ä¸€ä¸ªcoroutineé¦–å…ˆéƒ½å˜æˆtaskï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¸ç”¨è‡ªå·±æ‰‹åŠ¨å…ˆå»å»ºç«‹è¿™äº› task äº†ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šè¿°ä»£ç ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼åœ¨æ‹¿åˆ°äº†æ­£ç¡®çš„è¿”å›å€¼çš„åŒæ—¶ï¼Œå®ƒä¹Ÿåªç”¨äº† 2 ç§’ã€‚å› ä¸º gather é¦–å…ˆæŠŠè¿™ä¸¤ä¸ª coroutine éƒ½å˜æˆäº†taskï¼Œç„¶ååœ¨ main åš await çš„æ—¶å€™æ‰æŠŠæ§åˆ¶æƒäº¤å›ç»™äº† event loopï¼Œè¿™æ · event loop åœ¨åˆ†é…å“ªä¸€ä¸ª task å¯ä»¥å·¥ä½œçš„æ—¶å€™ï¼Œå®ƒå°±æœ‰æ›´å¤šçš„ task å¯ä»¥åˆ†é…äº†ã€‚</p><p>å°½ç®¡asyncioé‡Œé¢è¿˜æœ‰ä¸å°‘çš„åŠŸèƒ½ï¼Œä½†æ˜¯æŒæ¡äº†è¿™å‡ ä¸ªï¼ŒåŸºæœ¬ä¸Šä½ å°±ç†è§£äº†asyncioçš„æ ¸å¿ƒç†å¿µäº†ã€‚é‚£æˆ‘å†å¼ºè°ƒä¸€ä¸‹å‰é¢æåˆ°è¿‡çš„å‡ ä¸ªé‡ç‚¹ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>è¦å»ºç«‹ä¸€ä¸ª event loop çš„æ¦‚å¿µï¼Œä¸Šé¢å„¿æœ‰ä¸€ä¸ª event loop ä½œä¸ºå¤§è„‘ï¼Œä¸‹é¢æ˜¯è‹¥å¹²å¯æ‰§è¡Œçš„taskã€‚ task æ˜¯æ²¡æœ‰åŠæ³•æ§åˆ¶ event loop å»æ‰§è¡ŒæŸä¸€ä¸ª task çš„ï¼Œå®ƒåªèƒ½å‘Šè¯‰ event loop è¯´æˆ‘åœ¨ç­‰è¿™ä¸ªtaskã€‚æœ€ç»ˆæ˜¯ç”± event loop æ¥å†³å®šä¸‹é¢è¦è¿è¡Œå“ªä¸ªtaskï¼Œè€Œ event loop ä¸€æ—¦å¼€å§‹è¿è¡Œtaskï¼Œå°±å¿…é¡»è¦ task æ˜¾ç¤ºçš„æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ event loopã€‚äº¤è¿˜æ§åˆ¶æƒçš„æ–¹å¼ç”± await å’Œå‡½æ•°è¿è¡Œå®Œæ¯•ã€‚æ‰€ä»¥å°½ç®¡æˆ‘ä»¬ä¼šè¯´è¿™ç§åç¨‹çš„æ–¹å¼æ˜¯å¹¶å‘çš„ï¼Œä½†æ˜¯åŒæ—¶åˆ»å®é™…ä¸Šåªæœ‰ä¸€æ®µä»£ç åœ¨è·‘ï¼Œå®ƒåªæ˜¯æƒ³åŠæ³•å†åˆ©ç”¨è¿™äº›ä»£ç ä¸­é—´çš„ç­‰å¾…æ—¶é—´ã€‚æ‰€ä»¥å¦‚æœä½ çš„ä»£ç é‡Œé¢å¹¶æ²¡æœ‰ç­‰å¾…è¿™ä»¶äº‹çš„è¯ï¼Œåç¨‹å¯¹ä½ çš„ä»£ç æ˜¯æ²¡æœ‰å¸®åŠ©çš„ã€‚</li><li>åŠ¡å¿…åˆ†æ¸…ä»€ä¹ˆæ˜¯coroutineï¼Œä»€ä¹ˆæ˜¯taskã€‚ coroutine åªæœ‰å˜æˆäº† task æ‰å¼€å§‹è¢«æ‰§è¡Œã€‚è¦èƒ½çŸ¥é“ä»€ä¹ˆæ—¶å€™ coroutine è¢«éšå¼çš„å˜æˆäº†taskï¼Œåœ¨ä½ ç›´æ¥await coroutine çš„æ—¶å€™ï¼Œç»™ä½ æ”¾åˆ° gather é‡Œçš„æ—¶å€™ï¼Œä½ æ”¾è¿›å»çš„éƒ½æ˜¯coroutineï¼Œä½†æ˜¯å®ƒä»¬ä¼šå·å·æŠŠå®ƒå˜æˆ task æ‰§è¡Œcoroutineï¼Œä¸å˜æˆ task æ˜¯æ²¡æœ‰åŠæ³•æ‰§è¡Œçš„ã€‚</li><li>æœ€åæ‹¿åˆ°ä¸€ä¸ª coroutine çš„è¿”å›å€¼æ˜¯éœ€è¦ç”¨ await çš„ã€‚ä¸€ä¸ªå˜é‡ç­‰äº await xxxã€‚</li></ol><p>â€</p><p>â€</p><p>â€</p><p>â€</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> å¼‚æ­¥ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> asyncio </tag>
            
            <tag> å¼‚æ­¥ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ç³»ç»Ÿå­¦ä¹ èµ„æ–™</title>
      <link href="/2023/02/28/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/"/>
      <url>/2023/02/28/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/</url>
      
        <content type="html"><![CDATA[<p>source:<a href="https://gist.github.com/ascrutae/7fbc3681ff6e7f68fc908e196eac980e">https://gist.github.com/ascrutae/7fbc3681ff6e7f68fc908e196eac980e</a></p><script src="https://gist.github.com/ascrutae/7fbc3681ff6e7f68fc908e196eac980e.js"></script><p>source2: <a href="https://zhuanlan.zhihu.com/p/372646991">https://zhuanlan.zhihu.com/p/372646991</a></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ è·¯çº¿ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ€æºç¬”è®°åŸºæœ¬ä½¿ç”¨</title>
      <link href="/2023/02/26/%E6%80%9D%E6%BA%90%E7%AC%94%E8%AE%B0%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/02/26/%E6%80%9D%E6%BA%90%E7%AC%94%E8%AE%B0%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>æ€æºç¬”è®°æ˜¯ä¸€æ¬¾å¾ˆå¥½çš„ç®¡ç†çŸ¥è¯†åº“çš„è½¯ä»¶ã€‚æ”¯æŒæœ¬åœ°ï¼ˆå…è´¹ï¼‰å’Œäº‘ç«¯ï¼ˆä»˜è´¹ï¼‰ä¸¤ç§æ¨¡å¼ã€‚</p><p>ä¸ä»…æ”¯æŒmarkdownè¯­æ³•ï¼Œè¿˜æœ‰æ›´å¤šå®ç”¨åŠŸèƒ½ã€‚è¿™é‡Œè¿›è¡ŒåŸºæœ¬çš„ä½¿ç”¨ä»‹ç»ã€‚</p><h1 id="æ”¯æŒmarkdownè¯­æ³•"><a href="#æ”¯æŒmarkdownè¯­æ³•" class="headerlink" title="æ”¯æŒmarkdownè¯­æ³•"></a>æ”¯æŒmarkdownè¯­æ³•</h1><p>ç•¥</p><h1 id="æ”¯æŒæ–°å»ºå¤šçº§æ–‡æ¡£"><a href="#æ”¯æŒæ–°å»ºå¤šçº§æ–‡æ¡£" class="headerlink" title="æ”¯æŒæ–°å»ºå¤šçº§æ–‡æ¡£"></a>æ”¯æŒæ–°å»ºå¤šçº§æ–‡æ¡£</h1><p><img src="image-20230226161146934.png" alt="image-20230226161146934"></p><h1 id="è®¾ç½®æ ‡ç­¾ã€ç¬”è®°å›¾æ ‡å’Œé¢˜å¤´å›¾"><a href="#è®¾ç½®æ ‡ç­¾ã€ç¬”è®°å›¾æ ‡å’Œé¢˜å¤´å›¾" class="headerlink" title="è®¾ç½®æ ‡ç­¾ã€ç¬”è®°å›¾æ ‡å’Œé¢˜å¤´å›¾"></a>è®¾ç½®æ ‡ç­¾ã€ç¬”è®°å›¾æ ‡å’Œé¢˜å¤´å›¾</h1><p>å°†é¼ æ ‡æ”¾ç½®åˆ°ç¬”è®°å¼€å¤´ï¼Œå‡ºç°çš„ä¸‰ä¸ªiconåˆ†åˆ«å¯¹åº”ï¼Œæ·»åŠ æ ‡ç­¾ï¼Œè®¾ç½®å›¾æ ‡å’Œè®¾ç½®é¢˜å¤´å›¾ã€‚</p><p><img src="image-20230226161241016.png" alt="image-20230226161241016"></p><p>è®¾ç½®ä¹‹åçš„æ•ˆæœä¸ºï¼š</p><p><img src="image-20230226161340368.png" alt="image-20230226161340368"></p><h1 id="å†…å®¹å—åˆå¹¶"><a href="#å†…å®¹å—åˆå¹¶" class="headerlink" title="å†…å®¹å—åˆå¹¶"></a>å†…å®¹å—åˆå¹¶</h1><p>å†…å®¹å—æ˜¯æ€æºçš„åŸºç¡€ã€‚å—å’Œå—ä¹‹é—´å¯ä»¥è¿›è¡Œåˆå¹¶ç­‰æ“ä½œã€‚</p><p><img src="1.gif" alt="åŠ¨ç”»"></p><h1 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h1><p>æ€æºç¬”è®°å¯ä»¥åˆ¶ä½œæ¨¡æ¿ï¼Œå¯¼å‡ºå¯¼å…¥æ¨¡æ¿ã€‚è®©ç¬”è®°æ ‡å‡†åŒ–ã€‚</p><h1 id="æŒ‚ä»¶"><a href="#æŒ‚ä»¶" class="headerlink" title="æŒ‚ä»¶"></a>æŒ‚ä»¶</h1><p>åœ¨ã€è®¾ç½®ã€‘-ã€é›†å¸‚ã€‘-ã€æŒ‚ä»¶ã€‘ä¸­è¿›è¡Œä¸‹è½½ã€‚</p><p>ç›®å‰çœ‹åˆ°æ¯”è¾ƒå¥½ç”¨çš„æŒ‚ä»¶æœ‰</p><ul><li>superdrawï¼š å¯ä»¥è®©å®ç°éšæ„æ¶‚å†™çš„æŒ‚ä»¶</li><li>drawioï¼šå®ç°ç”»æµç¨‹å›¾çš„æŒ‚ä»¶</li><li>æ€ç»´å¯¼å›¾ï¼šå¯ä»¥æ’å…¥æ€ç»´å¯¼å›¾çš„æŒ‚ä»¶</li></ul><p>å…¶ä»–çš„è‡ªè¡Œç ”ç©¶ã€‚è¿™é‡Œä»¥drawioä¸ºä¾‹ã€‚ä»–çš„æ•ˆæœæ˜¯è¿™æ ·çš„ã€‚</p><p><img src="image-20230226163445070.png" alt="image-20230226163445070"></p><h1 id="å¯¼å…¥pdfå¹¶è¿›è¡Œé˜…è§ˆ"><a href="#å¯¼å…¥pdfå¹¶è¿›è¡Œé˜…è§ˆ" class="headerlink" title="å¯¼å…¥pdfå¹¶è¿›è¡Œé˜…è§ˆ"></a>å¯¼å…¥pdfå¹¶è¿›è¡Œé˜…è§ˆ</h1><p>é€šè¿‡æ‹–æ‹½å¯¼å…¥pdfï¼Œç‚¹å‡»è¿›è¡Œé˜…è§ˆ</p><p><img src="image-20230226163828335.png" alt="image-20230226163828335"></p><p>ä¸ä»…å¦‚æ­¤ï¼Œåœ¨pdfä¸­å¯ä»¥è¿›è¡Œé€‰ä¸­å’Œæ ‡æ³¨ã€‚å°†æ ‡æ³¨ä½œä¸ºâ€œå¼•ç”¨é“¾æ¥â€å¤åˆ¶å›ç¬”è®°ã€‚ç‚¹å‡»â€œå¼•ç”¨é“¾æ¥â€å¯ä»¥ç›´æ¥æ‰“å¼€pdfï¼Œå¹¶è·³è½¬åˆ°æ ‡æ³¨çš„ä½ç½®ã€‚</p><p><img src="image-20230226164254104.png" alt="image-20230226164254104"></p><h1 id="å¯¼å‡º"><a href="#å¯¼å‡º" class="headerlink" title="å¯¼å‡º"></a>å¯¼å‡º</h1><p>ç›´æ¥å¤åˆ¶ç²˜è´´å¯¼å‡ºçš„æ˜¯markdownæ ¼å¼çš„å†…å®¹</p><p>ä¹Ÿå¯ä»¥ç›´æ¥é€‰æ‹©å¯¼å‡ºæ¨¡å¼ï¼Œå¯¼å‡ºä¸åŒå¹³å°çš„æ ¼å¼ã€‚ç›®å‰æ”¯æŒçŸ¥ä¹ã€å¾®ä¿¡å…¬ä¼—å·ç­‰ã€‚</p><p><img src="2.gif" alt="åŠ¨ç”»"></p><h1 id="å‰ªè—"><a href="#å‰ªè—" class="headerlink" title="å‰ªè—"></a>å‰ªè—</h1><p>é€šè¿‡chromeæ’ä»¶è¿›è¡Œwebé¡µé¢çš„ç¬”è®°å‰ªè—</p><p>ç±»ä¼¼æœ‰é“äº‘ç¬”è®°çš„åŠŸèƒ½ã€‚</p><p>è¿™é‡Œéœ€è¦å¯¹tokenè¿›è¡Œé…ç½®ã€‚tokenåœ¨ã€è®¾ç½®ã€‘ã€å…³äºã€‘ä¸­æŸ¥çœ‹</p><h1 id="ç½‘ç»œå›¾ç‰‡è½¬åˆ°æœ¬åœ°"><a href="#ç½‘ç»œå›¾ç‰‡è½¬åˆ°æœ¬åœ°" class="headerlink" title="ç½‘ç»œå›¾ç‰‡è½¬åˆ°æœ¬åœ°"></a>ç½‘ç»œå›¾ç‰‡è½¬åˆ°æœ¬åœ°</h1><p><img src="image-20230226164816361.png" alt="image-20230226164816361"></p><h1 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h1><p>å½“å‰å—å¯ä»¥å¼•ç”¨å…¶ä»–ç¬”è®°çš„å†…å®¹ï¼Œè¾“å…¥ä¸¤ä¸ªå·¦æ‹¬å·è§¦å‘ã€‚</p><p>ç»§ç»­è¾“å…¥å…³é”®è¯ï¼Œé€‰ä¸­å¼•ç”¨çš„å†…å®¹å³å¯ã€‚</p><p>é¼ æ ‡æ‚¬æµ®åœ¨å¼•ç”¨é“¾æ¥ä¸Šï¼Œå¯ä»¥å¯¹å¼•ç”¨çš„å†…å®¹è¿›è¡Œé¢„è§ˆã€‚</p><p>å…·ä½“æ•ˆæœå¦‚ä¸‹ã€‚</p><p><img src="3.gif" alt="åŠ¨ç”»"></p><p>é“¾æ¥åˆ†ä¸ºæ­£å‘é“¾æ¥å’Œåå‘è¿æ¥ã€‚</p><p>æ­£å‘é“¾æ¥å°±æ˜¯æŸ¥çœ‹é“¾æ¥å¼•ç”¨äº†å“ªäº›å†…å®¹å—</p><p>åå‘é“¾æ¥å°±æ˜¯æŸ¥çœ‹å“ªäº›å†…å®¹å—è¢«å¼•ç”¨äº†ã€‚</p><p>ç‚¹å‡»å³ä¸‹è§’çš„ã€åå‘é“¾æ¥ã€‘å›¾æ ‡æŸ¥çœ‹</p><p><img src="image-20230226165621640.png" alt="image-20230226165621640"></p><p>åœ¨è¿æ¥ä¸­ä½ å¯ä»¥å³é”®è¾“å…¥é”šæ–‡æœ¬ä¿®æ”¹å¼•ç”¨é“¾æ¥çš„æ–‡æœ¬</p><p><img src="image-20230226165718183.png" alt="image-20230226165718183"></p><h1 id="é—ªå¡"><a href="#é—ªå¡" class="headerlink" title="é—ªå¡"></a>é—ªå¡</h1><h2 id="åˆ¶ä½œé—ªå¡"><a href="#åˆ¶ä½œé—ªå¡" class="headerlink" title="åˆ¶ä½œé—ªå¡"></a>åˆ¶ä½œé—ªå¡</h2><p>é—ªå¡ç”¨äºèƒŒè¯µæŸäº›å†…å®¹ã€‚åˆ¶ä½œé—ªå¡çš„æµç¨‹å¦‚ä¸‹ã€‚</p><p>æ ‡è®°éœ€è¦èƒŒè¯µçš„å†…å®¹ï¼Œé€‰æ‹©å—ã€æ·»åŠ åˆ°å¡åŒ…ã€‘ï¼Œåˆ›å»ºå¡åŒ…å¹¶æ·»åŠ ã€‚</p><p><img src="image-20230226170647766.png" alt="image-20230226170647766"></p><p><img src="image-20230226170750105.png" alt="image-20230226170750105"></p><p><img src="image-20230226170852763.png" alt="image-20230226170852763"></p><h2 id="å¤ä¹ é—ªå¡"><a href="#å¤ä¹ é—ªå¡" class="headerlink" title="å¤ä¹ é—ªå¡"></a>å¤ä¹ é—ªå¡</h2><p>é€‰æ‹©ã€é—ªå¡ã€‘</p><p><img src="image-20230226170933812.png" alt="image-20230226170933812"></p><p>é€‰æ‹©å¡åŒ…å°±å¯ä»¥çœ‹åˆ°å¾…å¤ä¹ çš„é—ªå¡äº†ã€‚</p><p><img src="image-20230226171010071.png" alt="image-20230226171010071"></p><h1 id="å›¾è¡¨"><a href="#å›¾è¡¨" class="headerlink" title="å›¾è¡¨"></a>å›¾è¡¨</h1><p>è¾“å…¥<code>/</code>ï¼Œé€‰æ‹©æ’å…¥Chart</p><p><img src="image-20230226171217053.png" alt="image-20230226171217053"></p><p>è¿™é‡Œè¾“å…¥ä»£ç å³å¯æ’å…¥chartï¼Œå…¶æ ¼å¼ä¸ºechartsçš„jsonæ ¼å¼ä»£ç ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼</p><ol><li>ä½¿ç”¨JSç¼–å†™å›¾è¡¨</li><li>ä½¿ç”¨<a href="https://tushuo.baidu.com/">ç™¾åº¦å›¾è¯´</a>ï¼Œå¯è§†åŒ–åˆ¶ä½œå›¾è¡¨ï¼Œç„¶åå¤åˆ¶å›¾è¡¨ä»£ç ã€‚</li></ol><p>è¿™é‡Œä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚</p><p>è¿›å…¥ç™¾åº¦å›¾è¯´ï¼Œåˆ›å»ºå›¾è¡¨ï¼Œä¿®æ”¹æ•°æ®ï¼Œç‚¹å‡»ã€æ˜¾ç¤ºä»£ç ã€‘</p><p><img src="image-20230226171700714.png" alt="image-20230226171700714"></p><p>å¤åˆ¶ä»£ç åç²˜è´´åˆ°æ€æºçš„å›¾æ ‡ä»£ç ä¸­ï¼Œå°±å¯ä»¥çœ‹åˆ°å›¾è¡¨å•¦</p><p><img src="image-20230226171753886.png" alt="image-20230226171753886"></p><h1 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h1><p>è¾“å…¥<code>/</code>ï¼Œé€‰æ‹©æ’å…¥flowchart</p><p>è¿™é‡Œæ”¯æŒä¸¤ç§è¯­æ³•æ ¼å¼ï¼š</p><ol><li>flowchart.js</li><li>plantUML</li></ol><h1 id="Graphviz"><a href="#Graphviz" class="headerlink" title="Graphviz"></a>Graphviz</h1><p>è¾“å…¥<code>/</code>ï¼Œé€‰æ‹©æ’å…¥Graphviz</p><p>æ”¯æŒçš„è¯­æ³•æ ¼å¼ä¸ºdotè¯­æ³•ã€‚å…·ä½“å¯ä»¥å‚è€ƒ<a href="">ç½‘ç«™</a>è¿›è¡Œç»˜åˆ¶ã€‚åœ¨è½¯ä»¶å·¥ç¨‹ã€æ•°æ®åº“å’Œæœºå™¨å­¦ä¹ æ–¹é¢ç”¨çš„å¤šï¼Œæ•ˆæœå¦‚ä¸‹ã€‚</p><p><img src="image-20230226172409698.png" alt="image-20230226172409698"></p><h1 id="Mermaid"><a href="#Mermaid" class="headerlink" title="Mermaid"></a>Mermaid</h1><p>è¾“å…¥<code>/</code>ï¼Œé€‰æ‹©æ’å…¥Mermaid</p><p>Mermaidå’ŒGraphviz ç±»ä¼¼ã€‚Mermaidå¯ä»¥ç»˜åˆ¶æµç¨‹å›¾ç­‰æ•°åç§å›¾ã€‚</p><p>æ‰“å¼€<a href="https://mermaid.js.org/">å®˜ç½‘</a>ï¼Œé€‰æ‹©å³ä¸Šè§’çš„ã€live editorã€‘è¿›è¡Œå®æ—¶ç¼–è¾‘ã€‚</p><p><img src="image-20230226172909167.png" alt="image-20230226172909167"></p><p>å¤åˆ¶ä»£ç å³å¯åœ¨æ€æºç¬”è®°ä¸­çœ‹åˆ°æ•ˆæœ</p><p><img src="image-20230226172955029.png" alt="image-20230226172955029"></p><h1 id="MindMap"><a href="#MindMap" class="headerlink" title="MindMap"></a>MindMap</h1><p>mindmapæ˜¯è„‘å›¾ã€‚</p><p>è¾“å…¥<code>/</code>ï¼Œé€‰æ‹©æ’å…¥MindMap</p><p>ä¹‹åè¿›è¡Œç¼–è¾‘</p><p><img src="image-20230226173129422.png" alt="image-20230226173129422"></p><h1 id="å¤šåª’ä½“"><a href="#å¤šåª’ä½“" class="headerlink" title="å¤šåª’ä½“"></a>å¤šåª’ä½“</h1><p>æ€æºæ”¯æŒå¤šåª’ä½“æ•°æ®çš„æ’å…¥ï¼ŒåŒ…æ‹¬è§†é¢‘ã€é“¾æ¥ã€iframe</p><p>è¿™é‡Œæ’å…¥ä¸€ä¸ªè§†é¢‘ä¸ºä¾‹ï¼š</p><p>è¾“å…¥<code>/</code>ï¼Œé€‰æ‹©æ’å…¥iframeé“¾æ¥ï¼Œå¤åˆ¶è§†é¢‘urlé“¾æ¥ã€‚æ•ˆæœå¦‚ä¸‹</p><p><img src="image-20230226173429042.png" alt="image-20230226173429042"></p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://www.bilibili.com/video/BV1bv4y1r7tA/?spm_id_from=333.788&amp;vd_source=53d8e50bea64fe70bc50c86af86d28e1">https://www.bilibili.com/video/BV1bv4y1r7tA/?spm_id_from=333.788&amp;vd_source=53d8e50bea64fe70bc50c86af86d28e1</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ç®± </category>
          
      </categories>
      
      
        <tags>
            
            <tag> siyuan </tag>
            
            <tag> æ€æº </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> çŸ¥è¯†åº“å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶è¡Œä¸šå°±ä¸šæ–¹å‘è°ƒç ”</title>
      <link href="/2023/02/25/%E8%BD%AF%E4%BB%B6%E8%A1%8C%E4%B8%9A%E5%B0%B1%E4%B8%9A%E6%96%B9%E5%90%91%E8%B0%83%E7%A0%94/"/>
      <url>/2023/02/25/%E8%BD%AF%E4%BB%B6%E8%A1%8C%E4%B8%9A%E5%B0%B1%E4%B8%9A%E6%96%B9%E5%90%91%E8%B0%83%E7%A0%94/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h1><p>æœ¬æ–‡è°ƒç ”äº†ç›®å‰è½¯ä»¶è¡Œä¸šçš„å°±ä¸šæ–¹å‘ã€‚ç”¨äºä¸ªäººé€‰æ‹©åˆé€‚çš„å°±ä¸šå²—ä½ä½¿ç”¨ã€‚ä¸»è¦è°ƒç ”äº†è½¯ä»¶è¡Œä¸šæœ‰å“ªäº›å°±ä¸šæ–¹å‘ï¼Œé’ˆå¯¹è¿™äº›æ–¹å‘åˆè°ƒç ”äº†</p><ol><li>èŒä½å²—ä½</li><li>ç›®å‰éœ€æ±‚ï¼šå¤šè¿˜æ˜¯å°‘ï¼Œä¸ºä»€ä¹ˆ</li><li>å‰æ™¯å¦‚ä½•ï¼šå¥½è¿˜æ˜¯åï¼Œè¿˜æ˜¯ä¸æ˜ï¼›ä»å›½å†…å’Œå›½å¤–ä¸¤ä¸ªè§’åº¦ï¼›æœªæ¥å‘å±•è¯„ä¼°</li><li>ä¼ä¸šï¼šæœ‰å“ªäº›ä¼ä¸šåœ¨åšï¼Œé¾™å¤´ä¼ä¸šæœ‰å“ªäº›ï¼Œä»å›½å†…å¤–ä¸¤æ–¹é¢</li><li>ç»†åˆ†é¢†åŸŸï¼šæ¯”å¦‚è‡ªç„¶è¯­è¨€å¤„ç†æœ‰å¯¹è¯é¢†åŸŸblabla</li><li>ç‰¹ç‚¹ï¼šéš¾åº¦ï¼Œç‰¹ç‚¹</li><li>æŠ€æœ¯è·¯çº¿ï¼šæ•´ç†è¯¥æ–¹å‘çš„æŠ€æœ¯è·¯çº¿å›¾ï¼Œå¯¹è¯¥æ–¹å‘çš„æŠ€æœ¯æ ˆè¿›è¡Œç®€å•ä»‹ç»</li><li>èŒä¸šè§„åˆ’ï¼šæ–¹å‘èŒä¸šçš„å‰è¿›è·¯çº¿ï¼Œåˆçº§-ä¸­çº§ï¼Œblabla</li><li>æ˜¯å¦åˆ©äºå‡ºå›½ï¼šå›½å¤–çš„éœ€æ±‚æ˜¯å¦æ›´æ—ºç››ï¼Œæ˜¯å¦æ›´å®¹æ˜“å‡ºå›½</li></ol><h1 id="è°ƒç ”æ–¹å¼"><a href="#è°ƒç ”æ–¹å¼" class="headerlink" title="è°ƒç ”æ–¹å¼"></a>è°ƒç ”æ–¹å¼</h1><p>æœ¬æ–‡æ±‡æ€»çš„è½¯ä»¶è¡Œä¸šå°±ä¸šæ–¹å‘çš„è°ƒç ”æ–¹å¼æ˜¯ï¼Œé€šè¿‡çŸ¥ä¹ã€bilibiliã€è°·æ­Œã€YouTubeã€å¾®ä¿¡å…¬ä¼—å·ã€GitHubç­‰å¹³å°ï¼Œä½¿ç”¨ä»¥ä¸‹å‡ ç»„å…³é”®è¯ï¼šã€å°±ä¸šã€èŒä¸šã€‘ã€ç¨‹åºå‘˜ã€ç å†œã€è½¯ä»¶è¡Œä¸šã€‘ã€æ–¹å‘ã€å‰æ™¯ã€è§„åˆ’ã€èµ›é“ã€‘ï¼Œæ—¶é—´é€‰å–è¿‘ä¸¤å¹´ï¼Œè¿›è¡Œæœç´¢ï¼Œæ€»ç»“ç›¸å…³è§†é¢‘ã€æ–‡ç« ã€è¯„è®ºç­‰å†…å®¹ã€‚</p><p>å…ˆæœé›†æ•´ç†å¯èƒ½çš„è½¯ä»¶è¡Œä¸šæ–¹å‘ï¼Œå†æ ¹æ®å°†è¿™äº›è½¯ä»¶è¡Œä¸šæ–¹å‘ä½œä¸ºå…³é”®è¯ï¼ŒäºŒæ¬¡æœç´¢ã€‚</p><p>PSç”±äºå›½å†…å¹¿å‘Šå¤ªå¤šï¼Œå¾ˆå¤šè¯éƒ½ä¸å¤ªå¯ä¿¡ã€‚ã€‚</p><h1 id="å¼€å‘æ–¹å‘-å‰ç«¯"><a href="#å¼€å‘æ–¹å‘-å‰ç«¯" class="headerlink" title="å¼€å‘æ–¹å‘-å‰ç«¯"></a>å¼€å‘æ–¹å‘-å‰ç«¯</h1><h2 id="èŒä½å²—ä½"><a href="#èŒä½å²—ä½" class="headerlink" title="èŒä½å²—ä½"></a>èŒä½å²—ä½</h2><p>æ— </p><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>å’Œåç«¯å·®ä¸å¤šã€‚</p><h2 id="å‰æ™¯"><a href="#å‰æ™¯" class="headerlink" title="å‰æ™¯"></a>å‰æ™¯</h2><blockquote><p>Webè¿™ç§è¿˜æ˜¯æŒºæœ‰ç”Ÿå‘½åŠ›çš„ï¼Œä½†æ˜¯ï¼Œä¸€åˆ‡éƒ½æ˜¯åœ¨å˜åŒ–ï¼Œæœ‰å¯èƒ½è‹¥å¹²å¹´åä¸€ä¸ªæŠ€æœ¯å˜é©ï¼ŒWebå°±ä¸§å¤±ä¼˜åŠ¿å˜å¾—é—¨å¯ç½—é›€äº†ï¼Œæ‰€ä»¥å‘¢ï¼Œå„ä½åŒä»ï¼Œè¦æœ‰å¿ƒç†å‡†å¤‡ã€‚</p></blockquote><p>åŒè´¨åŒ–</p><h2 id="ä¼ä¸š"><a href="#ä¼ä¸š" class="headerlink" title="ä¼ä¸š"></a>ä¼ä¸š</h2><p>ä¸å±€é™äºäº’è”ç½‘ï¼Œä½†æ˜¯äº’è”ç½‘çš„æŠ€æœ¯æ›´æ–°ï¼Œæ›´æœ‰ç«äº‰åŠ›ã€‚</p><h2 id="åº”ç”¨é¢†åŸŸ"><a href="#åº”ç”¨é¢†åŸŸ" class="headerlink" title="åº”ç”¨é¢†åŸŸ"></a>åº”ç”¨é¢†åŸŸ</h2><p>ä¸»è¦æ˜¯ç§»åŠ¨ç«¯ã€PCç«¯çš„å‰ç«¯å¼€å‘ï¼Œè¿˜æœ‰æ¸¸æˆï¼Œåç«¯ï¼ˆNodeJSï¼‰ä»¥åŠå…¶ä»–ï¼ˆæ¡Œé¢ç«¯ï¼‰</p><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ol><li>è¶Šæ¥è¶Šå·¥å…·åŒ–ã€å·¥ç¨‹åŒ–</li><li>çŸ¥è¯†çç¢ï¼Œé—¨æ§›ä½</li><li>å‡ºæ•ˆæœå¿«ã€æ¿€åŠ±å‘¨æœŸçŸ­</li></ol><h2 id="æŠ€æœ¯è·¯çº¿"><a href="#æŠ€æœ¯è·¯çº¿" class="headerlink" title="æŠ€æœ¯è·¯çº¿"></a>æŠ€æœ¯è·¯çº¿</h2><p><img src="png-FrontEnd-by-StuQ.png" alt="png-FrontEnd-by-StuQ.png"></p><p>å‰ç«¯å‘å±•ç»å†äº†ä¸‰ä¸ªé˜¶æ®µ:</p><ol><li>åŸç”Ÿhtmlã€jsã€css</li><li>å°è£…åº“ã€jquery</li><li>ç»„ä»¶åŒ–å¼€å‘ï¼šnode</li></ol><h2 id="èŒä¸šè§„åˆ’"><a href="#èŒä¸šè§„åˆ’" class="headerlink" title="èŒä¸šè§„åˆ’"></a>èŒä¸šè§„åˆ’</h2><div class="table-container"><table><thead><tr><th>èŒç§°</th><th>èŒè´£</th><th>å¹´é™(ä»…ä¾›å‚è€ƒ)</th></tr></thead><tbody><tr><td>åˆçº§å·¥ç¨‹å¸ˆ</td><td>èƒ½åœ¨å¯¼å¸ˆçš„å¸®åŠ©(è¯¦ç»†è®¾è®¡, å…³é”®ç‚¹å®ç°)ä¸‹å®Œæˆç®€å•ä»»åŠ¡</td><td>0</td></tr><tr><td>ä¸­çº§å·¥ç¨‹å¸ˆ(å¼€å‘)</td><td>èƒ½åœ¨å¯¼å¸ˆçš„ååŠ©(æ¦‚è¦è®¾è®¡, å…³é”®ç‚¹è¯´æ˜)ä¸‹<strong>ç‹¬ç«‹å®Œæˆ</strong>å¤æ‚ä»»åŠ¡</td><td>1+</td></tr><tr><td>é«˜çº§å·¥ç¨‹å¸ˆ(ç ”å‘)</td><td><strong>èƒ½é«˜è´¨é‡é«˜æ•ˆç‡åœ°ç‹¬ç«‹å®Œæˆä»»åŠ¡</strong></td><td>5+</td></tr><tr><td>èµ„æ·±/é¦–å¸­/ä¸“å®¶/æ¶æ„</td><td>å…¨å±€è§‚, æ—¢æœ‰å¹¿åº¦åˆæœ‰æ·±åº¦, åœ¨æŸä¸ªä¸“ä¸šé¢†åŸŸæœ‰ä¸€å¸­ä¹‹åœ°</td><td>8+</td></tr></tbody></table></div><h2 id="å‡ºå›½"><a href="#å‡ºå›½" class="headerlink" title="å‡ºå›½"></a>å‡ºå›½</h2><p>æ— </p><h1 id="å¼€å‘æ–¹å‘-åç«¯"><a href="#å¼€å‘æ–¹å‘-åç«¯" class="headerlink" title="å¼€å‘æ–¹å‘-åç«¯"></a>å¼€å‘æ–¹å‘-åç«¯</h1><h2 id="èŒä½å²—ä½-1"><a href="#èŒä½å²—ä½-1" class="headerlink" title="èŒä½å²—ä½"></a>èŒä½å²—ä½</h2><p>æ ¹æ®è¯­è¨€ä¸åŒåˆ†ä¸ºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼ŒJavaã€Goç­‰ã€‚</p><p>å»æŸå…¬å¸åšåç«¯å¼€å‘ï¼Œä¸ä¸€å®šå¯¹ä»–ä»¬ç”¨åˆ°çš„è¯­è¨€å’Œæ¡†æ¶å¾ˆç†Ÿç»ƒï¼Œä¼šå…¶ä¸­ä¸€éƒ¨åˆ†å°±å¤Ÿäº†ï¼Œå¾ˆå¤šéƒ½æ˜¯åœ¨å·¥ä½œä¸­å­¦çš„ã€‚</p><h2 id="éœ€æ±‚-1"><a href="#éœ€æ±‚-1" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>å‰åç«¯å·®ä¸å¤šã€‚</p><h2 id="å‰æ™¯-1"><a href="#å‰æ™¯-1" class="headerlink" title="å‰æ™¯"></a>å‰æ™¯</h2><p>éšæ—¶é—´å˜åŒ–å¾ˆå¤§ã€‚ç›®å‰ä¸æ˜ã€‚</p><h2 id="ä¼ä¸š-1"><a href="#ä¼ä¸š-1" class="headerlink" title="ä¼ä¸š"></a>ä¼ä¸š</h2><p>ä¸å±€é™äºäº’è”ç½‘ï¼Œä½†æ˜¯äº’è”ç½‘çš„æŠ€æœ¯æ›´æ–°ï¼Œæ›´æœ‰ç«äº‰åŠ›ã€‚</p><h2 id="åº”ç”¨é¢†åŸŸ-1"><a href="#åº”ç”¨é¢†åŸŸ-1" class="headerlink" title="åº”ç”¨é¢†åŸŸ"></a>åº”ç”¨é¢†åŸŸ</h2><p>é¢†åŸŸå¹¿æ³›ã€‚</p><h2 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ol><li>æ³¨é‡åŠŸèƒ½æ€§å’Œç¨³å®šæ€§</li><li>é—¨ç±»åˆ†æ”¯å¤šï¼šä¸šåŠ¡ã€ç®—æ³•ã€æ¶æ„ã€‚ã€‚ã€‚</li><li>éš¾ä»¥å­¦æ·±ï¼Œå®¹æ˜“ç“¶é¢ˆã€‚è¿™ä¸»è¦æ˜¯å°å…¬å¸ä¸šåŠ¡é‡ä¸å¤Ÿ&amp;å¤§å…¬å¸æ„å»ºæŠ€æœ¯å£å’ï¼Œå°å…¬å¸çš„åç«¯å¼€å‘å®¹æ˜“å’Œå¤§å…¬å¸æ‹‰å¼€å·®è·</li><li>åç«¯çš„å·¥ä½œèŒƒç•´å¾ˆå¹¿ï¼šè®¾è®¡apiã€æ¶æ„ã€æ•°æ®åº“ã€ä¸šåŠ¡é€»è¾‘ã€é«˜å¯ç”¨ç­‰</li><li>éå¸¸è€ƒéªŒã€Šç³»ç»Ÿè®¾è®¡ã€‹çš„èƒ½åŠ›</li></ol><h2 id="RoadMap"><a href="#RoadMap" class="headerlink" title="RoadMap"></a>RoadMap</h2><p>ä»¥Javaä¸ºä¾‹</p><p>å›¾ç‰‡æ¥æºï¼š<a href="https://github.com/s4kibs4mi/java-developer-roadmap/blob/master/i18n/zh-CN/ReadMe-zh-CN.md">https://github.com/s4kibs4mi/java-developer-roadmap/blob/master/i18n/zh-CN/ReadMe-zh-CN.md</a></p><p><img src="java-developer-roadmap-zh-CN.png" alt="Roadmap"></p><h2 id="å‡ºå›½-1"><a href="#å‡ºå›½-1" class="headerlink" title="å‡ºå›½"></a>å‡ºå›½</h2><p>æ— </p><h1 id="å°ç»“ï¼šå‰ç«¯åç«¯å¯¹æ¯”"><a href="#å°ç»“ï¼šå‰ç«¯åç«¯å¯¹æ¯”" class="headerlink" title="å°ç»“ï¼šå‰ç«¯åç«¯å¯¹æ¯”"></a>å°ç»“ï¼šå‰ç«¯åç«¯å¯¹æ¯”</h1><h2 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h2><p>éœ€æ±‚ã€å·¥èµ„ã€å‰æ™¯éƒ½å·®ä¸å¤š</p><p>èŒä¸šå‘å±•è§„åˆ’å·®ä¸å¤š</p><div class="table-container"><table><thead><tr><th>èŒç§°</th><th>èŒè´£</th><th>å¹´é™(ä»…ä¾›å‚è€ƒ)</th></tr></thead><tbody><tr><td>åˆçº§å·¥ç¨‹å¸ˆ</td><td>èƒ½åœ¨å¯¼å¸ˆçš„å¸®åŠ©(è¯¦ç»†è®¾è®¡, å…³é”®ç‚¹å®ç°)ä¸‹å®Œæˆç®€å•ä»»åŠ¡</td><td>0</td></tr><tr><td>ä¸­çº§å·¥ç¨‹å¸ˆ(å¼€å‘)</td><td>èƒ½åœ¨å¯¼å¸ˆçš„ååŠ©(æ¦‚è¦è®¾è®¡, å…³é”®ç‚¹è¯´æ˜)ä¸‹<strong>ç‹¬ç«‹å®Œæˆ</strong>å¤æ‚ä»»åŠ¡</td><td>1+</td></tr><tr><td>é«˜çº§å·¥ç¨‹å¸ˆ(ç ”å‘)</td><td><strong>èƒ½é«˜è´¨é‡é«˜æ•ˆç‡åœ°ç‹¬ç«‹å®Œæˆä»»åŠ¡</strong></td><td>5+</td></tr><tr><td>èµ„æ·±/é¦–å¸­/ä¸“å®¶/æ¶æ„</td><td>å…¨å±€è§‚, æ—¢æœ‰å¹¿åº¦åˆæœ‰æ·±åº¦, åœ¨æŸä¸ªä¸“ä¸šé¢†åŸŸæœ‰ä¸€å¸­ä¹‹åœ°</td><td>8+</td></tr></tbody></table></div><h2 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h2><blockquote><p><strong>åç«¯è¦å­¦çš„æŠ€æœ¯å¤ªå¤šäº†</strong>ï¼Œè€Œå‰ç«¯ç›¸å¯¹æ¥è¯´å°±å°‘å¤šäº†ï¼Œå‹åŠ›è‡ªç„¶å°‘å¾ˆå¤šï¼Œè€Œä¸”åç«¯ä¹Ÿéœ€è¦å­¦ä¸€äº›å‰ç«¯æŠ€æœ¯ï¼Œæœ‰çš„å…¬å¸å°±æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œè€ƒè™‘åˆ°åœ°ä¸­æµ·å¹²æ¶¸é—®é¢˜ï¼Œè‚¯å®šé€‰å‰ç«¯ï¼Œè€Œä¸”å¯¹äºåé¢çš„å‘å±•ï¼Œæ¯”å¦‚<strong>è½¬å‹èµ°ç®¡ç†æ¶æ„ä»€ä¹ˆçš„ï¼Œå‰ç«¯åŸºæœ¬æ²¡æœ‰ä¼˜åŠ¿</strong>ã€‚ä½†æ˜¯ç”±äº<strong>å‰ç«¯æŠ€æœ¯éš¾åº¦å’Œå­¦ä¹ æˆæœ¬ä¸æ˜¯å¤ªå¤§</strong>ï¼Œè€Œä¸”éšç€ç»éªŒç§¯ç´¯ï¼Œå³ä¾¿åˆ°äº†å››åå¤šå²ä¹Ÿå¯ä»¥ç»§ç»­å¼€å‘ï¼Œè€Œåç«¯å†ç»§ç»­æ’¸ä»£ç å°±éš¾å¤šäº†ï¼Œå› ä¸ºæœ¬æ¥å‰ç«¯é€»è¾‘ä»£ç ä¸æ˜¯å¤ªå¤šï¼Œå³ä¾¿æ˜¯ä½¿ç”¨nodeåšå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯å¤æ‚é€»è¾‘ä¹Ÿä¸æ˜¯å¤ªå¤šï¼Œè€Œä¸”å‰ç«¯ç°åœ¨æœ‰å¾ˆå¤šè„šæ‰‹æ¶å’Œæ’ä»¶ï¼Œéƒ½å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ã€‚è€Œåç«¯å°±ä¸ä¸€æ ·äº†ï¼Œæ€§èƒ½ï¼Œå¹¶å‘ï¼Œç®—æ³•ï¼Œå„ç§ä¼˜åŒ–ï¼ŒæœåŠ¡å™¨é—®é¢˜ç­‰ç­‰ï¼Œéƒ½æ˜¯åç«¯è€ƒè™‘çš„ï¼Œè™½ç„¶éšç€å„ç§æŠ€æœ¯çš„å‡ºç°ï¼Œç°åœ¨åç«¯ä¹Ÿå¼€å‘æ²¡æœ‰ä»¥å‰è´¹åŠ²äº†ï¼Œä½†æ˜¯è¦çŸ¥é“åº•å±‚åŸç†å’Œæºç ä½ è¿˜æ˜¯è¦å»ç¿»ï¼Œå„ç§é—®é¢˜è¿˜æ˜¯ä¸»è¦åœ¨åç«¯è¿™è§£å†³çš„ã€‚</p></blockquote><p>è¯„è®ºï¼š</p><p>å‰ç«¯å››åå¤šå²ä¹Ÿå¯ä»¥ç»§ç»­å¼€å‘ï¼Œå­˜ç–‘ã€‚éšç€å‰ç«¯æŠ€æœ¯çš„å‘å±•ï¼Œä¹Ÿå¯èƒ½æŠ€æœ¯éš¾åº¦upï¼Œå››åå¤šå²ä¸èƒ½ç»§ç»­å¼€å‘ã€‚</p><h2 id="æ€ä¹ˆé€‰"><a href="#æ€ä¹ˆé€‰" class="headerlink" title="æ€ä¹ˆé€‰"></a>æ€ä¹ˆé€‰</h2><ul><li>å…´è¶£ã€ç°çŠ¶ï¼šä½ äº†è§£å“ªä¸ªå¤šä¸€ç‚¹å°±é€‰å“ªä¸ª</li><li>èŒä¸šèƒŒæ™¯</li><li>å¹´é¾„</li></ul><h1 id="å¼€å‘æ–¹å‘-å…¨æ ˆ"><a href="#å¼€å‘æ–¹å‘-å…¨æ ˆ" class="headerlink" title="å¼€å‘æ–¹å‘-å…¨æ ˆ"></a>å¼€å‘æ–¹å‘-å…¨æ ˆ</h1><h2 id="RoadMap-1"><a href="#RoadMap-1" class="headerlink" title="RoadMap"></a>RoadMap</h2><p>æ¥æºï¼š<a href="https://github.com/easychen/stack-roadmap">https://github.com/easychen/stack-roadmap</a></p><p><img src="æ–¹ç³–å…¨æ ˆè·¯çº¿å›¾.jpg" alt="img"></p><h2 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼Œ<strong>éš¾åº¦é«˜</strong></p><p>ç‰¹ç‚¹ä¹‹äºŒæ˜¯ï¼Œç¾å›½å…¨æ ˆå²—ä½å¤šï¼Œåé¢å†æ ¹æ®ä¸ªäººç»†åˆ†é¢†åŸŸã€‚<strong>å¯èƒ½åˆ©äºå‡ºå›½</strong>ã€‚</p><p><strong>ä¸é€‚åˆåº”å±Šç”Ÿ</strong></p><p>ä¾æ®æ˜¯2019å¹´stack-overflowçš„è°ƒæŸ¥é—®å·ï¼Œç¨‹åºå‘˜å²—ä½åˆ†å¸ƒï¼š</p><p><img src="image-20230223000029-erjot3z.png" alt="image"></p><h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><p>ç¿»è¯‘è¿‡æ¥å«è´¨é‡ä¿è¯ï¼Œåœ¨å›½å¤–ä¸»è¦æŒ‡çš„æ˜¯æµ‹è¯•ï¼Œtesterã€‚åœ¨å›½å†…è¿˜æœ‰å¦ä¸€ç§ä¸åŒäºæµ‹è¯•çš„è´¨é‡ä¿è¯ã€‚è¿™ç‚¹éœ€è¦æ³¨æ„ï¼Œæ‹›è˜æ—¶çš„QAç©¶ç«ŸæŒ‡çš„æ˜¯è´¨é‡ä¿è¯è¿˜æ˜¯æµ‹è¯•å·¥ç¨‹å¸ˆã€‚</p><h2 id="ç‰¹ç‚¹-3"><a href="#ç‰¹ç‚¹-3" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ol><li>åˆ†æˆä¸¤ç§ï¼Œæ‰‹å·¥æµ‹è¯•å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</li><li>è‡ªåŠ¨åŒ–æµ‹è¯•éœ€è¦å†™ä»£ç ï¼Œéœ€è¦æ‡‚ä¸€ä¸¤é—¨è‡ªåŠ¨åŒ–æµ‹è¯•è¯­è¨€å’Œæ¡†æ¶ã€‚</li><li>æ‰‹å·¥æµ‹è¯•ï¼Œå¯¹å¼€å‘èƒ½åŠ›å’Œå†™ä»£ç èƒ½åŠ›æ²¡æœ‰è¦æ±‚ï¼Œä½†æ˜¯éœ€è¦æœ‰å¼€å‘çš„ç»éªŒã€‚è¿™ç±»å²—ä½åŸºæœ¬è¢«æ·˜æ±°æ‰äº†ã€‚</li></ol><h2 id="RoadMap-2"><a href="#RoadMap-2" class="headerlink" title="RoadMap"></a>RoadMap</h2><p><a href="https://github.com/yangzige/qa-roadmap/blob/main/roadmap/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF.md">https://github.com/yangzige/qa-roadmap/blob/main/roadmap/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF.md</a></p><h1 id="äººå·¥æ™ºèƒ½-CVæ–¹å‘"><a href="#äººå·¥æ™ºèƒ½-CVæ–¹å‘" class="headerlink" title="äººå·¥æ™ºèƒ½-CVæ–¹å‘"></a>äººå·¥æ™ºèƒ½-CVæ–¹å‘</h1><p>2015-2020æ˜¯é»„é‡‘æœŸï¼Œæ‰¾å·¥ä½œæ¯”è¾ƒå®¹æ˜“ã€‚2020ä»¥åèµšé’±çš„ä¸šåŠ¡æŒ–æ˜çš„å·®ä¸å¤šäº†ï¼Œ<strong>å¯¹å­¦å†å’Œè®ºæ–‡çš„è¦æ±‚é«˜</strong>ã€‚</p><p>CVå²—ä½æ¯”å¼€å‘å²—<strong>å°‘å¾ˆå¤š</strong>ã€‚</p><h2 id="å‰æ™¯-2"><a href="#å‰æ™¯-2" class="headerlink" title="å‰æ™¯"></a>å‰æ™¯</h2><p>ä»Šåä¼šèµ°å‘â€œå¹³è¡¡â€ã€‚äººè¯å°±æ˜¯ä¸æ¸©ä¸ç«</p><h2 id="åº”ç”¨é¢†åŸŸ-2"><a href="#åº”ç”¨é¢†åŸŸ-2" class="headerlink" title="åº”ç”¨é¢†åŸŸ"></a>åº”ç”¨é¢†åŸŸ</h2><p><img src="640.png" alt="å›¾ç‰‡"></p><ul><li>è‡ªåŠ¨é©¾é©¶é¢†åŸŸï¼šæ¯”è¾ƒç«</li><li>å·¥ä¸šè§†è§‰é¢†åŸŸï¼šåº”ç”¨æ½œåŠ›å¤§</li><li>æ™ºæ…§åŒ»ç–—ï¼šæœ‰å‰æ™¯ä½†æ¯”è¾ƒå›°éš¾</li></ul><h2 id="RoadMap-3"><a href="#RoadMap-3" class="headerlink" title="RoadMap"></a>RoadMap</h2><p>æ²¡æ‰¾åˆ°æ¯”è¾ƒå¥½çš„ã€‚åŸºæœ¬å°±æ˜¯Pythonã€PyTorchã€æ•°å­—å›¾è±¡å¤„ç†ï¼Œæ·±åº¦å­¦ä¹ é‚£ä¸€å¥—ã€‚ã€‚</p><h1 id="äººå·¥æ™ºèƒ½-NLPæ–¹å‘"><a href="#äººå·¥æ™ºèƒ½-NLPæ–¹å‘" class="headerlink" title="äººå·¥æ™ºèƒ½-NLPæ–¹å‘"></a>äººå·¥æ™ºèƒ½-NLPæ–¹å‘</h1><blockquote><p>è‡ªç„¶è¯­è¨€å¤„ç†(<em>NLP</em>)æ˜¯äººå·¥æ™ºèƒ½æŠ€æœ¯çš„ç‹å† ï¼Œå®ƒæ¨åŠ¨ç€å½“ä»£ç§‘æŠ€çš„æŒç»­å‘å±•å’Œé‡å¤§çªç ´ï¼Œå¹¶è¶Šæ¥è¶Šå¤šåœ°åº”ç”¨äºå„è¡Œå„ä¸šï¼›å®ƒæœ‰ç€ååˆ†é‡è¦çš„å®ç”¨ä»·å€¼ï¼Œä¹Ÿæœ‰ç€é©å‘½æ€§çš„ç†è®º</p></blockquote><h2 id="å‰æ™¯-3"><a href="#å‰æ™¯-3" class="headerlink" title="å‰æ™¯"></a>å‰æ™¯</h2><p>å‰æ™¯å¹¿é˜”ã€‚ä¹‹å‰æ¯”è¾ƒå·ï¼Œç°åœ¨å› ä¸ºChatGPTçš„å‡ºç°ï¼Œç»­äº†ä¸€å£æ°”</p><h2 id="åº”ç”¨é¢†åŸŸ-3"><a href="#åº”ç”¨é¢†åŸŸ-3" class="headerlink" title="åº”ç”¨é¢†åŸŸ"></a>åº”ç”¨é¢†åŸŸ</h2><p>å¯¹è¯ã€é—®ç­”ã€‚</p><h2 id="RoadMap-4"><a href="#RoadMap-4" class="headerlink" title="RoadMap"></a>RoadMap</h2><p><a href="https://github.com/graykode/nlp-roadmap">https://github.com/graykode/nlp-roadmap</a></p><h1 id="äººå·¥æ™ºèƒ½-å…¶ä»–"><a href="#äººå·¥æ™ºèƒ½-å…¶ä»–" class="headerlink" title="äººå·¥æ™ºèƒ½-å…¶ä»–"></a>äººå·¥æ™ºèƒ½-å…¶ä»–</h1><p>äººå·¥æ™ºèƒ½è¿˜åŒ…æ‹¬å…¶ä»–æ–¹å‘ï¼Œä¾‹å¦‚æ¨èç®—æ³•ã€‚</p><h1 id="å¤§æ•°æ®"><a href="#å¤§æ•°æ®" class="headerlink" title="å¤§æ•°æ®"></a>å¤§æ•°æ®</h1><h2 id="èŒä½å²—ä½-2"><a href="#èŒä½å²—ä½-2" class="headerlink" title="èŒä½å²—ä½"></a>èŒä½å²—ä½</h2><p>å¤§æ•°æ®æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¬¼ç»Ÿçš„æ–¹å‘ï¼Œæ—¢å¯ä»¥åšå¤§æ•°æ®å¼€å‘æ–¹å‘ï¼Œä¹Ÿå¯ä»¥åšæ•°æ®æŒ–æ˜ç­‰ç®—æ³•æ–¹å‘ï¼Œä¹Ÿæœ‰å•†ä¸šæ™ºèƒ½BIã€‚ã€‚ã€‚</p><p>å…·ä½“æ–¹å‘æœ‰ä»¥ä¸‹ï¼š</p><ol><li>ETL/æ•°ä»“å·¥ç¨‹å¸ˆï¼šè´Ÿè´£æ•°ä»“å»ºè®¾ï¼Œåè„šæœ¬å¼€å‘ä»¥åŠSQLå¼€å‘ã€‚</li><li>å¤§æ•°æ®å¼€å‘å·¥ç¨‹å¸ˆï¼šè´Ÿè´£æ•°æ®è®¡ç®—ï¼Œåç¦»çº¿ã€‚å®æ—¶ä»£ç å¼€å‘ã€‚</li><li>å¤§æ•°æ®åˆ†æå¸ˆï¼šè´Ÿè´£æ•°æ®æŒ–æ˜åˆ†æã€åä¸šåŠ¡åˆ†æ/SQL</li><li>å¤§æ•°æ®ç®—æ³•å·¥ç¨‹å¸ˆï¼šç®—æ³•å»ºæ¨¡ã€åŸºäºäººå·¥æ™ºèƒ½å»ºæ¨¡ã€‚å¾€å¾€æ˜¯å’Œæ¨èç®—æ³•ç›¸å…³ã€‚</li><li>å¤§æ•°æ®BIå·¥ç¨‹å¸ˆï¼šåæŠ¥è¡¨å’ŒSQLå¼€å‘ã€‚</li></ol><p>ä¸åŒæ–¹å‘çš„å­¦ä¹ è·¯çº¿å’ŒæŠ€èƒ½éƒ½æœ‰æ‰€ä¸åŒã€‚</p><h2 id="éœ€æ±‚-2"><a href="#éœ€æ±‚-2" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>æ²¡æœ‰Javaé‚£ä¹ˆå·ï¼Œä½†æ˜¯å²—ä½ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤šã€‚</p><h2 id="å‰æ™¯-4"><a href="#å‰æ™¯-4" class="headerlink" title="å‰æ™¯"></a>å‰æ™¯</h2><h2 id="ç‰¹ç‚¹-4"><a href="#ç‰¹ç‚¹-4" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ol><li>å¤§æ•°æ®å¼€å‘éœ€è¦å­¦ä¹ çš„ç»„ä»¶éå¸¸å¤šã€‚ä¹Ÿæ¯”è¾ƒéš¾ã€‚</li><li>ETL/æ•°ä»“çš„å·¥ä½œæ¯”è¾ƒåŸºç¡€ã€‚</li><li>å¤§æ•°æ®åˆ†æå’Œç®—æ³•ä¸»è¦åç®—æ³•ç›¸å…³ã€‚</li></ol><h2 id="RoadMap-5"><a href="#RoadMap-5" class="headerlink" title="RoadMap."></a>RoadMap.</h2><p>å­¦ä¹ å¯ä»¥ä»SQLå…¥æ‰‹ã€‚</p><p><a href="https://github.com/TeamStuQ/skill-map/blob/master/data/map-BigDataEngineer.md">https://github.com/TeamStuQ/skill-map/blob/master/data/map-BigDataEngineer.md</a></p><h2 id="ä¸€ç¯‡æœ‰ç”¨çš„æ–‡ç« "><a href="#ä¸€ç¯‡æœ‰ç”¨çš„æ–‡ç« " class="headerlink" title="ä¸€ç¯‡æœ‰ç”¨çš„æ–‡ç« "></a>ä¸€ç¯‡æœ‰ç”¨çš„æ–‡ç« </h2><p>æƒ³å­¦å¤§æ•°æ®ï¼Œå¤§æ•°æ®å¼€å‘ä»¥åçš„å‰æ™¯æ€ä¹ˆæ ·ï¼Œå®¶é‡Œäººå¯¹è¿™æ–¹é¢äº†è§£ä¸æ·±ï¼Œä¸å¤ªåŒæ„è½¬è¡Œï¼Ÿ - äº‘åŸç”Ÿç ”ä¹ ç¤¾çš„å›ç­” - çŸ¥ä¹ <a href="https://www.zhihu.com/question/509912345/answer/2664371834">https://www.zhihu.com/question/509912345/answer/2664371834</a></p><h1 id="UX-UI"><a href="#UX-UI" class="headerlink" title="UX/UI"></a>UX/UI</h1><p>UXæ˜¯User Experienceï¼ˆç”¨æˆ·ä½“éªŒï¼‰çš„ç¼©å†™ï¼ŒæŒ‡çš„æ˜¯å›´ç»•ç”¨æˆ·ï¼Œä»¥ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸»è§‚æ„Ÿå—ä¸ºå‡ºå‘ç‚¹ï¼ŒåŠ›æ±‚æ›´ç®€å•é«˜æ•ˆåœ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚ UXè®¾è®¡å¸ˆçš„èŒè´£ç®€å•æ¥è¯´å°±æ˜¯ä¸ºç”¨æˆ·è®¾è®¡å‹å¥½çš„äº§å“ä½“éªŒï¼Œä»–æ›´å…³æ³¨äº§å“çš„æ˜“ç”¨æ€§ã€å®ç”¨æ€§ã€é«˜æ•ˆæ€§åŠä»·å€¼ä½“ç°ã€‚</p><p>UIçš„å…¨åæ˜¯User Interfaceï¼Œä¸­æ–‡æ˜¯ã€Œä½¿ç”¨è€…ä»‹é¢ã€çš„æ„æ€ã€‚ä»‹é¢æŒ‡çš„æ˜¯APPã€ç¶²é ç­‰ï¼Œå¯ä»¥èˆ‡ä½¿ç”¨è€…äº’å‹•çš„åª’ä»‹ã€‚å¦‚åŒå­—é¢ä¸Šçš„æ„æ€ï¼ŒUIè‘—é‡çš„æ˜¯ä½¿ç”¨è€…ä»‹é¢çš„å‘ˆç¾ï¼Œå¦‚ï¼šè¦–è¦ºç¾æ„Ÿã€è¨­è¨ˆç¾å­¸ã€ä¾¿åˆ©æ€§ã€é¢¨æ ¼å‘ˆç¾ï¼Œç´°ç¯€æ›´åŒ…å«äº†å­—å‹ã€å­—é«”å¤§å°ã€é¡è‰²ã€æ¨™èªŒã€æŒ‰éµã€å‹•ç•«æ•ˆæœç­‰ã€‚UIçš„å‘ˆç¾ï¼Œæœƒå½±éŸ¿åˆ°ä½¿ç”¨è€…çš„ä½¿ç”¨æ„Ÿå—ï¼Œä»¥åŠé †æš¢æ€§ã€‚</p><p>å…¶ä»–ç•¥ã€‚</p><h1 id="æ•°æ®é‡‡é›†"><a href="#æ•°æ®é‡‡é›†" class="headerlink" title="æ•°æ®é‡‡é›†"></a>æ•°æ®é‡‡é›†</h1><p>çˆ¬è™«æ–¹å‘ã€‚ä¸æƒ³è¯´ã€‚ã€‚</p><h1 id="æ•°æ®æŒ–æ˜"><a href="#æ•°æ®æŒ–æ˜" class="headerlink" title="æ•°æ®æŒ–æ˜"></a>æ•°æ®æŒ–æ˜</h1><blockquote><p>å¹¿ä¹‰ä¸Šè¯´ï¼Œä»»ä½•ä»æ•°æ®åº“ä¸­æŒ–æ˜ä¿¡æ¯çš„è¿‡ç¨‹éƒ½å«åšæ•°æ®æŒ–æ˜ã€‚ä»è¿™ç‚¹çœ‹æ¥ï¼Œæ•°æ®æŒ–æ˜å°±æ˜¯BIï¼ˆå•†ä¸šæ™ºèƒ½ï¼‰ã€‚ä½†ä»æŠ€æœ¯æœ¯è¯­ä¸Šè¯´ï¼Œæ•°æ®æŒ–æ˜(Data Mining)ç‰¹æŒ‡çš„æ˜¯ï¼šæºæ•°æ®ç»è¿‡æ¸…æ´—å’Œè½¬æ¢ç­‰æˆä¸ºé€‚åˆäºæŒ–æ˜çš„æ•°æ®é›†ã€‚æ•°æ®æŒ–æ˜åœ¨è¿™ç§å…·æœ‰å›ºå®šå½¢å¼çš„æ•°æ®é›†ä¸Šå®ŒæˆçŸ¥è¯†çš„æç‚¼ï¼Œæœ€åä»¥åˆé€‚çš„çŸ¥è¯†æ¨¡å¼ç”¨äºè¿›ä¸€æ­¥åˆ†æå†³ç­–å·¥ä½œã€‚ä»è¿™ç§ç‹­ä¹‰çš„è§‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ï¼šæ•°æ®æŒ–æ˜æ˜¯ä»ç‰¹å®šå½¢å¼çš„æ•°æ®é›†ä¸­æç‚¼çŸ¥è¯†çš„è¿‡ç¨‹ã€‚æ•°æ®æŒ–æ˜å¾€å¾€é’ˆå¯¹ç‰¹å®šçš„æ•°æ®ã€ç‰¹å®šçš„é—®é¢˜ï¼Œé€‰æ‹©ä¸€ç§æˆ–è€…å¤šç§æŒ–æ˜ç®—æ³•ï¼Œæ‰¾åˆ°æ•°æ®ä¸‹é¢éšè—çš„è§„å¾‹ï¼Œè¿™äº›è§„å¾‹å¾€å¾€è¢«ç”¨æ¥é¢„æµ‹ã€æ”¯æŒå†³ç­–ã€‚</p></blockquote><p>å¯ä»¥æ”¾åˆ°å¤§æ•°æ®çš„æ•°æ®æŒ–æ˜çš„ç›¸å…³å²—ä½æ¥çœ‹ã€‚</p><h2 id="åº”ç”¨é¢†åŸŸ-4"><a href="#åº”ç”¨é¢†åŸŸ-4" class="headerlink" title="åº”ç”¨é¢†åŸŸ"></a>åº”ç”¨é¢†åŸŸ</h2><p>æƒ…æŠ¥æ£€ç´¢ã€æ•°æ®åˆ†æã€æ¨¡å¼è¯†åˆ«</p><h1 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h1><p>å¯ä»¥æ”¾åˆ°å¤§æ•°æ®çš„æ•°æ®å­˜å‚¨çš„ç›¸å…³å²—ä½æ¥çœ‹ã€‚</p><p>ä¸»è¦ç ”ç©¶å„ç§æ•°æ®åº“å­˜å‚¨ã€‚</p><h2 id="æœ‰ç”¨çš„æ–‡ç« "><a href="#æœ‰ç”¨çš„æ–‡ç« " class="headerlink" title="æœ‰ç”¨çš„æ–‡ç« "></a>æœ‰ç”¨çš„æ–‡ç« </h2><p><a href="https://github.com/wx-chevalier/Database-Series">https://github.com/wx-chevalier/Database-Series</a></p><h1 id="åŒºå—é“¾"><a href="#åŒºå—é“¾" class="headerlink" title="åŒºå—é“¾"></a>åŒºå—é“¾</h1><h2 id="å‰æ™¯-5"><a href="#å‰æ™¯-5" class="headerlink" title="å‰æ™¯"></a>å‰æ™¯</h2><p>å‰æ™¯å¾ˆå¥½ã€‚</p><h2 id="æœ‰ç”¨çš„æ–‡ç« -1"><a href="#æœ‰ç”¨çš„æ–‡ç« -1" class="headerlink" title="æœ‰ç”¨çš„æ–‡ç« "></a>æœ‰ç”¨çš„æ–‡ç« </h2><p><a href="https://github.com/LiuBoyu/blockchain">https://github.com/LiuBoyu/blockchain</a></p><p><a href="https://github.com/xianfeng92/Love-Ethereum">https://github.com/xianfeng92/Love-Ethereum</a></p><h2 id="åº”ç”¨é¢†åŸŸ-5"><a href="#åº”ç”¨é¢†åŸŸ-5" class="headerlink" title="åº”ç”¨é¢†åŸŸ"></a>åº”ç”¨é¢†åŸŸ</h2><p>åŒºå—é“¾+ç‰©è”ç½‘</p><h1 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h1><p>ç•¥ï¼Œä¸æ„Ÿå…´è¶£ã€‚ä½†æ˜¯å’ŒåŒºå—é“¾æ¯æ¯ç›¸å…³ã€‚</p><h1 id="æ¸¸æˆå¼€å‘"><a href="#æ¸¸æˆå¼€å‘" class="headerlink" title="æ¸¸æˆå¼€å‘"></a>æ¸¸æˆå¼€å‘</h1><h1 id="VR"><a href="#VR" class="headerlink" title="VR"></a>VR</h1><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="ç´ è´¨è¦æ±‚"><a href="#ç´ è´¨è¦æ±‚" class="headerlink" title="ç´ è´¨è¦æ±‚"></a>ç´ è´¨è¦æ±‚</h2><p>è¿™éƒ¨åˆ†æ˜¯é™¤äº†ç»†åˆ†æ–¹å‘ä¹‹å¤–çš„ï¼Œå¯¹è½¯ä»¶è¡Œä¸šä»ä¸šè€…çš„å…±åŒè¦æ±‚ï¼š</p><ol><li>æ¶‰çŒå…¶å®ƒé¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ï¼Œä¸°å¯Œè‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€æé«˜è‡ªå·±çš„ç»¼åˆç´ è´¨ï¼Œäº‰å–åœ¨è‡ªå·±çš„ä¸“ä¸šé¢†åŸŸæœ‰æ‰€ç§¯ç´¯ï¼Œç„¶åå†åšæ‰©å±•ã€‚<strong>ä¸è¦æŠŠè‡ªå·±çš„çŸ¥è¯†ä½“ç³»å±€é™äºè‡ªå·±çš„å²—ä½ä¸Š</strong></li><li><strong>ç»ˆèº«å­¦ä¹ </strong></li><li>æŠ€æœ¯è§‚ï¼šä¸è¦æ’æ–¥å…¶ä»–æŠ€æœ¯</li><li>äº§å“è§‚ï¼šæœ‰äº§å“å¸¸è¯†</li><li>æ•°æ®è§‚ï¼šå¯¹æ•°æ®æ•æ„Ÿ</li><li>çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä¼šä½¿ç”¨è½®å­ï¼Œä¹Ÿè¦ç ”ç©¶è½®å­ã€‚</li></ol><h2 id="ç¾å›½ç¡•å£«åšå£«CSä¸“ä¸šåˆ†ç±»"><a href="#ç¾å›½ç¡•å£«åšå£«CSä¸“ä¸šåˆ†ç±»" class="headerlink" title="ç¾å›½ç¡•å£«åšå£«CSä¸“ä¸šåˆ†ç±»"></a>ç¾å›½ç¡•å£«åšå£«CSä¸“ä¸šåˆ†ç±»</h2><p><img src="image-20230223090322289.png" alt="image-20230223090322289"></p><p><img src="image-20230223090346670.png" alt="image-20230223090346670"></p><h2 id="è®¡ç®—æœºç§‘å­¦çš„ä¸»è¦åˆ†æ”¯"><a href="#è®¡ç®—æœºç§‘å­¦çš„ä¸»è¦åˆ†æ”¯" class="headerlink" title="è®¡ç®—æœºç§‘å­¦çš„ä¸»è¦åˆ†æ”¯"></a>è®¡ç®—æœºç§‘å­¦çš„ä¸»è¦åˆ†æ”¯</h2><p><img src="815c0d5aed01530b7cf11d0c9061ec70.png" alt="815c0d5aed01530b7cf11d0c9061ec70.png"></p><h1 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h1><p>è¿™ç¯‡æ–‡ç« éå¸¸æµ…è–„ï¼Œæ²¡æœ‰ä»”ç»†åˆ†æå„ä¸ªè¡Œä¸šçš„ç°çŠ¶å’Œæƒ…å†µã€‚åªæ˜¯ç½—åˆ—äº†ä¸€äº›èµ„æ–™ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶è¡Œä¸š </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Visual Attention Network</title>
      <link href="/2023/02/04/Visual-Attention-Network/"/>
      <url>/2023/02/04/Visual-Attention-Network/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ˜¯è®ºæ–‡ã€ŠVisual Attention Networkã€‹çš„å­¦ä¹ ç¬”è®°</p><p>æˆ‘åœ¨è¯¥æ¨¡å‹ä¸Šæ‰§è¡Œä¸€ä¸ªåˆ†ç±»ä»»åŠ¡ï¼Œå‘ç°è¯¥æ¨¡å‹çš„æ•ˆæœè¦ä¼˜äºæˆ‘å®éªŒçš„å…¶ä»–æ¨¡å‹ï¼ˆåŒ…æ‹¬resnet50ã€densenet121ã€efficientNet-b0ã€swin-tinyï¼‰</p><p>æ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼Œç¬”è®°å¤§å¤šæ˜¯æŠ„çš„ï¼Œå‡ºå¤„åœ¨Refsä¸Šè¡¨æ˜ï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»æˆ‘ã€‚</p><p><a href="https://arxiv.org/abs/2202.09741">è®ºæ–‡åœ°å€</a>   <a href="https://github.com/Visual-Attention-Network">ä»£ç åœ°å€</a></p></blockquote><p>â€</p><h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="è‡ªæ³¨æ„åŠ›æœºåˆ¶"><a href="#è‡ªæ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="è‡ªæ³¨æ„åŠ›æœºåˆ¶"></a>è‡ªæ³¨æ„åŠ›æœºåˆ¶</h2><p><a href="https://zhuanlan.zhihu.com/p/265108616">Attentionæ³¨æ„åŠ›æœºåˆ¶ä¸self-attentionè‡ªæ³¨æ„åŠ›æœºåˆ¶</a></p><p><a href="https://www.jiqizhixin.com/articles/100902">ä»€ä¹ˆæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ</a></p><h2 id="ç©ºé—´ç›¸å…³æ€§å’Œé€šé“ç›¸å…³æ€§1"><a href="#ç©ºé—´ç›¸å…³æ€§å’Œé€šé“ç›¸å…³æ€§1" class="headerlink" title="ç©ºé—´ç›¸å…³æ€§å’Œé€šé“ç›¸å…³æ€§1"></a>ç©ºé—´ç›¸å…³æ€§å’Œé€šé“ç›¸å…³æ€§<sup><a href="#fn_1" id="reffn_1">1</a></sup></h2><p>ä»ç»´åº¦çš„è§’åº¦çœ‹ï¼Œå·ç§¯æ ¸å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç©ºé—´ç»´(å®½å’Œé«˜)å’Œé€šé“ç»´çš„ç»„åˆï¼Œè€Œ<strong>å·ç§¯æ“ä½œåˆ™å¯ä»¥è§†ä¸ºç©ºé—´ç›¸å…³æ€§å’Œé€šé“ç›¸å…³æ€§çš„è”åˆæ˜ å°„</strong>ã€‚ä»inceptionçš„1x1å·ç§¯æ¥çœ‹ï¼Œ<strong>å·ç§¯ä¸­çš„ç©ºé—´ç›¸å…³æ€§å’Œé€šé“ç›¸å…³æ€§æ˜¯å¯ä»¥è§£è€¦çš„ï¼Œå°†å®ƒä»¬åˆ†å¼€è¿›è¡Œæ˜ å°„ï¼Œå¯èƒ½ä¼šè¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚</strong></p><p>æ·±åº¦å¯åˆ†ç¦»å·ç§¯æ˜¯åœ¨1x1å·ç§¯åŸºç¡€ä¸Šçš„ä¸€ç§åˆ›æ–°ã€‚ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šæ·±åº¦å·ç§¯å’Œ1x1å·ç§¯ã€‚æ·±åº¦å·ç§¯çš„ç›®çš„åœ¨äºå¯¹è¾“å…¥çš„æ¯ä¸€ä¸ªé€šé“éƒ½å•ç‹¬ä½¿ç”¨ä¸€ä¸ªå·ç§¯æ ¸å¯¹å…¶è¿›è¡Œå·ç§¯ï¼Œä¹Ÿå°±æ˜¯é€šé“åˆ†ç¦»åå†ç»„åˆã€‚1x1å·ç§¯çš„ç›®çš„åˆ™åœ¨äºåŠ å¼ºæ·±åº¦ã€‚ä¸‹é¢ä»¥ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸‹æ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç”¨128ä¸ª$3 \times3 \times3$çš„æ»¤æ³¢å™¨å¯¹ä¸€ä¸ª $7 \times7 \times3$çš„è¾“å…¥è¿›è¡Œå·ç§¯ï¼Œå¯å¾—åˆ°$5 \times5 \times128$çš„è¾“å‡º,å…¶è®¡ç®—é‡ä¸º$5 \times5 \times128 \times3 \times3 \times3=86400$ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="image-20230204110644-zz7yeyj.png" alt="image">â€‹</p><p>ç°åœ¨çœ‹å¦‚ä½•ä½¿ç”¨æ·±åº¦å¯åˆ†ç¦»å·ç§¯æ¥å®ç°åŒæ ·çš„ç»“æœã€‚æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„ç¬¬ä¸€æ­¥æ˜¯æ·±åº¦å·ç§¯ã€‚è¿™é‡Œçš„æ·±åº¦å·ç§¯ï¼Œå°±æ˜¯åˆ†åˆ«ç”¨3ä¸ª$3 \times3 \times1$çš„æ»¤æ³¢å™¨å¯¹è¾“å…¥çš„3ä¸ªé€šé“åˆ†åˆ«åšå·ç§¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¦åš3æ¬¡å·ç§¯ï¼Œæ¯æ¬¡å·ç§¯éƒ½æœ‰ä¸€ä¸ª$5 \times5 \times1$çš„è¾“å‡ºï¼Œç»„åˆåœ¨ä¸€èµ·ä¾¿æ˜¯$5 \times5 \times3$çš„è¾“å‡ºã€‚ç°åœ¨ä¸ºäº†æ‹“å±•æ·±åº¦è¾¾åˆ°128ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„ç¬¬äºŒæ­¥ï¼š1x1å·ç§¯ã€‚ç°åœ¨æˆ‘ä»¬ç”¨128ä¸ª$1 \times1 \times3$çš„æ»¤æ³¢å™¨å¯¹$5 \times5 \times3$è¿›è¡Œå·ç§¯ï¼Œå°±å¯ä»¥å¾—åˆ°$5 \times5 \times128$çš„è¾“å‡ºã€‚å®Œæ•´è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="image-20230204111234-3ia5cu3.png" alt="image">â€‹</p><p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„è®¡ç®—é‡å¦‚ä½•ã€‚ç¬¬ä¸€æ­¥æ·±åº¦å·ç§¯çš„è®¡ç®—é‡ï¼š$5 \times5 \times1 \times3 \times3 \times1 \times3=675$ã€‚ç¬¬äºŒæ­¥1x1å·ç§¯çš„è®¡ç®—é‡ï¼š$5 \times5 \times128 \times1 \times1 \times3=9600$ï¼Œåˆè®¡è®¡ç®—é‡ä¸º10275æ¬¡ã€‚å¯è§ï¼Œç›¸åŒçš„å·ç§¯è®¡ç®—è¾“å‡ºï¼Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯è¦æ¯”å¸¸è§„å·ç§¯èŠ‚çœ12å€çš„è®¡ç®—æˆæœ¬ã€‚</p><blockquote><p>å…¸å‹çš„åº”ç”¨æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„ç½‘ç»œæ¨¡å‹åŒ…æ‹¬xceptionå’Œmobilenetç­‰ã€‚æœ¬è´¨ä¸Šè€Œè¨€ï¼Œxceptionå°±æ˜¯åº”ç”¨äº†æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„inceptionç½‘ç»œã€‚</p></blockquote><h1 id="æ­£æ–‡2"><a href="#æ­£æ–‡2" class="headerlink" title="æ­£æ–‡2"></a>æ­£æ–‡<sup><a href="#fn_2" id="reffn_2">2</a></sup></h1><h2 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h2><p>å›¾åƒçš„äºŒç»´æ€§è´¨ç»™åœ¨è®¡ç®—æœºè§†è§‰ä¸­åº”ç”¨è‡ªæ³¨æ„åŠ›å¸¦æ¥äº†ä¸‰ä¸ªæŒ‘æˆ˜ï¼š</p><ol><li>å°†å›¾åƒå¤„ç†ä¸ºä¸€ç»´åºåˆ—ï¼Œå¿½ç•¥äº†å…¶äºŒç»´ç»“æ„ã€‚</li><li>äºŒæ¬¡å¤æ‚åº¦å¯¹äºé«˜åˆ†è¾¨ç‡çš„å›¾åƒæ¥è¯´å¤ªè´µäº†ã€‚</li><li>å®ƒåªæ•æ‰äº†ç©ºé—´é€‚åº”æ€§ï¼Œè€Œå¿½ç•¥äº†é€šé“é€‚åº”æ€§</li></ol><p>åœ¨æœ¬æ–‡ä¸­ï¼Œä½œè€…æå‡ºäº†ä¸€ç§æ–°çš„å¤§æ ¸æ³¨æ„(LKA)æ¨¡å—ï¼Œä»¥ä½¿è‡ªæ³¨æ„çš„è‡ªé€‚åº”å’Œé•¿ç¨‹ç›¸å…³ï¼ŒåŒæ—¶é¿å…äº†ä¸Šè¿°é—®é¢˜ã€‚ä½œè€…è¿›ä¸€æ­¥ä»‹ç»äº†ä¸€ç§åŸºäºLKAçš„æ–°çš„ç¥ç»ç½‘ç»œï¼Œå³è§†è§‰æ³¨æ„ç½‘ç»œ(VAN)ã€‚VANè™½ç„¶éå¸¸ç®€å•å’Œé«˜æ•ˆï¼Œä½†åœ¨åŒ…æ‹¬å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²ã€å®ä¾‹åˆ†å‰²ç­‰å¹¿æ³›çš„å®éªŒä¸­ï¼Œå®ƒä»¥å¾ˆå¤§çš„ä¼˜åŠ¿ä¼˜äºæœ€å…ˆè¿›çš„transfomerå’Œå·ç§¯ç¥ç»ç½‘ç»œã€‚</p><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><h3 id="LCK"><a href="#LCK" class="headerlink" title="LCK"></a>LCK</h3><p>å·ç§¯ç¥ç»ç½‘ç»œ(CNNs)åˆ©ç”¨å±€éƒ¨ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå¹³ç§»ä¸å˜æ€§ï¼Œå¤§å¤§æé«˜äº†ç¥ç»ç½‘ç»œçš„æ•ˆç‡ã€‚è‡ªAlexNetä»¥æ¥ï¼Œcnnè¿…é€Ÿæˆä¸ºè®¡ç®—æœºè§†è§‰çš„ä¸»è¦ä¸»æµæ¡†æ¶ã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼Œç ”ç©¶äººå‘˜æŠ•å…¥äº†å¤§é‡çš„ç²¾åŠ›ï¼Œä½¿cnnæˆä¸ºæ›´æ·±çš„å’Œæ›´è½»çš„ã€‚ä½œè€…çš„å·¥ä½œä¸MobileNetæœ‰ç›¸ä¼¼ä¹‹å¤„ï¼ŒMobileNetå°†æ ‡å‡†å·ç§¯è§£è€¦ä¸ºä¸¤éƒ¨åˆ†ï¼Œå³æ·±åº¦å·ç§¯å’Œé€ç‚¹å·ç§¯(ä¹Ÿå°±æ˜¯1Ã—1Conv)ã€‚ä½œè€…çš„æ–¹æ³•å°†å·ç§¯åˆ†è§£ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šæ·±åº¦å·ç§¯ã€æ·±åº¦ç©ºæ´å·ç§¯å’Œé€ç‚¹å·ç§¯ã€‚å¾—ç›Šäºè¿™ç§åˆ†è§£ï¼Œä½œè€…çš„æ–¹æ³•æ›´é€‚åˆäºæœ‰æ•ˆåœ°åˆ†è§£å¤§çš„æ ¸å·ç§¯ã€‚ä½œè€…è¿˜åœ¨è¯¥æ–¹æ³•ä¸­å¼•å…¥äº†æ³¨æ„æœºåˆ¶æ¥è·å¾—è‡ªé€‚åº”ç‰¹æ€§ã€‚</p><p><img src="v2-467f001629900492069a79a14d2dc757_720w.webp" alt="img"></p><p>å½©è‰²ç½‘æ ¼è¡¨ç¤ºå·ç§¯æ ¸çš„ä½ç½®ï¼Œé»„è‰²ç½‘æ ¼è¡¨ç¤ºä¸­å¿ƒç‚¹ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ13Ã—13å·ç§¯åˆ†è§£ä¸º5Ã—5æ·±åº¦å·ç§¯ï¼Œ5Ã—5æ·±åº¦ç©ºæ´å·ç§¯ï¼Œè†¨èƒ€é€Ÿç‡3å’Œ1Ã—1å·ç§¯</p><p><img src="v2-d22b7728ed41dd3491530ad8a94fbe19_720w.webp" alt="img"></p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">class AttentionModule(nn.Module):</span><br><span class="line">    def __init__(self, dim):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.conv0 = nn.Conv2d(dim, dim, 5, padding=2, groups=dim)#æ·±åº¦å·ç§¯</span><br><span class="line">        self.conv_spatial = nn.Conv2d(dim, dim, 7, stride=1, padding=9, groups=dim, dilation=3)#æ·±åº¦ç©ºæ´å·ç§¯</span><br><span class="line">        self.conv1 = nn.Conv2d(dim, dim, 1)#é€ç‚¹å·ç§¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        u = x.clone()        </span><br><span class="line">        attn = self.conv0(x)</span><br><span class="line">        attn = self.conv_spatial(attn)</span><br><span class="line">        attn = self.conv1(attn)</span><br><span class="line"></span><br><span class="line">        return u * attn   #æ³¨æ„åŠ›æ“ä½œ</span><br><span class="line">     </span><br><span class="line">class SpatialAttention(nn.Module):</span><br><span class="line">    def __init__(self, d_model):</span><br><span class="line">        super().__init__()</span><br><span class="line"></span><br><span class="line">        self.proj_1 = nn.Conv2d(d_model, d_model, 1)</span><br><span class="line">        self.activation = nn.GELU()</span><br><span class="line">        self.spatial_gating_unit = AttentionModule(d_model)  #æ³¨æ„åŠ›æ“ä½œ</span><br><span class="line">        self.proj_2 = nn.Conv2d(d_model, d_model, 1)</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        shorcut = x.clone()</span><br><span class="line">        x = self.proj_1(x)</span><br><span class="line">        x = self.activation(x)</span><br><span class="line">        x = self.spatial_gating_unit(x)  #æ³¨æ„åŠ›æ“ä½œ</span><br><span class="line">        x = self.proj_2(x)</span><br><span class="line">        x = x + shorcut   #æ®‹å·®è¿æ¥</span><br><span class="line">        return x</span><br><span class="line"></span><br><span class="line">class Block(nn.Module):</span><br><span class="line">    def __init__(self, dim, mlp_ratio=4., drop=0.,drop_path=0., act_layer=nn.GELU):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.norm1 = nn.BatchNorm2d(dim)</span><br><span class="line">        self.attn = SpatialAttention(dim)</span><br><span class="line">        self.drop_path = DropPath(drop_path) if drop_path &gt; 0. else nn.Identity()</span><br><span class="line"></span><br><span class="line">        self.norm2 = nn.BatchNorm2d(dim)</span><br><span class="line">        mlp_hidden_dim = int(dim * mlp_ratio)</span><br><span class="line">        self.mlp = Mlp(in_features=dim, hidden_features=mlp_hidden_dim, act_layer=act_layer, drop=drop)</span><br><span class="line">        layer_scale_init_value = 1e-2            </span><br><span class="line">        self.layer_scale_1 = nn.Parameter(</span><br><span class="line">            layer_scale_init_value * torch.ones((dim)), requires_grad=True)</span><br><span class="line">        self.layer_scale_2 = nn.Parameter(</span><br><span class="line">            layer_scale_init_value * torch.ones((dim)), requires_grad=True)</span><br><span class="line"></span><br><span class="line">        self.apply(self._init_weights)</span><br><span class="line"></span><br><span class="line">    def _init_weights(self, m):</span><br><span class="line">        if isinstance(m, nn.Linear):</span><br><span class="line">            trunc_normal_(m.weight, std=.02)</span><br><span class="line">            if isinstance(m, nn.Linear) and m.bias is not None:</span><br><span class="line">                nn.init.constant_(m.bias, 0)</span><br><span class="line">        elif isinstance(m, nn.LayerNorm):</span><br><span class="line">            nn.init.constant_(m.bias, 0)</span><br><span class="line">            nn.init.constant_(m.weight, 1.0)</span><br><span class="line">        elif isinstance(m, nn.Conv2d):</span><br><span class="line">            fan_out = m.kernel_size[0] * m.kernel_size[1] * m.out_channels</span><br><span class="line">            fan_out //= m.groups</span><br><span class="line">            m.weight.data.normal_(0, math.sqrt(2.0 / fan_out))</span><br><span class="line">            if m.bias is not None:</span><br><span class="line">                m.bias.data.zero_()</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        x = x + self.drop_path(self.layer_scale_1.unsqueeze(-1).unsqueeze(-1) * self.attn(self.norm1(x)))#drop_pathåˆ†æ”¯ä¸­ï¼Œæ¯ä¸ªbatchæœ‰æ¦‚ç‡ä½¿æ ·æœ¬åœ¨self.attnæˆ–è€…mlpä¸ä¼šâ€æ‰§è¡Œâ€œï¼Œä¼šä»¥0ç›´æ¥ä¼ é€’ã€‚</span><br><span class="line">        x = x + self.drop_path(self.layer_scale_2.unsqueeze(-1).unsqueeze(-1) * self.mlp(self.norm2(x)))</span><br><span class="line">        return </span><br></pre></td></tr></table></figure><p>ä½œè€…æå‡ºå¯¹å¤§æ ¸å·ç§¯æ“ä½œè¿›è¡Œåˆ†è§£æ¥æ•è·é•¿ç¨‹å…³ç³»ã€‚å¤§æ ¸å·ç§¯å¯åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šç©ºé—´å±€éƒ¨å·ç§¯ï¼ˆæ·±åº¦å·ç§¯ï¼‰ã€ç©ºé—´è¿œç¨‹å·ç§¯ï¼ˆæ·±åº¦ç©ºæ´å·ç§¯ï¼‰å’Œé€šé“å·ç§¯ï¼ˆ1Ã—1å·ç§¯ï¼‰ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å°†KÃ—Kå·ç§¯åˆ†è§£ä¸ºK/dÃ—K/dçš„æ·±åº¦ç©ºæ´å·ç§¯ï¼Œ(2dâˆ’1)Ã—(2dâˆ’1)çš„æ·±åº¦å·ç§¯å’Œ1Ã—1å·ç§¯ã€‚é€šè¿‡ä¸Šè¿°åˆ†è§£ï¼Œå¯ä»¥ç”¨è½»å¾®çš„è®¡ç®—ä»£ä»·å’Œå‚æ•°æ¥æ•è·é•¿ç¨‹å…³ç³»ã€‚åœ¨å¾—åˆ°é•¿ç¨‹å…³ç³»åï¼Œå¯ä»¥ä¼°è®¡ä¸€ä¸ªç‚¹çš„é‡è¦æ€§å¹¶ç”Ÿæˆæ³¨æ„åŠ›å›¾ã€‚</p><p><img src="v2-f2a083b057051de4ae3a87fd77138a8e_720w.webp" alt="img"></p><p><img src="v2-6109ccc0466efee70bf7ac2324513a09_720w.webp" alt="img"></p><p>ä½œè€…æå‡ºçš„LKAç»“åˆäº†å·ç§¯å’Œè‡ªæ³¨æ„åŠ›çš„ä¼˜ç‚¹ã€‚å®ƒè€ƒè™‘äº†å±€éƒ¨ä¸Šä¸‹æ–‡ä¿¡æ¯ã€å¤§çš„æ„Ÿå—é‡å’ŒåŠ¨æ€è¿‡ç¨‹ã€‚æ­¤å¤–ï¼ŒLKAä¸ä»…å®ç°äº†ç©ºé—´ç»´åº¦çš„è‡ªé€‚åº”æ€§ï¼Œè€Œä¸”è¿˜å®ç°äº†é€šé“ç»´åº¦çš„è‡ªé€‚åº”æ€§ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œä¸åŒçš„é€šé“å¾€å¾€ä»£è¡¨ä¸åŒçš„å¯¹è±¡ï¼Œè€Œé€šé“ç»´åº¦çš„é€‚åº”æ€§å¯¹è§†è§‰ä»»åŠ¡ä¹Ÿå¾ˆé‡è¦ã€‚</p><h3 id="VAN"><a href="#VAN" class="headerlink" title="VAN"></a>VAN</h3><p>VANå…·æœ‰ç®€å•çš„å±‚æ¬¡ç»“æ„ï¼Œå³è¾“å‡ºç©ºé—´åˆ†è¾¨ç‡é™ä½çš„å››ä¸ªé˜¶æ®µåºåˆ—ï¼Œåˆ†åˆ«ä¸ºH/4Ã—W/4ã€H/8Ã—W/8ã€H/16Ã—W/16å’ŒH/32Ã—W/32ã€‚Hå’ŒWæ˜¯è¾“å…¥å›¾åƒçš„é«˜åº¦å’Œå®½åº¦ã€‚éšç€åˆ†è¾¨ç‡çš„é™ä½ï¼Œè¾“å‡ºé€šé“çš„æ•°é‡ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚è¾“å‡ºé€šé“Ciçš„å˜åŒ–å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ é¦–å…ˆå¯¹è¾“å…¥å€¼è¿›è¡Œä¸‹é‡‡æ ·ï¼Œå¹¶ä½¿ç”¨æ­¥å¹…æ•°æ¥æ§åˆ¶ä¸‹é‡‡æ ·ç‡ã€‚ä¸‹é‡‡æ ·åï¼Œä¸€ä¸ªstageä¸­çš„æ‰€æœ‰å±‚ä¿æŒç›¸åŒçš„è¾“å‡ºå¤§å°ï¼Œå³ç©ºé—´åˆ†è¾¨ç‡å’Œé€šé“æ•°é‡ã€‚ç„¶åï¼Œæ‰¹é‡å½’ä¸€åŒ–ã€GELUæ¿€æ´»å‡½æ•°ã€å¤§æ ¸æ³¨æ„å’Œå·ç§¯å‰é¦ˆç½‘ç»œä¾æ¬¡å †å ï¼Œæå–ç‰¹å¾ã€‚æœ€åï¼Œåœ¨æ¯ä¸ªé˜¶æ®µç»“æŸæ—¶åº”ç”¨ä¸€ä¸ªå±‚å½’ä¸€åŒ–ã€‚æ ¹æ®å‚æ•°å’Œè®¡ç®—æˆæœ¬ï¼Œè®¾è®¡äº† VAN-Tiny, VAN-Small, VAN-Base and VAN-Largeå››ç§ç»“æ„ã€‚</p><p><img src="v2-9c29743630133af223ffb0b9d3c592f0_720w.webp" alt="img"></p><p><img src="v2-f3d5e05ccc5b5d1691c26fc3d8daafcd_720w.webp" alt="img"></p><p>å¯¹21Ã—21å·ç§¯çš„ä¸åŒæ–¹å¼å‚æ•°çš„æ¯”è¾ƒã€‚Xï¼ŒYå’Œouråˆ†åˆ«æä¾›äº†æ ‡å‡†å·ç§¯ï¼Œmobilenet]å’Œvançš„åˆ†è§£ã€‚è¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒå¤§å°çš„HÃ—WÃ—C</p><p><img src="v2-f39da3202b78c90cd02669ff5039e8a9_720w.webp" alt="img"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬æ–‡çš„LKAé‡‡ç”¨5Ã—5æ·±åº¦å·ç§¯ï¼Œ7Ã—7æ·±åº¦å·ç§¯ä¸è†¨èƒ€ç‡ä¸º3çš„ç©ºæ´å·ç§¯å’Œ1Ã—1å·ç§¯æ¥è¿‘ä¼¼21Ã—21å·ç§¯ã€‚åœ¨è¿™ç§è®¾ç½®ä¸‹ï¼ŒVANå¯ä»¥æœ‰æ•ˆåœ°è·å–å±€éƒ¨ä¿¡æ¯å’Œé•¿ç¨‹è”ç³»ã€‚ä½œè€…åˆ†åˆ«ä½¿ç”¨7Ã—7å’Œ3Ã—3æ­¥å¹…å·ç§¯è¿›è¡Œ4Ã—å’Œ2Ã—çš„é™é‡‡æ ·ã€‚</p><h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>ä½œè€…åœ¨ImageNet-1Kå›¾åƒåˆ†ç±»æ•°æ®é›†ã€COCOç›®æ ‡æ£€æµ‹æ•°æ®é›†å’ŒADE20Kè¯­ä¹‰åˆ†å‰²æ•°æ®é›†ä¸Šè¿›è¡Œäº†å®šé‡å®éªŒã€‚æ­¤å¤–ï¼Œä½œè€…é€šè¿‡åœ¨ImageNetéªŒè¯é›†ä¸Šä½¿ç”¨Grad-CAMæ¥å¯è§†åŒ–ç±»æ¿€æ´»æ˜ å°„(CAM)ã€‚</p><h3 id="å›¾åƒåˆ†ç±»"><a href="#å›¾åƒåˆ†ç±»" class="headerlink" title="å›¾åƒåˆ†ç±»"></a>å›¾åƒåˆ†ç±»</h3><p><img src="https://pic2.zhimg.com/80/v2-2fefbe89e8e7da997c3683528fbb2535_720w.webp" alt="img"></p><p>VANä¸å…¶ä»–mlpã€cnnå’ŒViTsçš„æ¯”è¾ƒã€‚VANä¼˜äºå…¶ä»–å‚æ•°ç›¸ä¼¼ï¼Œè®¡ç®—æˆæœ¬ç›¸ä¼¼çš„cnn(ResNet[29]ï¼ŒResNeXt[90]ï¼ŒConvNeXt[53]ç­‰)ï¼ŒViTs(DeiT[74]ã€PVT[83]ã€Swin-Transformer[52]ç­‰)å’ŒMLPs(MLP-Mixer[72]ï¼ŒResMLP[73]ï¼ŒgMLP[46]ç­‰)ã€‚ä½œè€…åœ¨æ¯ä¸ªç±»åˆ«ä¸­é€‰æ‹©äº†ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„ç½‘ç»œè¿›è¡Œè®¨è®ºã€‚ConvNeXt[53]æ˜¯ä¸€ç§ç‰¹æ®Šçš„CNNï¼Œå®ƒå¸æ”¶äº†vitçš„ä¸€äº›ä¼˜åŠ¿ï¼Œå¦‚å¤§çš„æ„Ÿå—é‡ï¼ˆ7Ã—7å·ç§¯ï¼‰å’Œå…ˆè¿›çš„è®­ç»ƒç­–ç•¥(300ä¸ªepochã€æ•°æ®å¢å¼ºç­‰)ã€‚VANå’ŒConvNeXt[53]ç›¸æ¯”ï¼ŒVAN-baseæ¯”CoNvNeXt-tå¤šå‡º0.7%(82.8%vs.82.1%)ï¼Œå› ä¸ºVANå…·æœ‰æ›´å¤§çš„æ„Ÿå—åŸŸå’Œè‡ªé€‚åº”èƒ½åŠ›ã€‚Swin-Transformeræ˜¯ä¸€ç§è‘—åçš„ViTå˜ä½“ï¼Œé‡‡ç”¨å±€éƒ¨æ³¨æ„åŠ›å’Œç§»åŠ¨çª—å£çš„æ–¹å¼ã€‚ç”±äºVANå¯¹äºŒç»´ç»“æ„ä¿¡æ¯éå¸¸å‹å¥½ï¼Œå…·æœ‰è¾ƒå¤§çš„æ„Ÿå—é‡ï¼Œå¹¶åœ¨é€šé“ç»´åº¦ä¸Šå®ç°äº†è‡ªé€‚åº”æ€§ï¼ŒVAN-Baseè¶…è¿‡Swin-T1.5%(82.8%vs.81.3%)ã€‚å¯¹äºMLPsï¼Œé€‰æ‹©gMLP[46]ã€‚VAN-Baseè¶…è¿‡gMLP-S[46]3.2%(82.8%vs.79.6%)ã€‚ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåœ¨å°å‹æ¨¡å‹ä¸Šé¢VANçš„è¡¨ç°æ›´åŠ å‡ºè‰²ã€‚</p><h3 id="ç›®æ ‡æ£€æµ‹"><a href="#ç›®æ ‡æ£€æµ‹" class="headerlink" title="ç›®æ ‡æ£€æµ‹"></a>ç›®æ ‡æ£€æµ‹</h3><p><img src="v2-c04b7aef7af9212da50e947198ea0179_720w.webp" alt="img"></p><p><img src="v2-ac6fd9136c34fa6ebfce940f20b6a318_720w.webp" alt="img"></p><p><img src="v2-f0a76550ee33afe78ff4d4458f544c25_720w.webp" alt="img"></p><h3 id="è¯­ä¹‰åˆ†å‰²"><a href="#è¯­ä¹‰åˆ†å‰²" class="headerlink" title="è¯­ä¹‰åˆ†å‰²"></a>è¯­ä¹‰åˆ†å‰²</h3><p><img src="v2-5675289d453da40b8f33f28c1966aa44_720w.webp" alt="img"></p><h3 id="æ¶ˆèå®éªŒ"><a href="#æ¶ˆèå®éªŒ" class="headerlink" title="æ¶ˆèå®éªŒ"></a>æ¶ˆèå®éªŒ</h3><p><img src="v2-1f9970a60d196d053e6433e7bbcca814_720w.webp" alt="img"></p><p>DW-D-Convæä¾›äº†æ·±åº¦ç©ºæ´å·ç§¯ï¼Œè¿™åœ¨æ•è·LKAä¸­çš„é•¿ç¨‹ä¾èµ–æ€§ä¸­å‘æŒ¥äº†ä½œç”¨ã€‚</p><p>DW-Convå¯ä»¥åˆ©ç”¨å›¾åƒçš„å±€éƒ¨ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p><p>æ³¨æ„åŠ›æœºåˆ¶çš„å¼•å…¥å¯ä»¥çœ‹ä½œæ˜¯ä½¿ç½‘ç»œå®ç°äº†è‡ªé€‚åº”ç‰¹æ€§ã€‚å—ç›Šäºæ­¤ï¼ŒVAN-Tinyå®ç°äº†çº¦1.1%ï¼ˆ74.3%å¯¹75.4%ï¼‰çš„æ”¹å–„ã€‚</p><p>1Ã—1Convæ•è·äº†é€šé“ç»´åº¦ä¸­çš„å…³ç³»ã€‚ç»“åˆæ³¨æ„æœºåˆ¶ï¼Œå¼•å…¥äº†é€šé“ç»´åº¦çš„è‡ªé€‚åº”æ€§ã€‚æé«˜äº†0.8%(74.1%vs.75.4%)ï¼Œè¯æ˜äº†é€šé“ç»´åº¦è‡ªé€‚åº”æ€§çš„å¿…è¦æ€§ã€‚</p><h3 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h3><p><img src="v2-84a72be357178fade018043de0213190_720w.webp" alt="img"></p><p>å¯è§†åŒ–ç»“æœã€‚æ‰€æœ‰çš„å›¾åƒéƒ½æ¥è‡ªäºImageNetéªŒè¯é›†ä¸­çš„ä¸åŒç±»åˆ«ã€‚CAMé‡‡ç”¨VAN-Baseæ¨¡å‹å’ŒGrad-CAMäº§ç”Ÿã€‚å·¦ï¼šåŸå§‹å›¾åƒï¼Œå³ï¼šç±»æ¿€æ´»å›¾</p><p>ç»“æœæ˜¾ç¤ºï¼ŒVAN-Baseå¯ä»¥æ¸…æ™°åœ°èšç„¦äºç›®æ ‡å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯è§†åŒ–ç›´è§‚åœ°è¯æ˜äº†VANçš„æœ‰æ•ˆæ€§ã€‚</p><p>â€</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><blockquote id="fn_1"><sup>1</sup>. <a href="https://baidinghub.github.io/2020/04/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E7%B3%BB%E5%88%97%28%E4%BA%8C%29%20%E5%90%84%E7%A7%8D%E5%8D%B7%E7%A7%AF%E5%BD%A2%E5%BC%8F/">æ·±åº¦å­¦ä¹ çŸ¥è¯†ç³»åˆ—(äºŒ) å„ç§å·ç§¯å½¢å¼</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a></blockquote><blockquote id="fn_2 "><sup>2 </sup>. <a href="https://zhuanlan.zhihu.com/p/474526444">ã€ARXIV2202ã€‘Visual Attention Network</a><a href="#reffn_2 " title="Jump back to footnote [2 ] in the text."> &#8617;</a></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> è®¡ç®—æœºè§†è§‰ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring AOP Demo</title>
      <link href="/2022/12/04/Spring-AOP-Demo/"/>
      <url>/2022/12/04/Spring-AOP-Demo/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸æ¶‰åŠSpring AOPåŸç†</p></blockquote><h1 id="Spring-AOP-ç®€ä»‹"><a href="#Spring-AOP-ç®€ä»‹" class="headerlink" title="Spring AOP ç®€ä»‹"></a>Spring AOP ç®€ä»‹</h1><p>é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰æ˜¯ Spring æœ€ä¸ºé‡è¦çš„åŠŸèƒ½ä¹‹ä¸€äº†ï¼Œåœ¨æ•°æ®åº“äº‹åŠ¡ä¸­åˆ‡é¢ç¼–ç¨‹è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><h2 id="AOP-å³-Aspect-Oriented-Program-é¢å‘åˆ‡é¢ç¼–ç¨‹"><a href="#AOP-å³-Aspect-Oriented-Program-é¢å‘åˆ‡é¢ç¼–ç¨‹" class="headerlink" title="AOP å³ Aspect Oriented Program é¢å‘åˆ‡é¢ç¼–ç¨‹"></a>AOP å³ Aspect Oriented Program é¢å‘åˆ‡é¢ç¼–ç¨‹</h2><p>é¦–å…ˆï¼Œåœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ€æƒ³é‡Œé¢ï¼ŒæŠŠåŠŸèƒ½åˆ†ä¸ºæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼Œå’Œå‘¨è¾¹åŠŸèƒ½ã€‚</p><ul><li><strong>æ‰€è°“çš„æ ¸å¿ƒä¸šåŠ¡</strong>â€‹ï¼Œæ¯”å¦‚ç™»é™†ï¼Œå¢åŠ æ•°æ®ï¼Œåˆ é™¤æ•°æ®éƒ½å«æ ¸å¿ƒä¸šåŠ¡</li><li><strong>æ‰€è°“çš„å‘¨è¾¹åŠŸèƒ½</strong>â€‹ï¼Œæ¯”å¦‚æ€§èƒ½ç»Ÿè®¡ï¼Œæ—¥å¿—ï¼Œäº‹åŠ¡ç®¡ç†ç­‰ç­‰</li></ul><p>å‘¨è¾¹åŠŸèƒ½åœ¨ Spring çš„é¢å‘åˆ‡é¢ç¼–ç¨‹AOPæ€æƒ³é‡Œï¼Œå³è¢«å®šä¹‰ä¸ºåˆ‡é¢</p><p>åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹AOPçš„æ€æƒ³é‡Œé¢ï¼Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å’Œåˆ‡é¢åŠŸèƒ½åˆ†åˆ«ç‹¬ç«‹è¿›è¡Œå¼€å‘ï¼Œç„¶åæŠŠåˆ‡é¢åŠŸèƒ½å’Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ â€œç¼–ç»‡â€ åœ¨ä¸€èµ·ï¼Œè¿™å°±å«AOP</p><h2 id="AOP-çš„ç›®çš„"><a href="#AOP-çš„ç›®çš„" class="headerlink" title="AOP çš„ç›®çš„"></a>AOP çš„ç›®çš„</h2><p>AOPèƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œâ€‹<strong>å´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥</strong>â€‹ï¼Œä¾¿äºâ€‹<strong>å‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç </strong>â€‹ï¼Œâ€‹<strong>é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦</strong>â€‹ï¼Œå¹¶â€‹<strong>æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§</strong>â€‹ã€‚</p><h2 id="AOP-å½“ä¸­çš„æ¦‚å¿µï¼š"><a href="#AOP-å½“ä¸­çš„æ¦‚å¿µï¼š" class="headerlink" title="AOP å½“ä¸­çš„æ¦‚å¿µï¼š"></a>AOP å½“ä¸­çš„æ¦‚å¿µï¼š</h2><ul><li>åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰<br>åœ¨å“ªäº›ç±»ï¼Œå“ªäº›æ–¹æ³•ä¸Šåˆ‡å…¥ï¼ˆâ€‹<strong>where</strong>â€‹ï¼‰</li><li>é€šçŸ¥ï¼ˆAdviceï¼‰<br>åœ¨æ–¹æ³•æ‰§è¡Œçš„ä»€ä¹ˆå®é™…ï¼ˆ<strong>when:</strong>æ–¹æ³•å‰/æ–¹æ³•å/æ–¹æ³•å‰åï¼‰åšä»€ä¹ˆï¼ˆ<strong>what:</strong>å¢å¼ºçš„åŠŸèƒ½ï¼‰</li><li>åˆ‡é¢ï¼ˆAspectï¼‰<br>åˆ‡é¢ = åˆ‡å…¥ç‚¹ + é€šçŸ¥ï¼Œé€šä¿—ç‚¹å°±æ˜¯ï¼š<strong>åœ¨ä»€ä¹ˆæ—¶æœºï¼Œä»€ä¹ˆåœ°æ–¹ï¼Œåšä»€ä¹ˆå¢å¼ºï¼</strong></li><li>ç»‡å…¥ï¼ˆWeavingï¼‰<br>æŠŠåˆ‡é¢åŠ å…¥åˆ°å¯¹è±¡ï¼Œå¹¶åˆ›å»ºå‡ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚ï¼ˆç”± Spring æ¥å®Œæˆï¼‰</li></ul><h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><h2 id="éœ€æ±‚è¯´æ˜"><a href="#éœ€æ±‚è¯´æ˜" class="headerlink" title="éœ€æ±‚è¯´æ˜"></a>éœ€æ±‚è¯´æ˜</h2><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜ AOP çš„æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªå®é™…ä¸­çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p><p><img src="image-20221204123653-p1e00ow.png" alt="image">â€‹</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒåŒ…ç§Ÿå©†çš„æ ¸å¿ƒä¸šåŠ¡å°±æ˜¯ç­¾åˆåŒï¼Œæ”¶æˆ¿ç§Ÿï¼Œé‚£ä¹ˆè¿™å°±å¤Ÿäº†ï¼Œç°è‰²æ¡†èµ·æ¥çš„éƒ¨åˆ†éƒ½æ˜¯é‡å¤ä¸”è¾¹ç¼˜çš„äº‹ï¼Œäº¤ç»™ä¸­ä»‹å•†å°±å¥½äº†ï¼Œè¿™å°±æ˜¯ <strong>AOP çš„ä¸€ä¸ªæ€æƒ³ï¼šè®©å…³æ³¨ç‚¹ä»£ç ä¸ä¸šåŠ¡ä»£ç åˆ†ç¦»ï¼</strong></p><h2 id="ä»£ç å®ç°ï¼ˆä½¿ç”¨æ³¨è§£ï¼‰"><a href="#ä»£ç å®ç°ï¼ˆä½¿ç”¨æ³¨è§£ï¼‰" class="headerlink" title="ä»£ç å®ç°ï¼ˆä½¿ç”¨æ³¨è§£ï¼‰"></a>ä»£ç å®ç°ï¼ˆä½¿ç”¨æ³¨è§£ï¼‰</h2><h3 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h3><p>Spring Bootä½¿ç”¨AOPéœ€è¦æ·»åŠ spring-boot-starter-aopä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦å†æ·»åŠ aspectjweaverçš„ä¾èµ–äº†ï¼Œå› ä¸ºspring-boot-starter-aopåŒ…å«äº†aspectjweaverï¼Œå¹¶ä¸”ç‰ˆæœ¬æ˜¯è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœåœ¨æ·»åŠ è€ç‰ˆæœ¬ï¼ˆå¦‚1.5.4ï¼‰å¯åŠ¨ä¼šæŠ¥é”™ã€‚</p><h3 id="ç¼–å†™æ ¸å¿ƒä¸šåŠ¡Bean"><a href="#ç¼–å†™æ ¸å¿ƒä¸šåŠ¡Bean" class="headerlink" title="ç¼–å†™æ ¸å¿ƒä¸šåŠ¡Bean"></a>ç¼–å†™æ ¸å¿ƒä¸šåŠ¡Bean</h3><p>ä¹Ÿå°±æ˜¯è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test_spring.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LandlordService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ¿ä¸œï¼šè°ˆåˆåŒ&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ¿ä¸œï¼šæ”¶æˆ¿ç§Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºåˆ‡é¢"><a href="#åˆ›å»ºåˆ‡é¢" class="headerlink" title="åˆ›å»ºåˆ‡é¢"></a>åˆ›å»ºåˆ‡é¢</h3><p>Springé‡‡ç”¨@AspectJæ³¨è§£å¯¹POJOè¿›è¡Œæ ‡æ³¨ï¼Œè¯¥æ³¨è§£è¡¨æ˜è¯¥ç±»ä¸ä»…ä»…æ˜¯ä¸€ä¸ªPOJOï¼Œè¿˜æ˜¯ä¸€ä¸ªåˆ‡é¢ã€‚åˆ‡é¢æ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥çš„ç»“åˆï¼Œé‚£ä¹ˆå®šä¹‰ä¸€ä¸ªåˆ‡é¢å°±éœ€è¦ç¼–å†™åˆ‡ç‚¹å’Œé€šçŸ¥ã€‚åœ¨ä»£ç ä¸­ï¼Œåªéœ€è¦æ·»åŠ @Aspectæ³¨è§£å³å¯ã€‚</p><h3 id="å®šä¹‰åˆ‡ç‚¹"><a href="#å®šä¹‰åˆ‡ç‚¹" class="headerlink" title="å®šä¹‰åˆ‡ç‚¹"></a>å®šä¹‰åˆ‡ç‚¹</h3><p>åˆ‡ç‚¹æ˜¯é€šè¿‡<strong>@Pointcut</strong>æ³¨è§£å’Œåˆ‡ç‚¹è¡¨è¾¾å¼å®šä¹‰çš„ã€‚</p><p>@Pointcutæ³¨è§£å¯ä»¥åœ¨ä¸€ä¸ªåˆ‡é¢å†…å®šä¹‰<strong>å¯é‡ç”¨</strong>çš„åˆ‡ç‚¹ã€‚</p><p>ç”±äºSpringåˆ‡é¢ç²’åº¦æœ€å°æ˜¯è¾¾åˆ°æ–¹æ³•çº§åˆ«ï¼Œè€Œexecutionè¡¨è¾¾å¼å¯ä»¥ç”¨äºæ˜ç¡®æŒ‡å®šæ–¹æ³•è¿”å›ç±»å‹ï¼Œç±»åï¼Œæ–¹æ³•åå’Œå‚æ•°åç­‰ä¸æ–¹æ³•ç›¸å…³çš„éƒ¨ä»¶ï¼Œå¹¶ä¸”å®é™…ä¸­ï¼Œå¤§éƒ¨åˆ†éœ€è¦ä½¿ç”¨AOPçš„ä¸šåŠ¡åœºæ™¯ä¹Ÿåªéœ€è¦è¾¾åˆ°æ–¹æ³•çº§åˆ«å³å¯ï¼Œå› è€Œexecutionè¡¨è¾¾å¼çš„ä½¿ç”¨æ˜¯æœ€ä¸ºå¹¿æ³›çš„ã€‚å¦‚å›¾æ˜¯executionè¡¨è¾¾å¼çš„è¯­æ³•ï¼š</p><p>executionè¡¨ç¤ºåœ¨æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™è§¦å‘ã€‚ä»¥â€œâ€‹<em>â€å¼€å¤´ï¼Œè¡¨æ˜æ–¹æ³•è¿”å›å€¼ç±»å‹ä¸ºä»»æ„ç±»å‹ã€‚ç„¶åæ˜¯å…¨é™å®šçš„ç±»åå’Œæ–¹æ³•åï¼Œâ€œ</em>â€‹â€å¯ä»¥è¡¨ç¤ºä»»æ„ç±»å’Œä»»æ„æ–¹æ³•ã€‚å¯¹äºæ–¹æ³•å‚æ•°åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨â€œ..â€è¡¨ç¤ºå‚æ•°ä¸ºä»»æ„ç±»å‹ã€‚å¦‚æœéœ€è¦å¤šä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨â€œ&amp;&amp;â€ã€â€œ||â€å’Œâ€œ!â€å®Œæˆä¸ã€æˆ–ã€éçš„æ“ä½œã€‚</p><p><img src="image-20221204150048-bd0mj1f.png" alt="image">â€‹</p><h3 id="å®šä¹‰é€šçŸ¥"><a href="#å®šä¹‰é€šçŸ¥" class="headerlink" title="å®šä¹‰é€šçŸ¥"></a>å®šä¹‰é€šçŸ¥</h3><blockquote><p>é€šçŸ¥æœ‰äº”ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><p>å‰ç½®é€šçŸ¥ï¼ˆ@Beforeï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰è°ƒç”¨é€šçŸ¥</p><p>åç½®é€šçŸ¥ï¼ˆ@Afterï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•å®Œæˆä¹‹åè°ƒç”¨é€šçŸ¥</p><p>ç¯ç»•é€šçŸ¥ï¼ˆ@Aroundï¼‰ï¼šåœ¨è¢«é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œè°ƒç”¨ä¹‹åæ‰§è¡Œè‡ªå®šä¹‰çš„æ–¹æ³•</p><p>è¿”å›é€šçŸ¥ï¼ˆ@AfterReturningï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥</p><p>å¼‚å¸¸é€šçŸ¥ï¼ˆ@AfterThrowingï¼‰ï¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ä¹‹åè°ƒç”¨é€šçŸ¥</p></blockquote><p>æœ¬ä¾‹ä¸­ï¼Œåˆ†åˆ«ä½¿ç”¨å‰ç½®é€šçŸ¥å®ç°â€œçœ‹æˆ¿â€å’Œâ€œè°ˆä»·æ ¼â€åŠŸèƒ½ï¼Œä½¿ç”¨åç½®é€šçŸ¥å®ç°â€œäº¤é’¥åŒ™â€åŠŸèƒ½ã€‚è¿™æ ·ä¸€ä¸ªåˆ‡é¢å°±å®šä¹‰å®Œæˆï¼Œä¸‹é¢æ˜¯ä»£ç </p><h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test_spring.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Broker</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.test_spring.service.LandlordService.rent())&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeRent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­é—´å•†ï¼šå¸¦ç§Ÿå®¢çœ‹æˆ¿&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­é—´å•†ï¼šè°ˆä»·æ ¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterRent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­é—´å•†ï¼šäº¤é’¥åŒ™&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSpringApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(TestSpringApplication.class, args);</span><br><span class="line">        <span class="type">LandlordService</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(LandlordService.class);</span><br><span class="line">        bean.rent();</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="image-20221204150759-y1b4f1u.png" alt="image">â€‹</p><h2 id="ç¯ç»•é€šçŸ¥"><a href="#ç¯ç»•é€šçŸ¥" class="headerlink" title="ç¯ç»•é€šçŸ¥"></a>ç¯ç»•é€šçŸ¥</h2><p>çœ‹åˆ°ä¸Šè¿°çš„éœ€æ±‚ä¹Ÿå¯ä»¥ä½¿ç”¨ç¯ç»•é€šçŸ¥ï¼Œä»–ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œã€‚</p><p>æ”¹å†™<code>Broker.java</code>â€‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test_spring.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Broker</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.test_spring.service.LandlordService.rent())&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Before(&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="comment">//    public void beforeRent() &#123;</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;ä¸­é—´å•†ï¼šå¸¦ç§Ÿå®¢çœ‹æˆ¿&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;ä¸­é—´å•†ï¼šè°ˆä»·æ ¼&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    @After(&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="comment">//    public void afterRent() &#123;</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;ä¸­é—´å•†ï¼šäº¤é’¥åŒ™&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aroundRent</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­é—´å•†ï¼šå¸¦ç§Ÿå®¢çœ‹æˆ¿&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­é—´å•†ï¼šè°ˆä»·æ ¼&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            point.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­é—´å•†ï¼šäº¤é’¥åŒ™&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ä»£ç ï¼Œç»“æœä¾ç„¶æ­£ç¡®</p><h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><ol><li><a href="https://www.jianshu.com/p/994027425b44">Spring(4)â€”â€”é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPæ¨¡å—ï¼‰</a></li><li><a href="https://www.cnblogs.com/sgh1023/p/13363679.html">Spring Bootä½¿ç”¨AOPçš„æ­£ç¡®å§¿åŠ¿</a>â€‹</li></ol><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> é¢å‘åˆ‡é¢ç¼–ç¨‹ </tag>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨dockeréƒ¨ç½²rediså¹¶å®ç°å¤–éƒ¨è®¿é—®</title>
      <link href="/2022/11/23/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2redis%E5%B9%B6%E5%AE%9E%E7%8E%B0%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE/"/>
      <url>/2022/11/23/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2redis%E5%B9%B6%E5%AE%9E%E7%8E%B0%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…ä¹‹å‰ç¯å¢ƒéƒ¨ç½²"><a href="#å®‰è£…ä¹‹å‰ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="å®‰è£…ä¹‹å‰ç¯å¢ƒéƒ¨ç½²"></a>å®‰è£…ä¹‹å‰ç¯å¢ƒéƒ¨ç½²</h1><p>å…³é—­linuxé˜²ç«å¢™</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯äº‘æœåŠ¡å™¨ï¼ŒåŠ¡å¿…è¿›å…¥äº‘æœåŠ¡å™¨,ç»™6379ç«¯å£æ”¾è¡Œ</p><h1 id="å®‰è£…éƒ¨ç½²"><a href="#å®‰è£…éƒ¨ç½²" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h1><h2 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull redis:latest</span><br></pre></td></tr></table></figure><h2 id="ä»å®˜ç½‘ä¸‹è½½redisé…ç½®æ–‡ä»¶"><a href="#ä»å®˜ç½‘ä¸‹è½½redisé…ç½®æ–‡ä»¶" class="headerlink" title="ä»å®˜ç½‘ä¸‹è½½redisé…ç½®æ–‡ä»¶"></a>ä»å®˜ç½‘ä¸‹è½½redisé…ç½®æ–‡ä»¶</h2><p><code>wget http://download.redis.io/redis-stable/redis.conf</code></p><h2 id="åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºä¿å­˜æ­¤æ–‡ä»¶"><a href="#åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºä¿å­˜æ­¤æ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºä¿å­˜æ­¤æ–‡ä»¶"></a>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºä¿å­˜æ­¤æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/redis</span><br><span class="line"><span class="built_in">mv</span> /root/redis.conf  /root/redis</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹redis-confçš„é…ç½®"><a href="#æ›´æ”¹redis-confçš„é…ç½®" class="headerlink" title="æ›´æ”¹redis.confçš„é…ç½®"></a>æ›´æ”¹redis.confçš„é…ç½®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /root/redis/redis.conf</span><br></pre></td></tr></table></figure><p>å°†redis.confæ–‡ä»¶ä¸‹åˆ—å‚æ•°æ›´æ”¹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#bind 127.0.0.1 #å…è®¸è¿œç¨‹è¿æ¥(æ³¨é‡Šæˆ–è€…æ”¹ä¸ºbind 0.0.0.0) </span></span><br><span class="line">protected-mode no    <span class="comment">#ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">appendonly <span class="built_in">yes</span> <span class="comment">#æŒä¹…åŒ–</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis -v /root/redis/redis.conf:/etc/redis/redis.conf -v /root/redis/data:/data -d redis redis-server /etc/redis/redis.conf </span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><ul><li>-p 6379:6379ï¼šæŠŠå®¹å™¨å†…çš„6379ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº6379ç«¯å£</li><li>â€“name redisï¼šè®¾ç½®å®¹å™¨åç§°ä¸ºredis</li><li>-v /root/redis/redis.conf:/etc/redis/redis.confï¼šæŠŠä¸»æœºé…ç½®å¥½çš„redis.confæ”¾åˆ°å®¹å™¨å†…çš„è¿™ä¸ªä½ç½®ä¸­</li><li>-v /root/redis/data:/dataï¼šæŠŠredisæŒä¹…åŒ–çš„æ•°æ®åœ¨å®¿ä¸»æœºå†…æ˜¾ç¤ºï¼Œåšæ•°æ®å¤‡ä»½</li><li>-dï¼šredisåå°è¿è¡Œ</li><li>redis-server /etc/redis/redis.confï¼šè¿™ä¸ªæ˜¯å…³é”®é…ç½®ï¼Œè®©redisä¸æ˜¯æ— é…ç½®å¯åŠ¨ï¼Œè€Œæ˜¯æŒ‰ç…§è¿™ä¸ªredis.confçš„é…ç½®å¯åŠ¨</li></ul><h2 id="å®Œæˆæµ‹è¯•"><a href="#å®Œæˆæµ‹è¯•" class="headerlink" title="å®Œæˆæµ‹è¯•"></a>å®Œæˆæµ‹è¯•</h2><p>æŸ¥çœ‹å®¹å™¨æ˜¯å¦å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥å¯åŠ¨redis-cli</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@Met-Guo:~<span class="comment"># docker exec -it 56 bash # 56ä¸ºå®¹å™¨id</span></span><br><span class="line">root@5601af5f1f67:/data<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name 50</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;50&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exit</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨å®¿ä¸»æœºå®‰è£…Redis Desktop Managerå®¢æˆ·ç«¯ï¼Œå¹¶é…ç½®</p><p><img src="image-20221123222544338.png" alt="æˆªå›¾"></p><p>æˆåŠŸã€‚</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://blog.csdn.net/weixin_46186045/article/details/117387772">docker éƒ¨ç½²rediså¤–éƒ¨è®¿é—®è¯¥æ³¨æ„çš„åœ°æ–¹ä½ éƒ½çŸ¥é“å—</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rediså®‰è£… </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSHä¸‰æ­¥è§£å†³å…å¯†ç™»å½•</title>
      <link href="/2022/11/07/SSH%E4%B8%89%E6%AD%A5%E8%A7%A3%E5%86%B3%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/"/>
      <url>/2022/11/07/SSH%E4%B8%89%E6%AD%A5%E8%A7%A3%E5%86%B3%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://blog.csdn.net/jeikerxiao/article/details/84105529">SSH ä¸‰æ­¥è§£å†³å…å¯†ç™»å½•</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEä½¿ç”¨é‡åˆ°çš„é—®é¢˜æ±‡æ€»</title>
      <link href="/2022/11/04/FATE%E4%BD%BF%E7%94%A8%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
      <url>/2022/11/04/FATE%E4%BD%BF%E7%94%A8%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ±‡æ€»åœ¨ä½¿ç”¨å’Œå¼€å‘FATEæ—¶é‡åˆ°çš„å„ç±»é—®é¢˜ï¼Œä»¥åŠç»™å‡ºå¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚</p><h1 id="flow-init"><a href="#flow-init" class="headerlink" title="flow init"></a>flow init</h1><h2 id="é—®é¢˜çŠ¶æ€"><a href="#é—®é¢˜çŠ¶æ€" class="headerlink" title="é—®é¢˜çŠ¶æ€"></a>é—®é¢˜çŠ¶æ€</h2><p>å·²è§£å†³</p><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>é¦–æ¬¡è¿›å…¥fate-clientæ—¶ï¼Œæç¤ºéœ€è¦æ‰§è¡Œflow initï¼Œå¦åˆ™æœ‰å…³flowçš„å‘½ä»¤éƒ½æ‰§è¡Œä¸äº†ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p><code>flow init --ip &lt;dockerå®¹å™¨å®¿ä¸»æœºip&gt; --port 9380</code></p><p>â€</p><h1 id="ModuleNotFoundError-No-module-named-â€˜-lzmaâ€™"><a href="#ModuleNotFoundError-No-module-named-â€˜-lzmaâ€™" class="headerlink" title="ModuleNotFoundError: No module named â€˜_lzmaâ€™"></a>ModuleNotFoundError: No module named â€˜_lzmaâ€™</h1><h2 id="é—®é¢˜æè¿°-1"><a href="#é—®é¢˜æè¿°-1" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œnnæ¨¡å—æŠ¥é”™ï¼šModuleNotFoundError: No module named â€˜_lzmaâ€™</p><p><img src="image-20220927210914-c8pbaiz.png" alt="image.png"></p><h2 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨fate-flow containerå®‰è£…ç›¸å…³çš„åŒ…å³å¯ï¼ˆguestã€hostå’Œarbiteréƒ½è¦å®‰è£…ï¼‰ã€‚å®‰è£…æ•™ç¨‹ï¼š<a href="https://github.com/ultralytics/yolov5/issues/1298">https://github.com/ultralytics/yolov5/issues/1298</a></p><p>è¿™é‡Œéœ€è¦ä¿®æ”¹è·¯å¾„</p><p><img src="image-20220928115429-n9l4hgw.png" alt="image.png"></p><h1 id="æ‰¾ä¸åˆ°æ–‡ä»¶ï¼šNo-such-file-or-directory-â€˜-data-projects-fate-work-mnist-fed-mnist-train-part2-config-yamlâ€™"><a href="#æ‰¾ä¸åˆ°æ–‡ä»¶ï¼šNo-such-file-or-directory-â€˜-data-projects-fate-work-mnist-fed-mnist-train-part2-config-yamlâ€™" class="headerlink" title="æ‰¾ä¸åˆ°æ–‡ä»¶ï¼šNo such file or directory: â€˜/data/projects/fate/work/mnist_fed/mnist_train_part2/config.yamlâ€™"></a>æ‰¾ä¸åˆ°æ–‡ä»¶ï¼š<strong>No such file or directory: â€˜/data/projects/fate/work/mnist_fed/mnist_train_part2/config.yamlâ€™</strong></h1><h2 id="é—®é¢˜çŠ¶æ€-1"><a href="#é—®é¢˜çŠ¶æ€-1" class="headerlink" title="é—®é¢˜çŠ¶æ€"></a>é—®é¢˜çŠ¶æ€</h2><p>å·²è§£å†³</p><h2 id="é—®é¢˜æè¿°-2"><a href="#é—®é¢˜æè¿°-2" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œreaderç»„ä»¶æŠ¥é”™ï¼š</p><p><img src="image-20220927205925-34fvaot.png" alt="image.png"></p><p>è¿™æ˜¯ç”±äºæˆ‘æŠŠæ•°æ®ä¿å­˜åœ¨äº†fate-clientï¼Œè€Œfateè¯»å–æ•°æ®æ˜¯åœ¨fate-flow containerå¯¼è‡´çš„ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ç”±äºfate-clientå’Œfate-flowä¸¤ä¸ªå®¹å™¨ä¸­çš„examplesæ–‡ä»¶å¤¹æŒ‚è½½åˆ°dockeråº•å±‚åŒä¸€å¤„å­˜å‚¨ã€‚æ‰€ä»¥æŠŠæ•°æ®æ”¾åˆ°examplesä¸‹ï¼ŒæŠŠé…ç½®ä¿®æ”¹ä¸ºæ–°çš„æ–‡ä»¶è·¯å¾„å³å¯ã€‚</p><h1 id="å¼€å‘æ–°çš„FATE-FLOW-API"><a href="#å¼€å‘æ–°çš„FATE-FLOW-API" class="headerlink" title="å¼€å‘æ–°çš„FATE-FLOW API"></a>å¼€å‘æ–°çš„FATE-FLOW API</h1><p>è¿™é‡Œæ˜¯å·²æœ‰çš„APIï¼š<a href="https://federatedai.github.io/FATE-Flow/latest/zh/swagger/">https://federatedai.github.io/FATE-Flow/latest/zh/swagger/</a></p><p>FATEçš„HTTPæ¥å£éƒ½æ˜¯åŸºäºflaskæ¡†æ¶ç¼–å†™çš„ã€‚</p><p>å¼€å‘æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è¿›å…¥FATE-FLOWå®¹å™¨</li><li>cd /data/projects/fate/fateflow/python/fate_flow/apps</li><li>æ–°å»ºpythonæ–‡ä»¶ï¼Œå‘½åä¸ºxxx_app.pyï¼Œç¼–å†™æ–°çš„æ¥å£ã€‚</li><li>é‡å¯FLOWå®¹å™¨</li></ol><h1 id="ä¿®æ”¹ä»£ç å¯¼è‡´docker-containeræ²¡èµ·æ¥"><a href="#ä¿®æ”¹ä»£ç å¯¼è‡´docker-containeræ²¡èµ·æ¥" class="headerlink" title="ä¿®æ”¹ä»£ç å¯¼è‡´docker containeræ²¡èµ·æ¥"></a>ä¿®æ”¹ä»£ç å¯¼è‡´docker containeræ²¡èµ·æ¥</h1><p>ä¿®æ”¹FATE-FLOWçš„ä»£ç åï¼Œç”±äºä»£ç æœ‰bugï¼Œå¯¼è‡´å®¹å™¨èµ·ä¸æ¥ï¼Œåˆå¯¼è‡´ä¸èƒ½è¿›å…¥å®¹å™¨ä¿®æ”¹ä»£ç çš„æ­»å¾ªç¯ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>æŸ¥çœ‹dockerå®¹å™¨çš„å¯åŠ¨æ—¥å¿—ï¼Œç¡®å®šå‡ºé”™çš„ä»£ç ï¼Œdocker cpæ‹·è´å‡ºæ¥éœ€è¦ä¿®æ”¹çš„ä»£ç ï¼Œå†æ‹·è´å›å»ã€‚</p><p>â€</p><h1 id="å®é™…è®­ç»ƒçš„epochå°äºé…ç½®çš„max-iter"><a href="#å®é™…è®­ç»ƒçš„epochå°äºé…ç½®çš„max-iter" class="headerlink" title="å®é™…è®­ç»ƒçš„epochå°äºé…ç½®çš„max_iter"></a>å®é™…è®­ç»ƒçš„epochå°äºé…ç½®çš„max_iter</h1><p>æŸ¥çœ‹è‡ªå·±æ˜¯å¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;early_stop&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;early_stop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;diff&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eps&quot;</span><span class="punctuation">:</span> <span class="number">0.0001</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªepochå¾—åˆ°çš„lossä¹‹å·®å°äº0.0001æ—¶åˆ™åœæ­¢è®­ç»ƒã€‚</p><h1 id="memory-error"><a href="#memory-error" class="headerlink" title="memory error"></a>memory error</h1><p>æ ¹æ®å®è·µç»éªŒï¼Œmemory error è¿˜æœ‰dataloader worker pidä¹‹ç±»çš„é”™è¯¯ï¼Œå‡æ˜¯ç”±äºå†…å­˜ä¸å¤Ÿå¼•èµ·çš„ã€‚è°ƒå°batch sizeï¼Œæˆ–è€…å¢åŠ ç¡¬ä»¶é…ç½®</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šè‚ºç‚çš„å¤šæ¨¡æ€ä»»åŠ¡çš„è”é‚¦å­¦ä¹ </title>
      <link href="/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%82%BA%E7%82%8E%E7%9A%84%E5%A4%9A%E6%A8%A1%E6%80%81%E4%BB%BB%E5%8A%A1%E7%9A%84%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%82%BA%E7%82%8E%E7%9A%84%E5%A4%9A%E6%A8%A1%E6%80%81%E4%BB%BB%E5%8A%A1%E7%9A%84%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¤šæ¨¡æ€æœ€è¿‘æ¯”è¾ƒç«</p><p>å¤šæ¨¡æ€ä»»åŠ¡çš„inputå’Œç®—æ³•FATEä¸æ”¯æŒï¼Œå› æ­¤éœ€è¦å¼€å‘æ–°çš„dataloaderå’Œç®—æ³•ç»„ä»¶ã€‚</p><p>æœ¬ç¯‡å°±ä»¥è‚ºç‚å¤šæ¨¡æ€ä»»åŠ¡ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•å¼€å‘æ–°çš„FATEæœºå™¨å­¦ä¹ ç»„ä»¶</p><p>å®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œï¼š<a href="https://fate.readthedocs.io/en/latest/develop/develop_guide/#develop-an-algorithm-component-of-fate">https://fate.readthedocs.io/en/latest/develop/develop_guide/#develop-an-algorithm-component-of-fate</a></p></blockquote><h1 id="baseline"><a href="#baseline" class="headerlink" title="baseline"></a>baseline</h1><p>æœ¬ä»»åŠ¡å°†å¼€å‘åŸºäºè‚ºéƒ¨Xå…‰å›¾åƒå’Œæè¿°æ–‡å­—æ­£ç¡®åˆ¤æ–­æ˜¯å¦æ‚£æœ‰è‚ºç‚çš„äºŒåˆ†ç±»ç®—æ³•ã€‚</p><p>æ•°æ®é›†è¾“å…¥ç”±ä¸¤éƒ¨åˆ†ç»„æˆã€‚ä¸€éƒ¨åˆ†ä¸ºè‚ºéƒ¨Xå…‰æ‰«æå›¾åƒï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºå¯¹å›¾åƒçš„æè¿°æ–‡å­—ã€‚æ•°æ®æ ‡ç­¾åˆ†ä¸º0å’Œ1ï¼Œåˆ†åˆ«å¯¹åº”æ­£å¸¸å’Œæ‚£æœ‰è‚ºç‚ä¸¤ç±»æ ‡ç­¾ã€‚</p><h2 id="æœ¬åœ°ä»£ç å¤ç°"><a href="#æœ¬åœ°ä»£ç å¤ç°" class="headerlink" title="æœ¬åœ°ä»£ç å¤ç°"></a>æœ¬åœ°ä»£ç å¤ç°</h2><ol><li>baseline ä»£ç åœ¨è¿™é‡Œï¼š<a href="https://github.com/AxelAllen/Multimodal-BERT-in-Medical-Image-and-Text-Classification">https://github.com/AxelAllen/Multimodal-BERT-in-Medical-Image-and-Text-Classification</a></li><li>å°†å…¶cloneåˆ°æœ¬åœ°ï¼ŒæŒ‰ç…§README.mdçš„æç¤ºï¼Œå°†NLMCXR_png_frontalå›¾åƒæ–‡ä»¶å¤¹æ”¾åˆ°dataç›®å½•ä¸‹ã€‚æ‰§è¡Œdata/preparations.ipynbç”Ÿæˆå…ƒæ•°æ®ã€‚</li><li>æ‰§è¡Œrun_mmbt.ipynb</li><li>æ‰§è¡Œå®Œæ¯•åï¼Œä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆmmbt_output_findings_10epochs_næ–‡ä»¶å¤¹ï¼Œé‡Œé¢ä¿å­˜æœ‰æ¨¡å‹æ‹Ÿåˆåçš„æ¢¯åº¦å’Œè¯„ä¼°ç»“æœã€‚</li></ol><h2 id="é˜…è¯»ä»£ç "><a href="#é˜…è¯»ä»£ç " class="headerlink" title="é˜…è¯»ä»£ç "></a>é˜…è¯»ä»£ç </h2><p>è¿™é‡Œè¦å¼„æ¸…æ¥šä»£ç çš„æ•´å¥—æµç¨‹ï¼Œä¸»è¦æ˜¯è¶…å‚ã€ä½¿ç”¨çš„ç®—æ³•ã€è®­ç»ƒã€æ•°æ®å¤„ç†å’ŒåŠ è½½ï¼Œæ¨¡å‹å¦‚ä½•è¯„ä¼°è¿™å‡ æ­¥ã€‚è¿™é‡Œåªå±•ç¤ºæ ¸å¿ƒä»£ç </p><h3 id="è¶…å‚"><a href="#è¶…å‚" class="headerlink" title="è¶…å‚"></a>è¶…å‚</h3><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å€¼</th></tr></thead><tbody><tr><td>Epoch</td><td>10</td></tr><tr><td>Bacth_size</td><td>16/32</td></tr><tr><td>Optimizer</td><td>AdamW</td></tr><tr><td>LR</td><td>5e-5</td></tr><tr><td>Loss</td><td>CrossEntropyLoss</td></tr><tr><td>Metrics</td><td>Accuracy</td></tr></tbody></table></div><blockquote><p>æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœbatch size = 4ï¼Œæ¨¡å‹æ— æ³•è®­ç»ƒå¤„ä»»ä½•ç»“æœã€‚</p></blockquote><h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éƒ¨åˆ†code</span></span><br><span class="line"></span><br><span class="line">transformer_config = AutoConfig.from_pretrained(args.config_name <span class="keyword">if</span> args.config_name <span class="keyword">else</span> args.model_name, num_labels=num_labels)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(</span><br><span class="line">        args.tokenizer_name <span class="keyword">if</span> args.tokenizer_name <span class="keyword">else</span> args.model_name,</span><br><span class="line">        do_lower_case=<span class="literal">True</span>,</span><br><span class="line">        cache_dir=<span class="literal">None</span>,</span><br><span class="line">    )</span><br><span class="line">transformer = AutoModel.from_pretrained(args.model_name, config=transformer_config, cache_dir=<span class="literal">None</span>)</span><br><span class="line">img_encoder = ImageEncoderDenseNet(num_image_embeds=args.num_image_embeds)</span><br><span class="line">multimodal_config = MMBTConfig(transformer, img_encoder, num_labels=num_labels, modal_hidden_size=<span class="number">1024</span>)</span><br><span class="line">model = MMBTForClassification(transformer_config, multimodal_config)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨MMBTæ¨¡å‹: ç”¨äºå›¾åƒå’Œæ–‡æœ¬åˆ†ç±»çš„æœ‰ç›‘ç£å¤šæ¨¡æ€åŒå‘Transformerã€‚</p><ul><li>å›¾åƒç¼–ç å™¨ä½¿ç”¨çš„ChexNetï¼Œè¿™æ˜¯ä¸€ä¸ªé’ˆå¯¹Xå…‰èƒ¸ç‰‡è‚ºç‚æ£€æµ‹çš„æ¨¡å‹ï¼›</li><li>æ–‡æœ¬ç¼–ç å™¨ä½¿ç”¨çš„é¢„è®­ç»ƒçš„BERTæ¨¡å‹ï¼šbert-base-uncasedã€‚</li></ul><p>æ•´ä½“ç½‘ç»œç»“æ„å¦‚å›¾</p><p><img src="image-20221102150400-2suo5cw.png" alt="image">â€‹</p><p>â€</p><h3 id="data-loader"><a href="#data-loader" class="headerlink" title="data loader"></a>data loader</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éƒ¨åˆ†code</span></span><br><span class="line">dataset = JsonlDataset(path, img_dir, tokenizer, img_transforms, labels, wandb_config.max_seq_length -</span><br><span class="line">                       wandb_config.num_image_embeds - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">train_dataloader = DataLoader(</span><br><span class="line">    train_dataset,</span><br><span class="line">    sampler=train_sampler,</span><br><span class="line">    batch_size=args.train_batch_size,</span><br><span class="line">    collate_fn=collate_fn</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="train"><a href="#train" class="headerlink" title="train"></a>train</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éƒ¨åˆ†code</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> train_iterator:</span><br><span class="line">    epoch_iterator = tqdm(train_dataloader, desc=<span class="string">&quot;Training Batch Iteration&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> step, batch <span class="keyword">in</span> <span class="built_in">enumerate</span>(epoch_iterator):</span><br><span class="line"></span><br><span class="line">        batch = <span class="built_in">tuple</span>(t.to(args.device) <span class="keyword">for</span> t <span class="keyword">in</span> batch)</span><br><span class="line">        labels = batch[<span class="number">5</span>]</span><br><span class="line">        input_ids = batch[<span class="number">0</span>]</span><br><span class="line">        input_modal = batch[<span class="number">2</span>]</span><br><span class="line">        attention_mask = batch[<span class="number">1</span>]</span><br><span class="line">        modal_start_tokens = batch[<span class="number">3</span>]</span><br><span class="line">        modal_end_tokens = batch[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">        outputs = model(</span><br><span class="line">            input_modal,</span><br><span class="line">            input_ids=input_ids,</span><br><span class="line">            modal_start_tokens=modal_start_tokens,</span><br><span class="line">            modal_end_tokens=modal_end_tokens,</span><br><span class="line">            attention_mask=attention_mask,</span><br><span class="line">            token_type_ids=<span class="literal">None</span>,</span><br><span class="line">            modal_token_type_ids=<span class="literal">None</span>,</span><br><span class="line">            position_ids=<span class="literal">None</span>,</span><br><span class="line">            modal_position_ids=<span class="literal">None</span>,</span><br><span class="line">            head_mask=<span class="literal">None</span>,</span><br><span class="line">            inputs_embeds=<span class="literal">None</span>,</span><br><span class="line">            labels=labels,</span><br><span class="line">            return_dict=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">        logits = outputs.logits</span><br><span class="line">        loss = outputs.loss</span><br><span class="line">        loss.backward()</span><br></pre></td></tr></table></figure><h3 id="è¯„ä¼°"><a href="#è¯„ä¼°" class="headerlink" title="è¯„ä¼°"></a>è¯„ä¼°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éƒ¨åˆ†ä»£ç </span></span><br><span class="line">result = evaluate(args, model, tokenizer, evaluate=<span class="literal">True</span>, test=<span class="literal">True</span>, prefix=prefix)</span><br></pre></td></tr></table></figure><h1 id="å¼€å‘æ–°ç»„ä»¶"><a href="#å¼€å‘æ–°ç»„ä»¶" class="headerlink" title="å¼€å‘æ–°ç»„ä»¶"></a>å¼€å‘æ–°ç»„ä»¶</h1><p>å½“æˆ‘ä»¬å·²ç»åœ¨æœ¬åœ°è·‘é€šä»£ç ï¼Œå¹¶æ˜ç¡®ç®—æ³•ä¹‹åï¼Œå°±å¯ä»¥å¼€å‘æ–°çš„ç»„ä»¶ï¼Œå°†ç®—æ³•è”é‚¦åŒ–ã€‚</p><p>è¿™é‡Œå®˜æ–¹æ–‡æ¡£å†™çš„å¾ˆæ¸…æ¥šï¼Œæˆ‘å¤§æ¦‚å¤è¿°ä¸€ä¸‹</p><h3 id="Step-1-Define-the-python-parameter-object-to-be-used-by-this-component"><a href="#Step-1-Define-the-python-parameter-object-to-be-used-by-this-component" class="headerlink" title="Step 1. Define the python parameter object to be used by this component"></a>Step 1. Define the python parameter object to be used by this component</h3><ol><li>Open a new python file called <code>xxx_param.py</code>â€‹, where xxx stands for your componentâ€™s name. Place this file in the folder <code>python/federatedm/param/</code>â€‹. The class object defined in <code>xxx_param.py</code>â€‹ should inherit the <code>BaseParam</code>â€‹ class declared in <code>python/federatedml/param/base_param.py</code>â€‹</li><li>The <code>__init__</code>â€‹ method of your parameter class should specify all parameters that the component uses.</li><li>Override and implement the <code>check</code>â€‹ interface method of BaseParam. The <code>check</code>â€‹ method is used to validate the parameter variables.</li><li><code>python/federatedml/param/__init__.py</code>â€‹åˆ—è¡¨<code>__all__</code>â€‹å¢åŠ ä½ çš„ç»„ä»¶åç§°ï¼Œå¹¶å¯¼å…¥ã€‚</li></ol><p>æˆ‘è¿™é‡Œç»„ä»¶åç§°å«homo_mmï¼Œæ‰€ä»¥åˆ›å»ºçš„pythonæ–‡ä»¶åä¸ºhomo_mm_param.pyã€‚ç”±äºå’Œhomo_nnå¾ˆåƒï¼Œæ‰€ä»¥ç›´æ¥è®²homo_nn_param.pyå¤åˆ¶è¿‡æ¥ï¼Œå°†é‡Œé¢çš„â€œnnâ€æ”¹æˆâ€œmmâ€ã€‚</p><p>ç¬¬å››æ­¥å¢åŠ äº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> federatedml.param.homo_mm_param <span class="keyword">import</span> HomoMMParam</span><br><span class="line">...</span><br><span class="line">__all__ = [... <span class="string">&quot;HomoMMParam&quot;</span>, ...]</span><br></pre></td></tr></table></figure><p>python/federatedml/param/<strong>init</strong>.py</p><h3 id="Step-2-Define-the-meta-file-of-the-new-component"><a href="#Step-2-Define-the-meta-file-of-the-new-component" class="headerlink" title="Step 2. Define the meta file of the new component"></a>Step 2. Define the meta file of the new component</h3><ol><li>Define component meta python file under <code>python/federatedml/components/</code>â€‹, name it as <code>xxx.py</code>â€‹, where xxx stands for the algorithm component being developed.</li><li>Implement the meta file.</li></ol><p>æˆ‘è¿™é‡Œç»„ä»¶åç§°å«homo_mmï¼Œæ‰€ä»¥åˆ›å»ºçš„pythonæ–‡ä»¶åä¸ºhomo_mm.pyã€‚ç”±äºå’Œhomo_nnå¾ˆåƒï¼Œæ‰€ä»¥ç›´æ¥è®²homo_nn.pyå¤åˆ¶è¿‡æ¥ï¼Œå°†é‡Œé¢çš„â€œnnâ€æ”¹æˆâ€œmmâ€ã€‚</p><h3 id="Step-3-Define-the-transfer-variable-object-of-this-module-Optional"><a href="#Step-3-Define-the-transfer-variable-object-of-this-module-Optional" class="headerlink" title="Step 3. Define the transfer variable object of this module. (Optional)"></a>Step 3. Define the transfer variable object of this module. (Optional)</h3><p>è¿™é‡Œä¸éœ€è¦</p><h3 id="Step-4-Create-the-component-which-inherits-the-class-model-baseâ€‹"><a href="#Step-4-Create-the-component-which-inherits-the-class-model-baseâ€‹" class="headerlink" title="Step 4. Create the component which inherits the class model_baseâ€‹"></a>Step 4. Create the component which inherits the class <code>model_base</code>â€‹</h3><p>ç°åœ¨å°±å¯ä»¥å°†<code>python/federatedml/nn/homo_nn</code>â€‹å¤åˆ¶ä¸€ä»½ï¼Œä¿®æ”¹ä¸ºhomo_mmï¼Œä¿®æ”¹_torch.pyæ–‡ä»¶</p><p>è¯¦ç•¥ã€‚</p><h3 id="additional"><a href="#additional" class="headerlink" title="additional"></a>additional</h3><p>éœ€è¦æ³¨æ„åœ¨<code>python/federatedml/nn/backend/pytorch/data.py</code>â€‹æ–°å»ºæ–°çš„datasetã€‚å¹¶åœ¨_torchä¸­çš„make_datasetåˆ›å»ºï¼Œè¿™é‡Œå¯ä»¥å‚ç…§VisionDataSet</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MMDataSet</span>(<span class="title class_ inherited__">DatasetMixIn</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_num_labels</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_num_features</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_keys</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._keys</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">as_data_instance</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">from</span> federatedml.feature.instance <span class="keyword">import</span> Instance</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">_as_instance</span>(<span class="params">x</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, np.number):</span><br><span class="line">                <span class="keyword">return</span> Instance(label=x.tolist())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> Instance(label=x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> computing_session.parallelize(</span><br><span class="line">            data=<span class="built_in">zip</span>(self._keys, <span class="built_in">map</span>(_as_instance, self.targets)),</span><br><span class="line">            include_key=<span class="literal">True</span>,</span><br><span class="line">            partition=<span class="number">1</span>,</span><br><span class="line">        )</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,train_data_path, is_train=<span class="literal">True</span>, expected_label_type=np.float32,**kwargs</span>):</span><br><span class="line"><span class="comment"># è¿™é‡Œå¿…é¡»åŠ ä¸Šï¼Œå¦åˆ™ä¼šå¡åœ¨æ ‡ç­¾å¯¹é½ä¸”ä¸æŠ¥é”™</span></span><br><span class="line">        <span class="keyword">if</span> is_train:</span><br><span class="line">            HomoLabelEncoderClient().label_alignment([<span class="string">&quot;fake&quot;</span>])</span><br><span class="line"></span><br><span class="line">        tokenizer = AutoTokenizer.from_pretrained(</span><br><span class="line">            <span class="string">&quot;bert-base-uncased&quot;</span>,</span><br><span class="line">            do_lower_case=<span class="literal">True</span>,</span><br><span class="line">            cache_dir=<span class="literal">None</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        labels = [<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line">        labels2id = &#123;<span class="string">&#x27;0&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;1&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">        self.labels2id = labels2id</span><br><span class="line">        self.data = [json.loads(line) <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(os.path.join(train_data_path, <span class="string">&quot;meta.jsonl&quot;</span>))]</span><br><span class="line"></span><br><span class="line">        self.targets = [ item[<span class="string">&#x27;label&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> self.data]</span><br><span class="line">        self.img_data_dir = os.path.join(train_data_path, <span class="string">&#x27;images&#x27;</span>)</span><br><span class="line">        self.tokenizer = tokenizer</span><br><span class="line">        self.labels = labels</span><br><span class="line">        self.n_classes = <span class="built_in">len</span>(labels)</span><br><span class="line">        self.max_seq_length = <span class="number">300</span> - <span class="number">3</span> - <span class="number">2</span></span><br><span class="line">        self.transforms = torchvision.transforms.Compose(</span><br><span class="line">            [</span><br><span class="line">                torchvision.transforms.Resize(<span class="number">256</span>),</span><br><span class="line">                torchvision.transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">                torchvision.transforms.ToTensor(),</span><br><span class="line">                torchvision.transforms.Normalize(</span><br><span class="line">                    mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">                    std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]</span><br><span class="line">                )</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        key_dic = []</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self.data)):</span><br><span class="line">            key_dic.append(<span class="built_in">id</span>)</span><br><span class="line">        self._keys = key_dic</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        sentence = torch.LongTensor(self.tokenizer.encode(self.data[index][<span class="string">&quot;text&quot;</span>], add_special_tokens=<span class="literal">True</span>))</span><br><span class="line">        start_token, sentence, end_token = sentence[<span class="number">0</span>], sentence[<span class="number">1</span>:-<span class="number">1</span>], sentence[-<span class="number">1</span>]</span><br><span class="line">        sentence = sentence[:self.max_seq_length]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.n_classes &gt; <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># multiclass</span></span><br><span class="line">            label = torch.zeros(self.n_classes)</span><br><span class="line">            label[self.labels.index(self.data[index][<span class="string">&quot;label&quot;</span>])] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            label = torch.LongTensor([self.labels.index(self.data[index][<span class="string">&quot;label&quot;</span>])])</span><br><span class="line"></span><br><span class="line">        image = Image.<span class="built_in">open</span>(os.path.join(self.img_data_dir, self.data[index][<span class="string">&quot;img&quot;</span>])).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">        image = self.transforms(image)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;image_start_token&quot;</span>: start_token,</span><br><span class="line">            <span class="string">&quot;image_end_token&quot;</span>: end_token,</span><br><span class="line">            <span class="string">&quot;sentence&quot;</span>: sentence,</span><br><span class="line">            <span class="string">&quot;image&quot;</span>: image,</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: label,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.data)</span><br><span class="line">    <span class="comment"># æ ‡ç­¾åç§°å’Œæ ‡ç­¾indexçš„å¯¹åº”ï¼Œä¾‹å¦‚&#123;&quot;é˜´æ€§&quot;:0, &quot;é˜³æ€§&quot;:1&#125;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_label_align_mapping</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.labels2id</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœJobä»ç„¶è·‘ä¸èµ·æ¥ï¼Œå¯ä»¥é€šè¿‡FATE-BOARDæ—¥å¿—æ’é”™ã€‚</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šè‚ ç™Œå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸‹ï¼‰â€”â€”è”é‚¦åŒ–</title>
      <link href="/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%82%A0%E7%99%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94%E8%81%94%E9%82%A6%E5%8C%96/"/>
      <url>/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%82%A0%E7%99%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1%EF%BC%88%E4%B8%8B%EF%BC%89%E2%80%94%E2%80%94%E8%81%94%E9%82%A6%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨ä¸Šä¸€ç¯‡å·²ç»åœ¨æœ¬åœ°è·‘é€šäº†è‚ ç™Œå›¾åƒåˆ†ç±»çš„æ•´ä¸ªæµç¨‹ï¼Œç°åœ¨æˆ‘ä»¬å°†å®ƒç§»æ¤åˆ°FATEä¸Šï¼Œå®ç°è”é‚¦å­¦ä¹ ã€‚</p></blockquote><h1 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h1><p>ä»¿ç…§â€œæ‰‹å†™æ•°å­—è¯†åˆ«â€ä»»åŠ¡ï¼Œå°†ä¸‰ä»½è®­ç»ƒæ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚å¹¶æ–°å»ºé…ç½®æ–‡ä»¶ï¼Œå¤„ç†åçš„æ ¼å¼å¦‚å›¾ã€‚</p><p><img src="image-20221101234910-nivm8sx.png" alt="image.png"></p><ul><li>code/ï¼š bindå¼€å¤´çš„æ–‡ä»¶æ˜¯ç”¨äºæ•°æ®ç»‘å®šï¼›colon_confæ˜¯confæ–‡ä»¶ï¼Œcolon_dslæ˜¯dslæ–‡ä»¶</li><li>test/ï¼š500å¼ æµ‹è¯•æ•°æ®</li><li>val/ï¼š500å¼ éªŒè¯é›†</li><li><p>train_pX/ï¼šç¬¬Xä»½è®­ç»ƒæ•°æ®ï¼Œæ¯ä¸€ä»½3000å¼ </p><ul><li>images/ï¼šå›¾ç‰‡æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾æ‰€æœ‰å›¾åƒ</li><li>config.yamlï¼šå›¾ç‰‡æ–‡ä»¶å¤¹é…ç½®ï¼šé€šé“æ•°ï¼Œæ ¼å¼ç­‰ã€‚</li><li>filenamesï¼šimagesç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼ˆå»æ‰åç¼€ï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶åå ä¸€è¡Œ</li><li>targetsï¼šimagesç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼ˆå»æ‰åç¼€ï¼‰å’Œlabelï¼Œé€—å·åŒºåˆ†ï¼Œæ¯ä¸ªæ–‡ä»¶åå’Œç±»åˆ«å ä¸€è¡Œã€‚</li></ul></li></ul><h1 id="ä¿®æ”¹æºä»£ç "><a href="#ä¿®æ”¹æºä»£ç " class="headerlink" title="ä¿®æ”¹æºä»£ç "></a>ä¿®æ”¹æºä»£ç </h1><p>ä¹‹å‰åœ¨åˆ†ææºç æ—¶ï¼Œå¯ä»¥çœ‹åˆ°homo_nnçš„æ¨¡å‹é…ç½®æ¯”è¾ƒå®šåˆ¶åŒ–ï¼Œä¸å¤Ÿçµæ´»ï¼Œå› æ­¤æˆ‘ä»¬ä¿®æ”¹æºç å®ç°ï¼š</p><ol><li>ä¿®æ”¹æ•°æ®åŠ è½½</li><li>ä½¿ç”¨é¢„è®­ç»ƒçš„vgg16ç®—æ³•æ¨¡å‹ï¼›</li><li>ä½¿ç”¨GPU</li><li>å®ç°æ¨¡å‹è¯„ä¼°</li></ol><h2 id="ä¿®æ”¹æ•°æ®åŠ è½½"><a href="#ä¿®æ”¹æ•°æ®åŠ è½½" class="headerlink" title="ä¿®æ”¹æ•°æ®åŠ è½½"></a>ä¿®æ”¹æ•°æ®åŠ è½½</h2><p>æˆ‘ä»¬çŸ¥é“vgg16ä¼ å…¥çš„å›¾åƒå°ºå¯¸ä¸º$224<em>224</em>3$ï¼Œè€Œè‚ ç™Œæ•°æ®é›†çš„å›¾åƒæ ¼å¼å¤§å°ä¸º$768<em>768</em>3$ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¯¹æ•°æ®åŠ è½½è¿›è¡Œä¿®æ”¹ï¼š</p><p>ä¿®æ”¹FATE/python/federatedml/nn/backend/pytorch/data.pyçš„<code>VisionDataSet</code>ç±»çš„<strong>get_item</strong>æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line"></span><br><span class="line">    img = Image.<span class="built_in">open</span>(self.images[index]).convert(self._PIL_mode)</span><br><span class="line">    <span class="keyword">if</span> img.size[<span class="number">0</span>] &gt; <span class="number">224</span>:</span><br><span class="line">        resize_transform = torchvision.transforms.Compose(</span><br><span class="line">            [</span><br><span class="line">                torchvision.transforms.Resize(<span class="number">256</span>),</span><br><span class="line">                torchvision.transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line">        img = resize_transform(img)</span><br><span class="line">    <span class="keyword">if</span> self.targets_is_image:</span><br><span class="line">        target = Image.<span class="built_in">open</span>(self.targets[index])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        target = self.targets[index]</span><br><span class="line">    <span class="keyword">return</span> self.transforms(img, target)</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç®—æ³•æ¨¡å‹"><a href="#ä¿®æ”¹ç®—æ³•æ¨¡å‹" class="headerlink" title="ä¿®æ”¹ç®—æ³•æ¨¡å‹"></a>ä¿®æ”¹ç®—æ³•æ¨¡å‹</h2><p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹homo<em>nnç»„ä»¶ä¸‹çš„<em>torch.pyæ–‡ä»¶ï¼Œ<code>FedLightModule</code>ç±»çš„__init</em></em>æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --------- ä¿®æ”¹å‰ ----------</span></span><br><span class="line"><span class="comment"># self.model = nn.Sequential(*layers)</span></span><br><span class="line"><span class="comment"># --------- ä¿®æ”¹å ----------</span></span><br><span class="line"><span class="comment"># è¿™é‡Œéå¸¸å®šåˆ¶åŒ–ï¼Œout_features=2æ˜¯é’ˆå¯¹æœ¬äºŒåˆ†ç±»ä»»åŠ¡ï¼Œå¦‚æœéœ€è¦æ›´çµæ´»çš„ä¼ å‚ï¼Œå¯ä»¥è¯»å–é…ç½®æ–‡ä»¶çš„é…ç½®</span></span><br><span class="line">LOGGER.info(<span class="string">&quot;define vgg16&quot;</span>)</span><br><span class="line">self.model = models.vgg16(pretrained=<span class="literal">True</span>)</span><br><span class="line">self.model.classifier[<span class="number">6</span>] = nn.Linear(in_features=<span class="number">4096</span>, out_features=<span class="number">2</span>, bias=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨GPU"><a href="#ä½¿ç”¨GPU" class="headerlink" title="ä½¿ç”¨GPU"></a>ä½¿ç”¨GPU</h2><p>éœ€è¦ä¿®æ”¹homo_nnç»„ä»¶ä¸‹çš„_torch.pyæ–‡ä»¶ï¼Œ<code>FedLightModule</code>ç±»çš„training_stepã€validation_stepä»¥åŠdo_convergence_checkå’Œencryptæ–¹æ³•ã€‚æ”¹åŠ¨å¦‚ä¸‹ã€‚</p><blockquote><p>do_convergence_checkå’Œencryptè¦æ”¹åŠ¨çš„åŸå› å¹¶ä¸æ¸…æ¥šï¼Œå¤§è‡´æ¥çœ‹ï¼Œåº”è¯¥æ˜¯åœ¨modelèšåˆå’ŒåŠ å¯†çš„æ—¶å€™éœ€è¦å°†å…¶ä»GPUä¸­å–å‡ºã€‚ã€‚ä¸è¿‡å¯ä»¥è‚¯å®šï¼Œå¦‚æ­¤æ”¹åŠ¨å°±ä¼šç”Ÿæ•ˆã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">validation_step</span>(<span class="params">self, batch, batch_idx</span>):</span><br><span class="line">    x, y = batch</span><br><span class="line">    <span class="comment"># -------------- add start ------------------</span></span><br><span class="line">    device = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line">    <span class="comment"># LOGGER.info(f&#x27;device:&#123;device&#125;&#x27;)</span></span><br><span class="line">    x, y = x.to(device), y.to(device)</span><br><span class="line">    <span class="comment"># -------------- add end ------------------</span></span><br><span class="line">    y_hat = self.forward(x)</span><br><span class="line">    loss = self.loss_fn(y_hat, y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> y_hat.shape[<span class="number">1</span>] &gt; <span class="number">1</span>:</span><br><span class="line">        accuracy = (y_hat.argmax(dim=<span class="number">1</span>) == y).<span class="built_in">sum</span>().<span class="built_in">float</span>() / <span class="built_in">float</span>(y.size(<span class="number">0</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        y_prob = y_hat[:, <span class="number">0</span>] &gt; <span class="number">0.5</span></span><br><span class="line">        accuracy = (y == y_prob).<span class="built_in">sum</span>().<span class="built_in">float</span>() / y.size(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;val_loss&quot;</span>: loss, <span class="string">&quot;val_accuracy&quot;</span>: accuracy&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">training_step</span>(<span class="params">self, batch, batch_idx</span>):</span><br><span class="line">    x, y = batch</span><br><span class="line">    <span class="comment"># -------------- add start ------------------</span></span><br><span class="line">    device = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line">    x, y = x.to(device), y.to(device)</span><br><span class="line">    self.model = self.model.to(device)</span><br><span class="line">    <span class="comment"># -------------- add end ------------------</span></span><br><span class="line">    y_hat = self.model(x)</span><br><span class="line">    <span class="comment"># LOGGER.info(&#x27;y_hat: &#123;&#125;&#x27;.format(y_hat.detach().numpy()))</span></span><br><span class="line">    loss = self.loss_fn(y_hat, y)</span><br><span class="line">    self.log(<span class="string">&quot;train_loss&quot;</span>, loss)</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_convergence_check</span>(<span class="params">self, weight, loss</span>):</span><br><span class="line">    <span class="comment"># loss_value = loss.detach().numpy().tolist()</span></span><br><span class="line">    loss_value = loss.detach().cpu().numpy().tolist()</span><br><span class="line"></span><br><span class="line">    self.loss_summary.append(loss_value)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># send loss to server</span></span><br><span class="line">    self.send_loss(loss_value, weight)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># recv convergence status</span></span><br><span class="line">    status = self.recv_loss()</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, tensor: torch.Tensor, weight</span>):</span><br><span class="line">    <span class="keyword">return</span> self.random_padding_cipher.encrypt(</span><br><span class="line"><span class="comment"># torch.clone(tensor).detach().mul_(weight)</span></span><br><span class="line">        torch.clone(tensor).detach().mul_(weight).cpu()</span><br><span class="line">    ).numpy()</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å‹è¯„ä¼°"><a href="#æ¨¡å‹è¯„ä¼°" class="headerlink" title="æ¨¡å‹è¯„ä¼°"></a>æ¨¡å‹è¯„ä¼°</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å‹è¯„ä¼°ä»£ç ï¼Œåœ¨homo_nnæ–‡ä»¶å¤¹ä¸‹æ–°å»ºevaluation.pyï¼Œä»£ç åŠæ³¨é‡Šå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥å¿…è¦çš„åº“ï¼Œæ³¨æ„è¿™é‡Œéœ€è¦å¯¼å…¥homo_nnä¸‹çš„FedLightModuleç±»</span></span><br><span class="line"><span class="comment"># å¦‚æœåº“ä¸å­˜åœ¨ï¼Œéœ€è¦åœ¨fate-flowå®¹å™¨ä¸‹pipå®‰è£…</span></span><br><span class="line"><span class="keyword">from</span> federatedml.nn.homo_nn._torch <span class="keyword">import</span> FedLightModule</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader, Dataset, random_split</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> datasets, models, transforms</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># import cv2</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># dataset</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">My_Dataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, image_path, target</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.image_path = image_path</span><br><span class="line">        self.target = target</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.image_path)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        path = self.image_path[index]</span><br><span class="line">        img = Image.<span class="built_in">open</span>(path).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">        resize_transform = transforms.Compose([</span><br><span class="line">            transforms.Resize(<span class="number">256</span>),</span><br><span class="line">            transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        toTensor_transform = transforms.Compose([</span><br><span class="line">            transforms.ToTensor()</span><br><span class="line">        ])</span><br><span class="line">        label = self.target[index]</span><br><span class="line">        <span class="keyword">if</span> img.size[<span class="number">0</span>] &gt; <span class="number">224</span>:</span><br><span class="line">            img = resize_transform(img)</span><br><span class="line">        img = toTensor_transform(img)</span><br><span class="line">        <span class="keyword">return</span> img, label</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_model</span>(<span class="params">test_loader, model, criterion, device</span>):</span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">  </span><br><span class="line">    true_labels = []</span><br><span class="line">    pred_labels = []</span><br><span class="line">    scores = []</span><br><span class="line"></span><br><span class="line">    size = <span class="built_in">len</span>(test_loader.dataset)</span><br><span class="line">    num_batches = <span class="built_in">len</span>(test_loader)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;size:<span class="subst">&#123;size&#125;</span>; num_batches:<span class="subst">&#123;num_batches&#125;</span>&#x27;</span>)</span><br><span class="line">    losses, correct = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment"># log_loss = 0</span></span><br><span class="line">    <span class="comment">################################# validation #################################</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> batch, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(test_loader)):</span><br><span class="line">            device = torch.device(device)</span><br><span class="line">            x, y = x.to(device), y.to(device)</span><br><span class="line">            pred = model(x)</span><br><span class="line">            loss = criterion(pred, y.long().squeeze()) </span><br><span class="line">            current = batch * <span class="built_in">len</span>(x)</span><br><span class="line">            scores += pred.tolist()</span><br><span class="line">            y_pred, y_true = torch.argmax(pred, axis=<span class="number">1</span>), y.long().squeeze()</span><br><span class="line">            correct += (y_pred == y_true).<span class="built_in">type</span>(torch.<span class="built_in">float</span>).<span class="built_in">sum</span>().item()</span><br><span class="line">            loss, current = np.<span class="built_in">round</span>(loss.item(), <span class="number">5</span>), batch * <span class="built_in">len</span>(x)</span><br><span class="line">            true_labels += y_true.detach().cpu().tolist()</span><br><span class="line">            pred_labels += y_pred.detach().cpu().tolist()</span><br><span class="line">            losses += loss</span><br><span class="line">    correct /= size</span><br><span class="line">    losses /= num_batches</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;losses:<span class="subst">&#123;losses&#125;</span>\n&#x27;</span>)</span><br><span class="line">    metrics = <span class="string">f&quot;Test: Accuracy: <span class="subst">&#123;(<span class="number">100</span>*correct):&gt;<span class="number">0.2</span>f&#125;</span>%, Avg loss: <span class="subst">&#123;losses:&gt;5f&#125;</span> \n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> np.array(true_labels), np.array(pred_labels), np.array(scores), metrics</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">model_path: model path</span></span><br><span class="line"><span class="string">res_path: save csv pathï¼Œä¿å­˜é¢„æµ‹çš„æ•°æ®ç»“æœ</span></span><br><span class="line"><span class="string">metric_path: mertic pathï¼Œä¿å­˜æ¨¡å‹è¯„ä¼°ç»“æœ</span></span><br><span class="line"><span class="string">typ : predict or testï¼Œtestæ˜¯è¯„ä¼°æ¨¡å‹ï¼Œéœ€è¦è¾“å‡ºæ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡ï¼Œpredictæ˜¯å•çº¯çš„å¯¹æœªçŸ¥labelæ•°æ®è¿›è¡Œé¢„æµ‹</span></span><br><span class="line"><span class="string">test_path: test data pathï¼Œæµ‹è¯•æ•°æ®é›†pathï¼Œé»˜è®¤å’Œtrainæ˜¯ç›¸åŒçš„ç»„ç»‡å½¢å¼</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluation</span>(<span class="params">model_path, res_path, metric_path,  typ, test_path</span>):</span><br><span class="line">    model = FedLightModule.load_from_checkpoint(model_path)</span><br><span class="line">    test_images_over = []</span><br><span class="line">    test_labels_over = []</span><br><span class="line">    <span class="keyword">if</span> typ == <span class="string">&#x27;test&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(test_path, <span class="string">&#x27;targets&#x27;</span>), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            line = f.readline()</span><br><span class="line">            <span class="keyword">while</span> line:</span><br><span class="line">                filename = line.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">                target = <span class="built_in">int</span>(line.split(<span class="string">&#x27;,&#x27;</span>)[-<span class="number">1</span>].replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">                test_images_over.append(os.path.join(test_path, <span class="string">&#x27;images&#x27;</span>, filename))</span><br><span class="line">                test_labels_over.append(target)</span><br><span class="line">                line = f.readline()</span><br><span class="line">    <span class="keyword">elif</span> typ == <span class="string">&#x27;predict&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(test_path, <span class="string">&#x27;filenames&#x27;</span>), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            line = f.readline()</span><br><span class="line">            <span class="keyword">while</span> line:</span><br><span class="line">                filename = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">                target = <span class="number">0</span></span><br><span class="line">                test_images_over.append(os.path.join(test_path, <span class="string">&#x27;images&#x27;</span>, filename))</span><br><span class="line">                test_labels_over.append(target)</span><br><span class="line">                line = f.readline()</span><br><span class="line">    test_dataset = My_Dataset(test_images_over, test_labels_over)</span><br><span class="line">    test_loader = DataLoader(test_dataset, batch_size=<span class="number">32</span>)</span><br><span class="line">    loss_fn = nn.CrossEntropyLoss()</span><br><span class="line">    <span class="comment"># device = torch.device(&#x27;cuda&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</span></span><br><span class="line">    device = <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line">    true_labels, pred_labels, scores, metrics = test_model(test_loader, model, loss_fn, device)</span><br><span class="line"></span><br><span class="line">    l = <span class="built_in">len</span>(true_labels)</span><br><span class="line">    <span class="keyword">if</span> typ == <span class="string">&#x27;test&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(metric_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">f&#x27;<span class="subst">&#123;metrics&#125;</span>\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(res_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">&#x27;true_label,pred_label,score\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">                true_label, pred_label, score = true_labels[i], pred_labels[i], scores[i]</span><br><span class="line">                f.write(<span class="string">f&#x27;<span class="subst">&#123;true_label&#125;</span>,<span class="subst">&#123;pred_label&#125;</span>,<span class="subst">&#123;score&#125;</span>\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> typ == <span class="string">&#x27;predict&#x27;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(res_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">&#x27;pred_label,score\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">                true_label, pred_label, score = true_labels[i], pred_labels[i], scores[i]</span><br><span class="line">                f.write(<span class="string">f&#x27;<span class="subst">&#123;pred_label&#125;</span>,<span class="subst">&#123;score&#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res_path = <span class="string">&quot;./123.csv&quot;</span></span><br><span class="line">    metric_path = <span class="string">&quot;./123.txt&quot;</span></span><br><span class="line">    typ = <span class="string">&quot;test&quot;</span></span><br><span class="line">    path = <span class="string">&quot;/data/projects/fate/examples/gwork/colon/test&quot;</span></span><br><span class="line">    model_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    evaluation(model_path, res_path, metric_path,  typ, path)</span><br></pre></td></tr></table></figure><p>ä»£ç ä¿®æ”¹å®Œæ¯•ã€‚ä¸‹é¢è¿›è¡Œè®­ç»ƒã€‚</p><h1 id="è”é‚¦å­¦ä¹ "><a href="#è”é‚¦å­¦ä¹ " class="headerlink" title="è”é‚¦å­¦ä¹ "></a>è”é‚¦å­¦ä¹ </h1><p>åˆ†åˆ«ä¿®æ”¹CONFå’ŒDSLé…ç½®</p><h2 id="colon-conf-json"><a href="#colon-conf-json" class="headerlink" title="colon_conf.json"></a>colon_conf.json</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;dsl_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;initiator&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;guest&quot;</span>,</span><br><span class="line">        <span class="string">&quot;party_id&quot;</span>: <span class="number">9999</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;role&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;arbiter&quot;</span>: [</span><br><span class="line">            <span class="number">10000</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;host&quot;</span>: [</span><br><span class="line">            <span class="number">9998</span>,<span class="number">9997</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;guest&quot;</span>: [</span><br><span class="line">            <span class="number">9999</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;component_parameters&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;common&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;homo_nn_0&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;api_version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;encode_label&quot;</span>: true,</span><br><span class="line">                <span class="string">&quot;max_iter&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;batch_size&quot;</span>: <span class="number">32</span>,</span><br><span class="line">                <span class="string">&quot;optimizer&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;lr&quot;</span>: <span class="number">0.000001</span>,</span><br><span class="line">                    <span class="string">&quot;optimizer&quot;</span>: <span class="string">&quot;Adam&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;loss&quot;</span>: <span class="string">&quot;CrossEntropyLoss&quot;</span>,</span><br><span class="line">                <span class="string">&quot;metrics&quot;</span>: [</span><br><span class="line">                    <span class="string">&quot;accuracy&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;nn_define&quot;</span>: [</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;config_type&quot;</span>: <span class="string">&quot;pytorch&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;0&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;reader_0&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;table&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;colon_images_0&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;experiment&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">      <span class="string">&quot;1&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;reader_0&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;table&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;colon_images_1&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;experiment&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;guest&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;0&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;reader_0&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;table&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;colon_images_2&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;experiment&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="colon-dsl-json"><a href="#colon-dsl-json" class="headerlink" title="colon_dsl.json"></a>colon_dsl.json</h2><p>ç•¥</p><p>é¦–å…ˆæ•°æ®å·²ç»å¤„ç†æˆFATEå¯ä»¥è¯»å–çš„æ ¼å¼ã€‚</p><p>ç„¶åå°†ä¸‰ä»½æ•°æ®åˆ†å‘åˆ°é›†ç¾¤çš„ä¸‰å°ä¸åŒçš„æœºå™¨ä¸Šï¼Œåˆ†åˆ«æ˜¯fate9999ï¼Œfate9998ï¼Œä»¥åŠfate9997</p><p>è¿›å…¥ä¸‰å°æœºå™¨çš„fate-client containerï¼Œä½¿ç”¨flow table bind -c å‘½ä»¤å°†æ–‡ä»¶å¤¹ç»‘å®šåˆ°tableã€‚</p><p>åœ¨å‘èµ·æ–¹FATE9999çš„clientå®¹å™¨ä¸­ï¼Œè¿›å…¥codeæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ<code>flow job submit -c colon_conf.json -d colon_dsl.json</code>å¯åŠ¨ä»»åŠ¡</p><p>æŸ¥çœ‹FATE-BOARD Job</p><p>ä»–çš„homo_nnç»„ä»¶è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹ï¼š</p><p><img src="image-20221014121445-6gzta7m.png" alt="image.png"></p><h1 id="æ¨¡å‹è¯„ä¼°-1"><a href="#æ¨¡å‹è¯„ä¼°-1" class="headerlink" title="æ¨¡å‹è¯„ä¼°"></a>æ¨¡å‹è¯„ä¼°</h1><p>åœ¨jobç»“æŸåï¼Œä¼šä¿å­˜check pointï¼Œä¿å­˜çš„å®¹å™¨ä¸ºfate-flow containerã€‚</p><p>ä»¥fate9999ä¸ºä¾‹ï¼Œä¿å­˜è·¯å¾„ä¸ºï¼š</p><p>/data/projects/fate/fateflow/jobs/202210131350059277200/guest/9999/homo_cv_0/202210131350059277200_homo_cv_0/0/task_executor/7f86f6064aff11edbd540242c0a70064/model.ckpt</p><blockquote><p>ä¸åŒè§’è‰²ï¼ˆgusetã€hostï¼‰ã€ä¸åŒparty_idçš„æœºå™¨ä¸Šè·¯å¾„å¯èƒ½æœ‰æ‰€å·®å¼‚ã€‚</p></blockquote><p>å°†è¯¥è·¯å¾„å¤åˆ¶åˆ°åˆšæ‰çš„evaluation.pyçš„model_pathä¸­ï¼Œæ‰§è¡Œ<code>python evaluation.py</code>ï¼ŒæŸ¥çœ‹è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Accuracy: 99.20%, Avg loss: 0.022641</span><br></pre></td></tr></table></figure><h1 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h1><p>ç»“åˆbaselineçš„å®éªŒç»“æœï¼Œå¯ä»¥å¾—åˆ°ä¸‹è¡¨ã€‚</p><div class="table-container"><table><thead><tr><th>ä½¿ç”¨çš„æ•°æ®</th><th>è®­ç»ƒç±»å‹</th><th>æ¨¡å‹è¯„ä¼°</th></tr></thead><tbody><tr><td>å…¨éƒ¨è®­ç»ƒæ•°æ®ï¼ˆTrain_1+Train_2+Train_3ï¼‰</td><td>æœ¬åœ°ï¼ˆGPUï¼‰</td><td>Accuracy: 99.60%, Avg loss: 0.011775</td></tr><tr><td>Train_1</td><td>æœ¬åœ°ï¼ˆGPUï¼‰</td><td>Accuracy: 73.20%, Avg loss: 0.641481</td></tr><tr><td>Train_2</td><td>æœ¬åœ°ï¼ˆGPUï¼‰</td><td>Accuracy: 71.40%, Avg loss: 0.649055</td></tr><tr><td>Train_3</td><td>æœ¬åœ°ï¼ˆGPUï¼‰</td><td>Accuracy: 56.80%, Avg loss: 0.654335</td></tr><tr><td>å…¨éƒ¨è®­ç»ƒæ•°æ®ï¼ˆTrain_1+Train_2+Train_3ï¼‰</td><td>è”é‚¦ï¼ˆGPUï¼‰</td><td>Accuracy: 99.20%, Avg loss: 0.022641</td></tr></tbody></table></div><p>åœ¨å¢åŠ äº†éƒ¨åˆ†è¯»å†™æ—¥å¿—ï¼Œå¹¶åŠ ä»¥åˆ†æå¯ä»¥å¾—åˆ°è®­ç»ƒçš„æ—¶é—´åˆ†å¸ƒï¼š</p><p><img src="image-20221102004157-5zhbj13.png" alt="image.png"></p><h1 id="å®éªŒåˆ†æ"><a href="#å®éªŒåˆ†æ" class="headerlink" title="å®éªŒåˆ†æ"></a>å®éªŒåˆ†æ</h1><ol><li><p>ä½¿ç”¨è”é‚¦å­¦ä¹ çš„æ•ˆæœè¦ä¼˜äºåˆ†å¼€è®­ç»ƒçš„æ¨¡å‹æ•ˆæœï¼Œè¯æ˜äº†è”é‚¦å­¦ä¹ çš„æœ‰æ•ˆæ€§ã€‚</p></li><li><p>åšå®éªŒå‘ç°ï¼Œä½¿ç”¨CPUè¿›è¡Œè®­ç»ƒï¼Œæ¯ä¸ªepochéœ€è¦å¤§çº¦15åˆ†é’Ÿï¼Œè€Œä½¿ç”¨GPUä¹‹åï¼Œæ¯ä¸ªepochä»…éœ€è¦29så·¦å³ã€‚ä½¿ç”¨GPUçš„è®¡ç®—æ•ˆç‡è¦è¿œè¿œå¤§äºä½¿ç”¨CPUã€‚</p></li><li><p>å¯¹æ—¥å¿—è¿›è¡Œåˆ†æå‘ç°ï¼Œè®¡ç®—æ—¶é—´çº¦ä¸º60sï¼Œæ¨¡å‹å‚æ•°åŠ å¯†ã€è§£å¯†ä»¥åŠä¼ è¾“çš„æ—¶é—´çº¦ä¸ºæ¯”ä¾‹çº¦ä¸º600sï¼ŒäºŒè€…æ¯”ä¾‹çº¦ä¸º1:10ã€‚å› æ­¤å¯ä»¥å¾—å‡ºç»“è®ºï¼šç»“è‚ ç™Œè”é‚¦å­¦ä¹ çš„æ—¶é—´ç“¶é¢ˆä¸åœ¨äºæœ¬åœ°æ¨¡å‹çš„è®­ç»ƒæ—¶é—´ï¼Œè€Œæ˜¯åœ¨äºæ¨¡å‹å‚æ•°åŠ å¯†ã€è§£å¯†ä»¥åŠä¼ è¾“æ—¶é—´ã€‚</p></li></ol><h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><p>ä¿®æ”¹äº†homo_nnçš„æºç ï¼Œå¯¼è‡´åŸæœ‰çš„homo_nnçš„åŠŸèƒ½å¤±æ•ˆï¼Œæ‰€ä»¥è¿™é‡Œä¸æ¨èè¿™æ ·æ”¹ï¼Œæ›´æ¨èå¼€å‘æ–°çš„ç»„ä»¶æ¥å®Œæˆã€‚</p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šè‚ ç™Œå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸Šï¼‰â€”â€”baseline</title>
      <link href="/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%82%A0%E7%99%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94baseline/"/>
      <url>/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%82%A0%E7%99%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94baseline/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¡ˆä¾‹åˆ†ä¸Šä¸‹ä¸¤ç¯‡ï¼Œä¸Šç¯‡ä»‹ç»è‚ ç™Œå›¾åƒåˆ†ç±»ä»»åŠ¡çš„æœ¬åœ°baselineï¼Œä¸‹ç¯‡ä»‹ç»å°†è‚ ç™Œå›¾åƒåˆ†ç±»ä»»åŠ¡ç§»æ¤åˆ°FATEä¸Šï¼Œå®ç°è”é‚¦å­¦ä¹ ã€‚</p><h1 id="ä»»åŠ¡ç›®æ ‡"><a href="#ä»»åŠ¡ç›®æ ‡" class="headerlink" title="ä»»åŠ¡ç›®æ ‡"></a>ä»»åŠ¡ç›®æ ‡</h1><ol><li>ä½¿ç”¨FATEå¼€å‘æ–°çš„ç»„ä»¶ï¼Œå®ç°å›¾åƒæ¨ªå‘è”é‚¦å­¦ä¹ </li><li>è¯æ˜è”é‚¦å­¦ä¹ æœ‰æ•ˆ</li></ol><h1 id="ä»»åŠ¡ä»‹ç»"><a href="#ä»»åŠ¡ä»‹ç»" class="headerlink" title="ä»»åŠ¡ä»‹ç»"></a>ä»»åŠ¡ä»‹ç»</h1><p>è¯¥ä»»åŠ¡å°†å¼€å‘åŸºäºç»“è‚ çš„ç»„ç»‡ç—…ç†å­¦å›¾åƒæ­£ç¡®åˆ¤æ–­æ˜¯è‰¯æ€§ç»„ç»‡æˆ–è€…ç»“è‚ ç™Œçš„äºŒåˆ†ç±»ç®—æ³•ã€‚</p><h2 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h2><p>æ•°æ®é›†æ¥è‡ªäº<a href="https://www.kaggle.com/datasets/andrewmvd/lung-and-colon-cancer-histopathological-imagesçš„colon_image_sets">https://www.kaggle.com/datasets/andrewmvd/lung-and-colon-cancer-histopathological-imagesçš„colon_image_sets</a></p><p>æœ¬ä»»åŠ¡æ•°æ®é›†ç”±2ä¸ªç±»åˆ«ç»„æˆçš„10000å¼ ç¬¦åˆHIPAAæ ‡å‡†çš„ç»“è‚ ç»„ç»‡ç—…ç†å­¦å›¾åƒã€‚æ‰€æœ‰å›¾åƒçš„å°ºå¯¸ä¸º$768 <em> 768 </em> 3$ï¼Œä¸ºjpegæ–‡ä»¶æ ¼å¼ã€‚</p><p>ä¸ºäº†è¿›è¡Œå®éªŒï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼šæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>æ•°æ®shuffleã€‚</p></li><li><p>åˆ†ä¸ºäº”ä¸ªå­é›†ï¼ŒåŒ…å«ä¸‰ä»½è®­ç»ƒé›†å­é›†ï¼Œå‘½åä¸ºTrain_1, Train_2, Train_3ï¼Œè®­ç»ƒé›†å­é›†å„ä¸‰åƒå¼ å›¾åƒï¼Œä¸€ä»½éªŒè¯é›†å’Œä¸€ä»½æµ‹è¯•é›†å„500å¼ ï¼Œåˆ†åˆ«å‘½åä¸ºvalå’Œtestã€‚ï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰å¯¹å›¾åƒæœ¬èº«è¿›è¡Œæ”¹åŠ¨ï¼Œè€Œæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªexcelï¼Œæ¯ä¸ªsheetåŒ…å«image_pathå’Œtypeä¸¤åˆ—ï¼Œåˆ†åˆ«å¯¹åº”å›¾åƒçš„ä½ç½®å’Œlabelï¼Œä¸€å…±æœ‰input1ï¼Œinput2ï¼Œinput3ï¼Œvalå’Œtestäº”ä¸ªsheeté¡µï¼‰</p></li></ol><p>ä¸‰ä»½è®­ç»ƒæ•°æ®å’Œä¸€ä»½æµ‹è¯•æ•°æ®å¯¹åº”çš„ä¸‰ç§ç±»å‹çš„å›¾åƒæ•°é‡å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>Data</th><th>ç»“è‚ ç™Œç»„ç»‡</th><th>è‰¯æ€§ç»„ç»‡</th><th>æ€»è®¡</th></tr></thead><tbody><tr><td>Train_1</td><td>1505</td><td>1495</td><td>3000</td></tr><tr><td>Train_2</td><td>1467</td><td>1533</td><td>3000</td></tr><tr><td>Train_3</td><td>1515</td><td>1485</td><td>3000</td></tr><tr><td>Test</td><td>253</td><td>247</td><td>500</td></tr><tr><td>æ€»è®¡ï¼ˆä¸ç®—Testï¼‰</td><td>4487</td><td>4513</td><td>/</td></tr></tbody></table></div><h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><p>ä¸ºäº†ä¿è¯å•ä¸€å˜é‡å½±å“ï¼Œåœ¨æœ¬åœ°è®­ç»ƒå’Œè”é‚¦è®­ç»ƒçš„æ¨¡å‹å‚æ•°ç›¸åŒï¼Œå…·ä½“å‚æ•°å¦‚ä¸‹è¡¨</p><div class="table-container"><table><thead><tr><th>key</th><th>val</th></tr></thead><tbody><tr><td>å¹³å°</td><td>kaggle</td></tr><tr><td>ç®—æ³•</td><td>åŸºäºImageNet1Ké¢„è®­ç»ƒçš„vgg16æ¨¡å‹</td></tr><tr><td>Epoch</td><td>2</td></tr><tr><td>Batch Size</td><td>16 or 32</td></tr><tr><td>Optimizer</td><td>Adam</td></tr><tr><td>Learning Rate</td><td>1e-5</td></tr><tr><td>Loss</td><td>CrossEntropyLoss</td></tr><tr><td>Metrics</td><td>Accuracy</td></tr></tbody></table></div><h1 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h1><ol><li><p>ä½¿ç”¨å…¨éƒ¨è®­ç»ƒé›†åœ¨æœ¬åœ°è¿›è¡Œè®­ç»ƒï¼Œåœ¨æµ‹è¯•é›†è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚</p></li><li><p>åˆ†åˆ«ä½¿ç”¨ä¸‰ä»½è®­ç»ƒé›†å­é›†åœ¨æœ¬åœ°è¿›è¡Œè®­ç»ƒï¼Œåœ¨æµ‹è¯•é›†è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚</p></li><li><p>ä½¿ç”¨FATEå¯¹ä¸‰ä»½è®­ç»ƒé›†å­é›†è¿›è¡Œè”é‚¦è®­ç»ƒï¼Œåœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚</p></li></ol><h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><blockquote><p>è¿™é‡Œåªåˆ—å‡ºé‡è¦çš„codeï¼Œè¯¦ç»†codeå¯ä»¥å‚è§ï¼š<a href="https://www.kaggle.com/code/guoyujian/colon-cancer101">https://www.kaggle.com/code/guoyujian/colon-cancer101</a></p></blockquote><h2 id="define-params"><a href="#define-params" class="headerlink" title="define params"></a>define params</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">EPOCHS = <span class="number">2</span></span><br><span class="line">BATCH_SIZE = <span class="number">32</span></span><br><span class="line">lr = <span class="number">1e-5</span></span><br><span class="line"></span><br><span class="line">device = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(device)</span><br></pre></td></tr></table></figure><h2 id="åŠ è½½æ•°æ®"><a href="#åŠ è½½æ•°æ®" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»å…ƒæ•°æ®ä¸­è¯»å–å›¾åƒçš„pathå’Œlabel</span></span><br><span class="line">metadata_path = <span class="string">&#x27;../input/input-colon/colon_inputs.xls&#x27;</span></span><br><span class="line"><span class="comment"># metadata_path = &#x27;../input/input-colon-cuts/colon_inputs_cuts.xls&#x27;</span></span><br><span class="line">df1 = pd.read_excel(metadata_path, sheet_name = <span class="string">&#x27;input1&#x27;</span>)</span><br><span class="line">df2 = pd.read_excel(metadata_path, sheet_name = <span class="string">&#x27;input2&#x27;</span>)</span><br><span class="line">df3 = pd.read_excel(metadata_path, sheet_name = <span class="string">&#x27;input3&#x27;</span>)</span><br><span class="line">df4 = pd.read_excel(metadata_path, sheet_name = <span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">df5 = pd.read_excel(metadata_path, sheet_name = <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">df = pd.concat([df1, df2, df3])</span><br><span class="line"></span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨éƒ¨çš„å›¾ç‰‡è·¯å¾„å’Œæ ‡ç­¾</span></span><br><span class="line"><span class="comment"># images_all_over = df[&#x27;image_path&#x27;].to_list()</span></span><br><span class="line">images_all_over = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> df[<span class="string">&#x27;image_path&#x27;</span>]:</span><br><span class="line">    item = images_all_over.append(<span class="string">&#x27;../input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/colon_image_sets/&#x27;</span> + item)</span><br><span class="line">labels_all_over = df[<span class="string">&#x27;type&#x27;</span>].to_list()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;len images_all_over: <span class="subst">&#123;<span class="built_in">len</span>(images_all_over)&#125;</span>; len labels_all_over: <span class="subst">&#123;<span class="built_in">len</span>(labels_all_over)&#125;</span>; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># part1,2,3 &amp; val</span></span><br><span class="line">images_1_over = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> df1[<span class="string">&#x27;image_path&#x27;</span>]:</span><br><span class="line">    item = images_1_over.append(<span class="string">&#x27;../input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/colon_image_sets/&#x27;</span> + item)</span><br><span class="line">labels_1_over = df1[<span class="string">&#x27;type&#x27;</span>].to_list()</span><br><span class="line"></span><br><span class="line">images_2_over = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> df2[<span class="string">&#x27;image_path&#x27;</span>]:</span><br><span class="line">    item = images_2_over.append(<span class="string">&#x27;../input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/colon_image_sets/&#x27;</span> + item)</span><br><span class="line">labels_2_over = df2[<span class="string">&#x27;type&#x27;</span>].to_list()</span><br><span class="line"></span><br><span class="line">images_3_over = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> df3[<span class="string">&#x27;image_path&#x27;</span>]:</span><br><span class="line">    item = images_3_over.append(<span class="string">&#x27;../input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/colon_image_sets/&#x27;</span> + item)</span><br><span class="line">labels_3_over = df3[<span class="string">&#x27;type&#x27;</span>].to_list()</span><br><span class="line"></span><br><span class="line">images_val_over = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> df4[<span class="string">&#x27;image_path&#x27;</span>]:</span><br><span class="line">    item = images_val_over.append(<span class="string">&#x27;../input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/colon_image_sets/&#x27;</span> + item)</span><br><span class="line">labels_val_over = df4[<span class="string">&#x27;type&#x27;</span>].to_list()</span><br><span class="line"></span><br><span class="line">images_test_over = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> df5[<span class="string">&#x27;image_path&#x27;</span>]:</span><br><span class="line">    item = images_test_over.append(<span class="string">&#x27;../input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/colon_image_sets/&#x27;</span> + item)</span><br><span class="line">labels_test_over = df5[<span class="string">&#x27;type&#x27;</span>].to_list()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¹å…¨éƒ¨æ•°æ®shuffle</span></span><br><span class="line"></span><br><span class="line">shuffle_dataset = np.hstack((np.array(images_all_over).reshape(-<span class="number">1</span>, <span class="number">1</span>), np.array(labels_all_over).reshape(-<span class="number">1</span>, <span class="number">1</span>)))</span><br><span class="line">np.random.shuffle(shuffle_dataset)</span><br><span class="line">images_all_over = shuffle_dataset[:, <span class="number">0</span>].tolist()</span><br><span class="line">labels_all_over = shuffle_dataset[:, <span class="number">1</span>].astype(<span class="built_in">int</span>).tolist()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰datasetç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Colon_Dataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, image_path, target, train_transform = <span class="literal">None</span>, test_transform = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.image_path = image_path</span><br><span class="line">        self.target = target</span><br><span class="line">        self.train_transform = train_transform</span><br><span class="line">        self.test_transform = test_transform</span><br><span class="line">        self.transform = <span class="literal">None</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.image_path)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        path = self.image_path[index]</span><br><span class="line">        image = cv2.imread(path)</span><br><span class="line">        label = self.target[index]</span><br><span class="line">        <span class="keyword">if</span> self.transform:</span><br><span class="line">            image = self.transform(image)</span><br><span class="line">        <span class="keyword">return</span> image, label</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">train_mode</span>(<span class="params">self</span>):</span><br><span class="line">        self.transform = self.train_transform</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_mode</span>(<span class="params">self</span>):</span><br><span class="line">        self.transform = self.test_transform</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># define data transform</span></span><br><span class="line">train_transform = transforms.Compose([</span><br><span class="line">    transforms.ToPILImage(),</span><br><span class="line">    transforms.Resize(<span class="number">256</span>),</span><br><span class="line">    transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">    transforms.RandomHorizontalFlip(),</span><br><span class="line">    transforms.RandomRotation(<span class="number">10</span>),</span><br><span class="line">    transforms.ColorJitter(),</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">test_transform = transforms.Compose([</span><br><span class="line">    transforms.ToPILImage(),</span><br><span class="line">    transforms.Resize(<span class="number">256</span>),</span><br><span class="line">    transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">    transforms.ToTensor()</span><br><span class="line">])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨éƒ¨è®­ç»ƒæ•°æ®</span></span><br><span class="line">colon_all_dataset = Colon_Dataset(images_all_over, labels_all_over, train_transform, test_transform)</span><br><span class="line">train_loader = DataLoader(colon_all_dataset, batch_size=BATCH_SIZE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‰ä»½è®­ç»ƒæ•°æ®ã€éªŒè¯æ•°æ®å’Œæµ‹è¯•æ•°æ®</span></span><br><span class="line">colon_1_dataset = Colon_Dataset(images_1_over, labels_1_over, train_transform, test_transform)</span><br><span class="line">colon_2_dataset = Colon_Dataset(images_2_over, labels_2_over, train_transform, test_transform)</span><br><span class="line">colon_3_dataset = Colon_Dataset(images_3_over, labels_3_over, train_transform, test_transform)</span><br><span class="line">colon_val_dataset = Colon_Dataset(images_val_over, labels_val_over, train_transform, test_transform)</span><br><span class="line">colon_test_dataset = Colon_Dataset(images_test_over, labels_test_over, train_transform, test_transform)</span><br><span class="line"></span><br><span class="line">train_1_loader = DataLoader(colon_1_dataset, batch_size=BATCH_SIZE)</span><br><span class="line">train_2_loader = DataLoader(colon_2_dataset, batch_size=BATCH_SIZE)</span><br><span class="line">train_3_loader = DataLoader(colon_3_dataset, batch_size=BATCH_SIZE)</span><br><span class="line">val_loader = DataLoader(colon_val_dataset, batch_size=BATCH_SIZE)</span><br><span class="line">test_loader = DataLoader(colon_test_dataset, batch_size=BATCH_SIZE)</span><br></pre></td></tr></table></figure><h2 id="define-a-model"><a href="#define-a-model" class="headerlink" title="define a model"></a>define a model</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Model = models.vgg16(pretrained=<span class="literal">True</span>)</span><br><span class="line">Model.classifier[<span class="number">6</span>] = nn.Linear(in_features=<span class="number">4096</span>, out_features=<span class="number">2</span>, bias=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">Model = Model.to(device)</span><br><span class="line"></span><br><span class="line">optimizer = torch.optim.Adam(Model.parameters() , lr = lr)</span><br><span class="line"></span><br><span class="line">scheduler = torch.optim.lr_scheduler.MultiStepLR(optimizer, milestones=[<span class="number">10</span>, <span class="number">25</span>, <span class="number">50</span>, <span class="number">75</span>, <span class="number">120</span>], gamma=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">loss_fn = nn.CrossEntropyLoss()</span><br></pre></td></tr></table></figure><h2 id="train-amp-val"><a href="#train-amp-val" class="headerlink" title="train&amp;val"></a>train&amp;val</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®­ç»ƒä¸€è½®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_one_epoch</span>(<span class="params">train_loader, model, criterion, optimizer, device</span>):</span><br><span class="line">    model.train()</span><br><span class="line">  </span><br><span class="line">    colon_all_dataset.train_mode()</span><br><span class="line">    colon_1_dataset.train_mode()</span><br><span class="line">    colon_2_dataset.train_mode()</span><br><span class="line">    colon_3_dataset.train_mode()</span><br><span class="line">    colon_val_dataset.train_mode()</span><br><span class="line">  </span><br><span class="line">    size = <span class="built_in">len</span>(train_loader.dataset)</span><br><span class="line">    num_batches = <span class="built_in">len</span>(train_loader)</span><br><span class="line">    losses, correct = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment">################################# train #################################</span></span><br><span class="line">    <span class="keyword">for</span> batch, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(train_loader)):</span><br><span class="line">        device = torch.device(device)</span><br><span class="line">        x, y = x.to(device), y.to(device)  </span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        pred = model(x)</span><br><span class="line"></span><br><span class="line">        loss = criterion(pred, y.long().squeeze())</span><br><span class="line"></span><br><span class="line">        current = batch * <span class="built_in">len</span>(x)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        y_pred, y_true = torch.argmax(pred, axis=<span class="number">1</span>), y.long().squeeze()</span><br><span class="line">        correct += (y_pred == y_true).<span class="built_in">type</span>(torch.<span class="built_in">float</span>).<span class="built_in">sum</span>().item()</span><br><span class="line">        losses += loss.item()</span><br><span class="line">    correct /= size</span><br><span class="line">    losses /= num_batches</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Train: Accuracy: <span class="subst">&#123;(<span class="number">100</span>*correct):&gt;<span class="number">0.2</span>f&#125;</span>%, Avg loss: <span class="subst">&#123;losses:&gt;5f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> losses, correct</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éªŒè¯ä¸€è½®ï¼Œ éªŒè¯é›†æ•°æ®åŠ è½½ï¼Œæ¨¡å‹ï¼ŒæŸå¤±å‡½æ•°ï¼Œdevice</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_one_epoch</span>(<span class="params">valid_loader, model, criterion, device</span>):</span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    colon_all_dataset.train_mode()</span><br><span class="line">    colon_1_dataset.train_mode()</span><br><span class="line">    colon_2_dataset.train_mode()</span><br><span class="line">    colon_3_dataset.train_mode()</span><br><span class="line">    colon_val_dataset.train_mode()</span><br><span class="line">  </span><br><span class="line">    size = <span class="built_in">len</span>(valid_loader.dataset)</span><br><span class="line">    num_batches = <span class="built_in">len</span>(valid_loader)</span><br><span class="line">    losses, correct = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment">################################# validation #################################</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> batch, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(valid_loader)):</span><br><span class="line">            device = torch.device(device)</span><br><span class="line">            x, y = x.to(device), y.to(device)</span><br><span class="line">            pred = model(x)</span><br><span class="line">            loss = criterion(pred, y.long().squeeze())</span><br><span class="line"></span><br><span class="line">            current = batch * <span class="built_in">len</span>(x)</span><br><span class="line">            y_pred, y_true = torch.argmax(pred, axis=<span class="number">1</span>), y.long().squeeze()</span><br><span class="line">            correct += (y_pred == y_true).<span class="built_in">type</span>(torch.<span class="built_in">float</span>).<span class="built_in">sum</span>().item()</span><br><span class="line">            losses += loss.item()</span><br><span class="line">    correct /= size</span><br><span class="line">    losses /= num_batches</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Valid: Accuracy: <span class="subst">&#123;(<span class="number">100</span>*correct):&gt;<span class="number">0.2</span>f&#125;</span>%, Avg loss: <span class="subst">&#123;losses:&gt;5f&#125;</span> \n&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> losses, correct</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train_valid</span>(<span class="params">train_loader,valid_loader, model, criterion, optimizer, scheduler, device, part = <span class="literal">None</span></span>):</span><br><span class="line">    liveloss = PlotLosses()</span><br><span class="line">  </span><br><span class="line">    tolerance = <span class="number">0</span></span><br><span class="line">    best_loss = np.inf</span><br><span class="line">    best_epoch = <span class="number">0</span></span><br><span class="line">    best_acc = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Starting Training...\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, EPOCHS):</span><br><span class="line">        logs = &#123;&#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;-------------------------------   Epoch <span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>   -------------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">        train_loss, train_acc = train_one_epoch(train_loader, model, criterion, optimizer, device)</span><br><span class="line">        valid_loss, valid_acc = valid_one_epoch(valid_loader, model, criterion, device)</span><br><span class="line">        scheduler.step()</span><br><span class="line">      </span><br><span class="line">        <span class="comment"># save validation loss if it was improved (reduced) &amp; validation accuracy if it was improved (increased)</span></span><br><span class="line">        <span class="keyword">if</span> valid_loss &lt; best_loss <span class="keyword">and</span> valid_acc &gt; best_acc:</span><br><span class="line">            best_epoch = epoch + <span class="number">1</span></span><br><span class="line">            best_loss = valid_loss</span><br><span class="line">            best_acc = valid_acc</span><br><span class="line">            <span class="comment"># save the model&#x27;s weights and biases</span></span><br><span class="line">            <span class="keyword">if</span> part:</span><br><span class="line">                torch.save(model, <span class="string">f&quot;vgg_ep<span class="subst">&#123;best_epoch&#125;</span>_part<span class="subst">&#123;part&#125;</span>.pth&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                torch.save(model, <span class="string">f&quot;vgg_ep<span class="subst">&#123;best_epoch&#125;</span>.pth&quot;</span>)</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> valid_acc &lt; best_acc:</span><br><span class="line">            tolerance += <span class="number">1</span></span><br><span class="line">      </span><br><span class="line">        logs[<span class="string">&#x27;log loss&#x27;</span>] = train_loss</span><br><span class="line">        logs[<span class="string">&#x27;accuracy&#x27;</span>] = train_acc*<span class="number">100</span></span><br><span class="line">        logs[<span class="string">&#x27;val_log loss&#x27;</span>] = valid_loss</span><br><span class="line">        logs[<span class="string">&#x27;val_accuracy&#x27;</span>] = valid_acc*<span class="number">100</span></span><br><span class="line">      </span><br><span class="line">        liveloss.update(logs)</span><br><span class="line">        liveloss.send()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Done!&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># train all</span></span><br><span class="line">train_valid(train_loader,val_loader, Model, loss_fn, optimizer, scheduler, device)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ¨¡å‹æ‹Ÿåˆçš„å¾ˆå¿«</p><p><img src="image-20221101180725-qad0jfu.png" alt="image.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 3 parts train </span></span><br><span class="line">train_valid(train_1_loader,val_loader, Model, loss_fn, optimizer, scheduler, device, part = <span class="number">1</span>)</span><br><span class="line">train_valid(train_2_loader,val_loader, Model, loss_fn, optimizer, scheduler, device, part = <span class="number">2</span>)</span><br><span class="line">train_valid(train_3_loader,val_loader, Model, loss_fn, optimizer, scheduler, device, part = <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å‹è¯„ä¼°"><a href="#æ¨¡å‹è¯„ä¼°" class="headerlink" title="æ¨¡å‹è¯„ä¼°"></a>æ¨¡å‹è¯„ä¼°</h2><p>è¿™é‡Œæ³¨æ„çš„æ˜¯ä¸éœ€è¦å…ˆå¯¹predè¿›è¡Œsoftmaxï¼Œåœ¨è®¡ç®—lossï¼Œè€Œæ˜¯ç›´æ¥è®¡ç®—lossï¼š</p><p>Ref:<a href="https://blog.csdn.net/DragonGirI/article/details/105743487">pytorch è®¡ç®— CrossEntropyLoss å’Œ softmax æ¿€æ´»å±‚</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_model</span>(<span class="params">test_loader, model, criterion, device</span>):</span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    cervical_test_dataset.test_mode()</span><br><span class="line">  </span><br><span class="line">    true_labels = []</span><br><span class="line">    pred_labels = []</span><br><span class="line">    scores = []</span><br><span class="line"></span><br><span class="line">    size = <span class="built_in">len</span>(test_loader.dataset)</span><br><span class="line"></span><br><span class="line">    num_batches = <span class="built_in">len</span>(test_loader)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;size:<span class="subst">&#123;size&#125;</span>; num_batches:<span class="subst">&#123;num_batches&#125;</span>&#x27;</span>)</span><br><span class="line">    losses, correct = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment">################################# validation #################################</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> batch, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(test_loader)):</span><br><span class="line">            device = torch.device(device)</span><br><span class="line">            x, y = x.to(device), y.to(device)</span><br><span class="line">            pred = model(x)</span><br><span class="line"><span class="comment">#             pred = nn.Softmax()(pred)</span></span><br><span class="line"></span><br><span class="line">            loss = criterion(pred, y.long().squeeze()) </span><br><span class="line">            current = batch * <span class="built_in">len</span>(x)</span><br><span class="line">            scores += pred.tolist()</span><br><span class="line">            y_pred, y_true = torch.argmax(pred, axis=<span class="number">1</span>), y.long().squeeze()</span><br><span class="line">            correct += (y_pred == y_true).<span class="built_in">type</span>(torch.<span class="built_in">float</span>).<span class="built_in">sum</span>().item()</span><br><span class="line">            loss, current = np.<span class="built_in">round</span>(loss.item(), <span class="number">5</span>), batch * <span class="built_in">len</span>(x)</span><br><span class="line">            true_labels += y_true.detach().cpu().tolist()</span><br><span class="line">            pred_labels += y_pred.detach().cpu().tolist()</span><br><span class="line">            losses += loss.item()</span><br><span class="line">    correct /= size</span><br><span class="line">    losses /= num_batches</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Test: Accuracy: <span class="subst">&#123;(<span class="number">100</span>*correct):&gt;<span class="number">0.2</span>f&#125;</span>%, Avg loss: <span class="subst">&#123;losses:&gt;5f&#125;</span> \n&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> np.array(true_labels), np.array(pred_labels), np.array(scores)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">test_model_obj = torch.load(<span class="string">&#x27;æ¨¡å‹æ–‡ä»¶path&#x27;</span>)</span><br><span class="line">test_model_obj = test_model_obj.to(device)</span><br><span class="line">test_model(test_loader, test_model_obj, loss_fn, device)</span><br></pre></td></tr></table></figure><h1 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h1><div class="table-container"><table><thead><tr><th>ä½¿ç”¨çš„æ•°æ®</th><th>è¯„ä¼°ç»“æœ</th></tr></thead><tbody><tr><td>å…¨éƒ¨è®­ç»ƒæ•°æ®ï¼ˆTrain_1+Train_2+Train_3ï¼‰</td><td>Accuracy: 99.60%, Avg loss: 0.011775</td></tr><tr><td>Train_1</td><td>Accuracy: 73.20%, Avg loss: 0.641481</td></tr><tr><td>Train_2</td><td>Accuracy: 71.40%, Avg loss: 0.649055</td></tr><tr><td>Train_3</td><td>Accuracy: 56.80%, Avg loss: 0.654335</td></tr></tbody></table></div><h1 id="å®éªŒåˆ†æ"><a href="#å®éªŒåˆ†æ" class="headerlink" title="å®éªŒåˆ†æ"></a>å®éªŒåˆ†æ</h1><p>è§ä¸‹ç¯‡</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šæ‰‹å†™æ•°å­—è¯†åˆ«</title>
      <link href="/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB/"/>
      <url>/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸Šä¸Šä¸€ç¯‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨FATEå‘èµ·ä¸€ä¸ªæ¨ªå‘è”é‚¦å­¦ä¹ ä»»åŠ¡ï¼Œä½¿ç”¨çš„æ•°æ®æ ¼å¼æ˜¯ç»“æ„åŒ–çš„æ•°æ®ï¼Œä½¿ç”¨çš„ç®—æ³•æ˜¯ç»å…¸çš„LRç®—æ³•ã€‚</p><p>èƒ½ä¸èƒ½ä½¿ç”¨FATEåšè®¡ç®—æœºè§†è§‰çš„ç¥ç»ç½‘ç»œçš„è”é‚¦å­¦ä¹ å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚æœ¬ç¯‡å°±é€šè¿‡æ‰‹å†™æ•°å­—è¯†åˆ«è¿™ä¸€ç»å…¸ä»»åŠ¡æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨FATEæ¥å®Œæˆä¸€ä¸ªè®¡ç®—æœºè§†è§‰æ–¹é¢çš„ç¥ç»ç½‘ç»œç®—æ³•çš„è”é‚¦å­¦ä¹ job</p></blockquote><p>â€</p><h1 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h1><p>fate standalone 1.9.0</p><ul><li>æ•°æ®é›†mnistï¼š<code>/data/projects/fate/examples/data/mnist_train</code></li><li>code:<code>/data/projects/fate/examples/dsl/v2/homo_nn/mnist_demo</code></li></ul><blockquote><p>æœ€å¥½æŠŠè¿™å‡ ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶å‡ºæ¥ï¼Œå†æ”¹</p></blockquote><p>codeæ–‡ä»¶å¤¹ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼Œåé¢éœ€è¦ç”¨åˆ°ã€‚</p><p>â€</p><p>åœ¨README.mdä¸­å·²ç»å†™å‡ºäº†ç”¨æ³•ï¼Œæœ¬ç¯‡å°†è¯¦ç»†è®²è§£ã€‚</p><p><img src="image-20221028155604-ny1t6o7.png" alt="image.png"></p><p>â€</p><h1 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h1><h2 id="ä¸‹è½½æ•°æ®é›†"><a href="#ä¸‹è½½æ•°æ®é›†" class="headerlink" title="ä¸‹è½½æ•°æ®é›†"></a>ä¸‹è½½æ•°æ®é›†</h2><p>æ‰§è¡Œ<code>fate_test data download -t mnist</code>å‘½ä»¤ä¸‹è½½mnistæ•°æ®é›†ï¼Œä¸‹è½½çš„ä½ç½®ä½äº<code>FATE/examples/data/mnist_train</code></p><h2 id="ç»‘å®šæ•°æ®"><a href="#ç»‘å®šæ•°æ®" class="headerlink" title="ç»‘å®šæ•°æ®"></a>ç»‘å®šæ•°æ®</h2><p>ä¿®æ”¹bind_local_path.jsonçš„address.pathä¸ºæ•°æ®é›†æ–‡ä»¶å¤¹æ‰€åœ¨çš„ä½ç½®ï¼Œä¿®æ”¹åå¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;engine&quot;</span>: <span class="string">&quot;PATH&quot;</span>,</span><br><span class="line">    <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;experiment&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;mnist_images&quot;</span>,</span><br><span class="line">    <span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/data/projects/fate/examples/data/mnist_train&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆåæ‰§è¡Œ<code>flow table bind -c bind_local_path.json</code>å‘½ä»¤è¿›è¡Œæ•°æ®ç»‘å®šã€‚è¿™æ ·ä¸€æ¥ï¼Œæ–‡ä»¶å¤¹ä¸­çš„æ•°æ®å°±å’Œå‘½åç©ºé—´ä¸ºexperimentï¼Œè¡¨åä¸ºmnist_imagesçš„è¡¨å…³è”äº†èµ·æ¥ã€‚</p><p>è¿”å›ç±»ä¼¼å³ç»‘å®šæˆåŠŸã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;retcode&quot;</span>: 0,</span><br><span class="line"><span class="string">&quot;retmsg&quot;</span>: <span class="string">&quot;success&quot;</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶å¹¶æäº¤job"><a href="#é…ç½®æ–‡ä»¶å¹¶æäº¤job" class="headerlink" title="é…ç½®æ–‡ä»¶å¹¶æäº¤job"></a>é…ç½®æ–‡ä»¶å¹¶æäº¤job</h2><p>mnist_dsl.jsonæ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;components&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;reader_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Reader&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;homo_nn_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HomoNN&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;train_data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;reader_0.data&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;model&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>mnist_conf.jsonæ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dsl_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;initiator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;guest&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;party_id&quot;</span><span class="punctuation">:</span> <span class="number">9999</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;arbiter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">9999</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">9999</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;guest&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">9999</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;component_parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;common&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;homo_nn_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;api_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;encode_label&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;max_iter&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;batch_size&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;early_stop&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;early_stop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;diff&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;eps&quot;</span><span class="punctuation">:</span> <span class="number">0.0001</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;optimizer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;lr&quot;</span><span class="punctuation">:</span> <span class="number">0.001</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;optimizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Adam&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;loss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NLLLoss&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;metrics&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;accuracy&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nn_define&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Conv2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;in_channels&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;out_channels&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;kernel_size&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="number">5</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MaxPool2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;kernel_size&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ReLU&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Conv2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;in_channels&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;out_channels&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;kernel_size&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="number">5</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dropout2d&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MaxPool2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;kernel_size&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ReLU&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Flatten&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Linear&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;in_features&quot;</span><span class="punctuation">:</span> <span class="number">320</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;out_features&quot;</span><span class="punctuation">:</span> <span class="number">50</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ReLU&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Linear&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;in_features&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;out_features&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;layer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LogSoftmax&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;config_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pytorch&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;reader_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mnist_images&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;experiment&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;guest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;reader_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mnist_images&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;experiment&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>flow job submit -c mnist_conf.json -d mnist_dsl.json</code>å‘½ä»¤æäº¤jobï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@693afd940463 mnist_demo]<span class="comment"># flow job submit -c mnist_conf.json -d mnist_dsl.json </span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;board_url&quot;</span>: <span class="string">&quot;http://127.0.0.1:8080/index.html#/dashboard?job_id=202209210827526887030&amp;role=guest&amp;party_id=10000&quot;</span>,</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;dsl_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209210827526887030/job_dsl.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;job_id&quot;</span>: <span class="string">&quot;202209210827526887030&quot;</span>,</span><br><span class="line">        <span class="string">&quot;logs_directory&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/logs/202209210827526887030&quot;</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        <span class="string">&quot;model_info&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;model_id&quot;</span>: <span class="string">&quot;arbiter-10000#guest-10000#host-10000#model&quot;</span>,</span><br><span class="line">            <span class="string">&quot;model_version&quot;</span>: <span class="string">&quot;202209210827526887030&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;pipeline_dsl_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209210827526887030/pipeline_dsl.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;runtime_conf_on_party_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209210827526887030/guest/10000/job_runtime_on_party_conf.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;runtime_conf_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209210827526887030/job_runtime_conf.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;train_runtime_conf_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209210827526887030/train_runtime_conf.json&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;jobId&quot;</span>: <span class="string">&quot;202209210827526887030&quot;</span>,</span><br><span class="line">    <span class="string">&quot;retcode&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;retmsg&quot;</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨flow-testæäº¤Job"><a href="#ä½¿ç”¨flow-testæäº¤Job" class="headerlink" title="ä½¿ç”¨flow-testæäº¤Job"></a>ä½¿ç”¨flow-testæäº¤Job</h2><p>é™¤äº†ä¸Šè¿°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å¿«é€Ÿæäº¤ä¸€ä¸ªjobã€‚</p><p>flow-test å¿«é€Ÿçš„flowæµ‹è¯•ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œåªéœ€è¦ä¿®æ”¹mnist_nn_testsuite.jsonå¹¶æ‰§è¡Œä¸€æ¬¡å‘½ä»¤å³å¯ã€‚ä»–æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ä¸éœ€è¦æå‰ç»‘å®šæ•°æ®ï¼Œæ‰§è¡Œå®Œæˆåï¼Œä¹Ÿä¸å­˜åœ¨è¢«ç»‘å®šçš„æ•°æ®</li><li>æ—¥å¿—ä¼šä¿å­˜åœ¨åˆ°æœ¬åœ°ç›®å½•logs</li><li>ä¸ä¼šäº§ç”Ÿmodel_idå’Œmodel_version</li></ul><p>ä¸‹é¢ä»‹ç»æ‰§è¡Œæ­¥éª¤ï¼š</p><h3 id="ä¿®æ”¹mnist-nn-testsuite-json"><a href="#ä¿®æ”¹mnist-nn-testsuite-json" class="headerlink" title="ä¿®æ”¹mnist_nn_testsuite.json"></a>ä¿®æ”¹<code>mnist_nn_testsuite.json</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;engine&quot;</span>: <span class="string">&quot;PATH&quot;</span>,</span><br><span class="line">            <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;experiment&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;mnist_images&quot;</span>,</span><br><span class="line">            <span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/data/projects/fate/work/mnist_fed/mnist_images&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;guest_0&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;engine&quot;</span>: <span class="string">&quot;PATH&quot;</span>,</span><br><span class="line">            <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;experiment&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;mnist_images&quot;</span>,</span><br><span class="line">            <span class="string">&quot;address&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/data/projects/fate/work/mnist_fed/mnist_images&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;host_0&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;tasks&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;mnist&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;conf&quot;</span>: <span class="string">&quot;./mnist_conf.json&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dsl&quot;</span>: <span class="string">&quot;./mnist_dsl.json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œflow-test"><a href="#æ‰§è¡Œflow-test" class="headerlink" title="æ‰§è¡Œflow-test"></a>æ‰§è¡Œflow-test</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fate_test suite -i mnist_nn_testsuite.json</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="image-20220922142054-e4f41jc.png" alt="image.png"></p><p>â€</p><h1 id="æ¨¡å‹è¯„ä¼°"><a href="#æ¨¡å‹è¯„ä¼°" class="headerlink" title="æ¨¡å‹è¯„ä¼°"></a>æ¨¡å‹è¯„ä¼°</h1><p>ä¸Šè¿°è®­ç»ƒå®Œæˆä¹‹åï¼Œå¦‚ä½•è¿›è¡Œè¯„ä¼°æœ¬æ¬¡è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹æ•ˆæœå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼šæˆªæ­¢åˆ°1.9.0ç‰ˆæœ¬ï¼ŒFATEè¿˜æš‚ä¸æ”¯æŒå¯¹è®¡ç®—æœºè§†è§‰ç±»ä»»åŠ¡è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚ã€‚ã€‚</p><p>æˆ‘çš„åšæ³•æ˜¯ï¼Œ<strong>ç›´æ¥åœ¨FATE-FLOWä¸­æ‰¾åˆ°Jobç”Ÿæˆçš„æ¨¡å‹æ–‡ä»¶ï¼Œè‡ªè¡Œå®ç°å¯¹æ¨¡å‹çš„è¯„ä¼°ã€‚</strong></p><p>è¦åšåˆ°è¿™ä¸€ç‚¹éœ€è¦ç†Ÿæ‚‰æºç ã€‚</p><h1 id="ä»Howåˆ°Why"><a href="#ä»Howåˆ°Why" class="headerlink" title="ä»Howåˆ°Why"></a>ä»Howåˆ°Why</h1><p>å‰é¢æˆ‘ä»¬äº†è§£äº†FATEæäº¤ä¸€ä¸ªè§†è§‰åˆ†ç±»ä»»åŠ¡çš„åŸºæœ¬æµç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šæœªçŸ¥çš„ä¸œè¥¿ï¼šæ¯”å¦‚ä¸ºä»€ä¹ˆè¦è¿™æ ·ç»„ç»‡æ•°æ®ï¼ŒFATEæ˜¯å¦‚ä½•è¯»å–é…ç½®åˆ›å»ºæ¨¡å‹çš„ï¼Œè”é‚¦å­¦ä¹ ç»“æŸåä¿å­˜çš„æ¨¡å‹åœ¨å“ªé‡Œï¼Œå¦‚ä½•è°ƒç”¨ï¼Ÿ</p><p>æƒ³è¦çŸ¥é“è¿™äº›éœ€è¦è¯»æ‡‚FATEæºç ã€‚</p><h1 id="æºç ï¼ˆéƒ¨åˆ†ï¼‰"><a href="#æºç ï¼ˆéƒ¨åˆ†ï¼‰" class="headerlink" title="æºç ï¼ˆéƒ¨åˆ†ï¼‰"></a>æºç ï¼ˆéƒ¨åˆ†ï¼‰</h1><p>è¯¥éƒ¨åˆ†ä»‹ç»FATEæ˜¯å¦‚ä½•æ ¹æ®DSLå’ŒCONFé…ç½®è¯»å…¥æ•°æ®ã€åˆ›å»ºå’Œè®­ç»ƒæ¨¡å‹ä»¥åŠå¯¼å‡ºæ¨¡å‹çš„ã€‚</p><p>è¿™é‡Œå…ˆä»‹ç»ä¸€äº›æ¯”è¾ƒé‡è¦çš„ç›®å½•ï¼š</p><blockquote><ul><li><a href="https://github.com/FederatedAI/FATEï¼š">https://github.com/FederatedAI/FATEï¼š</a> FATEå®˜æ–¹å¼€æºçš„æ ¹ç›®å½•</li><li><a href="https://github.com/FederatedAI/FATE/tree/master/python/federatedmlï¼šFATEè”é‚¦å­¦ä¹ ç®—æ³•ç»„ä»¶çš„æºç ç›®å½•ï¼Œä¹Ÿæ˜¯åé¢é‡ç‚¹ç ”ç©¶çš„ç›®å½•ï¼Œè¯»æ‡‚è¯¥ç›®å½•ä¸‹çš„æºç å°±å¯ä»¥å¼€å§‹å¼€å‘æ–°çš„ç®—æ³•ç»„ä»¶ã€‚">https://github.com/FederatedAI/FATE/tree/master/python/federatedmlï¼šFATEè”é‚¦å­¦ä¹ ç®—æ³•ç»„ä»¶çš„æºç ç›®å½•ï¼Œä¹Ÿæ˜¯åé¢é‡ç‚¹ç ”ç©¶çš„ç›®å½•ï¼Œè¯»æ‡‚è¯¥ç›®å½•ä¸‹çš„æºç å°±å¯ä»¥å¼€å§‹å¼€å‘æ–°çš„ç®—æ³•ç»„ä»¶ã€‚</a></li><li><a href="https://github.com/FederatedAI/FATE-Flow/tree/3afbc3e5d335ac96634eadfc493c4c697ecbfc19/python/fate_flow/appsï¼šFATE">https://github.com/FederatedAI/FATE-Flow/tree/3afbc3e5d335ac96634eadfc493c4c697ecbfc19/python/fate_flow/appsï¼šFATE</a> APIæºç ç›®å½•ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¼€å‘æ–°çš„API</li></ul></blockquote><p>â€</p><p>ä»ä¸Šé¢çš„æ¡ˆä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ˜¯HomoNNç®—æ³•ç»„ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦æ‰¾åˆ°NNå¯¹åº”çš„ä½ç½®ï¼š<a href="https://github.com/FederatedAI/FATE/tree/master/python/federatedml/nnï¼Œè¿™é‡Œnnæ˜¯ç¥ç»ç½‘ç»œçš„æ„æ€ã€‚">https://github.com/FederatedAI/FATE/tree/master/python/federatedml/nnï¼Œè¿™é‡Œnnæ˜¯ç¥ç»ç½‘ç»œçš„æ„æ€ã€‚</a></p><p>åœ¨è¯¥ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š</p><ul><li>backendï¼šå…¬å…±åç«¯ä»£ç </li><li>hetero_nnï¼šçºµå‘nnç»„ä»¶</li><li>homo_nnï¼šæ¨ªå‘nnç»„ä»¶</li></ul><p>è¿™ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­æ˜¯éœ€è¦é‡ç‚¹è¯»æ‡‚çš„ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œè¿™é‡Œæ˜ç¡®ï¼Œæˆ‘ä»¬è¦å¼„æ‡‚çš„é—®é¢˜ï¼š</p><ol><li>å›¾åƒæ•°æ®æ˜¯å¦‚ä½•inputçš„</li><li>ä¸ºä»€ä¹ˆåšå›¾åƒä»»åŠ¡æ—¶ï¼Œæ•°æ®çš„ç»„ç»‡å½¢å¼è¦åˆ†ä¸ºimages/ã€config.yamlã€filenamesä»¥åŠtargets</li><li>FATEæ˜¯å¦‚ä½•æ ¹æ®CONFç”Ÿæˆæ¨¡å‹ï¼Œoptimizerç­‰ç®—æ³•å‚æ•°çš„ã€‚</li><li>FATEæ˜¯å¦‚ä½•è¿›è¡Œè®­ç»ƒçš„ã€‚</li><li>FATEæ˜¯å¦æ”¯æŒä½¿ç”¨é¢„è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œæ˜¯å¦æ”¯æŒä½¿ç”¨GPUè¿›è¡Œè®­ç»ƒï¼Œæ˜¯å¦å¯ä»¥è‡ªå®šä¹‰æ·»åŠ logç­‰ç­‰ï¼Œå¦‚æœä¸èƒ½ï¼Œå¯å¦å¼€å‘è‡ªå·±çš„ç»„ä»¶æ¥å®ç°ã€‚</li><li>å¦‚æœä½¿ç”¨é…ç½®å®šä¹‰æ¨¡å‹ï¼Œé‚£ä¹ˆFATEæ”¯æŒçš„layerä»¥åŠå‚æ•°æœ‰å“ªäº›ï¼Ÿ</li></ol><p>å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ æºç ã€‚</p><h2 id="enter-point-py"><a href="#enter-point-py" class="headerlink" title="enter_point.py"></a>enter_point.py</h2><p>enter_pointæ˜¯homo_nnç»„ä»¶è¢«è°ƒç”¨çš„èµ·ç‚¹ï¼ˆå­˜ç–‘ï¼‰ï¼Œæ–‡ä»¶ä½ç½®ï¼š<a href="https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/homo_nn/enter_point.py">https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/homo_nn/enter_point.py</a></p><p>é‡ç‚¹å…³æ³¨<code>HomoNNClient</code>ç±»ã€‚å®ƒåŒ…å«å‡ ä¸ªé‡è¦çš„æ–¹æ³•ï¼š</p><ul><li>fitï¼šæ¨¡å‹è®­ç»ƒ</li><li>predictï¼šæ¨¡å‹é¢„æµ‹</li><li>export_modelå’Œload_modelï¼šæ¨¡å‹çš„å¯¼å‡ºå’ŒåŠ è½½ã€‚</li></ul><h3 id="fit"><a href="#fit" class="headerlink" title="fit"></a>fit</h3><p>ä»¥ä¸‹æ˜¯è¯¥æ–¹æ³•çš„ä¸»è¦ä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fit</span>(<span class="params">self, data, *args</span>):</span><br><span class="line">...</span><br><span class="line">        <span class="keyword">from</span> federatedml.nn.homo_nn._torch <span class="keyword">import</span> build_trainer</span><br><span class="line">...</span><br><span class="line">        self._trainer, dataloader = build_trainer(</span><br><span class="line">            param=self.param,</span><br><span class="line">            data=data,</span><br><span class="line">            should_label_align=<span class="keyword">not</span> self.component_properties.is_warm_start,</span><br><span class="line">            trainer=self._trainer,</span><br><span class="line">        ) <span class="comment"># è°ƒç”¨build_trainerè·å–trainerå’Œdataloader</span></span><br><span class="line">        self._trainer.fit(dataloader) <span class="comment"># æ‰§è¡Œè®­ç»ƒ</span></span><br><span class="line">        self.set_summary(self._trainer.summary())</span><br><span class="line">        <span class="comment"># save model to local filesystem</span></span><br><span class="line">        self._trainer.save_checkpoint()</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°trainerå’Œdataloaderæ˜¯é€šè¿‡è°ƒç”¨build_trainerè¿”å›çš„ã€‚</p><p>â€</p><h2 id="torch-py"><a href="#torch-py" class="headerlink" title="_torch.py"></a>_torch.py</h2><p>è¿™æ˜¯FATEè¿›è¡Œè”é‚¦å­¦ä¹ ï¼Œhomo_nnç»„ä»¶çš„ä¸»è¦å®ç°ä»£ç ã€‚</p><h3 id="build-trainer"><a href="#build-trainer" class="headerlink" title="build_trainer"></a>build_trainer</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_trainer</span>(<span class="params">param: HomoNNParam, data, should_label_align=<span class="literal">True</span>, trainer=<span class="literal">None</span></span>):</span><br><span class="line">    ...</span><br><span class="line">    pl_trainer = pl.Trainer(</span><br><span class="line">        max_epochs=total_epoch,</span><br><span class="line">        callbacks=[EarlyStopCallback(context)],</span><br><span class="line">        num_sanity_val_steps=<span class="number">0</span>,</span><br><span class="line">    )</span><br><span class="line">    ...</span><br><span class="line">    pl_model = FedLightModule(</span><br><span class="line">        context,</span><br><span class="line">        layers_config=param.nn_define,</span><br><span class="line">        optimizer_config=param.optimizer,</span><br><span class="line">        loss_config=&#123;<span class="string">&quot;loss&quot;</span>: param.loss&#125;,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    dataset = make_dataset(</span><br><span class="line">        data=data,</span><br><span class="line">        is_train=should_label_align,</span><br><span class="line">        expected_label_type=expected_label_type,</span><br><span class="line">    )</span><br><span class="line">    ...</span><br><span class="line">    dataloader = torch.utils.data.DataLoader(</span><br><span class="line">        dataset=dataset, batch_size=batch_size, num_workers=<span class="number">1</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">return</span> trainer, dataloader</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°datasetæ˜¯è°ƒç”¨make_datasetæ–¹æ³•å¾—åˆ°ï¼Œmodelæ˜¯FedLightModuleçš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</p><p>â€</p><h3 id="make-dataset"><a href="#make-dataset" class="headerlink" title="make_dataset"></a>make_dataset</h3><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå›¾åƒæ•°æ®ï¼Œæ˜¯é€šè¿‡VisionDataSetå®ä¾‹åŒ–å¾—åˆ°çš„ã€‚å…·ä½“VisionDataSetåé¢å†è°ˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_dataset</span>(<span class="params">data, **kwargs</span>):</span><br><span class="line">    <span class="keyword">if</span> is_table(data):</span><br><span class="line">        dataset = TableDataSet(data_instances=data, **kwargs)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(data, LocalData):</span><br><span class="line">        dataset = VisionDataSet(data.path, **kwargs)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">f&quot;data type <span class="subst">&#123;data&#125;</span> not supported&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataset</span><br></pre></td></tr></table></figure><p>â€</p><h3 id="FedLightModule-init"><a href="#FedLightModule-init" class="headerlink" title="FedLightModule.init()"></a>FedLightModule.<strong>init</strong>()</h3><p>å…³æ³¨<code>FedLightModule</code>è¿™ä¸ªç±»ã€‚è¯¥ç±»ç»§æ‰¿äº†<code>LightningModule</code>ã€‚è¿™ä¸œè¥¿çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªå°†pytorchè½»é‡åŒ–ã€è§„èŒƒåŒ–çš„åº“ã€‚</p><p>è¯¥ç±»æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><strong>init</strong>ï¼šåˆå§‹åŒ–</li><li>forwardï¼šå‰å‘ä¼ æ’­</li><li>training_stepï¼šæ¯ä¸ªbatchè®­ç»ƒçš„æ‰§è¡Œä»£ç ï¼Œä¼ å…¥batchå’Œbatch_idxï¼Œè¿”å›loss</li><li>validation_stepï¼šæ¯ä¸ªbatchéªŒè¯çš„æ‰§è¡Œä»£ç ï¼Œä¼ å…¥batchå’Œbatch_idxï¼Œè¿”å›losså’Œacc</li><li>validation_epoch_endï¼šæ¯ä¸ªepochç»“æŸåæ‰§è¡Œï¼Œè¾“å…¥çš„æ˜¯æ‰€æœ‰batchçš„outputsï¼Œæ‰“å°è¯¥epochçš„local losså’Œlocal accã€‚ï¼ˆlocalçš„æ„æ€æ˜¯ï¼ŒåªåŸºäºè‡ªå·±è¿™ä¸€æ–¹çš„æ•°æ®è®¡ç®—çš„ç»“æœï¼‰</li><li>configure_optimizersï¼šé…ç½®optimizer</li></ul><p>åœ¨initæ–¹æ³•ä¸­ï¼Œéå¸¸æ¸…æ™°çš„å¯ä»¥çœ‹åˆ°ï¼Œmodelã€losså’Œoptimizeræ˜¯å¦‚ä½•è¯»å–é…ç½®å®šä¹‰å‡ºæ¥çš„ã€‚</p><p>modelæ˜¯é€šè¿‡è¯»å–é…ç½®ä¸­çš„layer_configï¼Œç”Ÿæˆæ¨¡å‹çš„æ¯ä¸€å±‚ï¼Œç„¶ååœ¨â€œç»„è£…èµ·æ¥â€ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    context: PyTorchSAClientContext,</span></span><br><span class="line"><span class="params">    layers_config: typing.<span class="type">List</span>[typing.Mapping],</span></span><br><span class="line"><span class="params">    optimizer_config: types.SimpleNamespace,</span></span><br><span class="line"><span class="params">    loss_config: typing.Mapping,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="built_in">super</span>().__init__()</span><br><span class="line">    self.save_hyperparameters()</span><br><span class="line">    self.context = context</span><br><span class="line"></span><br><span class="line">    <span class="comment"># model</span></span><br><span class="line">    layers = []</span><br><span class="line">    <span class="keyword">for</span> layer_config <span class="keyword">in</span> layers_config:</span><br><span class="line">        layer_name = layer_config[<span class="string">&quot;layer&quot;</span>]</span><br><span class="line">        layer_kwargs = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> layer_config.items() <span class="keyword">if</span> k != <span class="string">&quot;layer&quot;</span>&#125;</span><br><span class="line">        layers.append(get_layer_fn(layer_name, layer_kwargs))</span><br><span class="line">    self.model = nn.Sequential(*layers)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># loss</span></span><br><span class="line">    loss_name = loss_config[<span class="string">&quot;loss&quot;</span>]</span><br><span class="line">    loss_kwargs = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> loss_config.items() <span class="keyword">if</span> k != <span class="string">&quot;loss&quot;</span>&#125;</span><br><span class="line">    self.loss_fn, self.expected_label_type = get_loss_fn(loss_name, loss_kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># optimizer</span></span><br><span class="line">    self._optimizer_name = optimizer_config.optimizer</span><br><span class="line">    self._optimizer_kwargs = optimizer_config.kwargs</span><br><span class="line"></span><br><span class="line">    self.num_data_consumed = <span class="number">0</span></span><br><span class="line">    self._all_consumed_data_aggregated = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    self._should_early_stop = <span class="literal">False</span></span><br><span class="line">    self._loss = <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±çš„æ¨¡å‹ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦å®šä¹‰ä¸€ä¸ªé¢„è®­ç»ƒçš„vgg16ï¼Œåˆ™ä¿®æ”¹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.model = models.vgg16(pretrained=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å›ç­”ç¬¬ä¸‰ã€å››ã€äº”ä¸ªé—®é¢˜ï¼š FATEæœ¬èº«ä¸æ”¯æŒåŠ è½½é¢„è®­ç»ƒæ¨¡å‹ã€ä½¿ç”¨GPUè®­ç»ƒã€è‡ªå®šä¹‰æ—¥å¿—ï¼Œä½†æ˜¯æ‚¨å¯ä»¥è‡ªè¡Œå¼€å‘ã€‚</p><h3 id="PyTorchFederatedTrainer"><a href="#PyTorchFederatedTrainer" class="headerlink" title="PyTorchFederatedTrainer"></a>PyTorchFederatedTrainer</h3><p>è¿™ä¸ªç±»å’Œæ¨¡å‹æœ‰å…³ã€‚ä»<code>save_checkpoint</code>æ–¹æ³•ä¸­å¯ä»¥çŸ¥é“ï¼ŒFATEå°†æ¨¡å‹æ–‡ä»¶ä¿å­˜ä¸ºmodel.ckptã€‚ä»<code>load_model</code>æ–¹æ³•ä¸­å¯ä»¥äº†è§£åˆ°ï¼ŒåŠ è½½æœ€åå¾—åˆ°çš„æ¨¡å‹æ–‡ä»¶çš„æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pl_model = FedLightModule.load_from_checkpoint(filepath)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æœ€åç”Ÿæˆçš„æ¨¡å‹ï¼Œå°±å¯ä»¥loadè¿›æ¥ï¼Œ è‡ªå·±å¼€å‘è¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚</p><h2 id="data-py"><a href="#data-py" class="headerlink" title="data.py"></a>data.py</h2><p><a href="https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/backend/pytorch/data.py">https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/backend/pytorch/data.py</a></p><p>FATEé€šè¿‡<code>VisionDataSet</code>ç±»åŠ è½½å›¾åƒæ•°æ®ï¼Œè¿™ä¹Ÿå›ç­”äº†ç¬¬ä¸€ã€äºŒä¸ªé—®é¢˜ã€‚</p><p>â€</p><h2 id="FATEæ”¯æŒçš„layer"><a href="#FATEæ”¯æŒçš„layer" class="headerlink" title="FATEæ”¯æŒçš„layer"></a>FATEæ”¯æŒçš„layer</h2><p>åœ¨CONFæ–‡ä»¶çš„â€œnn_defineâ€ä¸­å‡ºç°äº†å¾ˆå¤šç±»å‹çš„layerï¼šConv2dã€ReLuâ€¦</p><p>FATEæ”¯æŒçš„å±‚çš„å®šä¹‰ä½äº<a href="https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/backend/fate_torch/nn.py">https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/backend/fate_torch/nn.py</a></p><blockquote><p>è¿™é‡Œæˆ‘ä¸€å¼€å§‹è¯¯ä»¥ä¸ºå®šä¹‰çš„å±‚ä½äºï¼š<a href="https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/backend/pytorch/nn_model.py">https://github.com/FederatedAI/FATE/blob/master/python/federatedml/nn/backend/pytorch/nn_model.py</a></p><p>åæ¥å‘ç°æ˜¯ä¸å¯¹çš„ï¼Œä¸ºä»€ä¹ˆä¸å¯¹ã€‚æˆ‘ä¹Ÿæ²¡ææ¸…æ¥šã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATE DSLé…ç½®æ–‡ä»¶è¯¦ç»†è§£é‡Š</title>
      <link href="/2022/11/04/FATE-DSL%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A/"/>
      <url>/2022/11/04/FATE-DSL%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œå¯¹FATE DSLæ–‡ä»¶åšè¯¦ç»†è§£é‡Šã€‚</p><h1 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a>DSL</h1><p>DSLæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒFATE 1.7ä»¥ä¸Šç‰ˆæœ¬å¼ºåˆ¶ä½¿ç”¨v2ã€‚</p><p>dsl.jsonæä¾›äº†æµç¨‹ï¼Œconf.jsonæä¾›äº†ä¸ªæµç¨‹å‚æ•°ã€‚</p><p>å…¶ä¸­dsl.jsonçš„é…ç½®å‚è§ï¼š<a href="https://github.com/FederatedAI/FATE/blob/master/doc/tutorial/dsl_conf/dsl_conf_v2_setting_guide.zh.md">https://github.com/FederatedAI/FATE/blob/master/doc/tutorial/dsl_conf/dsl_conf_v2_setting_guide.zh.md</a></p><p>ä¸‹é¢é€‰å–ä¸€ä¸ªæ¡ˆä¾‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//dsl.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;components&quot;: &#123; // ä¸€çº§é…ç½®ï¼Œè¡¨ç¤ºè¿™ä¸ªä»»åŠ¡ä¼šä½¿ç”¨çš„ç»„ä»¶</span><br><span class="line">        &quot;reader_0&quot;: &#123; // ç»„ä»¶çš„åå­—ï¼Œè‡ªå®šä¹‰</span><br><span class="line">    // æŒ‡å®šæ¨¡å—ï¼Œå‚æ•°éœ€è¦å’Œç›®å½•/data/projects/fate/fate/python/federatedml/componentsä¸€è‡´ï¼Œé‡Œé¢æœ‰ä¸€äº›å®šä¹‰å¥½çš„ç»„ä»¶ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸å…¨ï¼Œæˆ‘çš„å»ºè®®è¿˜æ˜¯çœ‹å®˜æ–¹docsï¼šhttps://fate.readthedocs.io/en/latest/federatedml_component/</span><br><span class="line">            &quot;module&quot;: &quot;Reader&quot;, //æ•°æ®éœ€è¦é€šè¿‡Readerç»„ä»¶ä»æ•°æ®å­˜å‚¨æ‹¿å–æ•°æ®ï¼Œæ³¨æ„æ­¤ç»„ä»¶ä»…æœ‰è¾“å‡ºoutputï¼Œæ­¤æ¨¡å—å¿…é¡»è¦æœ‰</span><br><span class="line">            &quot;output&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data&quot; // è¿™ä¸ªåœ°æ–¹æ˜¯è‡ªå®šä¹‰è¿˜æ˜¯å¿…é¡»æ˜¯trainï¼Ÿéœ€è¦å°è¯•</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">// é™¤readerä¹‹å¤–ï¼Œæ¯ä¸ªç»„ä»¶ä¸‹åŒ…å«inputå’Œoutputï¼Œinputå’Œoutputä¸‹åˆåŒ…å«dataå’Œmodel</span><br><span class="line">// data input: æ¥è‡ªäºä¹‹å‰çš„ç»„ä»¶æœ‰å››ç§å¯èƒ½çš„ç±»å‹ï¼Œ</span><br><span class="line">// 1. data: ç”¨åœ¨data_transform, feature_engineering modules å’Œ evaluationæ¨¡å—</span><br><span class="line">// 2. train_data: ç”¨åœ¨è®­ç»ƒç»„ä»¶ï¼Œæ¯”å¦‚HeteroLRã€HeteroSBTï¼Œå¦‚æœä½¿ç”¨äº†è¿™ä¸ªå­—æ®µï¼Œ åˆ™è¿™ä¸ªtaskä¼šè¢«è§£æä¸ºä¸€ä¸ªfit taskï¼ˆè®­ç»ƒä»»åŠ¡ï¼Ÿï¼‰</span><br><span class="line">// 3. validate_data: å¦‚æœæœ‰äº†train_dataï¼Œé‚£ä¹ˆè¯¥å­—æ®µå°±æ˜¯å¯é€‰åœ°. è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®è¢«ç”¨ä½œvalidationé›†.</span><br><span class="line">// 4. test_data: æŒ‡å®šç”¨äºé¢„æµ‹çš„æ•°æ®ï¼Œå¦‚æœè®¾ç½®äº†è¿™ä¸ªå­—æ®µï¼Œæ¨¡å‹ä¹Ÿéœ€è¦ã€‚</span><br><span class="line"></span><br><span class="line">// model input: æ¥è‡ªäºä¹‹å‰çš„æ¨¡å—ï¼Œæœ‰2ç§å¯èƒ½çš„ç±»å‹ï¼Œ</span><br><span class="line">// 1. model: ç”±åŒç±»å‹ï¼ˆæŒ‡â€œmoduleâ€å­—æ®µç›¸åŒï¼‰ç»„ä»¶è¾“å…¥çš„æ¨¡å‹ã€‚æŠŠå…¶ä»–ç»„ä»¶çš„æ¨¡å‹è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚</span><br><span class="line">// 2. isometric_model: æ¨¡å‹è¾“å…¥æ¥è‡ªä¸Šæ¸¸ç»„ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">// data output: æ¥è‡ªäºä¹‹å‰çš„æ¨¡å—ï¼Œæœ‰4ç§å¯èƒ½çš„ç±»å‹ï¼Œ</span><br><span class="line">// 1. data: </span><br><span class="line">// 2. train_dataã€validate_dataã€test_data: ä»…ç”¨äºæ•°æ®åˆ†ç‰‡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">// model : æ¥è‡ªäºä¹‹å‰çš„æ¨¡å—ï¼Œæœ‰1ç§å¯èƒ½çš„ç±»å‹ï¼Œ</span><br><span class="line">// 1. model</span><br><span class="line"></span><br><span class="line">        &quot;data_transform_0&quot;: &#123;</span><br><span class="line">            &quot;module&quot;: &quot;DataTransform&quot;,</span><br><span class="line">            &quot;input&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                    &quot;data&quot;: [</span><br><span class="line">                        &quot;reader_0.data&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;output&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;model&quot;: [</span><br><span class="line">                    &quot;model&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;scale_0&quot;: &#123;</span><br><span class="line">            &quot;module&quot;: &quot;FeatureScale&quot;,</span><br><span class="line">            &quot;input&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                    &quot;data&quot;: [</span><br><span class="line">                        &quot;data_transform_0.data&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;output&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;model&quot;: [</span><br><span class="line">                    &quot;model&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;homo_lr_0&quot;: &#123;</span><br><span class="line">            &quot;module&quot;: &quot;HomoLR&quot;,</span><br><span class="line">            &quot;input&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                    &quot;train_data&quot;: [</span><br><span class="line">                        &quot;scale_0.data&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;output&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;model&quot;: [</span><br><span class="line">                    &quot;model&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;evaluation_0&quot;: &#123;</span><br><span class="line">            &quot;module&quot;: &quot;Evaluation&quot;,</span><br><span class="line">            &quot;input&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: &#123;</span><br><span class="line">                    &quot;data&quot;: [</span><br><span class="line">                        &quot;homo_lr_0.data&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;output&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><h1 id="CONF"><a href="#CONF" class="headerlink" title="CONF"></a>CONF</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//conf.json</span><br><span class="line">&#123;</span><br><span class="line">    //fateç‰ˆæœ¬å¤§äºç­‰äº1.7æ—¶ï¼Œå¿…é¡»è®¾ç½®dsl_version=2</span><br><span class="line">    &quot;dsl_version&quot;: 2,</span><br><span class="line"></span><br><span class="line">    &quot;initiator&quot;: &#123; //å®šä¹‰å‘èµ·è€…çš„è§’è‰²å’Œpartyid</span><br><span class="line">        &quot;role&quot;: &quot;guest&quot;,</span><br><span class="line">        &quot;party_id&quot;: 10000</span><br><span class="line">    &#125;,</span><br><span class="line">    //å®šä¹‰æ‰€æœ‰çš„å‚ä¸æ–¹</span><br><span class="line">    &quot;role&quot;: &#123;</span><br><span class="line">        &quot;guest&quot;: [</span><br><span class="line">            10000</span><br><span class="line">        ],</span><br><span class="line">        &quot;host&quot;: [</span><br><span class="line">            10000</span><br><span class="line">        ],</span><br><span class="line">        &quot;arbiter&quot;: [</span><br><span class="line">            10000</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">  </span><br><span class="line">    &quot;component_parameters&quot;: &#123;</span><br><span class="line">        //commonï¼šå‚æ•°åº”ç”¨åˆ°æ‰€æœ‰çš„å‚ä¸æ–¹, roleï¼šå‚æ•°åº”ç”¨åˆ°æŒ‡å®šçš„å‚ä¸æ–¹</span><br><span class="line">        &quot;common&quot;: &#123;</span><br><span class="line">    //ç»„ä»¶çš„è¯¦ç»†å‚æ•°å‚è§ï¼šhttps://fate.readthedocs.io/en/latest/federatedml_component/</span><br><span class="line">            &quot;data_transform_0&quot;: &#123;</span><br><span class="line">                &quot;with_label&quot;: true,</span><br><span class="line">                &quot;output_format&quot;: &quot;dense&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;homo_lr_0&quot;: &#123;</span><br><span class="line">                &quot;penalty&quot;: &quot;L2&quot;,</span><br><span class="line">                &quot;tol&quot;: 1e-05,</span><br><span class="line">                &quot;alpha&quot;: 0.01,</span><br><span class="line">                &quot;optimizer&quot;: &quot;sgd&quot;,</span><br><span class="line">                &quot;batch_size&quot;: -1,</span><br><span class="line">                &quot;learning_rate&quot;: 0.15,</span><br><span class="line">                &quot;init_param&quot;: &#123;</span><br><span class="line">                    &quot;init_method&quot;: &quot;zeros&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;max_iter&quot;: 30,</span><br><span class="line">                &quot;early_stop&quot;: &quot;diff&quot;,</span><br><span class="line">                &quot;encrypt_param&quot;: &#123;</span><br><span class="line">                    &quot;method&quot;: null</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;cv_param&quot;: &#123;</span><br><span class="line">                    &quot;n_splits&quot;: 4,</span><br><span class="line">                    &quot;shuffle&quot;: true,</span><br><span class="line">                    &quot;random_seed&quot;: 33,</span><br><span class="line">                    &quot;need_cv&quot;: false</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;decay&quot;: 1,</span><br><span class="line">                &quot;decay_sqrt&quot;: true</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;evaluation_0&quot;: &#123;</span><br><span class="line">                &quot;eval_type&quot;: &quot;binary&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &quot;role&quot;: &#123;</span><br><span class="line">            &quot;host&quot;: &#123;</span><br><span class="line">                &quot;0&quot;: &#123; //role.host.0ï¼šå‚æ•°åº”ç”¨åˆ°hostçš„index=0çš„å‚ä¸æ–¹</span><br><span class="line">                    &quot;reader_0&quot;: &#123;</span><br><span class="line">                        &quot;table&quot;: &#123;</span><br><span class="line">                            &quot;name&quot;: &quot;homo_default_credit_host&quot;,</span><br><span class="line">                            &quot;namespace&quot;: &quot;homo_default_credit_host&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;evaluation_0&quot;: &#123;</span><br><span class="line">                        &quot;need_run&quot;: false</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;guest&quot;: &#123;</span><br><span class="line">                &quot;0&quot;: &#123;</span><br><span class="line">                    &quot;reader_0&quot;: &#123;</span><br><span class="line">                        &quot;table&quot;: &#123;</span><br><span class="line">                            &quot;name&quot;: &quot;homo_default_credit_guest&quot;,</span><br><span class="line">                            &quot;namespace&quot;: &quot;homo_default_credit_guest&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨ï¼š</p><ol><li>ä¸Šé¢çš„confæ²¡æœ‰ä½¿ç”¨åˆ°providerç»„ä»¶ï¼Œè¯¥ç»„ä»¶æ”¯æŒåŠ è½½å¤šç§ä¸”å¤šç‰ˆæœ¬çš„ç»„ä»¶æä¾›æ–¹</li><li>ä¸Šé¢confæ²¡æ¶‰åŠç³»ç»Ÿè¿è¡Œæ—¶å‚æ•°ï¼Œå…·ä½“å‚è§ï¼š<a href="https://federatedai.github.io/FATE-Flow/latest/zh/fate_flow_job_scheduling/#43">https://federatedai.github.io/FATE-Flow/latest/zh/fate_flow_job_scheduling/#43</a></li><li>dsl v2ä¸­ï¼Œpredict dslä¸ä¼šåœ¨è®­ç»ƒåè‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·éœ€è¦é€šè¿‡flow clientéƒ¨ç½²æ‰€éœ€çš„ç»„ä»¶ï¼š<a href="https://github.com/FederatedAI/FATE-Flow/blob/main/doc/cli/model.md#deploy">https://github.com/FederatedAI/FATE-Flow/blob/main/doc/cli/model.md#deploy</a></li><li>train dsl å’Œpredict dsl examplesï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;components&quot;: &#123;</span><br><span class="line">    &quot;reader_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;Reader&quot;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: [</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;data_transform_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;DataTransform&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;reader_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: [</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;model&quot;: [</span><br><span class="line">                &quot;model&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;intersection_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;Intersection&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data_transform_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;:[</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;hetero_nn_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;HeteroNN&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;train_data&quot;: [</span><br><span class="line">                    &quot;intersection_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: [</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;model&quot;: [</span><br><span class="line">                &quot;model&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;components&quot;: &#123;</span><br><span class="line">    &quot;reader_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;Reader&quot;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: [</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;data_transform_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;DataTransform&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;reader_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: [</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;model&quot;: [</span><br><span class="line">                &quot;model&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;intersection_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;Intersection&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;data_transform_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;:[</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;hetero_nn_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;HeteroNN&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;train_data&quot;: [</span><br><span class="line">                    &quot;intersection_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;output&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: [</span><br><span class="line">                &quot;data&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;model&quot;: [</span><br><span class="line">                &quot;model&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;evaluation_0&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;Evaluation&quot;,</span><br><span class="line">        &quot;input&quot;: &#123;</span><br><span class="line">            &quot;data&quot;: &#123;</span><br><span class="line">                &quot;data&quot;: [</span><br><span class="line">                    &quot;hetero_nn_0.data&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         &quot;output&quot;: &#123;</span><br><span class="line">             &quot;data&quot;: [</span><br><span class="line">                 &quot;data&quot;</span><br><span class="line">             ]</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="åŸºæœ¬å·¥ä½œæµ"><a href="#åŸºæœ¬å·¥ä½œæµ" class="headerlink" title="åŸºæœ¬å·¥ä½œæµ"></a>åŸºæœ¬å·¥ä½œæµ</h1><ol><li>æäº¤ä½œä¸šåï¼Œä½œä¸šçš„dslå’Œé…ç½®ä¼šå­˜å‚¨åˆ°ç›¸åº”çš„ç›®å½•ï¼š<code>/data/projects/fate/fateflow/jobs</code></li><li>è§£ædslå’Œconfï¼Œç”Ÿæˆé…ç½®ï¼Œåˆ†å‘å…±åŒçš„é…ç½®ç»™æ¯ä¸€æ–¹ï¼Œå¹¶ç”Ÿæˆå­˜å‚¨ç‰¹å®šæ–¹çš„é…ç½®åœ¨ç›®å½•ï¼š<code>/data/projects/fate/fateflow/jobs/[job_id]/[role]/[party_id]</code></li></ol><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šä¿¡ç”¨æ•°æ®æ¡ˆä¾‹</title>
      <link href="/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E4%BF%A1%E7%94%A8%E6%95%B0%E6%8D%AE%E6%A1%88%E4%BE%8B/"/>
      <url>/2022/11/04/FATE%E6%A8%AA%E5%90%91%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E4%BF%A1%E7%94%A8%E6%95%B0%E6%8D%AE%E6%A1%88%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é€šè¿‡FATEå¹³å°æäº¤è”é‚¦å­¦ä¹ jobï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼šDSLå’Œpiplineï¼›</p><p>DSLæ˜¯é€šè¿‡å†™é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œé…ç½®è”é‚¦å­¦ä¹ jobçš„å„ä¸ªå‚æ•°ï¼›pipelineæ˜¯é€šè¿‡å†™pythonä»£ç çš„æ–¹å¼é…ç½®å’Œæäº¤job</p><p>æœ¬æ–‡ä½¿ç”¨Fateçš„ä¿¡ç”¨æ ·ä¾‹æ•°æ®ï¼Œä»‹ç»é€šè¿‡DSLçš„æ–¹å¼è¿›è¡ŒFateæ¨ªå‘è”é‚¦å­¦ä¹ çš„ä½¿ç”¨æ¡ˆä¾‹ã€‚</p></blockquote><h1 id="å®éªŒè®¾ç½®"><a href="#å®éªŒè®¾ç½®" class="headerlink" title="å®éªŒè®¾ç½®"></a>å®éªŒè®¾ç½®</h1><blockquote><p>fate lastest 1.9 standalone</p><p>æ•°æ®é›†ï¼šä¿¡ç”¨æ•°æ®ï¼Œä½ç½®FATE/examples/data/default_credit_homo_guest/</p><p>ç®—æ³•ï¼šlogistics regression</p></blockquote><h1 id="å®éªŒé…ç½®"><a href="#å®éªŒé…ç½®" class="headerlink" title="å®éªŒé…ç½®"></a>å®éªŒé…ç½®</h1><h2 id="ä¸Šä¼ ä¸¤æ–¹æ•°æ®"><a href="#ä¸Šä¼ ä¸¤æ–¹æ•°æ®" class="headerlink" title="ä¸Šä¼ ä¸¤æ–¹æ•°æ®"></a>ä¸Šä¼ ä¸¤æ–¹æ•°æ®</h2><p>ç¼–è¾‘ä¸Šä¼ æ•°æ®é…ç½®æ–‡ä»¶ï¼šupload_my_homolr_guest.json</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span><span class="string">&quot;/data/projects/fate/examples/data/default_credit_homo_guest.csv&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;head&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;partition&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;work_mode&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span><span class="string">&quot;homo_default_credit_guest&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;table_name&quot;</span><span class="punctuation">:</span><span class="string">&quot;homo_default_credit_guest&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>upload_my_homolr_host.json</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span><span class="string">&quot;/data/projects/fate/examples/data/default_credit_homo_host_1.csv&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;head&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;partition&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;work_mode&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span><span class="string">&quot;homo_default_credit_host&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;table_name&quot;</span><span class="punctuation">:</span><span class="string">&quot;homo_default_credit_host&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>fileæŒ‡å‡ºæ•°æ®æ–‡ä»¶çš„ä½ç½®</li><li>namespaceå’Œtable_nameç¡®å®šä¸Šä¼ è¡¨çš„å‘½åç©ºé—´å’Œè¡¨åã€‚</li></ul><h2 id="DSLé…ç½®æ–‡ä»¶"><a href="#DSLé…ç½®æ–‡ä»¶" class="headerlink" title="DSLé…ç½®æ–‡ä»¶"></a>DSLé…ç½®æ–‡ä»¶</h2><p>æ‰¾åˆ°dslé…ç½®æ–‡ä»¶ï¼š<code>/data/projects/fate/examples/dsl/v2/homo_logistic_regression/homo_lr_train_dsl.json</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;components&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;reader_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Reader&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;data_transform_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DataTransform&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;reader_0.data&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;model&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;scale_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FeatureScale&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;data_transform_0.data&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;model&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;homo_lr_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HomoLR&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;train_data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;scale_0.data&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;model&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;evaluation_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Evaluation&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;homo_lr_0.data&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;data&quot;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¯¥æ–‡ä»¶é…ç½®äº†jobçš„å„ä¸ªç»„ä»¶çš„ç±»å‹ï¼Œä»¥åŠç»„ä»¶çš„è¾“å…¥ã€è¾“å‡ºã€‚</p><p>æ‰¾åˆ°confé…ç½®æ–‡ä»¶ï¼š<code>/data/projects/fate/examples/dsl/v2/homo_logistic_regression/homo_lr_train_conf.json</code>ï¼Œå†…å®¹ï¼ˆç•¥ä½œä¿®æ”¹ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dsl_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;initiator&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;guest&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;party_id&quot;</span><span class="punctuation">:</span> <span class="number">10000</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;guest&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">10000</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">10000</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;arbiter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">10000</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;component_parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;common&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;data_transform_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;with_label&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;output_format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dense&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;homo_lr_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;penalty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;L2&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;tol&quot;</span><span class="punctuation">:</span> <span class="number">1e-05</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;alpha&quot;</span><span class="punctuation">:</span> <span class="number">0.01</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;optimizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sgd&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;batch_size&quot;</span><span class="punctuation">:</span> <span class="number">-1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;learning_rate&quot;</span><span class="punctuation">:</span> <span class="number">0.15</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;init_param&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;init_method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zeros&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;max_iter&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;early_stop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;diff&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;encrypt_param&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;cv_param&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;n_splits&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;shuffle&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;random_seed&quot;</span><span class="punctuation">:</span> <span class="number">33</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;need_cv&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;decay&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;decay_sqrt&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;evaluation_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;eval_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;binary&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;reader_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;homo_default_credit_guest&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;homo_default_credit_guest&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;evaluation_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;need_run&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;guest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;reader_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;homo_default_credit_host&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;homo_default_credit_host&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¯¥æ–‡ä»¶é…ç½®äº†è”é‚¦å­¦ä¹ å‘èµ·æ–¹ï¼ˆinitiatorï¼‰ã€å‚ä¸æ–¹ï¼ˆroleï¼‰ä»¥åŠæ¯ä¸€æ–¹ç»„ä»¶çš„å‚æ•°ï¼ˆcomponent_parametersï¼‰ã€‚</p><blockquote><ol><li>initiatoræ®µè®¾ç½®äº†è”é‚¦å‘èµ·è€…çš„è§’è‰²å’Œid</li><li>roleæ®µè®¾ç½®äº†è”é‚¦çš„å‚ä¸æ–¹ï¼Œå’Œå‚ä¸æ–¹çš„è§’è‰²</li><li>job_parameterså®šä¹‰äº†å·¥ä½œæ¨¡å¼ï¼ˆå•æœº/é›†ç¾¤ï¼‰</li><li>component_parametersè®¾ç½®äº†ç»„ä»¶çš„å‚æ•°ï¼Œåˆ†ä¸ºå„å‚ä¸æ–¹å…¬å…±çš„å‚æ•°ï¼ˆcommonï¼‰ï¼Œä»¥åŠå„å‚ä¸æ–¹çš„ç‹¬ç‰¹çš„å‚æ•°ï¼ˆroleï¼‰</li></ol></blockquote><h1 id="å®éªŒæ­¥éª¤"><a href="#å®éªŒæ­¥éª¤" class="headerlink" title="å®éªŒæ­¥éª¤"></a>å®éªŒæ­¥éª¤</h1><p>è¿›å…¥å®éªŒç¯å¢ƒï¼›è¿™é‡Œä½¿ç”¨standaloneæ¨¡æ‹Ÿä¸¤æ–¹è”é‚¦å­¦ä¹ ï¼Œæ‰€ä»¥æ‰€æœ‰æ“ä½œæ˜¯åœ¨åŒä¸€æœºå™¨ä¸Šè¿›è¡Œã€‚</p><h2 id="ä¸Šä¼ è®­ç»ƒæ•°æ®"><a href="#ä¸Šä¼ è®­ç»ƒæ•°æ®" class="headerlink" title="ä¸Šä¼ è®­ç»ƒæ•°æ®"></a>ä¸Šä¼ è®­ç»ƒæ•°æ®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(venv) [root@5af726377674 fate]<span class="comment"># flow data upload -c upload_my_homolr_guest.json</span></span><br><span class="line">...</span><br><span class="line">(venv) [root@5af726377674 fate]<span class="comment"># flow data upload -c upload_my_homolr_host.json</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">#guest hoståˆ†ä¸¤æ¬¡ä¸Šä¼ ã€‚</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨flow table æŸ¥çœ‹ä¸Šä¼ çš„è¡¨ä¿¡æ¯ï¼šhomo_default_credit_host</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(venv) [root@5af726377674 fate]# flow table info -n homo_default_credit_host -t homo_default_credit_host</span><br><span class="line">&#123;</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;address&quot;: &#123;</span><br><span class="line">            &quot;connector_name&quot;: null,</span><br><span class="line">            &quot;home&quot;: null,</span><br><span class="line">            &quot;name&quot;: &quot;homo_default_credit_host&quot;,</span><br><span class="line">            &quot;namespace&quot;: &quot;homo_default_credit_host&quot;,</span><br><span class="line">            &quot;storage_type&quot;: &quot;LMDB&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;count&quot;: 8000,</span><br><span class="line">        &quot;enable&quot;: true,</span><br><span class="line">        &quot;exist&quot;: 1,</span><br><span class="line">        &quot;namespace&quot;: &quot;homo_default_credit_host&quot;,</span><br><span class="line">        &quot;origin&quot;: &quot;upload&quot;,</span><br><span class="line">        &quot;partition&quot;: 10,</span><br><span class="line">        &quot;schema&quot;: &#123;</span><br><span class="line">            &quot;header&quot;: &quot;y,x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22&quot;,</span><br><span class="line">            &quot;sid&quot;: &quot;id&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;table_name&quot;: &quot;homo_default_credit_host&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;retcode&quot;: 0,</span><br><span class="line">    &quot;retmsg&quot;: &quot;success&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æäº¤è®­ç»ƒä»»åŠ¡"><a href="#æäº¤è®­ç»ƒä»»åŠ¡" class="headerlink" title="æäº¤è®­ç»ƒä»»åŠ¡"></a>æäº¤è®­ç»ƒä»»åŠ¡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(venv) [root@5af726377674 fate]<span class="comment"># flow job submit -d test_my_homolr_train_dsl.json -c test_my_homolr_train_conf.json </span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;board_url&quot;</span>: <span class="string">&quot;http://127.0.0.1:8080/index.html#/dashboard?job_id=202209200821441165650&amp;role=guest&amp;party_id=10000&quot;</span>,</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;dsl_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209200821441165650/job_dsl.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;job_id&quot;</span>: <span class="string">&quot;202209200821441165650&quot;</span>,</span><br><span class="line">        <span class="string">&quot;logs_directory&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/logs/202209200821441165650&quot;</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        <span class="string">&quot;model_info&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;model_id&quot;</span>: <span class="string">&quot;arbiter-10000#guest-10000#host-10000#model&quot;</span>,</span><br><span class="line">            <span class="string">&quot;model_version&quot;</span>: <span class="string">&quot;202209200821441165650&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;pipeline_dsl_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209200821441165650/pipeline_dsl.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;runtime_conf_on_party_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209200821441165650/guest/10000/job_runtime_on_party_conf.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;runtime_conf_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209200821441165650/job_runtime_conf.json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;train_runtime_conf_path&quot;</span>: <span class="string">&quot;/data/projects/fate/fateflow/jobs/202209200821441165650/train_runtime_conf.json&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;jobId&quot;</span>: <span class="string">&quot;202209200821441165650&quot;</span>,</span><br><span class="line">    <span class="string">&quot;retcode&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;retmsg&quot;</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h2><p>åœ¨fate-boardä¸ŠæŸ¥çœ‹è®­ç»ƒçŠ¶æ€ï¼š<code>http://ip:8086</code></p><p><img src="image-20220920170949-v81vtm8.png" alt="image.png"></p><p>é€‰æ‹©<code>guest</code>çš„é‚£æ¡è®°å½•ï¼Œè¿›å…¥è¯¦æƒ…é¡µã€‚ç‚¹å‡»<code>evaluation</code>ï¼Œé€‰æ‹©<code>view the outputs</code>ï¼ŒæŸ¥çœ‹æ¨¡å‹æ•ˆæœã€‚</p><p><img src="image-20220920203955-qua2axz.png" alt="image.png"></p><p><img src="image-20220920204118-0eu2i1y.png" alt="image.png"></p><p>lossåœ¨<code>homo_lr_0</code>çš„outputs</p><p>â€</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol><li>ä½¿ç”¨DSLè¿›è¡ŒFATEæ¨ªå‘è”é‚¦å­¦ä¹ çš„æµç¨‹åŒ…æ‹¬ï¼šå„æ–¹ä¸Šä¼ æ•°æ®ï¼›ç¼–å†™DSLå’ŒCONFæ–‡ä»¶é…ç½®ç»„ä»¶ã€å‚ä¸æ–¹ä¿¡æ¯ç­‰ï¼›æäº¤jobã€‚</li><li>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œè¿™é‡Œä½¿ç”¨çš„standaloneå•æœºç‰ˆæœ¬ï¼Œæ‰€ä»¥æ‰€æœ‰æ“ä½œéƒ½åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚å®é™…åœ¨é›†ç¾¤ä¸Šå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚éœ€è¦åœ¨å¤šæ–¹æœºå™¨ä¸Šä¸Šä¼ ä¸åŒçš„æ•°æ®ã€‚</li><li>FATEçš„ç»„ä»¶åˆ—è¡¨ã€ç»„ä»¶è¾“å…¥çš„æ ¼å¼ã€ç»„ä»¶çš„å‚æ•°é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://fate.readthedocs.io/en/latest/federatedml_component/">https://fate.readthedocs.io/en/latest/federatedml_component/</a></li><li>FATEå…³äºDSLå’ŒCONFæ–‡ä»¶çš„é…ç½®è¯´æ˜å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/FederatedAI/FATE/blob/master/doc/tutorial/dsl_conf/dsl_conf_v2_setting_guide.zh.md">https://github.com/FederatedAI/FATE/blob/master/doc/tutorial/dsl_conf/dsl_conf_v2_setting_guide.zh.md</a></li><li>flowå‘½ä»¤æŒ‡å—ï¼š<a href="https://federatedai.github.io/FATE-Flow/latest/zh/document_navigation/">https://federatedai.github.io/FATE-Flow/latest/zh/document_navigation/</a></li><li>flow apiæ–‡æ¡£ï¼š<a href="https://federatedai.github.io/FATE-Flow/latest/zh/swagger/">https://federatedai.github.io/FATE-Flow/latest/zh/swagger/</a></li></ol><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://www.freesion.com/article/2169210597/#1_3">è”é‚¦å­¦ä¹ æ¡†æ¶FATEä½¿ç”¨æ¡ˆä¾‹è®°å½•</a></li><li><a href="https://blog.csdn.net/WenDong1997/article/details/106743620">è”é‚¦å­¦ä¹ æ¡†æ¶FATEå®è·µï¼ˆè®­ç»ƒ/æµ‹è¯•æ­¥éª¤åŠå‚æ•°è¯´æ˜</a></li></ol><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEè”é‚¦å­¦ä¹ æ¡†æ¶ç®€ä»‹</title>
      <link href="/2022/11/03/FATE%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/"/>
      <url>/2022/11/03/FATE%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="è”é‚¦å­¦ä¹ ä»‹ç»"><a href="#è”é‚¦å­¦ä¹ ä»‹ç»" class="headerlink" title="è”é‚¦å­¦ä¹ ä»‹ç»"></a>è”é‚¦å­¦ä¹ ä»‹ç»</h1><h2 id="è”é‚¦å­¦ä¹ çš„å‡ºç°è§£å†³ä»€ä¹ˆé—®é¢˜"><a href="#è”é‚¦å­¦ä¹ çš„å‡ºç°è§£å†³ä»€ä¹ˆé—®é¢˜" class="headerlink" title="è”é‚¦å­¦ä¹ çš„å‡ºç°è§£å†³ä»€ä¹ˆé—®é¢˜"></a>è”é‚¦å­¦ä¹ çš„å‡ºç°è§£å†³ä»€ä¹ˆé—®é¢˜</h2><p>è§£å†³â€œæ•°æ®å­¤å²›â€é—®é¢˜ï¼Œä¿è¯æ•°æ®å®‰å…¨ä¸éšç§ä¿æŠ¤ã€‚</p><p>ç”±äºå„ç§åŸå› ï¼Œæ•°æ®å­¤å²›é—®é¢˜æ™®éå­˜åœ¨ã€‚åœ¨ç”¨æˆ·å’Œä¼ä¸šè§’åº¦ä¸‹ï¼Œå•†ä¸šå…¬å¸æ‰€æ‹¥æœ‰çš„æ•°æ®å¾€å¾€éƒ½æœ‰å·¨å¤§çš„æ½œåœ¨ä»·å€¼ã€‚ä¸¤ä¸ªå…¬å¸ç”šè‡³å…¬å¸é—´çš„éƒ¨é—¨éƒ½è¦è€ƒè™‘åˆ©ç›Šçš„äº¤æ¢ï¼Œå¾€å¾€è¿™äº›æœºæ„ä¸ä¼šæä¾›å„è‡ªæ•°æ®ä¸å…¶ä»–å…¬å¸åšä¸å•çš„èšåˆï¼Œå¯¼è‡´å³ä½¿åœ¨åŒä¸€ä¸ªå…¬å¸å†…ï¼Œæ•°æ®ä¹Ÿå¾€å¾€ä»¥å­¤å²›å½¢å¼å‡ºç°ã€‚</p><h2 id="è”é‚¦å­¦ä¹ çš„æ¦‚å¿µ"><a href="#è”é‚¦å­¦ä¹ çš„æ¦‚å¿µ" class="headerlink" title="è”é‚¦å­¦ä¹ çš„æ¦‚å¿µ"></a>è”é‚¦å­¦ä¹ çš„æ¦‚å¿µ</h2><p>æœ¬è´¨ï¼šè”é‚¦å­¦ä¹ æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>åˆ†å¸ƒå¼</strong>æœºå™¨å­¦ä¹ æŠ€æœ¯ï¼Œæˆ–æœºå™¨å­¦ä¹ <strong>æ¡†æ¶</strong>ã€‚</p><p>ç›®æ ‡ï¼šè”é‚¦å­¦ä¹ çš„ç›®æ ‡æ˜¯åœ¨ä¿è¯æ•°æ®éšç§å®‰å…¨åŠåˆæ³•åˆè§„çš„åŸºç¡€ä¸Šï¼Œå®ç°å…±åŒå»ºæ¨¡ï¼Œæå‡AIæ¨¡å‹çš„æ•ˆæœã€‚</p><h2 id="è”é‚¦å­¦ä¹ çš„åˆ†ç±»"><a href="#è”é‚¦å­¦ä¹ çš„åˆ†ç±»" class="headerlink" title="è”é‚¦å­¦ä¹ çš„åˆ†ç±»"></a>è”é‚¦å­¦ä¹ çš„åˆ†ç±»</h2><p>æ ¹æ®æ¯ä¸ªå‚ä¸å…±åŒå»ºæ¨¡çš„ä¼ä¸šç§°ä¸ºå‚ä¸æ–¹ï¼Œæ ¹æ®å¤šå‚ä¸æ–¹ä¹‹é—´æ•°æ®åˆ†å¸ƒçš„ä¸åŒï¼ŒæŠŠè”é‚¦å­¦ä¹ åˆ†ä¸ºä¸‰ç±»ï¼šæ¨ªå‘è”é‚¦å­¦ä¹ ã€çºµå‘è”é‚¦å­¦ä¹ å’Œè”é‚¦è¿ç§»å­¦ä¹ ã€‚</p><p><img src="image-20221016171301-jpflppr.png" alt="image.png"></p><ul><li>æ¨ªå‘è”é‚¦é€‚ç”¨äºï¼Œå‚ä¸æ–¹ä¹‹é—´çš„æ•°æ®ç‰¹å¾ç›¸ä¼¼ï¼Œä½†æ ·æœ¬ä¸åŒã€‚</li><li>çºµå‘è”é‚¦é€‚ç”¨äºï¼Œå‚ä¸æ–¹ä¹‹é—´çš„æ•°æ®ç‰¹å¾é‡å å¤šï¼Œä½†æ ·æœ¬é‡å å°‘ã€‚</li><li>è”é‚¦è¿ç§»å­¦ä¹ åˆ™é€‚ç”¨äºï¼Œå‚ä¸æ–¹ä¹‹é—´çš„æ•°æ®ç‰¹å¾é‡å å°‘ï¼Œæ ·æœ¬é‡å ä¹Ÿå°‘ã€‚</li></ul><p>è¿™ä¸‰ç§ç±»å‹çš„è”é‚¦å­¦ä¹ çš„å­¦ä¹ è¿‡ç¨‹ä¸å¤ªç›¸åŒï¼Œè¿™é‡Œä¸åšè¯¦ç»†æè¿°ã€‚</p><h2 id="è”é‚¦å­¦ä¹ æ¡†æ¶"><a href="#è”é‚¦å­¦ä¹ æ¡†æ¶" class="headerlink" title="è”é‚¦å­¦ä¹ æ¡†æ¶"></a>è”é‚¦å­¦ä¹ æ¡†æ¶</h2><p>æ®äº†è§£ï¼Œè”é‚¦å­¦ä¹ æ¡†æ¶æœ‰Fateã€PySyftã€FedLabã€Rosettaã€PaddleFLç­‰ç­‰ã€‚å…·ä½“å¯å‚è§<a href="https://zhuanlan.zhihu.com/p/387101962">è”é‚¦å­¦ä¹ å¼€æºæ¡†æ¶è°ƒç ”</a></p><p>ä¸åŒæ¡†æ¶çš„å—ä¼—å®šä½ã€åŠ å¯†æ‰‹æ®µã€æ”¯æŒçš„ç®—æ³•ã€å¼€å‘çš„æœºæ„ä¸åŒã€‚ä¸‹é¢æ˜¯å¯¹æ¯”å›¾ã€‚å›¾ç‰‡æ¥æºäºFateå®˜ç½‘ã€‚</p><p>è¿™å¼ å›¾æ—¶é—´æ¯”è¾ƒä¹…äº†ï¼Œå…·ä½“è¿˜æ˜¯è¦çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚</p><p><img src="image-20220907160332-fp0kf9k.png" alt="image.png"></p><p>â€</p><h1 id="Fateä»‹ç»"><a href="#Fateä»‹ç»" class="headerlink" title="Fateä»‹ç»"></a>Fateä»‹ç»</h1><p>FATE (Federated AI Technology Enabler) æ˜¯å¾®ä¼—é“¶è¡ŒAIéƒ¨é—¨å‘èµ·çš„å¼€æºé¡¹ç›®ï¼Œä¸ºè”é‚¦å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿæä¾›äº†å¯é çš„å®‰å…¨è®¡ç®—æ¡†æ¶ã€‚FATEé¡¹ç›®ä½¿ç”¨å¤šæ–¹å®‰å…¨è®¡ç®— (MPC) ä»¥åŠåŒæ€åŠ å¯† (HE) æŠ€æœ¯æ„å»ºåº•å±‚å®‰å…¨è®¡ç®—åè®®ï¼Œä»¥æ­¤æ”¯æŒä¸åŒç§ç±»çš„æœºå™¨å­¦ä¹ çš„å®‰å…¨è®¡ç®—ï¼ŒåŒ…æ‹¬é€»è¾‘å›å½’ã€åŸºäºæ ‘çš„ç®—æ³•ã€æ·±åº¦å­¦ä¹ å’Œè¿ç§»å­¦ä¹ ç­‰ã€‚</p><h2 id="Fateæ¶æ„"><a href="#Fateæ¶æ„" class="headerlink" title="Fateæ¶æ„"></a>Fateæ¶æ„</h2><p><img src="image-20220907151347-1sl8y67.png" alt="image.png"></p><p>å…¶ä¸­ï¼Œ</p><ul><li>FATE Boardï¼šè”é‚¦å­¦ä¹ å¯è§†åŒ–ç•Œé¢ã€‚</li><li>FATE Flowï¼šè”é‚¦å­¦ä¹ ç«¯åˆ°ç«¯å…¨æµç¨‹çš„å¤šæ–¹è”åˆä»»åŠ¡å®‰å…¨è°ƒåº¦å¹³å°ï¼Œæä¾›ç”Ÿäº§çº§çš„æœåŠ¡èƒ½åŠ›ã€‚</li><li>FATE Servingï¼šåœ¨çº¿æ¨¡å‹ç®¡ç†æœåŠ¡ï¼ˆåªæ”¯æŒçºµå‘è”é‚¦å­¦ä¹ ï¼‰</li><li>FederatedMLï¼šè”é‚¦å­¦ä¹ çš„æ ¸å¿ƒç»„ä»¶</li><li>Secure Protocolsï¼šFATEçš„å®‰å…¨åè®®</li></ul><h2 id="FATEæ ¸å¿ƒåŠŸèƒ½"><a href="#FATEæ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="FATEæ ¸å¿ƒåŠŸèƒ½"></a>FATEæ ¸å¿ƒåŠŸèƒ½</h2><ul><li>è”é‚¦åœ¨çº¿æ¨¡å‹æœåŠ¡ï¼ˆFATE Servingï¼‰</li><li>è”é‚¦å»ºæ¨¡Piplineå’Œå¯è§†åŒ–ï¼ˆFATE Flowï¼‰</li><li>è”é‚¦å­¦ä¹ ç®—æ³•çš„å„ä¸ªåŠŸèƒ½ç»„ä»¶ï¼ˆFederatedMLï¼‰</li><li>åˆ†å¸ƒå¼è®¡ç®—å’Œå­˜å‚¨æŠ½è±¡ï¼ˆEggRollï¼‰</li><li>è·¨ç«™ç‚¹ç½‘ç»œé€šä¿¡æŠ½è±¡ï¼ˆFederated Networkï¼‰</li></ul><h2 id="æ›´å¤šä»‹ç»"><a href="#æ›´å¤šä»‹ç»" class="headerlink" title="æ›´å¤šä»‹ç»"></a>æ›´å¤šä»‹ç»</h2><p>FATE githubåœ°å€ï¼š<a href="https://github.com/FederatedAI/FATE">https://github.com/FederatedAI/FATE</a></p><h2 id="å•æœºç‰ˆFATEå®‰è£…"><a href="#å•æœºç‰ˆFATEå®‰è£…" class="headerlink" title="å•æœºç‰ˆFATEå®‰è£…"></a>å•æœºç‰ˆFATEå®‰è£…</h2><p>è¿™é‡Œé‡‡ç”¨dockerå®‰è£…</p><p><a href="https://github.com/FederatedAI/FATE/blob/master/deploy/standalone-deploy/README.zh.md">éƒ¨ç½²æ–‡æ¡£</a></p><p>å¦‚æœéœ€è¦dockerä½¿ç”¨GPUèµ„æºï¼Œéœ€è¦åœ¨dockerå®¹å™¨å¯åŠ¨æ—¶åŠ ä¸Šå‚æ•°<code>--gpus</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d --gpus all --name standalone_fate -p 8080:8080 federatedai/standalone_fate:1.9.0</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯åŠ¨æŠ¥ç±»ä¼¼é”™è¯¯ï¼š<code>Error could not select device driver with capabilities: [[gpu]]</code>ï¼Œåˆ™æŸ¥çœ‹ä¸‹é¢çš„é“¾æ¥è¿›è¡Œè§£å†³ã€‚</p><p><a href="https://developer.aliyun.com/article/767168">Centos7å®‰è£…nvidia-container-toolkit</a></p><p>å®‰è£…å®Œæˆåï¼Œè¿›å…¥å®¹å™¨ï¼Œè¦å…ˆæ‰§è¡Œå‘½ä»¤ï¼š<code>source bin/init_env.sh</code></p><p>FATE Board é»˜è®¤ç”¨æˆ·åå¯†ç ï¼šadmin/admin</p><p>æƒ³è¦ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç </p><p><code>/data/projects/fate/fateboard/conf/application.properties</code></p><h2 id="é›†ç¾¤ç‰ˆ"><a href="#é›†ç¾¤ç‰ˆ" class="headerlink" title="é›†ç¾¤ç‰ˆ"></a>é›†ç¾¤ç‰ˆ</h2><p>é›†ç¾¤å¯ä»¥ä½¿ç”¨docker-composeæˆ–è€…kubeå®‰è£…ï¼Œè¿™é‡Œä¸åšä»‹ç»ã€‚</p><p>é›†ç¾¤ç‰ˆä¼šåŠ å…¥eggrollã€mysqlä¹‹ç±»çš„ç»„ä»¶ï¼Œå…¶å¼€æ”¾çš„ç«¯å£å¦‚ä¸‹ï¼š</p><p><img src="C:/Users/11599/Desktop/FATEè”é‚¦å­¦ä¹ æ¡†æ¶/FATEè”é‚¦å­¦ä¹ æ¡†æ¶/assets/image-20220923161817-1viqwi3.png" alt="image.png"></p><p>9380ç«¯å£æ˜¯FATE flowè°ƒç”¨apiçš„æ¥å£ï¼Œæœ‰å“ªäº›æ¥å£å¯ä»¥å‚çœ‹ä¸‹é¢çš„é“¾æ¥ã€‚</p><p><a href="https://federatedai.github.io/FATE-Flow/latest/zh/swagger/">https://federatedai.github.io/FATE-Flow/latest/zh/swagger/</a></p><p>é›†ç¾¤å®‰è£…åï¼Œæ¯ä¸ªèŠ‚ç‚¹åº”è¯¥æœ‰ä»¥ä¸‹dockerå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fate@vm172-31-0-217:~$ docker ps </span><br><span class="line">CONTAINER ID   IMAGE                                   COMMAND                  CREATED       STATUS                PORTS                                            NAMES</span><br><span class="line">f2ab95400e3f   federatedai/client:1.9.0-release        <span class="string">&quot;/bin/sh -c &#x27;flow inâ€¦&quot;</span>   2 weeks ago   Up 7 days             0.0.0.0:20000-&gt;20000/tcp                         confs-10000-client-1</span><br><span class="line">f24fac183cbe   federatedai/fateboard:1.9.0-release     <span class="string">&quot;/bin/sh -c &#x27;java -Dâ€¦&quot;</span>   2 weeks ago   Up 7 days             0.0.0.0:6080-&gt;6080/tcp, 8080/tcp                 confs-10000-fateboard-1</span><br><span class="line">33ca56f46fe3   federatedai/fateflow-nn:1.9.0-release   <span class="string">&quot;/bin/bash -c &#x27;set -â€¦&quot;</span>   2 weeks ago   Up 7 days (healthy)   0.0.0.0:9360-&gt;9360/tcp, 0.0.0.0:9380-&gt;9380/tcp   confs-10000-fateflow-1</span><br><span class="line">4dbb83db37cc   mysql:8.0.28                            <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   2 weeks ago   Up 7 days             3306/tcp, 33060/tcp                              confs-10000-mysql-1</span><br><span class="line">7e4567d52d9d   federatedai/eggroll-nn:1.9.0-release    <span class="string">&quot;/tini -- bash -c &#x27;jâ€¦&quot;</span>   2 weeks ago   Up 7 days             0.0.0.0:9370-&gt;9370/tcp                           confs-10000-rollsite-1</span><br><span class="line">10f118347296   federatedai/eggroll-nn:1.9.0-release    <span class="string">&quot;/tini -- bash -c &#x27;jâ€¦&quot;</span>   2 weeks ago   Up 7 days             4670/tcp                                         confs-10000-clustermanager-1</span><br><span class="line">7ceafb32bfd9   federatedai/eggroll-nn:1.9.0-release    <span class="string">&quot;/tini -- bash -c &#x27;jâ€¦&quot;</span>   2 weeks ago   Up 7 days             4671/tcp   </span><br></pre></td></tr></table></figure><p>é›†ç¾¤å¼€æ”¾çš„ç«¯å£ï¼š</p><div class="table-container"><table><thead><tr><th>port</th><th>service</th></tr></thead><tbody><tr><td>6080</td><td>fate-board</td></tr><tr><td>8350</td><td>serving</td></tr><tr><td>20000</td><td>jupyter</td></tr><tr><td>9370</td><td>rollsite</td></tr><tr><td>9380</td><td>flow api</td></tr></tbody></table></div><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†å››ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯FATE9997-10000ï¼Œå…¶ä¸­FATE10000ä¸ºarbiterç”¨äºå°†æ¢¯åº¦èšåˆå’Œåˆ†å‘ï¼Œå…¶ä½™ä¸ºguest/hostï¼Œæ˜¯å‚ä¸è”é‚¦å­¦ä¹ çš„å„æ–¹ã€‚</p><h2 id="Toy-Test"><a href="#Toy-Test" class="headerlink" title="Toy Test"></a>Toy Test</h2><p>å®‰è£…å®Œæˆåå¯ä»¥è¿›è¡Œç®€å•æµ‹è¯•ï¼Œä»¥æ£€æŸ¥å®‰è£…æ˜¯å¦æˆåŠŸã€‚10000æ˜¯å„ä¸ªå‚ä¸æ–¹çš„partyid</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flow test toy -gid 10000 -hid 10000</span><br></pre></td></tr></table></figure><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://zhuanlan.zhihu.com/p/79284686">è¯¦è§£è”é‚¦å­¦ä¹ Federated Learning</a></li></ol><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FATEè”é‚¦å­¦ä¹ æ¡†æ¶ï¼ˆå…±å…«ç¯‡ï¼‰</title>
      <link href="/2022/11/03/FATE%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%EF%BC%88%E5%85%B1%E5%85%AB%E7%AF%87%EF%BC%89/"/>
      <url>/2022/11/03/FATE%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%EF%BC%88%E5%85%B1%E5%85%AB%E7%AF%87%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><ol><li>FATEè”é‚¦å­¦ä¹ æ¡†æ¶ç®€ä»‹ï¼šè”é‚¦å­¦ä¹ +fateä»‹ç»+å•æœºç‰ˆdockerå®‰è£…+toy test</li><li>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šä¿¡ç”¨æ•°æ®æ¡ˆä¾‹</li><li>FATE DSLé…ç½®æ–‡ä»¶è¯¦ç»†è§£é‡Š</li><li>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šæ‰‹å†™æ•°å­—è¯†åˆ«ï¼ˆå¼€å‘ç»„ä»¶ï¼šè‡ªå®šä¹‰çš„æ¨¡å‹ã€ä½¿ç”¨gpuã€æ¨¡å‹è¯„ä¼°ï¼Ÿï¼‰</li><li>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šè‚ ç™Œå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸Šï¼‰â€”â€”baseline</li><li>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šè‚ ç™Œå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸‹ï¼‰â€”â€”è”é‚¦åŒ–</li><li>FATEæ¨ªå‘è”é‚¦å­¦ä¹ ï¼šè‚ºç‚çš„å¤šæ¨¡æ€ä»»åŠ¡çš„è”é‚¦å­¦ä¹ </li><li>FATEä½¿ç”¨é‡åˆ°çš„é—®é¢˜æ±‡æ€»</li></ol><h1 id="ä»“åº“"><a href="#ä»“åº“" class="headerlink" title="ä»“åº“"></a>ä»“åº“</h1><p><a href="https://github.com/guoyujian/FATE">https://github.com/guoyujian/FATE</a></p>]]></content>
      
      
      <categories>
          
          <category> è”é‚¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è”é‚¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPç¼“å­˜</title>
      <link href="/2022/09/24/HTTP%E7%BC%93%E5%AD%98/"/>
      <url>/2022/09/24/HTTP%E7%BC%93%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç«¯ç¼“å­˜çŸ¥è¯†ç‚¹"><a href="#å‰ç«¯ç¼“å­˜çŸ¥è¯†ç‚¹" class="headerlink" title="å‰ç«¯ç¼“å­˜çŸ¥è¯†ç‚¹"></a>å‰ç«¯ç¼“å­˜çŸ¥è¯†ç‚¹</h1><p><img src="å‰ç«¯ç¼“å­˜ä¸€è§ˆ.png" alt="å‰ç«¯ç¼“å­˜ä¸€è§ˆ">â€‹</p><h1 id="ä»€ä¹ˆæ˜¯HTTPç¼“å­˜"><a href="#ä»€ä¹ˆæ˜¯HTTPç¼“å­˜" class="headerlink" title="ä»€ä¹ˆæ˜¯HTTPç¼“å­˜"></a>ä»€ä¹ˆæ˜¯HTTPç¼“å­˜</h1><p>httpç¼“å­˜æŒ‡çš„æ˜¯: å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šå…ˆæŠµè¾¾æµè§ˆå™¨ç¼“å­˜ï¼Œå¦‚æœæµè§ˆå™¨æœ‰â€œè¦è¯·æ±‚èµ„æºâ€çš„å‰¯æœ¬ï¼Œå°±å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ç¼“å­˜ä¸­æå–è€Œä¸æ˜¯ä»åŸå§‹æœåŠ¡å™¨ä¸­æå–è¿™ä¸ªèµ„æºã€‚</p><p>å¸¸è§çš„httpç¼“å­˜åªèƒ½ç¼“å­˜getè¯·æ±‚å“åº”çš„èµ„æºï¼Œå¯¹äºå…¶ä»–ç±»å‹çš„å“åº”åˆ™æ— èƒ½ä¸ºåŠ›ï¼Œæ‰€ä»¥åç»­è¯´çš„è¯·æ±‚ç¼“å­˜éƒ½æ˜¯æŒ‡GETè¯·æ±‚ã€‚</p><p>httpç¼“å­˜éƒ½æ˜¯ä»ç¬¬äºŒæ¬¡è¯·æ±‚å¼€å§‹çš„ã€‚ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨è¿”å›èµ„æºï¼Œå¹¶åœ¨respone headerå¤´ä¸­å›ä¼ èµ„æºçš„ç¼“å­˜å‚æ•°ï¼›ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨åˆ¤æ–­è¿™äº›è¯·æ±‚å‚æ•°ï¼Œå‘½ä¸­å¼ºç¼“å­˜å°±ç›´æ¥200ï¼Œå¦åˆ™å°±æŠŠè¯·æ±‚å‚æ•°åŠ åˆ°request headerå¤´ä¸­ä¼ ç»™æœåŠ¡å™¨ï¼Œçœ‹æ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›304ï¼Œå¦åˆ™æœåŠ¡å™¨ä¼šè¿”å›æ–°çš„èµ„æºã€‚</p><h1 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨HTTPç¼“å­˜-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨HTTPç¼“å­˜-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨HTTPç¼“å­˜ ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨HTTPç¼“å­˜ ï¼Ÿ</h1><ol><li>å‡å°‘äº†å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœäº†ç½‘è´¹ã€‚</li><li>ç¼“è§£äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œ å¤§å¤§æé«˜äº†ç½‘ç«™çš„æ€§èƒ½</li><li>åŠ å¿«äº†å®¢æˆ·ç«¯åŠ è½½ç½‘é¡µçš„é€Ÿåº¦</li></ol><h1 id="å¦‚ä½•ä½¿ç”¨HTTPç¼“å­˜-ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨HTTPç¼“å­˜-ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨HTTPç¼“å­˜ ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨HTTPç¼“å­˜ ï¼Ÿ</h1><p>ä¸€èˆ¬éœ€è¦ç¼“å­˜çš„èµ„æºæœ‰htmlé¡µé¢å’Œå…¶ä»–é™æ€èµ„æºï¼š</p><blockquote><p>1ã€ <strong>htmlé¡µé¢ç¼“å­˜çš„è®¾ç½®ä¸»è¦æ˜¯åœ¨<code>&lt;head&gt;</code>æ ‡ç­¾ä¸­åµŒå…¥<code>&lt;meta&gt;</code>æ ‡ç­¾ï¼Œè¿™ç§æ–¹å¼åªå¯¹é¡µé¢æœ‰æ•ˆï¼Œå¯¹é¡µé¢ä¸Šçš„èµ„æºæ— æ•ˆ</strong></p></blockquote><p>1.1 htmlé¡µé¢ç¦ç”¨ç¼“å­˜çš„è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;cache-control&quot; content=&quot;no-cache&quot; \&gt;</span><br></pre></td></tr></table></figure><p>1.2 htmlè®¾ç½®ç¼“å­˜å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;max-age=7200&quot; /&gt;</span><br></pre></td></tr></table></figure><blockquote><p>2ã€ <strong>é™æ€èµ„æºçš„ç¼“å­˜ä¸€èˆ¬æ˜¯åœ¨webæœåŠ¡å™¨ä¸Šé…ç½®çš„ï¼Œå¸¸ç”¨çš„webæœåŠ¡å™¨æœ‰ï¼šnginxã€apacheã€‚å…·ä½“çš„é…ç½®è¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»ï¼Œå¤§å®¶è‡ªè¡ŒæŸ¥é˜…ã€‚</strong></p><p><strong>3ã€ä¸æƒ³ä½¿ç”¨ç¼“å­˜çš„å‡ ç§æ–¹å¼</strong></p></blockquote><ul><li>Ctrl + F5å¼ºåˆ¶åˆ·æ–°ï¼Œéƒ½ä¼šç›´æ¥å‘æœåŠ¡å™¨æå–æ•°æ®ã€‚</li><li>æŒ‰F5åˆ·æ–°æˆ–æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®ï¼Œé»˜è®¤åŠ ä¸ŠCache-Controlï¼šmax-age=0ï¼Œå³ä¼šèµ°åå•†ç¼“å­˜ã€‚</li><li>è¿˜æœ‰å°±æ˜¯ä¸Šé¢1ã€2ä¸­ç¦ç”¨ç¼“å­˜çš„åšæ³•</li></ul><h1 id="HTTPç¼“å­˜çš„å‡ ä¸ªæ³¨æ„ç‚¹"><a href="#HTTPç¼“å­˜çš„å‡ ä¸ªæ³¨æ„ç‚¹" class="headerlink" title="HTTPç¼“å­˜çš„å‡ ä¸ªæ³¨æ„ç‚¹"></a>HTTPç¼“å­˜çš„å‡ ä¸ªæ³¨æ„ç‚¹</h1><p>1ã€å¼ºç¼“å­˜æƒ…å†µä¸‹ï¼Œåªè¦ç¼“å­˜è¿˜æ²¡è¿‡æœŸï¼Œå°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­å–æ•°æ®ï¼Œå°±ç®—æœåŠ¡å™¨ç«¯æœ‰æ•°æ®å˜åŒ–ï¼Œä¹Ÿä¸ä¼šä»æœåŠ¡å™¨ç«¯è·å–äº†ï¼Œè¿™æ ·å°±æ— æ³•è·å–åˆ°ä¿®æ”¹åçš„æ•°æ®ã€‚è§£å†³çš„åŠæ³•æœ‰ï¼šåœ¨ä¿®æ”¹åçš„èµ„æºåŠ ä¸Šéšæœºæ•°ï¼Œç¡®ä¿ä¸ä¼šä»ç¼“å­˜ä¸­å–ã€‚</p><p>ä¾‹å¦‚ï¼š<code>http://www.kimshare.club/kim/common.css?v=22324432</code></p><p>2ã€å°½é‡å‡å°‘304çš„è¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œåå•†ç¼“å­˜æ¯æ¬¡éƒ½ä¼šä¸åå°æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šä¸æ˜¯å¾ˆå¥½ã€‚ä»æ€§èƒ½ä¸Šæ¥çœ‹å°½é‡å¤šä½¿ç”¨å¼ºç¼“å­˜ã€‚</p><p>3ã€ä¸ç¼“å­˜ç›¸å…³çš„å‡ ä¸ªheaderå±æ€§æœ‰ï¼šVaryã€Date/Ageã€‚</p><h1 id="HTTPç¼“å­˜çš„åˆ†ç±»"><a href="#HTTPç¼“å­˜çš„åˆ†ç±»" class="headerlink" title="HTTPç¼“å­˜çš„åˆ†ç±»"></a><strong>HTTPç¼“å­˜çš„åˆ†ç±»</strong></h1><ul><li>æ ¹æ®æ˜¯å¦éœ€è¦é‡æ–°å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ¥åˆ†ç±»ï¼Œå¯åˆ†ä¸ºå¼ºåˆ¶ç¼“å­˜ï¼Œåå•†ç¼“å­˜</li><li>æ ¹æ®æ˜¯å¦å¯ä»¥è¢«å•ä¸ªæˆ–è€…å¤šä¸ªç”¨æˆ·ä½¿ç”¨æ¥åˆ†ç±»ï¼Œå¯åˆ†ä¸ºç§æœ‰ç¼“å­˜ï¼Œå…±äº«ç¼“å­˜ï¼ˆä¸careï¼‰</li></ul><p>å¼ºåˆ¶ç¼“å­˜å¦‚æœç”Ÿæ•ˆï¼Œä¸éœ€è¦å†å’ŒæœåŠ¡å™¨å‘ç”Ÿäº¤äº’ï¼Œè€Œåå•†ç¼“å­˜ä¸ç®¡æ˜¯å¦ç”Ÿæ•ˆï¼Œéƒ½éœ€è¦ä¸æœåŠ¡ç«¯å‘ç”Ÿäº¤äº’ã€‚ä¸‹é¢æ˜¯å¼ºåˆ¶ç¼“å­˜å’Œåå•†ç¼“å­˜çš„ä¸€äº›å¯¹æ¯”ï¼š</p><p><img src="HTTPç¼“å­˜åˆ†ç±».png" alt="HTTPç¼“å­˜åˆ†ç±»"></p><h2 id="å¼ºç¼“å­˜"><a href="#å¼ºç¼“å­˜" class="headerlink" title="å¼ºç¼“å­˜"></a>å¼ºç¼“å­˜</h2><p>å¼ºåˆ¶ç¼“å­˜åœ¨ç¼“å­˜æ•°æ®æœªå¤±æ•ˆçš„æƒ…å†µä¸‹ï¼ˆå³Cache-Controlçš„max-ageæ²¡æœ‰è¿‡æœŸæˆ–è€…Expiresçš„ç¼“å­˜æ—¶é—´æ²¡æœ‰è¿‡æœŸï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥ä½¿ç”¨æµè§ˆå™¨çš„ç¼“å­˜æ•°æ®ï¼Œä¸ä¼šå†å‘æœåŠ¡å™¨å‘é€ä»»ä½•è¯·æ±‚ã€‚</p><p>å¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆæ—¶ï¼ŒhttpçŠ¶æ€ç ä¸º200ã€‚è¿™ç§æ–¹å¼é¡µé¢çš„åŠ è½½é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼Œæ€§èƒ½ä¹Ÿæ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯åœ¨è¿™æœŸé—´ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯çš„èµ„æºä¿®æ”¹äº†ï¼Œé¡µé¢ä¸Šæ˜¯æ‹¿ä¸åˆ°çš„ï¼Œå› ä¸ºå®ƒä¸ä¼šå†å‘æœåŠ¡å™¨å‘è¯·æ±‚äº†ã€‚</p><p>è¿™ç§æƒ…å†µå°±æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ç§ç»å¸¸é‡åˆ°çš„ï¼Œæ¯”å¦‚ä½ ä¿®æ”¹äº†é¡µé¢ä¸Šçš„æŸä¸ªæ ·å¼ï¼Œåœ¨é¡µé¢ä¸Šåˆ·æ–°äº†ä½†æ²¡æœ‰ç”Ÿæ•ˆï¼Œå› ä¸ºèµ°çš„æ˜¯å¼ºç¼“å­˜ï¼Œæ‰€ä»¥Ctrl + F5ä¸€é¡¿æ“ä½œä¹‹åå°±å¥½äº†ã€‚ </p><p>è·Ÿå¼ºåˆ¶ç¼“å­˜ç›¸å…³çš„headerå¤´å±æ€§æœ‰ï¼ˆPragma/Cache-Control/Expiresï¼‰</p><h2 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h2><p>å½“ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­æ²¡æœ‰Cache-Controlå’ŒExpiresæˆ–è€…Cache-Controlå’ŒExpiresè¿‡æœŸè¿˜æˆ–è€…å®ƒçš„å±æ€§è®¾ç½®ä¸ºno-cacheæ—¶(å³ä¸èµ°å¼ºç¼“å­˜)ï¼Œé‚£ä¹ˆæµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶å°±ä¼šä¸æœåŠ¡å™¨è¿›è¡Œåå•†ï¼Œä¸æœåŠ¡å™¨ç«¯å¯¹æ¯”åˆ¤æ–­èµ„æºæ˜¯å¦è¿›è¡Œäº†ä¿®æ”¹æ›´æ–°ã€‚</p><p>å¦‚æœæœåŠ¡å™¨ç«¯çš„èµ„æºæ²¡æœ‰ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›304çŠ¶æ€ç ï¼Œå‘Šè¯‰æµè§ˆå™¨å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å°±å‡å°‘äº†æœåŠ¡å™¨çš„æ•°æ®ä¼ è¾“å‹åŠ›ã€‚</p><p>å¦‚æœæ•°æ®æœ‰æ›´æ–°å°±ä¼šè¿”å›200çŠ¶æ€ç ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ›´æ–°åçš„èµ„æºå¹¶ä¸”å°†ç¼“å­˜ä¿¡æ¯ä¸€èµ·è¿”å›ã€‚</p><p>è·Ÿåå•†ç¼“å­˜ç›¸å…³çš„headerå¤´å±æ€§æœ‰ï¼ˆETag/If-Not-Match ã€Last-Modified/If-Modified-Sinceï¼‰è¯·æ±‚å¤´å’Œå“åº”å¤´éœ€è¦æˆå¯¹å‡ºç°ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>ä¸‹å›¾æ˜¯æµè§ˆå™¨é¦–æ¬¡å’Œå†æ¬¡å‘é€httpè¯·æ±‚çš„æ‰§è¡Œæµç¨‹å›¾ï¼š</strong></p><p><img src="é¦–æ¬¡HTTPè¯·æ±‚.png" alt="é¦–æ¬¡HTTPè¯·æ±‚"></p><p><img src="å†æ¬¡HTTPè¯·æ±‚.png" alt="å†æ¬¡HTTPè¯·æ±‚"></p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://www.jianshu.com/p/227cee9c8d15">https://www.jianshu.com/p/227cee9c8d15</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
          <category> HTTPåè®® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
            <tag> HTTPåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPSåè®®</title>
      <link href="/2022/09/24/HTTPS%E5%8D%8F%E8%AE%AE/"/>
      <url>/2022/09/24/HTTPS%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p>åŠ å¯†åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼ŒHTTPSå…¼é¡¾ä¸¤è€…ã€‚</p><p>å…³äºéå¯¹ç§°åŠ å¯†ï¼Œå¯ä»¥æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚è¿™é‡Œåªæä¸€ç‚¹ï¼š</p><blockquote><p><strong>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼</strong></p></blockquote><h1 id="ä¸ºä»€ä¹ˆéœ€è¦HTTPS"><a href="#ä¸ºä»€ä¹ˆéœ€è¦HTTPS" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦HTTPS"></a>ä¸ºä»€ä¹ˆéœ€è¦HTTPS</h1><p>HTTP ä¸»è¦æœ‰è¿™äº›ä¸è¶³ï¼š</p><ul><li>é€šä¿¡ä½¿ç”¨æ˜æ–‡ï¼ˆä¸åŠ å¯†ï¼‰ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ï¼›</li><li>ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œå› æ­¤æœ‰å¯èƒ½é­é‡ä¼ªè£…ï¼›</li><li>æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å·²é­ç¯¡æ”¹ï¼›</li></ul><p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒHTTPSé¡ºåº”è€Œç”Ÿã€‚</p><h1 id="HTTPSä»‹ç»"><a href="#HTTPSä»‹ç»" class="headerlink" title="HTTPSä»‹ç»"></a>HTTPSä»‹ç»</h1><p><strong>HTTP+ åŠ å¯† + è®¤è¯ + å®Œæ•´æ€§ä¿æŠ¤=HTTPS</strong>ã€‚</p><p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒHTTPSæ˜¯å®‰å…¨ç‰ˆçš„HTTPï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ–°çš„åè®®ï¼Œè€Œæ˜¯HTTP åŠ ä¸ŠåŠ å¯†å¤„ç†ï¼ˆè§£å†³HTTPé€šä¿¡ä½¿ç”¨æ˜æ–‡çš„é—®é¢˜ï¼‰å’Œè®¤è¯ï¼ˆè§£å†³HTTPä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½é—®é¢˜ï¼‰ä»¥åŠå®Œæ•´æ€§ä¿æŠ¤ï¼ˆè§£å†³HTTPæ— æ³•è¯æ˜æŠ¥æ–‡å®Œæ•´æ€§çš„é—®é¢˜ï¼‰åçš„ä¸œè¥¿ã€‚</p><p><strong>ç«¯å£ï¼š443</strong></p><p><img src="HTTPå’ŒHTTPSå¯¹æ¯”.png" alt="HTTPå’ŒHTTPSå¯¹æ¯”"></p><p>æ³¨ï¼šä¸Šå›¾å¹¶ä¸ä»£è¡¨é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´<strong>HTTPSæ˜¯å…ˆå»ºç«‹TCPè¿æ¥ï¼Œå†è¿›è¡ŒTLS/SSLæ¡æ‰‹ã€‚</strong></p><h1 id="HTTPSé€šä¿¡"><a href="#HTTPSé€šä¿¡" class="headerlink" title="HTTPSé€šä¿¡"></a>HTTPSé€šä¿¡</h1><p>ç›´æ¥ä¸Šå›¾</p><p><img src="HTTPSé€šä¿¡.png" alt="HTTPSé€šä¿¡">â€‹</p><p>ä¸Šå›¾åŸºæœ¬æŠŠHTTPSçš„é€šä¿¡æµç¨‹è¯´çš„éå¸¸æ¸…æ™°äº†ï¼Œè¡¥å……ä¸¤ç‚¹ï¼š</p><ol><li>è¿™é‡Œå¯¹æ¯”HASHæ˜¯ä¸ºäº†é˜²æ­¢æ¡æ‰‹æ¶ˆæ¯è¢«ç¯¡æ”¹ã€‚æµè§ˆå™¨ä¸ç½‘ç«™äº’ç›¸å‘é€åŠ å¯†çš„æ¡æ‰‹æ¶ˆæ¯å¹¶éªŒè¯ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯åŒæ–¹éƒ½è·å¾—äº†ä¸€è‡´çš„å¯†ç ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸çš„åŠ å¯†è§£å¯†æ•°æ®ï¼Œä¸ºåç»­çœŸæ­£æ•°æ®çš„ä¼ è¾“åšä¸€æ¬¡æµ‹è¯•ã€‚</li><li>å› ä¸ºå¯¹ç§°åŠ å¯†è¦æ¯”éå¯¹ç§°åŠ å¯†çš„è®¡ç®—å¿«å¾ˆå¤šï¼Œæ‰€ä»¥HTTPSæ²¡æœ‰å…¨ç¨‹ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œè€Œæ˜¯å…ˆä½¿ç”¨éå¯¹ç§°åŠ å¯†äº¤æ¢å¯¹ç§°å¯†é’¥ï¼Œå†ä½¿ç”¨å¯¹ç§°åŠ å¯†æ‰‹æ®µé€šä¿¡ã€‚</li><li>è¯ä¹¦ç¡®ä¿äº†åŒæ–¹èº«ä»½ã€‚</li></ol><p>å¦å¤–ï¼ŒHTTPSä¸€èˆ¬ä½¿ç”¨çš„åŠ å¯†ä¸HASHç®—æ³•å¦‚ä¸‹ï¼š</p><ul><li>éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼šRSAï¼ŒDSA/DSS</li><li>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼šAESï¼ŒRC4ï¼Œ3DES</li><li>HASHç®—æ³•ï¼šMD5ï¼ŒSHA1ï¼ŒSHA256</li></ul><h1 id="HTTPS-çš„ä¼˜ç¼ºç‚¹"><a href="#HTTPS-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="HTTPS çš„ä¼˜ç¼ºç‚¹?"></a>HTTPS çš„ä¼˜ç¼ºç‚¹?</h1><p>ä¼˜ç‚¹</p><ul><li><p>å®‰å…¨æ€§ï¼š</p><ul><li>ä½¿ç”¨HTTPSåè®®å¯è®¤è¯ç”¨æˆ·å’ŒæœåŠ¡å™¨ï¼Œç¡®ä¿æ•°æ®å‘é€åˆ°æ­£ç¡®çš„å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ï¼›</li><li>HTTPSåè®®æ˜¯ç”±SSL+HTTPåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œè¦æ¯”httpåè®®å®‰å…¨ï¼Œå¯é˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«çªƒå–ã€æ”¹å˜ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚</li><li>HTTPSæ˜¯ç°è¡Œæ¶æ„ä¸‹æœ€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶ä¸æ˜¯ç»å¯¹å®‰å…¨ï¼Œä½†å®ƒå¤§å¹…å¢åŠ äº†ä¸­é—´äººæ”»å‡»çš„æˆæœ¬ã€‚</li></ul></li><li>SEOæ–¹é¢ï¼šè°·æ­Œæ›¾åœ¨2014å¹´8æœˆä»½è°ƒæ•´æœç´¢å¼•æ“ç®—æ³•ï¼Œå¹¶ç§°â€œæ¯”èµ·åŒç­‰HTTPç½‘ç«™ï¼Œé‡‡ç”¨HTTPSåŠ å¯†çš„ç½‘ç«™åœ¨æœç´¢ç»“æœä¸­çš„æ’åå°†ä¼šæ›´é«˜â€ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>åœ¨ç›¸åŒç½‘ç»œç¯å¢ƒä¸­ï¼ŒHTTPS ç›¸æ¯” HTTP æ— è®ºæ˜¯å“åº”æ—¶é—´è¿˜æ˜¯è€—ç”µé‡éƒ½æœ‰å¤§å¹…åº¦ä¸Šå‡ã€‚</li><li>HTTPS çš„å®‰å…¨æ˜¯æœ‰èŒƒå›´çš„ï¼Œåœ¨é»‘å®¢æ”»å‡»ã€æœåŠ¡å™¨åŠ«æŒç­‰æƒ…å†µä¸‹å‡ ä¹èµ·ä¸åˆ°ä½œç”¨ã€‚</li><li>åœ¨ç°æœ‰çš„è¯ä¹¦æœºåˆ¶ä¸‹ï¼Œä¸­é—´äººæ”»å‡»ä¾ç„¶æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li>HTTPS éœ€è¦æ›´å¤šçš„æœåŠ¡å™¨èµ„æºï¼Œä¹Ÿä¼šå¯¼è‡´æˆæœ¬çš„å‡é«˜ã€‚</li></ul><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">SSL/TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°</a></li><li><a href="https://www.cnblogs.com/zery/p/5164795.html">HTTPS åŸç†è§£æ</a></li><li><a href="https://cloud.tencent.com/developer/article/1007810?from=article.detail.1017988">HTTPS å»ºç«‹è¿æ¥çš„è¯¦ç»†è¿‡ç¨‹</a></li><li><a href="https://juejin.cn/post/6906126429381984264">HTTPSè¿æ¥è¿‡ç¨‹</a></li><li><a href="https://zhuanlan.zhihu.com/p/45390160">HTTPSè¯¦ç»†ä»‹ç»</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
          <category> HTTPåè®® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
            <tag> HTTPåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPé¢è¯•é¢˜</title>
      <link href="/2022/09/24/HTTP%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2022/09/24/HTTP%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä½œä¸ºå¤ä¹ ï¼Œä¹Ÿä½œä¸ºä¸€ä¸ªç›®å½•</p></blockquote><h1 id="è¯´ä¸€ä¸‹HTTPåè®®"><a href="#è¯´ä¸€ä¸‹HTTPåè®®" class="headerlink" title="è¯´ä¸€ä¸‹HTTPåè®®"></a>è¯´ä¸€ä¸‹HTTPåè®®</h1><p>HTTPå…¨ç§°æ˜¯Hyper Text Transfer Protocolã€‚å³<strong>è¶…æ–‡æœ¬ä¼ è¾“åè®®</strong>ï¼Œå®ƒæ˜¯ä»¥<strong>TCP/IP</strong>ä¸ºåŸºç¡€æ¥ä¼ è¾“HTMLï¼Œæ–‡ä»¶ï¼Œå›¾ç‰‡ç­‰ã€‚ å®ƒæœ¬èº«å¤„äº<strong>åº”ç”¨å±‚</strong>ï¼Œ<strong>ç«¯å£å·80</strong>ã€‚</p><ol><li>HTTPæ˜¯åŸºäº<strong>æµè§ˆå™¨/æœåŠ¡å™¨</strong>æ¶æ„ï¼›</li><li>HTTPæ˜¯<strong>æ— çŠ¶æ€</strong>åè®®ï¼šHTTPæœ¬èº«å¹¶ä¸ä¿å­˜ç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šå¯¹ä¼ è¾“çš„æ•°æ®ï¼ŒçŠ¶æ€ä¿¡æ¯è¿›è¡ŒæŒä¹…åŒ–ï¼›</li><li>HTTPæ˜¯<strong>æ— è¿æ¥</strong>åè®®ï¼šæ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œç”¨æˆ·è¯·æ±‚ï¼Œå³æ–­å¼€è¿æ¥ï¼Œå€Ÿæ­¤èŠ‚çº¦ä¼ è¾“æ—¶é—´ã€‚</li></ol><h1 id="HTTPé€šä¿¡è¿‡ç¨‹"><a href="#HTTPé€šä¿¡è¿‡ç¨‹" class="headerlink" title="HTTPé€šä¿¡è¿‡ç¨‹"></a>HTTPé€šä¿¡è¿‡ç¨‹</h1><ol><li>ç”¨æˆ·è¾“å…¥ç½‘å€</li><li>DNSæœåŠ¡å™¨è§£æåŸŸå</li><li>æµè§ˆå™¨å’ŒæœåŠ¡å™¨å»ºç«‹TCPè¿æ¥</li><li>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚è¡Œ</li><li>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚å¤´ï¼Œå¹¶ä»¥ç©ºè¡Œä»£è¡¨å‘é€ç»“æŸï¼Œå¦‚æœè¯·æ±‚ç±»å‹ä¸º<code>post</code>ï¼Œåˆ™ç»§ç»­å‘é€è¯·æ±‚ä½“</li><li>æœåŠ¡å™¨åº”ç­”åè®®ç‰ˆæœ¬å·å’Œåº”ç­”çŠ¶æ€ç </li><li>æœåŠ¡å™¨å‘é€å“åº”å¤´ï¼Œå¹¶ä»¥ç©ºè¡Œä»£è¡¨å‘é€ç»“æŸ</li><li>æœåŠ¡å™¨å‘é€æ•°æ®ï¼šä»¥<code>Content-Type</code>ç»™å‡ºçš„æ ¼å¼å‘é€ç”¨æˆ·æ‰€è¯·æ±‚çš„ä¿¡æ¯</li><li>æœåŠ¡å™¨å…³é—­TCPè¿æ¥ï¼šå¦‚æœæµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨çš„å¤´ä¿¡æ¯ä¸­åŠ å…¥äº†è¿™æ ·ä¸€æ®µä»£ç ï¼š<code>connectionï¼šKeep-alive</code> åˆ™TCPè¿æ¥ä¼šä¿æŒæ‰“å¼€çŠ¶æ€</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æHTMLå†…å®¹</li></ol><p>ä¸‹å›¾æ•´ç†äº†HTTPé€šä¿¡çš„å…³é”®æ­¥éª¤ï¼š</p><p><img src="httpé€šä¿¡è¿‡ç¨‹.png" alt="è®¡ç®—æœºç½‘ç»œ-httpé€šä¿¡è¿‡ç¨‹">â€‹</p><h1 id="è¯´ä¸€ä¸‹HTTPSåè®®"><a href="#è¯´ä¸€ä¸‹HTTPSåè®®" class="headerlink" title="è¯´ä¸€ä¸‹HTTPSåè®®"></a>è¯´ä¸€ä¸‹HTTPSåè®®</h1><p>å¯ä»¥çœ‹æˆ‘çš„åšå®¢ï¼šã€ŠHTTPSåè®®ã€‹</p><h1 id="HTTPä¸HTTPSçš„å¯¹æ¯”"><a href="#HTTPä¸HTTPSçš„å¯¹æ¯”" class="headerlink" title="HTTPä¸HTTPSçš„å¯¹æ¯”"></a>HTTPä¸HTTPSçš„å¯¹æ¯”</h1><ul><li>ä¸¤è€…å·¥ä½œçš„ç«¯å£å·ä¸åŒï¼šHTTPå·¥ä½œåœ¨80ï¼ŒHTTPSå·¥ä½œåœ¨443ï¼›</li><li>HTTPSéœ€è¦ç”¨åˆ°CAï¼ˆæ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼‰ç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬éœ€è¦ä¸€å®šè´¹ç”¨ï¼›</li><li>HTTPå“åº”æ¯”HTTPSå¿«ï¼Œä¸»è¦å› ä¸ºHTTPSé™¤äº†TCP3æ¬¡æ¡æ‰‹å¤–è¿˜è¦åŠ ä¸Š<strong>SSL9æ¬¡æ¡æ‰‹</strong>å…±12æ¬¡æ¡æ‰‹ï¼›</li><li>HTTPSæ˜¯æ„å»ºåœ¨SSL/TLSä¸Šçš„HTTPåè®®ï¼Œå› æ­¤éœ€è¦å ç”¨æœåŠ¡å™¨èµ„æºã€‚</li></ul><h1 id="HTTPç¼“å­˜â€‹"><a href="#HTTPç¼“å­˜â€‹" class="headerlink" title="HTTPç¼“å­˜â€‹"></a>HTTPç¼“å­˜â€‹</h1><p>httpç¼“å­˜æŒ‡çš„æ˜¯: å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šå…ˆæŠµè¾¾<strong>æµè§ˆå™¨ç¼“å­˜</strong>ï¼Œå¦‚æœæµè§ˆå™¨æœ‰â€œè¦è¯·æ±‚èµ„æºâ€çš„å‰¯æœ¬ï¼Œå°±å¯ä»¥<strong>ç›´æ¥ä»æµè§ˆå™¨ç¼“å­˜ä¸­æå–</strong>è€Œä¸æ˜¯ä»åŸå§‹æœåŠ¡å™¨ä¸­æå–è¿™ä¸ªèµ„æºã€‚</p><p>å¸¸è§çš„httpç¼“å­˜<strong>åªèƒ½ç¼“å­˜getè¯·æ±‚</strong>å“åº”çš„èµ„æºï¼Œå¯¹äºå…¶ä»–ç±»å‹çš„å“åº”åˆ™æ— èƒ½ä¸ºåŠ›ï¼Œæ‰€ä»¥åç»­è¯´çš„è¯·æ±‚ç¼“å­˜éƒ½æ˜¯æŒ‡GETè¯·æ±‚ã€‚<br>httpç¼“å­˜éƒ½æ˜¯ä»ç¬¬äºŒæ¬¡è¯·æ±‚å¼€å§‹çš„ã€‚ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨è¿”å›èµ„æºï¼Œå¹¶åœ¨respone headerå¤´ä¸­å›ä¼ èµ„æºçš„ç¼“å­˜å‚æ•°ï¼›ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨åˆ¤æ–­è¿™äº›è¯·æ±‚å‚æ•°ï¼Œå‘½ä¸­å¼ºç¼“å­˜å°±ç›´æ¥200ï¼Œå¦åˆ™å°±æŠŠè¯·æ±‚å‚æ•°åŠ åˆ°request headerå¤´ä¸­ä¼ ç»™æœåŠ¡å™¨ï¼Œçœ‹æ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›304ï¼Œå¦åˆ™æœåŠ¡å™¨ä¼šè¿”å›æ–°çš„èµ„æºã€‚ï¼ˆå¯ä»¥ç”»ä¸ªå›¾ç†è§£ä¸€ä¸‹ï¼‰</p><p>HTTP ç¼“å­˜åˆåˆ†ä¸º<strong>å¼ºç¼“å­˜</strong>å’Œ <strong>åå•†ç¼“å­˜</strong> ï¼š</p><p><strong>å¼ºåˆ¶ç¼“å­˜</strong>ï¼šåœ¨ç¼“å­˜æ•°æ®æœªå¤±æ•ˆçš„æƒ…å†µä¸‹ï¼ˆå³Cache-Controlçš„max-ageæ²¡æœ‰è¿‡æœŸæˆ–è€…Expiresçš„ç¼“å­˜æ—¶é—´æ²¡æœ‰è¿‡æœŸï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥ä½¿ç”¨æµè§ˆå™¨çš„ç¼“å­˜æ•°æ®ï¼Œä¸ä¼šå†å‘æœåŠ¡å™¨å‘é€ä»»ä½•è¯·æ±‚ã€‚</p><p><strong>åå•†ç¼“å­˜</strong>ï¼šå½“ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­æ²¡æœ‰Cache-Controlå’ŒExpiresæˆ–è€…Cache-Controlå’ŒExpiresè¿‡æœŸè¿˜æˆ–è€…å®ƒçš„å±æ€§è®¾ç½®ä¸ºno-cacheæ—¶(å³ä¸èµ°å¼ºç¼“å­˜)ï¼Œé‚£ä¹ˆæµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶å°±ä¼šä¸æœåŠ¡å™¨è¿›è¡Œ <strong>åå•†</strong>ï¼Œä¸æœåŠ¡å™¨ç«¯å¯¹æ¯”åˆ¤æ–­èµ„æºæ˜¯å¦è¿›è¡Œäº†ä¿®æ”¹æ›´æ–°ã€‚å¦‚æœæœåŠ¡å™¨ç«¯çš„èµ„æºæ²¡æœ‰ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›304çŠ¶æ€ç ï¼Œå‘Šè¯‰æµè§ˆå™¨å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å°±å‡å°‘äº†æœåŠ¡å™¨çš„æ•°æ®ä¼ è¾“å‹åŠ›ã€‚å¦‚æœæ•°æ®æœ‰æ›´æ–°å°±ä¼šè¿”å›200çŠ¶æ€ç ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ›´æ–°åçš„èµ„æºå¹¶ä¸”å°†ç¼“å­˜ä¿¡æ¯ä¸€èµ·è¿”å›ã€‚</p><h1 id="HTTPçŠ¶æ€ç "><a href="#HTTPçŠ¶æ€ç " class="headerlink" title="HTTPçŠ¶æ€ç "></a>HTTPçŠ¶æ€ç </h1><ul><li>1xxï¼š<strong>ç›®å‰æ˜¯åè®®çš„ä¸­é—´çŠ¶æ€ï¼Œè¿˜éœ€è¦åç»­è¯·æ±‚ã€‚</strong><ul><li>101 åˆ‡æ¢è¯·æ±‚åè®®ï¼Œä» HTTP åˆ‡æ¢åˆ° WebSocket</li></ul></li><li>2xxï¼š<strong>è¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</strong><ul><li>200 è¯·æ±‚æˆåŠŸï¼Œæœ‰å“åº”ä½“</li></ul></li><li><p>3xxï¼š<strong>è¡¨ç¤ºé‡å®šå‘çŠ¶æ€ï¼Œéœ€è¦é‡æ–°è¯·æ±‚ã€‚</strong></p><ul><li>301 æ°¸ä¹…é‡å®šå‘ï¼šä¼šç¼“å­˜</li><li>302 ä¸´æ—¶é‡å®šå‘ï¼šä¸ä¼šç¼“å­˜</li><li>304 åå•†ç¼“å­˜å‘½ä¸­</li></ul></li><li><p>4xxï¼š<strong>è¯·æ±‚æŠ¥æ–‡é”™è¯¯ã€‚</strong></p><ul><li>403 æœåŠ¡å™¨ç¦æ­¢è®¿é—®</li><li>404 èµ„æºæœªæ‰¾åˆ°</li><li>400 è¯·æ±‚é”™è¯¯</li></ul></li><li><p>5xxï¼š<strong>æœåŠ¡å™¨é”™è¯¯ã€‚</strong></p><ul><li>500 æœåŠ¡å™¨ç«¯é”™è¯¯</li><li>503 æœåŠ¡å™¨ç¹å¿™</li></ul></li></ul><h1 id="ä¸€ä¸ªå…¸å‹çš„HTTPè¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬å“ªäº›éƒ¨åˆ†ï¼Ÿå“åº”æŠ¥æ–‡å‘¢ï¼Ÿ"><a href="#ä¸€ä¸ªå…¸å‹çš„HTTPè¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬å“ªäº›éƒ¨åˆ†ï¼Ÿå“åº”æŠ¥æ–‡å‘¢ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªå…¸å‹çš„HTTPè¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬å“ªäº›éƒ¨åˆ†ï¼Ÿå“åº”æŠ¥æ–‡å‘¢ï¼Ÿ"></a>ä¸€ä¸ªå…¸å‹çš„HTTPè¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬å“ªäº›éƒ¨åˆ†ï¼Ÿå“åº”æŠ¥æ–‡å‘¢ï¼Ÿ</h1><p>ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡åŒ…æ‹¬ï¼š  <strong>è¯·æ±‚å¤´ï¼Œè¯·æ±‚è¡Œï¼Œç©ºè¡Œï¼Œè¯·æ±‚ä½“</strong>ã€‚</p><p>ä¸€ä¸ªå“åº”æŠ¥æ–‡åŒ…æ‹¬ï¼š <strong>å“åº”è¡Œï¼Œå“åº”å¤´ï¼Œç©ºè¡Œï¼Œå“åº”ä½“</strong> ã€‚</p><p>å…·ä½“å‚è€ƒæˆ‘çš„åšå®¢ã€Šè¯¦è§£HTTPåè®®ã€‹</p><h1 id="HTTP1-0ã€HTTP1-1ã€HTTP2-0åŒºåˆ«"><a href="#HTTP1-0ã€HTTP1-1ã€HTTP2-0åŒºåˆ«" class="headerlink" title="HTTP1.0ã€HTTP1.1ã€HTTP2.0åŒºåˆ«"></a>HTTP1.0ã€HTTP1.1ã€HTTP2.0åŒºåˆ«</h1><h2 id="HTTP1-0å’ŒHTTP1-1çš„åŒºåˆ«-é•¿çŸ­è¿æ¥çš„åŒºåˆ«"><a href="#HTTP1-0å’ŒHTTP1-1çš„åŒºåˆ«-é•¿çŸ­è¿æ¥çš„åŒºåˆ«" class="headerlink" title="HTTP1.0å’ŒHTTP1.1çš„åŒºåˆ«/é•¿çŸ­è¿æ¥çš„åŒºåˆ«"></a>HTTP1.0å’ŒHTTP1.1çš„åŒºåˆ«/é•¿çŸ­è¿æ¥çš„åŒºåˆ«</h2><p>è¿™é‡Œä¸»è¦å›ç­”é•¿çŸ­è¿æ¥çš„åŒºåˆ«å°±è¡Œå§ã€‚ã€‚</p><p>åœ¨HTTP/1.0ä¸­é‡‡ç”¨çŸ­è¿æ¥ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ä¸­æ–­è¿æ¥ï¼›Connection: close</p><p>åœ¨HTTP/1.1é»˜è®¤é‡‡ç”¨é•¿è¿æ¥å’Œè¯·æ±‚çš„æµæ°´çº¿ï¼ˆPipeliningï¼‰å¤„ç†ï¼Œåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šå¯ä»¥ä¼ é€å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿã€‚Connection: keep-aliveï¼Œå°±æ˜¯ä¿æŒè¿æ¥ã€‚</p><hr><p>é•¿è¿æ¥é€‚ç”¨çš„åœºæ™¯ï¼šé•¿è¿æ¥é€‚ç”¨äºæ“ä½œé¢‘ç¹/ç‚¹å¯¹ç‚¹é€šè®¯ç­‰è¿æ¥æ•°ä¸å¤ªå¤šçš„æƒ…å†µï¼Œå¦‚ï¼šä¸€äº›æ¸¸æˆ/å³æ—¶é€šè®¯åœºæ™¯åº”è¯¥ä½¿ç”¨é•¿è¿æ¥ï¼›</p><p>çŸ­è¿æ¥é€‚ç”¨çš„åœºæ™¯ï¼š çŸ­è¿æ¥é€‚ç”¨äºå¤§é‡è¿æ¥çš„åœºæ™¯ï¼Œå¦‚Webã€wapWeb/H5ç­‰ã€‘çš„httpæœåŠ¡ï¼Œé•¿è¿æ¥å¯¹äºæœåŠ¡ç«¯æ¥è¯´ä¼šè€—è´¹ä¸€å®šèµ„æºã€‚</p><blockquote><p>è¡¥å……å…¶ä»–åŒºåˆ«ï¼š</p><ul><li>é•¿çŸ­è¿æ¥</li><li><strong>ç¼“å­˜å¤„ç†</strong>ï¼šåœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼Œå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li><li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong>ï¼šHTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li><li><strong>é”™è¯¯é€šçŸ¥çš„ç®¡ç†</strong>ï¼šåœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</li><li><strong>Hostå¤´å¤„ç†</strong>ï¼šåœ¨HTTP1.0ä¸­è®¤ä¸ºæ¯å°æœåŠ¡å™¨éƒ½ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå› æ­¤ï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­çš„URLå¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚ä½†éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•ï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆMulti-homed Web Serversï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ªIPåœ°å€ã€‚HTTP1.1çš„è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½åº”æ”¯æŒHostå¤´åŸŸï¼Œä¸”è¯·æ±‚æ¶ˆæ¯ä¸­å¦‚æœæ²¡æœ‰Hostå¤´åŸŸä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼ˆ400 Bad Requestï¼‰ã€‚</li></ul></blockquote><h2 id="HTTP1å’ŒHTTP2çš„åŒºåˆ«"><a href="#HTTP1å’ŒHTTP2çš„åŒºåˆ«" class="headerlink" title="HTTP1å’ŒHTTP2çš„åŒºåˆ«"></a>HTTP1å’ŒHTTP2çš„åŒºåˆ«</h2><p>HTTP2.0æ˜¯ç¬¬äºŒä»£TCPåè®®ã€‚å®ƒä¸HTTP1.1çš„ä¸åŒç‚¹åœ¨äºï¼š</p><ul><li>HTTP2é‡‡ç”¨<strong>äºŒè¿›åˆ¶</strong>è€Œéæ–‡æœ¬æ ¼å¼ï¼›æ­¤å±æ€§å‡è½»äº†æ¡†æ¶çš„å¤æ‚æ€§ï¼Œå¹¶ç®€åŒ–äº†ç”±äºåŒ…å«æ–‡æœ¬å’Œå¯é€‰ç©ºæ ¼çš„å‘½ä»¤è€Œå¯¼è‡´æ··æ·†çš„å‘½ä»¤çš„å®ç°ã€‚</li><li>HTTP2æ˜¯ <strong>å®Œå…¨å¤šè·¯å¤ç”¨</strong> ï¼Œè€Œçº¿ç«¯é˜»å¡çš„â€”â€”åªéœ€ä¸€ä¸ªè¿æ¥å¯ä»¥å®ç°å¹¶è¡Œï¼›</li><li>HTTP2ä½¿ç”¨<strong>æ ‡å¤´ï¼ˆheadersï¼‰å‹ç¼©</strong> ï¼Œå‡å°äº†å¼€é”€ï¼›</li><li>HTTP2è®©æœåŠ¡å™¨å¯ä»¥å°†å“åº”ä¸»åŠ¨æ¨é€åˆ°å®¢æˆ·ç«¯ç¼“å­˜ä¸­ã€‚</li></ul><p>åè¯è§£é‡Šï¼š</p><blockquote><p>çº¿ç«¯é˜»å¡å’Œå¤šè·¯å¤ç”¨</p><p>HTTP/1.x æœ‰ä¸ªé—®é¢˜å«çº¿ç«¯é˜»å¡(head-of-line blocking), å®ƒæ˜¯æŒ‡<strong>ä¸€ä¸ªè¿æ¥(connection)ä¸€æ¬¡åªæäº¤ä¸€ä¸ªè¯·æ±‚çš„æ•ˆç‡æ¯”è¾ƒé«˜, å¤šäº†å°±ä¼šå˜æ…¢</strong>ã€‚ HTTP/1.1 è¯•è¿‡ç”¨æµæ°´çº¿(pipelining)æ¥è§£å†³è¿™ä¸ªé—®é¢˜, ä½†æ˜¯æ•ˆæœå¹¶ä¸ç†æƒ³(æ•°æ®é‡è¾ƒå¤§æˆ–è€…é€Ÿåº¦è¾ƒæ…¢çš„å“åº”, ä¼šé˜»ç¢æ’åœ¨ä»–åé¢çš„è¯·æ±‚)ã€‚</p><p>å¤šè·¯ä¼ è¾“(Multiplexing)èƒ½å¾ˆå¥½çš„è§£å†³è¿™äº›é—®é¢˜, å› ä¸ºå®ƒèƒ½åŒæ—¶å¤„ç†å¤šä¸ªæ¶ˆæ¯çš„è¯·æ±‚å’Œå“åº”; ç”šè‡³å¯ä»¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å°†ä¸€ä¸ªæ¶ˆæ¯è·Ÿå¦å¤–ä¸€ä¸ªæºæ‚åœ¨ä¸€èµ·ã€‚æ‰€ä»¥<strong>å®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ªè¿æ¥</strong>å°±èƒ½åŠ è½½ä¸€ä¸ªé¡µé¢ã€‚å‡å°‘é¢å¤–çš„å¾€è¿”æ—¶é—´ã€‚</p><p><img src="http1å’Œ2å»ºç«‹è¿æ¥.png" alt="http1å’Œ2å»ºç«‹è¿æ¥"></p><p>ä¸»åŠ¨æ¨é€ï¼šé€šä¿—ç†è§£å°±æ˜¯å®¢æˆ·ç«¯è¯·æ±‚äº†htmlï¼ŒæœåŠ¡å™¨è§‰å¾—å’Œå…¶ç›¸å…³çš„cssä¹Ÿä¼šè¢«å…³è”åˆ°ï¼Œäºæ˜¯ä¸»åŠ¨åŒé€å…¶ä»–èµ„æºåˆ°å®¢æˆ·ç«¯ã€‚</p></blockquote><h1 id="GETã€POSTåŒºåˆ«"><a href="#GETã€POSTåŒºåˆ«" class="headerlink" title="GETã€POSTåŒºåˆ«"></a>GETã€POSTåŒºåˆ«</h1><p>å…·ä½“çœ‹æˆ‘çš„åšå®¢ã€Šè¯¦è§£HTTPåè®®ã€‹å’Œã€ŠHTTPåè®®å¹‚ç­‰æ€§ã€‹</p><p><img src="getå’ŒpoståŒºåˆ«.png" alt="getå’ŒpoståŒºåˆ«"></p><p>â€</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
          <category> HTTPåè®® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
            <tag> HTTPåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨è…¾è®¯ä¼šè®®çš„å±å¹•å…±äº«åŠŸèƒ½æ—¶å¼€å¯PPTæ¼”ç¤ºè€…è§†å›¾çš„æ–¹æ³•</title>
      <link href="/2022/09/11/%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%9A%E8%AE%AE%E7%9A%84%E5%B1%8F%E5%B9%95%E5%85%B1%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%97%B6%E5%BC%80%E5%90%AFPPT%E6%BC%94%E7%A4%BA%E8%80%85%E8%A7%86%E5%9B%BE%E7%9A%84%E6%96%B9%E6%B3%95/"/>
      <url>/2022/09/11/%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%9A%E8%AE%AE%E7%9A%84%E5%B1%8F%E5%B9%95%E5%85%B1%E4%BA%AB%E5%8A%9F%E8%83%BD%E6%97%B6%E5%BC%80%E5%90%AFPPT%E6%BC%94%E7%A4%BA%E8%80%85%E8%A7%86%E5%9B%BE%E7%9A%84%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p><a href="https://meeting.tencent.com/support-doc-detail/79/index.html">https://meeting.tencent.com/support-doc-detail/79/index.html</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ç®± </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è…¾è®¯ä¼šè®® </tag>
            
            <tag> ppt </tag>
            
            <tag> æ¼”ç¤ºè€…è§†å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>markdownå…¬å¼ç¼–è¾‘è¯­æ³•</title>
      <link href="/2022/09/11/markdown%E5%85%AC%E5%BC%8F%E7%BC%96%E8%BE%91%E8%AF%AD%E6%B3%95/"/>
      <url>/2022/09/11/markdown%E5%85%AC%E5%BC%8F%E7%BC%96%E8%BE%91%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹é¢ä¸¤ä¸ªè¿æ¥ç»™å‡ºçš„å…¬å¼è¯­æ³•æ¶µç›–äº†å¤§éƒ¨åˆ†çš„å†…å®¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯å®˜æ–¹è¿æ¥ã€‚</p><ol><li><a href="https://katex.org/docs/supported.html">Supported Functions</a></li><li><a href="https://blog.csdn.net/weixin_42782150/article/details/104878759">å²ä¸Šæœ€å…¨Markdownå…¬å¼ã€ç¬¦å·æ€»ç»“ï¼ï¼ï¼</a></li></ol><p>å¦å¤–æ¨èä¸€æ¬¾å…¬å¼ç”Ÿæˆè½¯ä»¶</p><blockquote><p><strong>mathpix snipping tool</strong></p></blockquote><p>é€šè¿‡æˆªå›¾ç”Ÿæˆå…¬å¼codeï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶å…¬å¼ä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶åˆ°wordç­‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ç®± </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
            <tag> typora </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä¸ç»æ„ä¼ è¾“ã€‘ç®—æ³•ä»‹ç»</title>
      <link href="/2022/09/11/%E3%80%90%E4%B8%8D%E7%BB%8F%E6%84%8F%E4%BC%A0%E8%BE%93%E3%80%91%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D/"/>
      <url>/2022/09/11/%E3%80%90%E4%B8%8D%E7%BB%8F%E6%84%8F%E4%BC%A0%E8%BE%93%E3%80%91%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>â€œä¸ç»æ„ä¼ è¾“â€è¦è§£å†³è¿™ç±»é—®é¢˜ï¼šä½ éœ€è¦ç»™å¯¹æ–¹å¤šæ¡ä¿¡æ¯ï¼Œä½†æ˜¯ä½ åˆå¿…é¡»ç¡®ä¿å¯¹æ–¹åªè·å¾—å…¶ä¸­ä¸€æ¡ï¼Œä½†æ˜¯å¯¹æ–¹åˆå¸Œæœ›èƒ½å¤Ÿç¡®ä¿ä½ ä¸çŸ¥é“ä»–çœ‹åˆ°å“ªä¸€æ¡ä¿¡æ¯ã€‚</p><p>è®¾è®¡ä¸€ä¸ªå…·ä½“åœºæ™¯ï¼šä½ ç»™ä½ çš„å“¥ä»¬ä»‹ç»ç›¸äº²å¥³æœ‹å‹ï¼Œä½ æœ‰ä¸¤ä¸ªå¯ä¾›ä»‹ç»çš„å•èº«å¥³æ€§ï¼Œä½†æ˜¯ä½ ä¸æƒ³åŒæ—¶å°†ä¸¤äººçš„æƒ…å†µå’Œè”ç³»æ–¹å¼ç»™å¯¹æ–¹ã€‚ä½†ä½ ä¹Ÿæ— æ³•æŠ‰æ‹©åˆ°åº•ç»™å“ªä¸ªï¼Œæ‰€ä»¥ä½ æƒ³è®©ä»–éšæœºæŠ½ç­¾é€‰æ‹©ä¸€ä¸ªã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œä½ çš„å“¥ä»¬ä¹Ÿä¸æƒ³è®©ä½ çŸ¥é“ï¼Œä»–æœ€ç»ˆæŠ½åˆ°äº†è°ã€‚</p><h1 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h1><p><strong>ä¸ç»æ„ä¼ è¾“</strong>ï¼ˆOblivious Transferï¼Œç®€ç§°OTï¼‰æ˜¯ä¸€ä¸ªå¯†ç å­¦åè®®ï¼Œåœ¨è¿™ä¸ªåè®®ä¸­ï¼Œæ¶ˆæ¯å‘é€è€…ä»ä¸€äº›å¾…å‘é€çš„æ¶ˆæ¯ä¸­å‘é€ä¸€æ¡ç»™æ¥æ”¶è€…ï¼Œä½†äº‹åå¯¹å‘é€äº†å“ªä¸€æ¡æ¶ˆæ¯ä»ç„¶obliviousï¼ˆä¸çŸ¥é“ï¼‰ï¼Œè¿™ä¸ªåè®®ä¹Ÿå«èŒ«ç„¶ä¼ è¾“åè®®ã€‚</p><p>ä¸ç»æ„ä¼ è¾“æ˜¯å¯†ç å­¦ä¸­çš„ä¸€ä¸ªåŸºæœ¬è€Œé‡è¦çš„é—®é¢˜ï¼Œè¢«è®¤ä¸ºæ˜¯è¯¥é¢†åŸŸçš„å…³é”®é—®é¢˜ä¹‹ä¸€ï¼Œå¯¹äº<strong>å®‰å…¨å¤šæ–¹è®¡ç®—</strong>æ¥è¯´æ˜¯å®Œæ•´çš„å®ç°ã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ï¼ŒAliceæ˜¯æ¶ˆæ¯å‘é€è€…ï¼ŒBobæ˜¯æ¶ˆæ¯æ¥å—è€…ã€‚Aliceæƒ³è¦å°†æ¶ˆæ¯$M_0$ã€$M_1$ä¹‹ä¸€ä¼ ç»™Bobï¼ŒBobåªèƒ½å¾—åˆ°è‡ªå·±æƒ³è¦çš„é‚£ä¸ªï¼ˆ$M_0$æˆ–$M_1$ï¼‰ä¸èƒ½è·å–å¦å¤–ä¸€ä¸ªæ¶ˆæ¯ï¼ŒAliceä¹Ÿä¸èƒ½çŸ¥é“Bobé€‰çš„æ˜¯å“ªä¸€æ¡æ¶ˆæ¯ã€‚</p><p><img src="ä¸ç»æ„ä¼ è¾“1.png" alt="ä¸ç»æ„ä¼ è¾“1"></p><h1 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h1><p>ç¬¬ä¸€ç§å½¢å¼çš„ä¸ç»æ„ä¼ è¾“ï¼Œæœ€åˆæ˜¯åœ¨1981ç”±Michael O.Rabinæå‡ºï¼Œåœ¨è¿™ç§ä¸ç»æ„ä¼ è¾“ä¸­ï¼Œå‘é€è€…Aliceå‘é€ä¸€æ¡æ¶ˆæ¯ç»™æ¥æ”¶ç€Bobï¼Œè€ŒBobä»¥1/2çš„æ¦‚ç‡æ¥æ”¶åˆ°ä¿¡æ¯ï¼Œåœ¨ç»“æŸåAliceå¹¶ä¸çŸ¥é“Bobæ˜¯å¦æ¥æ”¶åˆ°äº†ä¿¡æ¯ï¼Œè€ŒBobèƒ½ç¡®ä¿¡åœ°çŸ¥é“è‡ªå·±æ˜¯å¦æ”¶åˆ°äº†ä¿¡æ¯ã€‚</p><p>å¦ä¸€ç§æ›´å®ç”¨çš„ä¸ç»æ„ä¼ è¾“åè®®ï¼Œè¢«ç§°ä¸º2é€‰ä¸€ä¸ç»æ„ä¼ è¾“ï¼ˆ1 out 2 oblivious transferï¼‰ç”± Shimon Evenï¼ŒOded Goldreichå’ŒAbraham Lempelåœ¨1985å¹´æå‡ºï¼Œåœ¨è¿™ç§å½¢å¼çš„ä¸ç»æ„ä¼ è¾“æ¨¡å‹ä¸­ï¼ŒAliceæ¯æ¬¡å‘ä¸¤æ¡ä¿¡æ¯ï¼ˆm1ã€m2ï¼‰ç»™Bobï¼Œ<strong>Bobæä¾›ä¸€ä¸ªè¾“å…¥</strong>ï¼Œå¹¶æ ¹æ®è¾“å…¥è·å¾—è¾“å‡ºä¿¡æ¯ï¼Œåœ¨åè®®ç»“æŸåï¼ŒBobå¾—åˆ°äº†è‡ªå·±æƒ³è¦çš„é‚£æ¡ä¿¡æ¯ï¼ˆm1æˆ–è€…m2ï¼‰ï¼Œè€ŒAliceå¹¶ä¸çŸ¥é“Bobæœ€ç»ˆå¾—åˆ°çš„æ˜¯å“ªæ¡ã€‚</p><blockquote><p>è¿™ä¸ªè¾“å…¥ï¼Œæˆ‘çš„ç†è§£æ˜¯é€šçŸ¥å‘é€è€…å‘å“ªäº›æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯çš„èŒƒå›´</p></blockquote><p>1986å¹´ï¼ŒBrassardç­‰äººå°†2é€‰1ä¸ç»æ„ä¼ è¾“æ‹“å±•ä¸ºné€‰1ã€‚</p><p><img src="ä¸ç»æ„ä¼ è¾“2.png" alt="ä¸ç»æ„ä¼ è¾“2"></p><p>ä¸ç»æ„ä¼ è¾“ä¸€ç§å®ç°æ–¹å¼æ˜¯<strong>åŸºäºRSAå…¬é’¥ç®—æ³•</strong>ï¼Œä¸‹é¢å°±2é€‰1ä¸ç»æ„ä¼ è¾“çš„å®ç°åšç®€è¦ä»‹ç»ã€‚</p><h1 id="åŸºäºRSAå…¬é’¥ç®—æ³•çš„2é€‰1ä¸ç»æ„ä¼ è¾“"><a href="#åŸºäºRSAå…¬é’¥ç®—æ³•çš„2é€‰1ä¸ç»æ„ä¼ è¾“" class="headerlink" title="åŸºäºRSAå…¬é’¥ç®—æ³•çš„2é€‰1ä¸ç»æ„ä¼ è¾“"></a>åŸºäºRSAå…¬é’¥ç®—æ³•çš„2é€‰1ä¸ç»æ„ä¼ è¾“</h1><p>å…ˆæŠŠã€ŒåŸºäºRSAå…¬é’¥ç®—æ³•çš„2é€‰1ä¸ç»æ„ä¼ è¾“ã€çš„æµç¨‹å›¾åˆ—å‡ºæ¥ï¼š</p><p><img src="ä¸ç»æ„ä¼ è¾“æµç¨‹.png" alt="ä¸ç»æ„ä¼ è¾“æµç¨‹"></p><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol><li>å‘é€è€…Aliceç”Ÿæˆä¸¤å¯¹RSAå…¬ç§é’¥$(puk0, pri0)$ï¼Œ$(puk1, pri1)$ï¼Œå¹¶å°†ä¸¤ä¸ªå…¬é’¥$puk0$å’Œ$puk1$å‘é€ç»™Bobã€‚</li><li>Bobç”Ÿæˆä¸€ä¸ªéšæœºæ•°$r$ï¼Œå¹¶ç”¨æ”¶åˆ°çš„ä¸¤ä¸ªå…¬é’¥ä¹‹ä¸€åŠ å¯†éšæœºæ•°ï¼Œ$c=Encrypt(r)$ã€‚ï¼ˆç”¨å“ªä¸ªç§˜é’¥å–å†³äºæƒ³è·å–å“ªæ¡æ•°æ®ï¼Œä¾‹å¦‚å¦‚æœæƒ³è¦å¾—åˆ°æ¶ˆæ¯$M_0$å°±ç”¨$puk0$åŠ å¯†éšæœºæ•°ï¼Œå¦‚æœæƒ³è¦å¾—åˆ°$M_1$å°±ç”¨$puk1$åŠ å¯†éšæœºæ•°ï¼‰ï¼Œå¹¶å°†å¯†æ–‡ç»“æœå‘é€ç»™Aliceã€‚</li><li>Aliceç”¨è‡ªå·±çš„ä¸¤ä¸ªç§é’¥åˆ†åˆ«è§£å¯†æ”¶åˆ°éšæœºæ•°å¯†æ–‡ï¼Œå¾—åˆ°ä¸¤ä¸ªè§£å¯†ç»“æœï¼š$k_0=Decrypt(c, pri_0)$ï¼Œ$k_1=Decrypt(c, pri_1)$ã€‚ï¼ˆ$k_0$ï¼Œ$k_1$å…¶ä¸­ä¸€ä¸ªå°±æ˜¯éšæœºæ•°$r$ï¼‰ã€‚å¹¶å°†ä¸¤ä¸ªç»“æœåˆ†åˆ«ä¸ä¸¤æ¡ä¿¡æ¯è¿›è¡Œå¼‚æˆ–ï¼Œç”Ÿæˆæ©ç æ¶ˆæ¯ï¼š$e_0=k_0\bigoplus m_0$ï¼Œ$e_1=k_1\bigoplus m_1$ï¼Œå¹¶å°†ä¸¤ä¸ªç»“æœ$e_0$ï¼Œ$e_1$å‘ç»™Bobã€‚</li><li>Bobç”¨ä¹‹å‰ç”Ÿæˆçš„éšæœºæ•°$r$ä¸æ”¶åˆ°çš„$e_0$ï¼Œ$e_1$åˆ†åˆ«åšå¼‚æˆ–æ“ä½œï¼Œå¾—åˆ°çš„ä¸¤ä¸ªç»“æœä¸­åªæœ‰ä¸€æ¡ä¸ºçœŸå®æ•°æ®ï¼Œå¦å¤–ä¸€æ¡ä¸ºéšæœºæ•°ï¼š$m^{â€˜}_0=e_0\bigoplus r$ï¼Œ$m^{â€˜}_1=e_1\bigoplus r$ã€‚</li><li>Bobåœ¨æ­¥éª¤2ä¸­ï¼Œå¦‚æœä½¿ç”¨$puk0$åŠ å¯†ï¼Œå¾—åˆ°çš„$m^{â€˜}_0=m_0$ï¼Œåä¹‹æ˜¯$m_1$ã€‚</li></ol><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åœ¨æ­¤è¿‡ç¨‹ä¸­ç¬¬3æ­¥æœ€ä¸ºå…³é”®ï¼Œå¦‚æœAliceæ— æ³•ä»ç”¨ä¸¤æ¡ç§é’¥è§£å¯†å¾—åˆ°çš„ç»“æœ$k_0$ã€$k_1$ä¸­åŒºåˆ†å‡ºBobçš„çœŸå®éšæœºæ•°ï¼Œåˆ™èƒ½ä¿è¯Aliceæ— æ³•å¾—çŸ¥Bobå°†è¦è·å–çš„æ˜¯å“ªæ¡æ•°æ®ã€‚Bobæ²¡æœ‰ç§é’¥ä¹Ÿå°±æ— æ³•å¾—å‡ºçœŸå®çš„ç§é’¥è§£å¯†ç»“æœï¼ˆå¦‚æœ$k_0$ä¸ºçœŸå®éšæœºæ•°ï¼ŒBobæ— æ³•å¾—çŸ¥$k_1$çš„å€¼ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå°±åªèƒ½å¾—åˆ°è‡ªå·±æƒ³è¦çš„é‚£æ¡æ•°æ®è€Œæ— æ³•å¾—åˆ°å¦å¤–ä¸€æ¡ï¼Œä¿éšœåè®®èƒ½æ‰§è¡ŒæˆåŠŸã€‚</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://learnblockchain.cn/article/2022">åŒºå—é“¾ä¸­çš„æ•°å­¦ - ä¸ç»æ„ä¼ è¾“</a></li><li><a href="https://zhuanlan.zhihu.com/p/208295083">ä»€ä¹ˆæ˜¯ä¸ç»æ„ä¼ è¾“</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¯†ç å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSAåŠ å¯†ç®—æ³•</title>
      <link href="/2022/08/28/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
      <url>/2022/08/28/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†</h1><p>ä½¿ç”¨ç›¸åŒçš„è§„åˆ™ï¼ˆç§˜é’¥ï¼‰è¿›è¡ŒåŠ å¯†è§£å¯†çš„ç®—æ³•æˆä¸ºâ€œ<strong>å¯¹ç§°åŠ å¯†ç®—æ³•</strong>â€ï¼Œè¿™ç§åŠ å¯†æ¨¡å¼æœ‰ä¸€ä¸ªæœ€å¤§å¼±ç‚¹ï¼šç”²æ–¹å¿…é¡»æŠŠåŠ å¯†è§„åˆ™å‘Šè¯‰ä¹™æ–¹ï¼Œå¦åˆ™æ— æ³•è§£å¯†ã€‚ä¿å­˜å’Œä¼ é€’å¯†é’¥ï¼Œå°±æˆäº†æœ€å¤´ç–¼çš„é—®é¢˜ã€‚</p><p>1976å¹´ï¼Œä¸¤ä½ç¾å›½è®¡ç®—æœºå­¦å®¶Whitfield Diffie å’Œ Martin Hellmanï¼Œæå‡ºäº†ä¸€ç§å´­æ–°æ„æ€ï¼Œå¯ä»¥åœ¨ä¸ç›´æ¥ä¼ é€’å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œå®Œæˆè§£å¯†ã€‚è¿™è¢«ç§°ä¸º<a href="https://en.wikipedia.org/wiki/Diffieâ€“Hellman_key_exchange">â€œDiffie-Hellmanå¯†é’¥äº¤æ¢ç®—æ³•â€</a>ã€‚è¿™ä¸ªç®—æ³•å¯å‘äº†å…¶ä»–ç§‘å­¦å®¶ã€‚äººä»¬è®¤è¯†åˆ°ï¼ŒåŠ å¯†å’Œè§£å¯†å¯ä»¥ä½¿ç”¨ä¸åŒçš„è§„åˆ™ï¼Œåªè¦è¿™ä¸¤ç§è§„åˆ™ä¹‹é—´å­˜åœ¨æŸç§å¯¹åº”å…³ç³»å³å¯ï¼Œè¿™æ ·å°±é¿å…äº†ç›´æ¥ä¼ é€’å¯†é’¥ã€‚</p><p>è¿™ç§æ–°çš„åŠ å¯†æ¨¡å¼è¢«ç§°ä¸ºâ€éå¯¹ç§°åŠ å¯†ç®—æ³•â€ã€‚</p><blockquote><p>ï¼ˆ1ï¼‰ä¹™æ–¹ç”Ÿæˆä¸¤æŠŠå¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—ï¼Œç§é’¥åˆ™æ˜¯ä¿å¯†çš„ã€‚</p><p>ï¼ˆ2ï¼‰ç”²æ–¹è·å–ä¹™æ–¹çš„å…¬é’¥ï¼Œç„¶åç”¨å®ƒå¯¹ä¿¡æ¯åŠ å¯†ã€‚</p><p>ï¼ˆ3ï¼‰ä¹™æ–¹å¾—åˆ°åŠ å¯†åçš„ä¿¡æ¯ï¼Œç”¨ç§é’¥è§£å¯†ã€‚</p></blockquote><p>å¦‚æœå…¬é’¥åŠ å¯†çš„ä¿¡æ¯åªæœ‰ç§é’¥è§£å¾—å¼€ï¼Œé‚£ä¹ˆåªè¦ç§é’¥ä¸æ³„æ¼ï¼Œé€šä¿¡å°±æ˜¯å®‰å…¨çš„ã€‚</p><blockquote><p> æˆ‘çš„ç†è§£ï¼šRSAåŠ å¯†ç®—æ³•å°±æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ç”²å‘ä¹™å‘é€æ¶ˆæ¯ï¼Œä¹™å…ˆç”Ÿæˆç§é’¥å’Œå…¬é’¥ï¼Œä¹™æŠŠå…¬é’¥ç»™ç”²ï¼Œç”²ç”¨å…¬é’¥å°†ä¿¡æ¯åŠ å¯†ï¼Œå°†åŠ å¯†ä¿¡æ¯å‘ç»™ä¹™ï¼Œä¹™æ‹¿ç§é’¥è§£å¯†ã€‚</p></blockquote><p>åœ¨ä»‹ç»RSAç®—æ³•ä¹‹å‰éœ€è¦å…ˆä»‹ç»ä¸€ç‚¹æ•°å­¦çŸ¥è¯†ã€‚</p><h1 id="RSAç®—æ³•çš„æ•°å­¦åŸºç¡€"><a href="#RSAç®—æ³•çš„æ•°å­¦åŸºç¡€" class="headerlink" title="RSAç®—æ³•çš„æ•°å­¦åŸºç¡€"></a>RSAç®—æ³•çš„æ•°å­¦åŸºç¡€</h1><h2 id="äº’è´¨å…³ç³»"><a href="#äº’è´¨å…³ç³»" class="headerlink" title="äº’è´¨å…³ç³»"></a>äº’è´¨å…³ç³»</h2><p>å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°ï¼Œé™¤äº†1ä»¥å¤–ï¼Œæ²¡æœ‰å…¶ä»–å…¬å› å­ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ•°æ˜¯<a href="https://zh.wikipedia.org/zh-cn/äº’ç´ ">äº’è´¨å…³ç³»</a>ï¼ˆcoprimeï¼‰ã€‚æ¯”å¦‚ï¼Œ15å’Œ32æ²¡æœ‰å…¬å› å­ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯äº’è´¨å…³ç³»ã€‚è¿™è¯´æ˜ï¼Œä¸æ˜¯è´¨æ•°ä¹Ÿå¯ä»¥æ„æˆäº’è´¨å…³ç³»ã€‚</p><p>å…³äºäº’è´¨å…³ç³»ï¼Œä¸éš¾å¾—åˆ°ä»¥ä¸‹ç»“è®ºï¼š</p><blockquote><ol><li>ä»»æ„ä¸¤ä¸ªè´¨æ•°æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚13å’Œ61ã€‚â˜†</li><li>ä¸€ä¸ªæ•°æ˜¯è´¨æ•°ï¼Œå¦ä¸€ä¸ªæ•°åªè¦ä¸æ˜¯å‰è€…çš„å€æ•°ï¼Œä¸¤è€…å°±æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚3å’Œ10ã€‚</li><li>å¦‚æœä¸¤ä¸ªæ•°ä¹‹ä¸­ï¼Œè¾ƒå¤§çš„é‚£ä¸ªæ•°æ˜¯è´¨æ•°ï¼Œåˆ™ä¸¤è€…æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚97å’Œ57ã€‚</li><li>1å’Œä»»æ„ä¸€ä¸ªè‡ªç„¶æ•°æ˜¯éƒ½æ˜¯äº’è´¨å…³ç³»ï¼Œæ¯”å¦‚1å’Œ99ã€‚</li><li>pæ˜¯å¤§äº1çš„æ•´æ•°ï¼Œåˆ™på’Œp-1æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚57å’Œ56ã€‚</li><li>pæ˜¯å¤§äº1çš„å¥‡æ•°ï¼Œåˆ™på’Œp-2æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚17å’Œ15ã€‚</li></ol></blockquote><h2 id="æ¬§æ‹‰å‡½æ•°"><a href="#æ¬§æ‹‰å‡½æ•°" class="headerlink" title="æ¬§æ‹‰å‡½æ•°"></a>æ¬§æ‹‰å‡½æ•°</h2><p>å¯¹äºä»»æ„ç»™å®šçš„æ­£æ•´æ•°nï¼Œè®¡ç®—åœ¨å°äºç­‰äºnçš„æ­£æ•´æ•°ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªä¸næ„æˆäº’è´¨å…³ç³»çš„æ–¹æ³•å°±å«åš<strong>æ¬§æ‹‰å‡½æ•°</strong>ã€‚ä»¥Ï†(n)è¡¨ç¤ºã€‚åœ¨1åˆ°8ä¹‹ä¸­ï¼Œä¸8å½¢æˆäº’è´¨å…³ç³»çš„æ˜¯1ã€3ã€5ã€7ï¼Œæ‰€ä»¥ Ï†(n) = 4ã€‚</p><p><strong>ç¬¬ä¸€ç§æƒ…å†µ</strong></p><p>å¦‚æœn=1ï¼Œåˆ™ Ï†(1) = 1 ã€‚å› ä¸º1ä¸ä»»ä½•æ•°ï¼ˆåŒ…æ‹¬è‡ªèº«ï¼‰éƒ½æ„æˆäº’è´¨å…³ç³»ã€‚</p><p><strong>ç¬¬äºŒç§æƒ…å†µ</strong></p><p>å¦‚æœnæ˜¯è´¨æ•°ï¼Œåˆ™ Ï†(n)=n-1ã€‚å› ä¸ºè´¨æ•°ä¸å°äºå®ƒçš„æ¯ä¸€ä¸ªæ•°ï¼Œéƒ½æ„æˆäº’è´¨å…³ç³»ã€‚æ¯”å¦‚5ä¸1ã€2ã€3ã€4éƒ½æ„æˆäº’è´¨å…³ç³»ã€‚</p><p><strong>ç¬¬ä¸‰ç§æƒ…å†µ</strong></p><p>å¦‚æœnæ˜¯è´¨æ•°çš„æŸä¸€ä¸ªæ¬¡æ–¹ï¼Œå³$ n = p^k $ ï¼ˆpä¸ºè´¨æ•°ï¼Œkä¸ºå¤§äºç­‰äº1çš„æ•´æ•°ï¼‰ï¼Œåˆ™</p><script type="math/tex; mode=display">Ï†(p^k) = p^k - p^{k-1}</script><p>æ¯”å¦‚ $Ï†(8) = Ï†(2^3) = 2^3 - 2^2 = 4$ã€‚</p><p>è¿™æ˜¯å› ä¸ºåªæœ‰å½“ä¸€ä¸ªæ•°ä¸åŒ…å«è´¨æ•°pï¼Œæ‰å¯èƒ½ä¸näº’è´¨ã€‚è€ŒåŒ…å«è´¨æ•°pçš„æ•°ä¸€å…±æœ‰$p^{k-1}$ä¸ªï¼Œå³$1Ã—p$ã€$2Ã—p$ã€$3Ã—p$ã€â€¦ã€$p^{k-1}Ã—p$ï¼ŒæŠŠå®ƒä»¬å»é™¤ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸näº’è´¨çš„æ•°ã€‚</p><p>ä¸Šé¢çš„å¼å­è¿˜å¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">Ï†(p^k) = p^k - p^{k-1} = p^k(1-\frac{1}{p})</script><p>å¯ä»¥çœ‹å‡ºï¼Œä¸Šé¢çš„ç¬¬äºŒç§æƒ…å†µæ˜¯ k=1 æ—¶çš„ç‰¹ä¾‹ã€‚</p><p><strong>ç¬¬å››ç§æƒ…å†µ</strong></p><p>å¦‚æœnå¯ä»¥åˆ†è§£æˆä¸¤ä¸ªäº’è´¨çš„æ•´æ•°ä¹‹ç§¯ï¼Œ$n = p_1 <em> p_2$ï¼Œåˆ™$Ï†(n) = Ï†(p_1</em>p_2) = Ï†(p_1) * Ï†(p_2)$</p><p>å³ç§¯çš„æ¬§æ‹‰å‡½æ•°ç­‰äºæ¬§æ‹‰å‡½æ•°çš„ç§¯ã€‚æ¯”å¦‚ï¼Œ$Ï†(56)=Ï†(8Ã—7)=Ï†(8)Ã—Ï†(7)=4Ã—6=24$ã€‚</p><p>è¿™ä¸€æ¡çš„è¯æ˜è¦ç”¨åˆ°<a href="https://en.wikipedia.org/wiki/Chinese_remainder_theorem">â€œä¸­å›½å‰©ä½™å®šç†â€</a>ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p><p><strong>ç¬¬äº”ç§æƒ…å†µ</strong></p><p>å› ä¸ºä»»æ„ä¸€ä¸ªå¤§äº1çš„æ­£æ•´æ•°ï¼Œéƒ½å¯ä»¥å†™æˆä¸€ç³»åˆ—è´¨æ•°çš„ç§¯ã€‚</p><script type="math/tex; mode=display">n = p_1^{k_1}p_2^{k_2}â€¦p_r^{k_r}</script><p>æ ¹æ®ç¬¬4æ¡çš„ç»“è®ºï¼Œå¾—åˆ°</p><script type="math/tex; mode=display">Ï†(n)=Ï†(p_1^{k_1})Ï†(p_2^{k_2})â€¦Ï†(p_r^{k_r})</script><p>å†æ ¹æ®ç¬¬3æ¡çš„ç»“è®ºï¼Œå¾—åˆ°</p><script type="math/tex; mode=display">Ï†(n)=p_1^{k_1}p_2^{k_2}â€¦p_r^{k_r}(1-\frac{1}{p_1})(1-\frac{1}{p_2})â€¦(1-\frac{1}{p_r})</script><p>ä¹Ÿå°±ç­‰äº</p><script type="math/tex; mode=display">Ï†(n)=n(1-\frac{1}{p_1})(1-\frac{1}{p_2})â€¦(1-\frac{1}{p_r})</script><p>è¿™å°±æ˜¯æ¬§æ‹‰å‡½æ•°çš„é€šç”¨è®¡ç®—å…¬å¼ã€‚æ¯”å¦‚ï¼Œ1323çš„æ¬§æ‹‰å‡½æ•°ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">Ï†(1323)=Ï†(3^3*7^2)=1323(1-\frac{1}{3})(1-\frac{1}{7})=756</script><h2 id="æ¬§æ‹‰å®šç†"><a href="#æ¬§æ‹‰å®šç†" class="headerlink" title="æ¬§æ‹‰å®šç†"></a>æ¬§æ‹‰å®šç†</h2><p>æ¬§æ‹‰å‡½æ•°çš„ç”¨å¤„ï¼Œåœ¨äº<a href="https://zh.wikipedia.org/wiki/æ¬§æ‹‰å®šç†_(æ•°è®º">æ¬§æ‹‰å®šç†</a>)ã€‚â€æ¬§æ‹‰å®šç†â€æŒ‡çš„æ˜¯ï¼š</p><blockquote><p>å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°aå’Œnäº’è´¨ï¼Œåˆ™nçš„æ¬§æ‹‰å‡½æ•° Ï†(n) å¯ä»¥è®©ä¸‹é¢çš„ç­‰å¼æˆç«‹ï¼š</p><script type="math/tex; mode=display">a^{Ï†(n)}\equiv1 \pmod n</script></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œaçš„Ï†(n)æ¬¡æ–¹è¢«né™¤çš„ä½™æ•°ä¸º1ã€‚æˆ–è€…è¯´ï¼Œaçš„Ï†(n)æ¬¡æ–¹å‡å»1ï¼Œå¯ä»¥è¢«næ•´é™¤ã€‚æ¯”å¦‚ï¼Œ3å’Œ7äº’è´¨ï¼Œè€Œ7çš„æ¬§æ‹‰å‡½æ•°Ï†(7)ç­‰äº6ï¼Œæ‰€ä»¥3çš„6æ¬¡æ–¹ï¼ˆ729ï¼‰å‡å»1ï¼Œå¯ä»¥è¢«7æ•´é™¤ï¼ˆ728/7=104ï¼‰ã€‚</p><p>æ¬§æ‹‰å®šç†çš„è¯æ˜æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå°±çœç•¥äº†ã€‚æˆ‘ä»¬åªè¦è®°ä½å®ƒçš„ç»“è®ºå°±è¡Œäº†ã€‚</p><p>æ¬§æ‹‰å®šç†å¯ä»¥å¤§å¤§ç®€åŒ–æŸäº›è¿ç®—ã€‚æ¯”å¦‚ï¼Œ7å’Œ10äº’è´¨ï¼Œæ ¹æ®æ¬§æ‹‰å®šç†ï¼Œ</p><script type="math/tex; mode=display">7^{Ï†(10)}\equiv1 \pmod {10}</script><p>å·²çŸ¥ Ï†(10) ç­‰äº4ï¼Œæ‰€ä»¥é©¬ä¸Šå¾—åˆ°7çš„4å€æ•°æ¬¡æ–¹çš„ä¸ªä½æ•°è‚¯å®šæ˜¯1ã€‚</p><script type="math/tex; mode=display">7^{4k}\equiv1 \pmod {10}</script><p>å› æ­¤ï¼Œ7çš„ä»»æ„æ¬¡æ–¹çš„ä¸ªä½æ•°ï¼ˆä¾‹å¦‚7çš„222æ¬¡æ–¹ï¼‰ï¼Œå¿ƒç®—å°±å¯ä»¥ç®—å‡ºæ¥ã€‚</p><p>æ¬§æ‹‰å®šç†æœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µã€‚</p><blockquote><p>å‡è®¾æ­£æ•´æ•°aä¸è´¨æ•°päº’è´¨ï¼Œå› ä¸ºè´¨æ•°pçš„Ï†(p)ç­‰äºp-1ï¼Œåˆ™æ¬§æ‹‰å®šç†å¯ä»¥å†™æˆ</p><script type="math/tex; mode=display">a^{p-1} \equiv 1 \pmod p</script></blockquote><p>è¿™å°±æ˜¯è‘—åçš„<a href="https://zh.wikipedia.org/wiki/è´¹é©¬å°å®šç†">è´¹é©¬å°å®šç†</a>ã€‚å®ƒæ˜¯æ¬§æ‹‰å®šç†çš„ç‰¹ä¾‹ã€‚</p><p>æ¬§æ‹‰å®šç†æ˜¯RSAç®—æ³•çš„æ ¸å¿ƒã€‚ç†è§£äº†è¿™ä¸ªå®šç†ï¼Œå°±å¯ä»¥ç†è§£RSAã€‚</p><h2 id="æ¨¡åå…ƒç´ "><a href="#æ¨¡åå…ƒç´ " class="headerlink" title="æ¨¡åå…ƒç´ "></a>æ¨¡åå…ƒç´ </h2><p>è¿˜å‰©ä¸‹æœ€åä¸€ä¸ªæ¦‚å¿µï¼š</p><blockquote><p>å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°aå’Œnäº’è´¨ï¼Œé‚£ä¹ˆä¸€å®šå¯ä»¥æ‰¾åˆ°æ•´æ•°bï¼Œä½¿å¾— ab-1 è¢«næ•´é™¤ï¼Œæˆ–è€…è¯´abè¢«né™¤çš„ä½™æ•°æ˜¯1ã€‚</p><script type="math/tex; mode=display">ab \equiv 1 \pmod n</script><p>è¿™æ—¶ï¼Œbå°±å«åšaçš„<a href="https://zh.wikipedia.org/wiki/æ¨¡åå…ƒç´ ">â€œæ¨¡åå…ƒç´ â€</a>ã€‚</p></blockquote><p>æ¯”å¦‚ï¼Œ3å’Œ11äº’è´¨ï¼Œé‚£ä¹ˆ3çš„æ¨¡åå…ƒç´ å°±æ˜¯4ï¼Œå› ä¸º (3 Ã— 4)-1 å¯ä»¥è¢«11æ•´é™¤ã€‚æ˜¾ç„¶ï¼Œæ¨¡åå…ƒç´ ä¸æ­¢ä¸€ä¸ªï¼Œ 4åŠ å‡11çš„æ•´æ•°å€éƒ½æ˜¯3çš„æ¨¡åå…ƒç´  {â€¦,-18,-7,4,15,26,â€¦}ï¼Œå³å¦‚æœbæ˜¯açš„æ¨¡åå…ƒç´ ï¼Œåˆ™ b+kn éƒ½æ˜¯açš„æ¨¡åå…ƒç´ ã€‚</p><p>æ¬§æ‹‰å®šç†å¯ä»¥ç”¨æ¥è¯æ˜æ¨¡åå…ƒç´ å¿…ç„¶å­˜åœ¨ã€‚</p><script type="math/tex; mode=display">a^{Ï†(n)}=a*a^{Ï†(n)-1} \equiv 1 \pmod n</script><p>å¯ä»¥çœ‹åˆ°ï¼Œaçš„ Ï†(n)-1 æ¬¡æ–¹ï¼Œå°±æ˜¯açš„æ¨¡åå…ƒç´ ã€‚</p><h1 id="RSAç®—æ³•"><a href="#RSAç®—æ³•" class="headerlink" title="RSAç®—æ³•"></a>RSAç®—æ³•</h1><h2 id="å¯†é’¥ç”Ÿæˆçš„æ­¥éª¤"><a href="#å¯†é’¥ç”Ÿæˆçš„æ­¥éª¤" class="headerlink" title="å¯†é’¥ç”Ÿæˆçš„æ­¥éª¤"></a>å¯†é’¥ç”Ÿæˆçš„æ­¥éª¤</h2><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œæ¥ç†è§£RSAç®—æ³•ã€‚å‡è®¾çˆ±ä¸½ä¸è¦ä¸é²å‹ƒè¿›è¡ŒåŠ å¯†é€šä¿¡ï¼Œå¥¹è¯¥æ€ä¹ˆç”Ÿæˆå…¬é’¥å’Œç§é’¥å‘¢ï¼Ÿ</p><p><img src="bg2013070302.png" alt="img"></p><p><strong>ç¬¬ä¸€æ­¥ï¼Œéšæœºé€‰æ‹©ä¸¤ä¸ªä¸ç›¸ç­‰çš„è´¨æ•°på’Œqã€‚</strong></p><p>çˆ±ä¸½ä¸é€‰æ‹©äº†61å’Œ53ã€‚ï¼ˆå®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸¤ä¸ªè´¨æ•°è¶Šå¤§ï¼Œå°±è¶Šéš¾ç ´è§£ã€‚ï¼‰</p><p><strong>ç¬¬äºŒæ­¥ï¼Œè®¡ç®—på’Œqçš„ä¹˜ç§¯nã€‚</strong></p><p>çˆ±ä¸½ä¸å°±æŠŠ61å’Œ53ç›¸ä¹˜ã€‚</p><script type="math/tex; mode=display">n = 61*53 = 3233</script><p>nçš„äºŒè¿›åˆ¶é•¿åº¦å°±æ˜¯å¯†é’¥é•¿åº¦ã€‚3233å†™æˆäºŒè¿›åˆ¶æ˜¯110010100001ï¼Œä¸€å…±æœ‰12ä½ï¼Œæ‰€ä»¥è¿™ä¸ªå¯†é’¥å°±æ˜¯12ä½ã€‚</p><p>å®é™…åº”ç”¨ä¸­ï¼ŒRSAå¯†é’¥ä¸€èˆ¬æ˜¯1024ä½ï¼Œé‡è¦åœºåˆåˆ™ä¸º2048ä½ã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼Œè®¡ç®—nçš„æ¬§æ‹‰å‡½æ•°Ï†(n)ã€‚</strong></p><p>æ ¹æ®å…¬å¼ï¼š</p><script type="math/tex; mode=display">Ï†(n) = (p-1)(q-1)</script><p>$Ï†(3233)=Ï†(61<em>53)=Ï†(61)</em>Ï†ï¼ˆ53ï¼‰=60*52=3120$</p><p><strong>ç¬¬å››æ­¥ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°eï¼Œæ¡ä»¶æ˜¯1&lt; e &lt; Ï†(n)ï¼Œä¸”eä¸Ï†(n) äº’è´¨ã€‚</strong></p><p>çˆ±ä¸½ä¸å°±åœ¨1åˆ°3120ä¹‹é—´ï¼Œéšæœºé€‰æ‹©äº†17ã€‚ï¼ˆå®é™…åº”ç”¨ä¸­ï¼Œå¸¸å¸¸é€‰æ‹©65537ã€‚ï¼‰</p><p><strong>ç¬¬äº”æ­¥ï¼Œè®¡ç®—eå¯¹äºÏ†(n)çš„æ¨¡åå…ƒç´ dã€‚</strong></p><p>æ‰€è°“<a href="https://zh.wikipedia.org/wiki/æ¨¡åå…ƒç´ ">â€œæ¨¡åå…ƒç´ â€</a>å°±æ˜¯æŒ‡æœ‰ä¸€ä¸ªæ•´æ•°dï¼Œå¯ä»¥ä½¿å¾—edè¢«Ï†(n)é™¤çš„ä½™æ•°ä¸º1ã€‚</p><script type="math/tex; mode=display">ed \equiv 1 \pmod {Ï†(n)}</script><p>è¿™ä¸ªå¼å­ç­‰ä»·äº</p><script type="math/tex; mode=display">ed - 1 = k Ï†(n)</script><p>äºæ˜¯ï¼Œæ‰¾åˆ°æ¨¡åå…ƒç´ dï¼Œå®è´¨ä¸Šå°±æ˜¯å¯¹ä¸‹é¢è¿™ä¸ªäºŒå…ƒä¸€æ¬¡æ–¹ç¨‹æ±‚è§£ã€‚</p><script type="math/tex; mode=display">ed - kÏ†(n) = 1</script><p>å·²çŸ¥ e=17, Ï†(n)=3120ï¼Œ</p><script type="math/tex; mode=display">17d-3120k=1</script><p>è¿™ä¸ªæ–¹ç¨‹å¯ä»¥ç”¨<a href="https://zh.wikipedia.org/wiki/æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•">â€œæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•â€</a>æ±‚è§£ï¼Œæ­¤å¤„çœç•¥å…·ä½“è¿‡ç¨‹ã€‚æ€»ä¹‹ï¼Œçˆ±ä¸½ä¸ç®—å‡ºä¸€ç»„æ•´æ•°è§£ä¸º (d, k)=(2753,-15)ï¼Œå³ d=2753ã€‚</p><p>è‡³æ­¤æ‰€æœ‰è®¡ç®—å®Œæˆã€‚</p><p><strong>ç¬¬å…­æ­¥ï¼Œå°†nå’Œeå°è£…æˆå…¬é’¥ï¼Œnå’Œdå°è£…æˆç§é’¥ã€‚</strong></p><p>åœ¨çˆ±ä¸½ä¸çš„ä¾‹å­ä¸­ï¼Œn=3233ï¼Œe=17ï¼Œd=2753ï¼Œæ‰€ä»¥å…¬é’¥å°±æ˜¯(n, e) =  (3233,17)ï¼Œç§é’¥å°±æ˜¯(n, d)=(3233, 2753)ã€‚</p><h2 id="RSAç®—æ³•çš„å¯é æ€§"><a href="#RSAç®—æ³•çš„å¯é æ€§" class="headerlink" title="RSAç®—æ³•çš„å¯é æ€§"></a>RSAç®—æ³•çš„å¯é æ€§</h2><p>å›é¡¾ä¸Šé¢çš„å¯†é’¥ç”Ÿæˆæ­¥éª¤ï¼Œä¸€å…±å‡ºç°å…­ä¸ªæ•°å­—ï¼š</p><blockquote><p>p<br>q<br>n<br>Ï†(n)<br>e<br>d</p></blockquote><p>è¿™å…­ä¸ªæ•°å­—ä¹‹ä¸­ï¼Œå…¬é’¥ç”¨åˆ°äº†ä¸¤ä¸ªï¼ˆnå’Œeï¼‰ï¼Œå…¶ä½™å››ä¸ªæ•°å­—éƒ½æ˜¯ä¸å…¬å¼€çš„ã€‚å…¶ä¸­æœ€å…³é”®çš„æ˜¯dï¼Œå› ä¸ºnå’Œdç»„æˆäº†ç§é’¥ï¼Œä¸€æ—¦dæ³„æ¼ï¼Œå°±ç­‰äºç§é’¥æ³„æ¼ã€‚</p><p><strong>é‚£ä¹ˆï¼Œæœ‰æ— å¯èƒ½åœ¨å·²çŸ¥nå’Œeçš„æƒ…å†µä¸‹ï¼Œæ¨å¯¼å‡ºdï¼Ÿ</strong></p><blockquote><ol><li>edâ‰¡1 (mod Ï†(n))ã€‚åªæœ‰çŸ¥é“eå’ŒÏ†(n)ï¼Œæ‰èƒ½ç®—å‡ºdã€‚</li><li>Ï†(n)=(p-1)(q-1)ã€‚åªæœ‰çŸ¥é“på’Œqï¼Œæ‰èƒ½ç®—å‡ºÏ†(n)ã€‚</li><li>n=pqã€‚åªæœ‰å°†nå› æ•°åˆ†è§£ï¼Œæ‰èƒ½ç®—å‡ºpå’Œqã€‚</li></ol></blockquote><p><strong>ç»“è®ºï¼šå¦‚æœnå¯ä»¥è¢«å› æ•°åˆ†è§£ï¼Œdå°±å¯ä»¥ç®—å‡ºï¼Œä¹Ÿå°±æ„å‘³ç€ç§é’¥è¢«ç ´è§£ã€‚</strong></p><p>å¯æ˜¯ï¼Œå¤§æ•´æ•°çš„å› æ•°åˆ†è§£ï¼Œæ˜¯ä¸€ä»¶éå¸¸å›°éš¾çš„äº‹æƒ…ã€‚ç›®å‰ï¼Œé™¤äº†æš´åŠ›ç ´è§£ï¼Œè¿˜æ²¡æœ‰å‘ç°åˆ«çš„æœ‰æ•ˆæ–¹æ³•ã€‚ç»´åŸºç™¾ç§‘è¿™æ ·å†™é“ï¼š</p><blockquote><p>â€œå¯¹æå¤§æ•´æ•°åšå› æ•°åˆ†è§£çš„éš¾åº¦å†³å®šäº†RSAç®—æ³•çš„å¯é æ€§ã€‚æ¢è¨€ä¹‹ï¼Œå¯¹ä¸€æå¤§æ•´æ•°åšå› æ•°åˆ†è§£æ„ˆå›°éš¾ï¼ŒRSAç®—æ³•æ„ˆå¯é ã€‚</p><p>å‡å¦‚æœ‰äººæ‰¾åˆ°ä¸€ç§å¿«é€Ÿå› æ•°åˆ†è§£çš„ç®—æ³•ï¼Œé‚£ä¹ˆRSAçš„å¯é æ€§å°±ä¼šæåº¦ä¸‹é™ã€‚ä½†æ‰¾åˆ°è¿™æ ·çš„ç®—æ³•çš„å¯èƒ½æ€§æ˜¯éå¸¸å°çš„ã€‚ä»Šå¤©åªæœ‰çŸ­çš„RSAå¯†é’¥æ‰å¯èƒ½è¢«æš´åŠ›ç ´è§£ã€‚åˆ°2008å¹´ä¸ºæ­¢ï¼Œä¸–ç•Œä¸Šè¿˜æ²¡æœ‰ä»»ä½•å¯é çš„æ”»å‡»RSAç®—æ³•çš„æ–¹å¼ã€‚</p><p>åªè¦å¯†é’¥é•¿åº¦è¶³å¤Ÿé•¿ï¼Œç”¨RSAåŠ å¯†çš„ä¿¡æ¯å®é™…ä¸Šæ˜¯ä¸èƒ½è¢«è§£ç ´çš„ã€‚â€</p></blockquote><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä½ å¯ä»¥å¯¹3233è¿›è¡Œå› æ•°åˆ†è§£ï¼ˆ61Ã—53ï¼‰ï¼Œä½†æ˜¯ä½ æ²¡æ³•å¯¹ä¸‹é¢è¿™ä¸ªæ•´æ•°è¿›è¡Œå› æ•°åˆ†è§£ã€‚</p><blockquote><p>12301866845301177551304949<br>58384962720772853569595334<br>79219732245215172640050726<br>36575187452021997864693899<br>56474942774063845925192557<br>32630345373154826850791702<br>61221429134616704292143116<br>02221240479274737794080665<br>351419597459856902143413</p></blockquote><p>å®ƒç­‰äºè¿™æ ·ä¸¤ä¸ªè´¨æ•°çš„ä¹˜ç§¯ï¼š</p><blockquote><p>33478071698956898786044169<br>84821269081770479498371376<br>85689124313889828837938780<br>02287614711652531743087737<br>814467999489<br>Ã—<br>36746043666799590428244633<br>79962795263227915816434308<br>76426760322838157396665112<br>79233373417143396810270092<br>798736308917</p></blockquote><p>äº‹å®ä¸Šï¼Œè¿™å¤§æ¦‚æ˜¯äººç±»å·²ç»åˆ†è§£çš„æœ€å¤§æ•´æ•°ï¼ˆ232ä¸ªåè¿›åˆ¶ä½ï¼Œ768ä¸ªäºŒè¿›åˆ¶ä½ï¼‰ã€‚æ¯”å®ƒæ›´å¤§çš„å› æ•°åˆ†è§£ï¼Œè¿˜æ²¡æœ‰è¢«æŠ¥é“è¿‡ï¼Œå› æ­¤ç›®å‰è¢«ç ´è§£çš„æœ€é•¿RSAå¯†é’¥å°±æ˜¯768ä½ã€‚</p><h2 id="åŠ å¯†å’Œè§£å¯†"><a href="#åŠ å¯†å’Œè§£å¯†" class="headerlink" title="åŠ å¯†å’Œè§£å¯†"></a>åŠ å¯†å’Œè§£å¯†</h2><p>æœ‰äº†å…¬é’¥å’Œå¯†é’¥ï¼Œå°±èƒ½è¿›è¡ŒåŠ å¯†å’Œè§£å¯†äº†ã€‚</p><p><strong>åŠ å¯†è¦ç”¨å…¬é’¥ (n,e)</strong></p><p>å‡è®¾é²å‹ƒè¦å‘çˆ±ä¸½ä¸å‘é€åŠ å¯†ä¿¡æ¯mï¼Œä»–å°±è¦ç”¨çˆ±ä¸½ä¸çš„å…¬é’¥ (n,e) å¯¹mè¿›è¡ŒåŠ å¯†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œmå¿…é¡»æ˜¯æ•´æ•°ï¼ˆå­—ç¬¦ä¸²å¯ä»¥å–asciiå€¼æˆ–unicodeå€¼ï¼‰ï¼Œä¸”må¿…é¡»å°äºnã€‚</p><p>æ‰€è°“â€åŠ å¯†â€ï¼Œå°±æ˜¯ç®—å‡ºä¸‹å¼çš„cï¼š</p><script type="math/tex; mode=display">m^e \equiv c \pmod n</script><p>çˆ±ä¸½ä¸çš„å…¬é’¥æ˜¯ (3233, 17)ï¼Œé²å‹ƒçš„må‡è®¾æ˜¯65ï¼Œé‚£ä¹ˆå¯ä»¥ç®—å‡ºä¸‹é¢çš„ç­‰å¼ï¼š</p><script type="math/tex; mode=display">65^{17} \equiv 2790 \pmod {3233}</script><p>äºæ˜¯ï¼Œcç­‰äº2790ï¼Œé²å‹ƒå°±æŠŠ2790å‘ç»™äº†çˆ±ä¸½ä¸ã€‚</p><p><strong>è§£å¯†è¦ç”¨ç§é’¥(n,d)</strong></p><p>çˆ±ä¸½ä¸æ‹¿åˆ°é²å‹ƒå‘æ¥çš„2790ä»¥åï¼Œå°±ç”¨è‡ªå·±çš„ç§é’¥(3233, 2753) è¿›è¡Œè§£å¯†ã€‚å¯ä»¥è¯æ˜ï¼Œä¸‹é¢çš„ç­‰å¼ä¸€å®šæˆç«‹ï¼š</p><script type="math/tex; mode=display">c^d \equiv m \pmod n</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œcçš„dæ¬¡æ–¹é™¤ä»¥nçš„ä½™æ•°ä¸ºmã€‚ç°åœ¨ï¼Œcç­‰äº2790ï¼Œç§é’¥æ˜¯(3233, 2753)ï¼Œé‚£ä¹ˆï¼Œçˆ±ä¸½ä¸ç®—å‡º</p><script type="math/tex; mode=display">2790^{2753}\equiv65 \pmod {3233}</script><p>å› æ­¤ï¼Œçˆ±ä¸½ä¸çŸ¥é“äº†é²å‹ƒåŠ å¯†å‰çš„åŸæ–‡å°±æ˜¯65ã€‚</p><p>è‡³æ­¤ï¼Œâ€åŠ å¯†â€”è§£å¯†â€çš„æ•´ä¸ªè¿‡ç¨‹å…¨éƒ¨å®Œæˆã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸çŸ¥é“dï¼Œå°±æ²¡æœ‰åŠæ³•ä»cæ±‚å‡ºmã€‚è€Œå‰é¢å·²ç»è¯´è¿‡ï¼Œè¦çŸ¥é“då°±å¿…é¡»åˆ†è§£nï¼Œè¿™æ˜¯æéš¾åšåˆ°çš„ï¼Œæ‰€ä»¥RSAç®—æ³•ä¿è¯äº†é€šä¿¡å®‰å…¨ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå…¬é’¥(n,e) åªèƒ½åŠ å¯†å°äºnçš„æ•´æ•°mï¼Œé‚£ä¹ˆå¦‚æœè¦åŠ å¯†å¤§äºnçš„æ•´æ•°ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼šä¸€ç§æ˜¯æŠŠé•¿ä¿¡æ¯åˆ†å‰²æˆè‹¥å¹²æ®µçŸ­æ¶ˆæ¯ï¼Œæ¯æ®µåˆ†åˆ«åŠ å¯†ï¼›å¦ä¸€ç§æ˜¯å…ˆé€‰æ‹©ä¸€ç§â€å¯¹ç§°æ€§åŠ å¯†ç®—æ³•â€ï¼ˆæ¯”å¦‚<a href="https://zh.wikipedia.org/wiki/èµ„æ–™åŠ å¯†æ ‡å‡†">DES</a>ï¼‰ï¼Œç”¨è¿™ç§ç®—æ³•çš„å¯†é’¥åŠ å¯†ä¿¡æ¯ï¼Œå†ç”¨RSAå…¬é’¥åŠ å¯†DESå¯†é’¥ã€‚</p><h2 id="ç§é’¥è§£å¯†çš„è¯æ˜"><a href="#ç§é’¥è§£å¯†çš„è¯æ˜" class="headerlink" title="ç§é’¥è§£å¯†çš„è¯æ˜"></a>ç§é’¥è§£å¯†çš„è¯æ˜</h2><p>æœ€åï¼Œæˆ‘ä»¬æ¥è¯æ˜ï¼Œä¸ºä»€ä¹ˆç”¨ç§é’¥è§£å¯†ï¼Œä¸€å®šå¯ä»¥æ­£ç¡®åœ°å¾—åˆ°mã€‚ä¹Ÿå°±æ˜¯è¯æ˜ä¸‹é¢è¿™ä¸ªå¼å­ï¼š</p><script type="math/tex; mode=display">c^d\equiv m \pmod n</script><p>å› ä¸ºï¼Œæ ¹æ®åŠ å¯†è§„åˆ™</p><script type="math/tex; mode=display">m^e\equiv c \pmod n</script><p>äºæ˜¯ï¼Œcå¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">c = m^e -kn</script><p>å°†cä»£å…¥è¦æˆ‘ä»¬è¦è¯æ˜çš„é‚£ä¸ªè§£å¯†è§„åˆ™ï¼š</p><script type="math/tex; mode=display">(m^e-kn)^d=m \pmod n</script><p>å·¦è¾¹äºŒé¡¹å¼æ‹†å‡ºæ¥ï¼Œé™¤äº†ç¬¬ä¸€é¡¹$m^e$ï¼Œå…¶ä»–é¡¹éƒ½æ˜¯nçš„å€æ•°ï¼Œæ‰€ä»¥å®ƒç­‰åŒäºæ±‚è¯</p><script type="math/tex; mode=display">m^{ed} \equiv m \pmod n</script><p>ç”±äº</p><script type="math/tex; mode=display">ed \equiv 1 \pmod {Ï†(n)}</script><p>æ‰€ä»¥</p><script type="math/tex; mode=display">ed = h Ï†(n) + 1</script><p>å°†edä»£å…¥ï¼š</p><script type="math/tex; mode=display">m^{hÏ†(n)+1}=m \pmod n</script><p>æ¥ä¸‹æ¥ï¼Œåˆ†æˆä¸¤ç§æƒ…å†µè¯æ˜ä¸Šé¢è¿™ä¸ªå¼å­ã€‚</p><p><strong>ï¼ˆ1ï¼‰mä¸näº’è´¨ã€‚</strong></p><p>æ ¹æ®æ¬§æ‹‰å®šç†ï¼Œæ­¤æ—¶</p><script type="math/tex; mode=display">m^{Ï†(n)} \equiv 1 \pmod n</script><p>å¾—åˆ°</p><script type="math/tex; mode=display">(m^{Ï†(n)})^h*m \equiv m \pmod n</script><p>åŸå¼å¾—åˆ°è¯æ˜ã€‚</p><p><strong>ï¼ˆ2ï¼‰mä¸nä¸æ˜¯äº’è´¨å…³ç³»ã€‚</strong></p><p>æ­¤æ—¶ï¼Œç”±äºnç­‰äºè´¨æ•°på’Œqçš„ä¹˜ç§¯ï¼Œæ‰€ä»¥må¿…ç„¶ç­‰äºkpæˆ–kqã€‚</p><p>ä»¥ m = kpä¸ºä¾‹ï¼Œè€ƒè™‘åˆ°è¿™æ—¶kä¸qå¿…ç„¶äº’è´¨ï¼Œåˆ™æ ¹æ®æ¬§æ‹‰å®šç†ï¼Œä¸‹é¢çš„å¼å­æˆç«‹ï¼š</p><script type="math/tex; mode=display">(kp)^{q-1} \equiv 1 \pmod q</script><p>è¿›ä¸€æ­¥å¾—åˆ°</p><script type="math/tex; mode=display">[(kp)^{q-1}]^{h(p-1)}*kp \equiv kp \pmod q</script><p>å³</p><script type="math/tex; mode=display">(kp)^{ed} \equiv kp \pmod q</script><p>å°†å®ƒæ”¹å†™æˆä¸‹é¢çš„ç­‰å¼</p><script type="math/tex; mode=display">(kp)^{ed} = tq + kp</script><p>è¿™æ—¶tå¿…ç„¶èƒ½è¢«pæ•´é™¤ï¼Œå³ t=tâ€™p</p><script type="math/tex; mode=display">(kp)^{ed}=t'pq+kp</script><p>å› ä¸º m=kpï¼Œn=pqï¼Œæ‰€ä»¥</p><script type="math/tex; mode=display">m^{ed} \equiv m \pmod n</script><p>åŸå¼å¾—åˆ°è¯æ˜ã€‚</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1><ol><li><a href="https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSAç®—æ³•åŸç†ï¼ˆä¸€ï¼‰</a></li><li><a href="https://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">RSAç®—æ³•åŸç†ï¼ˆäºŒï¼‰</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> åŠ å¯†ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯†ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±åº¦å­¦ä¹ ä¸­å›¾åƒåˆ†ç±»é—®é¢˜çš„æ€»ç»“</title>
      <link href="/2022/08/16/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93/"/>
      <url>/2022/08/16/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><blockquote><p>ä¼ä¸šå®ä¹ ä¸­é‡åˆ°çš„åœºæ™¯ã€‚</p><p>è¾“å…¥æ˜¯ICUä¸­ç—…äººçš„ä¸€æ®µè§†é¢‘ï¼Œè¾“å‡ºæ˜¯åŸºäºåˆ¤æ–­è¯¥ç—…äººæ˜¯å¦è´«è¡€ã€‚</p><p>ç”²æ–¹ç»™å‡ºäº†300å¤šä¸ªçš„è§†é¢‘ï¼Œæ¯ä¸ªè§†é¢‘å¯¹åº”ä¸€ä¸ªç—…äººã€‚å…¶ä¸­é‡åº¦è´«è¡€æ ·æœ¬æœ€å°‘ï¼Œè½»åº¦è´«è¡€çš„æ ·æœ¬é‡æœ€å¤šã€‚</p><p>ï¼ˆè¯´å®åœ¨çš„ï¼Œè¿™ä¸ªä»»åŠ¡å®åœ¨æ˜¯æœ‰ç‚¹ç„å­¦ï¼ŒæŸ¥äº†ä¸€äº›èµ„æ–™ï¼Œä¹Ÿæ²¡æœ‰ç†è®ºä¾æ®ã€‚ä½†æ˜¯ç”²æ–¹è¯´æœ‰ç»éªŒçš„åŒ»ç”Ÿçœ‹å‡ çœ¼å°±èƒ½çœ‹å‡ºæ¥<strong>ç—…äºº</strong>æ˜¯å¦æ˜¯è´«è¡€ï¼Œæ‰€ä»¥åªèƒ½ç¡¬ç€å¤´çš®åšã€‚ï¼‰</p><p>åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°äº†ä¸“å®¶çš„æŒ‡ç‚¹ï¼Œæ•…æŠŠä¸“å®¶ç»™å‡ºçš„æŠ€å·§å’Œå®è·µä¸­é‡åˆ°çš„è‹¥å¹²é—®é¢˜å’Œè§£å†³æ€è·¯è®°å½•ä¸‹æ¥ã€‚</p></blockquote><h1 id="æ•°æ®å¤„ç†å’Œç®—æ³•æµç¨‹"><a href="#æ•°æ®å¤„ç†å’Œç®—æ³•æµç¨‹" class="headerlink" title="æ•°æ®å¤„ç†å’Œç®—æ³•æµç¨‹"></a>æ•°æ®å¤„ç†å’Œç®—æ³•æµç¨‹</h1><p>å¦‚å›¾ã€‚åœ†è§’çŸ©å½¢æ˜¯æ•°æ®ï¼ŒçŸ©å½¢æ˜¯å¤„ç†æµç¨‹</p><p><img src="image-20220816222412537.png" alt="æ•°æ®å¤„ç†å’Œç®—æ³•æµç¨‹"></p><h1 id="æŒ‡å¯¼çºªè¦"><a href="#æŒ‡å¯¼çºªè¦" class="headerlink" title="æŒ‡å¯¼çºªè¦"></a>æŒ‡å¯¼çºªè¦</h1><p>æœ¬èŠ‚è®°å½•ä¸“å®¶ç»™å‡ºçš„ä¸€äº›æŒ‡å¯¼è¦ç‚¹ã€‚</p><h2 id="æ˜ç¡®éœ€æ±‚"><a href="#æ˜ç¡®éœ€æ±‚" class="headerlink" title="æ˜ç¡®éœ€æ±‚"></a>æ˜ç¡®éœ€æ±‚</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œéœ€è¦æ˜ç¡®éœ€æ±‚ï¼Œé’ˆå¯¹æœ¬æ¬¡ä»»åŠ¡ä¸»è¦æ˜¯æ˜ç¡®ä¸€ä¸‹å‡ ç‚¹ï¼š</p><ol><li>ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿæœ€ç»ˆçš„ç®—æ³•æ¨¡å‹æ˜¯ç§‘ç ”ï¼Œè¿˜æ˜¯è½åœ°åº”ç”¨ã€‚å¦‚æœæ˜¯è½åœ°åº”ç”¨ï¼Œé‚£ä¹ˆå¯èƒ½æ›´çœ‹é‡é‡åº¦è´«è¡€çš„å¬å›ã€‚</li><li>æ˜ç¡®è¾“å…¥ï¼šæ˜¯ä¸€æ®µè§†é¢‘ï¼Œè¿˜æ˜¯ä¸€å¼ ç…§ç‰‡ï¼Œå¦‚æœæ˜¯ä¸€æ®µè§†é¢‘è¿˜è¦è€ƒè™‘æ—¶åºä¿¡æ¯ã€‚</li><li>é¢„æµ‹æ ·æœ¬æ˜¯å·²çŸ¥çš„è¿˜æ˜¯æœªçŸ¥çš„ï¼šæœªçŸ¥ã€‚</li><li>æ˜¯å¦èƒ½æœ‰æ›´å¤šçš„æ•°æ®ï¼Ÿèƒ½ï¼Œä½†æ¯”è¾ƒæ…¢ï¼Œæ¯•ç«Ÿå®é™…æƒ…å†µå°±æ˜¯ICUçš„ç—…åºŠæ•°é‡æ¯”è¾ƒå°‘ã€‚æ€»æ ·æœ¬é‡å°±é‚£äº›ã€‚</li></ol><h2 id="åˆ†æbad-case"><a href="#åˆ†æbad-case" class="headerlink" title="åˆ†æbad case"></a>åˆ†æbad case</h2><p>æ‰¾ä¸€ä¸ªæ¨¡å‹å¿«é€Ÿå®ç°ï¼Œï¼ˆæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯Efficient Netï¼‰ï¼ŒåŸºäºè¿™ä¸ªbaselineï¼Œåˆ†æbad caseã€‚</p><p>æ‰€è°“bad case å°±æ˜¯æ¨¡å‹ç»è¿‡è®­ç»ƒåï¼Œé¢„æµ‹é”™çš„caseã€‚åˆ†æbad caseéå¸¸é‡è¦ã€‚ï¼ˆè¿™ä¸€ç‚¹åœ¨æˆ‘å®è·µçš„è¿‡ç¨‹ä¸­æ²¡æœ‰é‡è§†ï¼ŒåŸå› æ˜¯ICUçš„ç—…äººçš„è§†é¢‘å’Œç…§ç‰‡å®¹æ˜“å¼•èµ·ä¸é€‚ï¼‰</p><p>åˆ†æbad caseçš„ç›®çš„æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><ol><li>ç¡®å®šç®—æ³•ä¸Šé™ï¼š<strong>æ•°æ®å†³å®šç®—æ³•ä¸Šé™ï¼Œæ¨¡å‹åªæ˜¯åœ¨é€¼è¿‘è¿™ä¸ªä¸Šé™ã€‚</strong>æˆ‘ä»¬çš„æ¨¡å‹åšåˆ°ä»€ä¹ˆæ ·æ‰ç®—å¯ä»¥äº¤å·®äº†ï¼Œä¸æ˜¯æ‹è„‘è¢‹å†³å®šçš„ï¼Œè€Œæ˜¯ç”±æœ¬æ­¥éª¤å¾—åˆ°çš„ç®—æ³•ä¸Šé™å†³å®šçš„ã€‚</li><li>å¦‚æœäººçœ¼åˆ†è¾¨èµ·æ¥éƒ½æ¯”è¾ƒå›°éš¾ï¼Œé‚£è¯¥ä»»åŠ¡å¯èƒ½æ˜¯ä¸å¯å®ç°çš„ã€‚</li><li>çº æ­£æ•°æ®ï¼ˆæ ‡æ³¨ï¼‰é—®é¢˜ã€‚åœ¨åˆ†æbad caseçš„æ—¶å€™æˆ‘å‘ç°æœ‰ä¸€äº›è§†é¢‘å¸§éå¸¸æ¨¡ç³Šï¼Œåé¢é€šè¿‡è®¡ç®—æ¸…æ™°åº¦ï¼Œå°†è§†é¢‘å¸§ä¸­æ¯”è¾ƒæ¨¡ç³Šçš„å›¾åƒå»é™¤æ‰äº†ã€‚</li></ol><h2 id="è°ƒå‚"><a href="#è°ƒå‚" class="headerlink" title="è°ƒå‚"></a>è°ƒå‚</h2><p>åœ¨æ˜ç¡®äº†ç®—æ³•ä¸Šé™ä¹‹åï¼Œå†è¿›è¡Œè°ƒå‚ã€‚</p><ol><li>trainé˜¶æ®µï¼š<ol><li>é’ˆå¯¹æ•°æ®ä¸å‡è¡¡çš„é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼šå¯¹æ¯ä¸€ä¸ªç±»åˆ«è¿›è¡ŒåŠ æƒï¼›æŠŠå æ¯”å¤§çš„åˆ†ç±»æ ·æœ¬é‡è°ƒä½ï¼›æ•°æ®å¢å¼ºã€‚ï¼ˆå‰ä¸¤ç§åœ¨ä»¥å‰çš„å®è·µä¸­æå‡ä¸å¤§ï¼Œæœ€åä¸€ç§PyTorchæœ‰ç°æˆçš„codeï¼‰</li><li>é’ˆå¯¹æ¨¡å‹ï¼Œä¸€èˆ¬æ¥è¯´<strong>æ¨¡å‹çš„åˆ†ç±»åŠ›åº¦è¦æ¯”éœ€æ±‚çš„ç²’åº¦æ›´ç»†</strong>ï¼Œåœ¨è¯¥åœºæ™¯ä¸‹ï¼Œéœ€æ±‚è¦æ±‚äºŒåˆ†ç±»ï¼Œè€Œæ¨¡å‹å–å››åˆ†ç±»ã€‚æ–¹ä¾¿åç»­çš„è°ƒæ•´ã€‚</li><li>æµ‹è¯•åï¼Œç”»å‡º<strong>æ··æ·†çŸ©é˜µ</strong>ï¼Œçœ‹å“ªå‡ ä¸ªå­ç±»å®¹æ˜“æ··æ·†ï¼Œå†å¯¹æ··æ·†çš„å­ç±»å•ç‹¬è®­ç»ƒæ¨¡å‹ã€‚ï¼ˆå¤šä¸ªæ¨¡å‹çº§è”ï¼‰</li><li>æ›´æ¢lossï¼šæˆ‘ä»¬å°è¯•äº†æŠŠäº¤å‰ç†µæŸå¤±æ¢æˆcenter lossã€focal lossï¼Œä½†æ•ˆæœä¹Ÿæ²¡æœ‰å¥½åˆ°å“ªå»ã€‚</li></ol></li><li>valé˜¶æ®µï¼š<ol><li>lossï¼šåœ¨è¯¥åœºæ™¯ä¸‹ï¼Œæ¨¡å‹ä¼šç»™å‡ºå››ä¸ªåˆ†æ•°ï¼Œåˆ†åˆ«å¯¹åº”å››ä¸ªç±»åˆ«çš„å¯èƒ½æ€§ã€‚ä¸€èˆ¬æ˜¯å–å››ä¸ªåˆ†æ•°ä¸­maxå¯¹åº”çš„åˆ†ç±»ï¼Œä½œä¸ºæœ€åçš„åˆ†ç±»ç»“æœã€‚<strong>ä¿®æ”¹é˜ˆå€¼</strong>ä»¥æ”¹å˜æœ€åçš„åˆ†ç±»ç»“æœï¼ˆæ¯”å¦‚ï¼Œå½“é‡åº¦è´«è¡€çš„æ¦‚ç‡å¤§äºäººä¸ºè®¾å®šçš„Xæ—¶ï¼Œå°±è®¤ä¸ºåˆ†ç±»ç»“æœä¸ºé‡åº¦è´«è¡€ï¼‰ã€‚</li><li>Xæ€ä¹ˆå®šï¼ŸXçš„å€¼å–å†³äºæŒ‡æ ‡ã€‚æ¯”å¦‚æˆ‘æƒ³è¦é‡åº¦è´«è¡€çš„Recallè¾¾åˆ°99%ï¼Œé‚£æˆ‘æŠŠé¢„æµ‹çš„é‡åº¦è´«è¡€çš„åˆ†æ•°ç”±é«˜åˆ°ä½æ’åºï¼Œç”»ä¸€ä¸ªæœ€ä½çº¿ï¼Œåœ¨è¯¥çº¿ä¹‹ä¸Šéƒ½è¢«é¢„æµ‹ä¸ºé‡åº¦è´«è¡€ï¼Œé‚£ä¹ˆè¯¥çº¿å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„Xã€‚</li><li>lossï¼šä¹Ÿå¯ä»¥ç»™å››ä¸ªåˆ†æ•°åˆ†åˆ«ä¹˜ä¸Šå››ä¸ªæƒé‡ã€‚è¿™æ¡ä¸ä¸Šæ¡çš„åŒºåˆ«æ˜¯ï¼Œä¸Šä¸€æ¡å¯ä»¥è½»æ˜“çš„ç¡®ä¿Precisionæˆ–Recallã€‚</li></ol></li></ol><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="æ‰‹å·¥æå–ç‰¹å¾V-S-è‡ªåŠ¨æå–ç‰¹å¾"><a href="#æ‰‹å·¥æå–ç‰¹å¾V-S-è‡ªåŠ¨æå–ç‰¹å¾" class="headerlink" title="æ‰‹å·¥æå–ç‰¹å¾V.S.è‡ªåŠ¨æå–ç‰¹å¾"></a>æ‰‹å·¥æå–ç‰¹å¾V.S.è‡ªåŠ¨æå–ç‰¹å¾</h3><p>ä¸Šé¢çš„<em>æ•°æ®å¤„ç†æµç¨‹å›¾</em>ä¸­å¯è§ï¼Œä¸ºäº†é¿å…èƒŒæ™¯ï¼ˆç—…åºŠç­‰ï¼‰å¹²æ‰°ï¼Œæˆ‘ä»¬å…ˆç”¨ç½‘ä¸Šä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹æå–äººè„¸ã€‚å†æŠŠæå–çš„äººè„¸æ‹¿å»è®­ç»ƒã€‚</p><p>ç”±äºæå–çš„æ•ˆæœæœ‰é™ï¼Œåæ¥åˆä½¿ç”¨K-meansç®—æ³•å¯¹é¢œè‰²è¿›è¡Œèšç±»ï¼Œè®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼ŒæŠŠå¤§éƒ¨åˆ†å›¾åƒä¸­ç—…äººçš„æ’ç®¡ï¼Œå£ç½©ç­‰å»æ‰ï¼Œç”¨é»‘è‰²èƒŒæ™¯ä»£æ›¿ã€‚ï¼ˆå½“ç„¶æ•ˆæœä¾ç„¶æœ‰é™ï¼‰</p><p>ä¸€å¼€å§‹æˆ‘ä»¬è®¤ä¸ºé€šè¿‡æ‰‹å·¥æå–ç‰¹å¾åï¼Œå†ä¸¢åˆ°ç½‘ç»œé‡Œè®­ç»ƒï¼Œè¿™æ ·çš„æ•ˆæœä¼šæ›´å¥½ã€‚</p><p>ä½†ä¸“å®¶è®¤ä¸ºå¹¶éå¦‚æ­¤ï¼Œå®é™…æ•ˆæœä¹Ÿç¡®å®å¦‚ä¸“å®¶æ‰€æ–™ã€‚</p><p>ä¸“å®¶è¯´ï¼Œæ‰‹å·¥æå–ç‰¹å¾çš„ç¼ºç‚¹æ˜¯ï¼Œæå–ç‰¹å¾çš„åŒæ—¶ä¼šæŸå®³å›¾åƒæœ¬èº«ï¼ˆå›¾åƒå‡ºç°ä¸€å°å—ä¸€å°å—çš„é»‘è‰²èƒŒæ™¯ï¼‰ï¼›å…¶æ¬¡ï¼Œæ‰‹å·¥æå–ç‰¹å¾éœ€è¦æ‰‹å·¥è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œè€Œè¿™ä¸ªé˜ˆå€¼çš„æœ€ä½³æƒ…å½¢åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†å¯èƒ½æ˜¯ä¸åŒçš„ã€‚</p><p>ä¸“å®¶åˆè¯´ï¼Œ<strong>åœ¨ä»¥å¾€çš„å®è·µä¸­ï¼Œæ·±åº¦å­¦ä¹ çš„è‡ªåŠ¨æå–ç‰¹å¾æ•ˆæœæ›´å¥½ã€æ›´ç¨³å®šã€‚</strong></p><h3 id="ä¸‰ç™¾ä¸ªæ ·æœ¬å¤Ÿä¸å¤Ÿç”¨"><a href="#ä¸‰ç™¾ä¸ªæ ·æœ¬å¤Ÿä¸å¤Ÿç”¨" class="headerlink" title="ä¸‰ç™¾ä¸ªæ ·æœ¬å¤Ÿä¸å¤Ÿç”¨"></a>ä¸‰ç™¾ä¸ªæ ·æœ¬å¤Ÿä¸å¤Ÿç”¨</h3><p><strong>æ ·æœ¬å¤Ÿä¸å¤Ÿå–å†³äºé—®é¢˜çš„éš¾åº¦ã€‚</strong>æ²¡æœ‰ç»å¯¹æ„ä¹‰ä¸Šçš„å¤Ÿä¸å¤Ÿã€‚</p><h3 id="é¢„è®­ç»ƒORæ²¡æœ‰é¢„è®­ç»ƒ"><a href="#é¢„è®­ç»ƒORæ²¡æœ‰é¢„è®­ç»ƒ" class="headerlink" title="é¢„è®­ç»ƒORæ²¡æœ‰é¢„è®­ç»ƒ"></a>é¢„è®­ç»ƒORæ²¡æœ‰é¢„è®­ç»ƒ</h3><p><strong>ä½¿ç”¨é¢„è®­ç»ƒçš„ç½‘ç»œæ¨¡å‹è¦æ¯”æ²¡æœ‰é¢„è®­ç»ƒçš„æ¨¡å‹æ›´å¥½ã€‚</strong>ï¼ˆå…·ä½“åŸå› å¿˜äº†ã€‚ï¼‰</p><h3 id="äº¤å‰éªŒè¯"><a href="#äº¤å‰éªŒè¯" class="headerlink" title="äº¤å‰éªŒè¯"></a>äº¤å‰éªŒè¯</h3><p>è™½ç„¶æ•°æ®éƒ½æ˜¯éšæœºçš„åˆ†åˆ°trainæˆ–è€…valï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢ï¼Œåˆ†åˆ°trainçš„æ•°æ®å¤ªç®€å•ã€valçš„æ•°æ®å¤ªéš¾å’Œåˆ†åˆ°trainçš„æ•°æ®å¤ªéš¾ã€valçš„æ•°æ®å¤ªç®€å•ï¼Œä¼šå¯¼è‡´æ¨¡å‹æœ€åçš„æ•ˆæœä¸ä¸€æ ·ã€‚<strong>ä¸ºäº†æé«˜æ¨¡å‹çš„é²æ£’æ€§ï¼Œéœ€è¦K-Foldäº¤å‰éªŒè¯ã€‚</strong></p><h3 id="å¤šæ¬¡è¿­ä»£è®­ç»ƒ"><a href="#å¤šæ¬¡è¿­ä»£è®­ç»ƒ" class="headerlink" title="å¤šæ¬¡è¿­ä»£è®­ç»ƒ"></a>å¤šæ¬¡è¿­ä»£è®­ç»ƒ</h3><p>ç”±æ˜“åˆ°éš¾å¤šè½®è¿­ä»£ã€‚</p><p>å…ˆäººå·¥ç­›é€‰å‡ºä¸€äº›<strong>ç®€å•</strong>æ ·æœ¬ï¼ŒæŒ‰ç…§ä¸€å®šæ¯”ä¾‹ç»„ç»‡æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°ä¸€ä¸ªå¯ä»¥åˆ†ç±»ç®€å•æ ·æœ¬çš„æ¨¡å‹ã€‚</p><p>å†ç­›é€‰å‡ºæ¯”ç®€å•æ ·æœ¬ç¨éš¾ä¸€ç‚¹çš„æ ·æœ¬ï¼ŒæŒ‰ç…§ä¸€å®šæ¯”ä¾‹ç»„ç»‡æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°ä¸€ä¸ªå¯ä»¥åˆ†ç±»æ¯”ç®€å•æ ·æœ¬ç¨éš¾æ ·æœ¬çš„æ¨¡å‹ã€‚</p><p>â€¦â€¦</p><p>ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰æ ·æœ¬éƒ½ä¸¢è¿›å»è®­ç»ƒã€‚</p><blockquote><p>è¿™é‡Œæ‰€è¯´çš„ç®€å•æ˜¯äººå®¹æ˜“åˆ†è¾¨çš„ã€‚</p><p>å¦‚æœæ‰€æœ‰æ ·æœ¬äººéƒ½ä¸å®¹æ˜“çœ‹å‡ºæ¥æ€ä¹ˆåŠï¼Ÿ</p><p>é‚£å°±å…ˆè¿›è¡Œä¸€æ¬¡æ•´ä½“çš„è®­ç»ƒã€‚æ‰¾åˆ°æœ¬æ¬¡è®­ç»ƒä¸­æ¨¡å‹é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬ï¼Œè¿™æ ·çš„æ ·æœ¬å³ä¸ºæ¨¡å‹è®¤ä¸ºçš„ç®€å•æ ·æœ¬</p></blockquote><p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œæ•ˆæœä¼šæ›´å¥½ã€‚ï¼ˆä¸“å®¶çš„åŸè¯æ˜¯ï¼Œå±¡è¯•ä¸çˆ½ï¼‰</p><p>æˆ‘æƒ³å¯èƒ½æ˜¯å› ä¸ºå®ƒæ¯”è¾ƒç¬¦åˆäººç”±æ˜“åˆ°éš¾çš„å­¦ä¹ æ€è·¯ã€‚</p><p>ç¼ºç‚¹å°±æ˜¯è€—æ—¶é•¿ï¼Œäººå¹²é¢„çš„æ—¶é—´é•¿ã€‚ï¼ˆæ¯•ç«Ÿéœ€è¦æŒ‘æ ·æœ¬ï¼ŒæŒºç´¯çš„ã€‚ã€‚ï¼‰</p><h3 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h3><p>å¦‚æœå¸Œæœ›æ¨¡å‹é›†ä¸­åˆ°æŸäº›å±€éƒ¨ç‰¹å¾å¯ä»¥ä½¿ç”¨attentionæœºåˆ¶ã€‚</p><h3 id="å¯¹äºä¸æ¸…æ¥šçš„ä»£ç æˆ–è€…å‚æ•°"><a href="#å¯¹äºä¸æ¸…æ¥šçš„ä»£ç æˆ–è€…å‚æ•°" class="headerlink" title="å¯¹äºä¸æ¸…æ¥šçš„ä»£ç æˆ–è€…å‚æ•°"></a>å¯¹äºä¸æ¸…æ¥šçš„ä»£ç æˆ–è€…å‚æ•°</h3><p>ç»†ç©¶è®ºæ–‡ã€æºç ã€‚</p><h1 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h1>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> è®¡ç®—æœºè§†è§‰ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ›æ‰£-å‰Kä¸ªé«˜é¢‘å…ƒç´ -ç”¨æµæ¥åš</title>
      <link href="/2022/07/11/%E5%8A%9B%E6%89%A3-%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0-%E7%94%A8%E6%B5%81%E6%9D%A5%E5%81%9A/"/>
      <url>/2022/07/11/%E5%8A%9B%E6%89%A3-%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0-%E7%94%A8%E6%B5%81%E6%9D%A5%E5%81%9A/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä½¿ç”¨Java8 Streamæ¥å®ŒæˆåŠ›æ‰£ <a href="https://leetcode.cn/problems/top-k-frequent-elements/">347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ </a></p></blockquote><h1 id="é¢˜ç›®åŠæ€è·¯"><a href="#é¢˜ç›®åŠæ€è·¯" class="headerlink" title="é¢˜ç›®åŠæ€è·¯"></a>é¢˜ç›®åŠæ€è·¯</h1><blockquote><p>ç»™ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç­”æ¡ˆã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>è¾“å…¥: nums = [1,1,1,2,2,3], k = 2</p><p>è¾“å‡º: [1,2]</p></blockquote><p>æ€è·¯å¾ˆç®€å•ï¼š</p><p>å°†<key: å…ƒç´ ï¼Œvalue: å…ƒç´ å‡ºç°çš„æ¬¡æ•°>å­˜åˆ°Mapä¸­ï¼Œå°†mapæŒ‰valueå€’åºæ’åºï¼Œè¾“å‡ºå‰kä¸ªè¿”å›ã€‚</p><h1 id="ç»å…¸åšæ³•"><a href="#ç»å…¸åšæ³•" class="headerlink" title="ç»å…¸åšæ³•"></a>ç»å…¸åšæ³•</h1><p>ä¸‹é¢æ˜¯æ ¹æ®ä¸Šé¢çš„æ€è·¯å®ç°çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(k == <span class="number">0</span> || nums.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> tmp[] = &#123;&#125;;</span><br><span class="line">            <span class="keyword">return</span> tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ›å»ºè¿”å›çš„resæ•°ç»„</span></span><br><span class="line">        <span class="type">int</span> res[] = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="comment">//åˆ›å»ºmap</span></span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//å°†numsæ•°ç»„ä¸­å…ƒç´ å’Œå…ƒç´ å‡ºç°çš„æ¬¡æ•°ä¿å­˜åˆ°mapä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(num)) &#123;</span><br><span class="line">                map.put(num, map.get(num)+<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                map.put(num, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ›å»ºmap.entrySet()çš„listç”¨äºæ’åº</span></span><br><span class="line">        List&lt;Map.Entry&lt;Integer, Integer&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(map.entrySet());</span><br><span class="line">        <span class="comment">//æŒ‰mapçš„å€¼å€’åºæ’åº</span></span><br><span class="line">        Collections.sort(list, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Map.Entry&lt;Integer, Integer&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Map.Entry&lt;Integer, Integer&gt; o1, Map.Entry&lt;Integer, Integer&gt; o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o2.getValue() - o1.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//å–å‡ºå‰kä¸ªæ”¾åˆ°resä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            res[i] = list.get(i).getKey();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨Stream"><a href="#ä½¿ç”¨Stream" class="headerlink" title="ä½¿ç”¨Stream"></a>ä½¿ç”¨Stream</h1><p>ä½¿ç”¨Streamå®ç°çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(nums) <span class="comment">// IntStream</span></span><br><span class="line">                .boxed() <span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">                .collect(Collectors.toMap(key -&gt; key, value -&gt; <span class="number">1</span>, Integer::sum)) <span class="comment">// Map&lt;Integer, Integer&gt;</span></span><br><span class="line">                .entrySet() <span class="comment">// Set&lt;Map&lt;K, V&gt;.Entry&lt;Integer, Integer&gt;&gt;</span></span><br><span class="line">                .stream() <span class="comment">// Stream&lt;Map&lt;K, V&gt;.Entry&lt;Integer, Integer&gt;&gt;</span></span><br><span class="line">                .sorted(Map.Entry.comparingByValue(Comparator.reverseOrder()))</span><br><span class="line">                .map(Map.Entry::getKey) <span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">                .limit(k)</span><br><span class="line">                .mapToInt(i -&gt; i) <span class="comment">//IntStream</span></span><br><span class="line">                .toArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯éå¸¸çš„ç®€æ´æ˜äº†ï¼Ÿä¸‹é¢å¯¹ä»£ç åšä¸€ä¸‹å¿…è¦è§£é‡Š</p><ul><li><p>ä¸ºäº†å°†<code>int[]</code>è½¬ä¸ºæµï¼Œä½¿ç”¨äº†<code>Arrays.stream(nums)</code></p></li><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ™®é€šçš„æµæ€»æ˜¯åŒ…è£…ç±»ï¼Œä½†è¿™é‡Œç›´æ¥å¾—åˆ°äº†IntStreamï¼Œä¸ºäº†åé¢å°è£…ä¸º<code>Map&lt;Integer, Integer&gt;</code>ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code>boxed()</code>å°†IntStreamè½¬ä¸º<code>Stream&lt;Integer&gt;</code></p></li><li><p><code>collect</code>å°†Streamæ”¶é›†åˆ°ä¸€ä¸ªMap</p></li><li><p><code>Collectors.toMap</code>çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼Œæ”¶é›†åˆ°Mapçš„keyï¼Œvalueå½“é‡åˆ°é‡å¤keyæ—¶çš„å¤„ç†æ–¹æ³•ï¼›</p></li><li><p>3-5è¡Œçš„ä»£ç ç­‰ä»·äºä¸‹é¢</p><ul><li><pre><code class="lang-java">Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();Arrays.stream(nums).forEach(num -&gt; &#123;    map.put(num, map.getOrDefault(num, 0) + 1);&#125;);</code></pre></li></ul></li><li><p>ä¸ºäº†ä»mapä¸­å†æ¬¡è·å¾—æµï¼Œæˆ‘ä»¬ä½¿ç”¨ä»£ç å…ˆå¾—åˆ°mapçš„setåœ¨è·å¾—æµã€‚ä»£ç å¯¹åº”<code>entryset()</code>å’Œ<code>stream()</code></p></li><li><p>è·å¾—æµä¹‹åéœ€è¦æ ¹æ®valueè¿›è¡Œå€’åºæ’åºï¼Œä½¿ç”¨<code>sorted()</code>ï¼Œå…¶ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå™¨</p></li><li><p>æ’åºä¹‹åæ˜ å°„ä½¿ç”¨map()å°†<code>Stream&lt;Map&lt;K, V&gt;.Entry&lt;Integer, Integer&gt;&gt;</code>æ˜ å°„ä¸º<code>Stream&lt;Integer&gt;</code></p></li><li><p>æˆ‘ä»¬åªéœ€è¦å‰kä¸ªï¼Œæ‰€ä»¥ç”¨limit(k)</p></li><li><p>ä½¿ç”¨<code>mapToInt(i -&gt; i)</code>è¿›è¡Œæ‹†åŒ…ï¼Œå¾—åˆ°IntStream</p></li><li><p><code>toArray()</code>è½¬æ¢ä¸ºæ•°ç»„å¹¶è¿”å›ã€‚</p></li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Java8 Streamåœ¨å¤„ç†é›†åˆæ–¹é¢æœ‰ç€å¾ˆå¤§çš„ä¼˜åŠ¿ï¼š</p><ul><li>é€»è¾‘æ¸…æ™°</li><li>ä»£ç ç®€æ´</li><li>â€¦â€¦</li></ul><p>ä½†æˆ‘åˆšæ¥è§¦ï¼Œä½¿ç”¨èµ·æ¥ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿˜éœ€è¦å†å¤šç»ƒä¹ ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>null</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†åº“åˆ†è¡¨æ€»ç»“</title>
      <link href="/2022/07/10/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%80%BB%E7%BB%93/"/>
      <url>/2022/07/10/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨"><a href="#ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨"></a>ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨</h1><p>ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œæµ·é‡çš„ç”¨æˆ·æ¯å¤©äº§ç”Ÿæµ·é‡çš„æ•°é‡ï¼Œæ¯”å¦‚ï¼šç”¨æˆ·è¡¨ã€è®¢å•è¡¨ã€äº¤æ˜“æµæ°´è¡¨ã€‚</p><p>ä»¥æ”¯ä»˜å®ç”¨æˆ·ä¸ºä¾‹ï¼Œ8äº¿ï¼›å¾®ä¿¡ç”¨æˆ·æ›´æ˜¯10äº¿ã€‚è®¢å•è¡¨æ›´å¤¸å¼ ï¼Œæ¯”å¦‚ç¾å›¢å¤–å–ï¼Œæ¯å¤©éƒ½æ˜¯å‡ åƒä¸‡çš„è®¢å•ã€‚æ·˜å®çš„å†å²è®¢å•æ€»é‡åº”è¯¥ç™¾äº¿ï¼Œç”šè‡³åƒäº¿çº§åˆ«ï¼Œè¿™äº›æµ·é‡æ•°æ®è¿œä¸æ˜¯ä¸€å¼ è¡¨èƒ½Holdä½çš„ã€‚</p><p>äº‹å®ä¸ŠMySQLå•è¡¨å¯ä»¥å­˜å‚¨10äº¿çº§æ•°æ®ï¼Œåªæ˜¯è¿™æ—¶å€™æ€§èƒ½æ¯”è¾ƒå·®ï¼Œ<strong>ä¸šç•Œå…¬è®¤MySQLå•è¡¨å®¹é‡åœ¨1KWä»¥ä¸‹æ˜¯æœ€ä½³çŠ¶æ€ï¼Œå› ä¸ºè¿™æ—¶å®ƒçš„BTREEç´¢å¼•æ ‘é«˜åœ¨3~5ä¹‹é—´ã€‚</strong></p><p>æ—¢ç„¶<strong>ä¸€å¼ è¡¨æ— æ³•æå®šï¼Œé‚£ä¹ˆå°±æƒ³åŠæ³•å°†æ•°æ®æ”¾åˆ°å¤šä¸ªåœ°æ–¹</strong>ï¼Œç›®å‰æ¯”è¾ƒæ™®éçš„æ–¹æ¡ˆæœ‰3ä¸ªï¼š</p><blockquote><ol><li>åˆ†åŒºï¼›</li><li>åˆ†åº“åˆ†è¡¨ï¼›</li><li>NoSQL/NewSQLï¼›NoSQLæ¯”è¾ƒå…·æœ‰ä»£è¡¨æ€§çš„æ˜¯MongoDBï¼Œesã€‚NewSQLæ¯”è¾ƒå…·æœ‰ä»£è¡¨æ€§çš„æ˜¯TiDBã€‚</li></ol></blockquote><h2 id="æ•°æ®åº“æ¶æ„æ¼”å˜ï¼šä»è¯»å†™åˆ†ç¦»åˆ°åˆ†åº“åˆ†è¡¨"><a href="#æ•°æ®åº“æ¶æ„æ¼”å˜ï¼šä»è¯»å†™åˆ†ç¦»åˆ°åˆ†åº“åˆ†è¡¨" class="headerlink" title="æ•°æ®åº“æ¶æ„æ¼”å˜ï¼šä»è¯»å†™åˆ†ç¦»åˆ°åˆ†åº“åˆ†è¡¨"></a>æ•°æ®åº“æ¶æ„æ¼”å˜ï¼šä»è¯»å†™åˆ†ç¦»åˆ°åˆ†åº“åˆ†è¡¨</h2><p>åˆšå¼€å§‹æˆ‘ä»¬åªç”¨å•æœºæ•°æ®åº“å°±å¤Ÿäº†ï¼Œéšåé¢å¯¹è¶Šæ¥è¶Šå¤šçš„è¯·æ±‚ï¼Œæˆ‘ä»¬å°†æ•°æ®åº“çš„<strong>å†™æ“ä½œå’Œè¯»æ“ä½œè¿›è¡Œåˆ†ç¦»</strong>ï¼Œ ä½¿ç”¨å¤šä¸ªä»åº“å‰¯æœ¬<strong>ï¼ˆSlaver Replicationï¼‰</strong>è´Ÿè´£è¯»ï¼Œä½¿ç”¨ä¸»åº“<strong>ï¼ˆMasterï¼‰</strong>è´Ÿè´£å†™ï¼Œ ä»åº“ä»ä¸»åº“åŒæ­¥æ›´æ–°æ•°æ®ï¼Œä¿æŒæ•°æ®ä¸€è‡´ã€‚æ¶æ„ä¸Šå°±æ˜¯æ•°æ®åº“ä¸»ä»åŒæ­¥ã€‚ ä»åº“å¯ä»¥æ°´å¹³æ‰©å±•ï¼Œæ‰€ä»¥æ›´å¤šçš„è¯»è¯·æ±‚ä¸æˆé—®é¢˜ã€‚</p><p>ä½†æ˜¯å½“ç”¨æˆ·é‡çº§ä¸Šæ¥åï¼Œå†™è¯·æ±‚è¶Šæ¥è¶Šå¤šï¼Œè¯¥æ€ä¹ˆåŠï¼ŸåŠ ä¸€ä¸ªMasteræ˜¯ä¸èƒ½è§£å†³é—®é¢˜çš„ï¼Œ å› ä¸ºæ•°æ®è¦ä¿å­˜ä¸€è‡´æ€§ï¼Œå†™æ“ä½œéœ€è¦2ä¸ªmasterä¹‹é—´åŒæ­¥ï¼Œç›¸å½“äºæ˜¯é‡å¤äº†ï¼Œè€Œä¸”æ›´åŠ å¤æ‚ã€‚</p><p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ°<strong>åˆ†åº“åˆ†è¡¨ï¼ˆshardingï¼‰ï¼Œå¯¹å†™æ“ä½œè¿›è¡Œåˆ‡åˆ†ã€‚</strong></p><h2 id="ä¸ºä»€ä¹ˆä¸NoSQL-NewSQL"><a href="#ä¸ºä»€ä¹ˆä¸NoSQL-NewSQL" class="headerlink" title="ä¸ºä»€ä¹ˆä¸NoSQL/NewSQL?"></a>ä¸ºä»€ä¹ˆä¸NoSQL/NewSQL?</h2><p>é¦–å…ˆï¼Œä¸ºä»€ä¹ˆä¸é€‰æ‹©ç¬¬ä¸‰ç§æ–¹æ¡ˆNoSQL/NewSQLï¼Œæˆ‘è®¤ä¸ºä¸»è¦æ˜¯RDBMSæœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p><blockquote><p>RDBMSï¼šå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRelational Database Management Systemï¼‰</p><ul><li>RDBMSç”Ÿæ€å®Œå–„ï¼›</li><li>RDBMSç»å¯¹ç¨³å®šï¼›</li><li>RDBMSçš„äº‹åŠ¡ç‰¹æ€§ï¼›</li></ul></blockquote><p>NoSQL/NewSQLä½œä¸ºæ–°ç”Ÿå„¿ï¼Œåœ¨æˆ‘ä»¬æŠŠå¯é æ€§å½“åšé¦–è¦è€ƒå¯Ÿå¯¹è±¡æ—¶ï¼Œå®ƒæ˜¯æ— æ³•ä¸RDBMSç›¸æå¹¶è®ºçš„ã€‚RDBMSå‘å±•å‡ åå¹´ï¼Œåªè¦æœ‰è½¯ä»¶çš„åœ°æ–¹ï¼Œå®ƒéƒ½æ˜¯æ ¸å¿ƒå­˜å‚¨çš„é¦–é€‰ã€‚</p><p>ç›®å‰ç»å¤§éƒ¨åˆ†å…¬å¸çš„æ ¸å¿ƒæ•°æ®éƒ½æ˜¯ï¼š<strong>ä»¥RDBMSå­˜å‚¨ä¸ºä¸»ï¼ŒNoSQL/NewSQLå­˜å‚¨ä¸ºè¾…</strong>ï¼äº’è”ç½‘å…¬å¸åˆä»¥MySQLä¸ºä¸»ï¼Œå›½ä¼&amp;é“¶è¡Œç­‰ä¸å·®é’±çš„ä¼ä¸šä»¥Oracle/DB2ä¸ºä¸»ï¼NoSQL/NewSQLå®£ä¼ çš„æ— è®ºå¤šç‰›é€¼ï¼Œå°±ç°åœ¨å„å¤§å…¬å¸å¯¹å®ƒçš„å®šä½ï¼Œéƒ½æ˜¯RDBMSçš„è¡¥å……ï¼Œè€Œä¸æ˜¯å–è€Œä»£ä¹‹ï¼</p><h2 id="ä¸ºä»€ä¹ˆä¸åˆ†åŒº"><a href="#ä¸ºä»€ä¹ˆä¸åˆ†åŒº" class="headerlink" title="ä¸ºä»€ä¹ˆä¸åˆ†åŒº?"></a>ä¸ºä»€ä¹ˆä¸åˆ†åŒº?</h2><p>æˆ‘ä»¬å†çœ‹åˆ†åŒºè¡¨æ–¹æ¡ˆã€‚äº†è§£è¿™ä¸ªæ–¹æ¡ˆä¹‹å‰ï¼Œå…ˆäº†è§£å®ƒçš„åŸç†ï¼š</p><p>åˆ†åŒºï¼šå°±æ˜¯æŠŠä¸€å¼ è¡¨çš„æ•°æ®åˆ†æˆNä¸ªåŒºå—ï¼Œåœ¨é€»è¾‘ä¸Šçœ‹æœ€ç»ˆåªæ˜¯ä¸€å¼ è¡¨ï¼Œä½†åº•å±‚æ˜¯ç”±Nä¸ªç‰©ç†åŒºå—ç»„æˆçš„ï¼Œåˆ†åŒºå®ç°æ¯”è¾ƒç®€å•ï¼Œæ•°æ®åº“mysqlã€oracleç­‰å¾ˆå®¹æ˜“å°±å¯æ”¯æŒã€‚</p><blockquote><p><strong>åˆ†åŒºè¡¨æ˜¯ç”±å¤šä¸ªç›¸å…³çš„åº•å±‚è¡¨å®ç°ï¼Œè¿™äº›åº•å±‚è¡¨ä¹Ÿæ˜¯ç”±å¥æŸ„å¯¹è±¡è¡¨ç¤º</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®å„ä¸ªåˆ†åŒºï¼Œå­˜å‚¨å¼•æ“ç®¡ç†åˆ†åŒºçš„å„ä¸ªåº•å±‚è¡¨å’Œç®¡ç†æ™®é€šè¡¨ä¸€æ ·ï¼ˆæ‰€æœ‰çš„åº•å±‚è¡¨éƒ½å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“ï¼‰ï¼Œ<strong>åˆ†åŒºè¡¨çš„ç´¢å¼•åªæ˜¯åœ¨å„ä¸ªåº•å±‚è¡¨ä¸Šå„è‡ªåŠ ä¸Šä¸€ä¸ªç›¸åŒçš„ç´¢å¼•</strong>ï¼Œä»å­˜å‚¨å¼•æ“çš„è§’åº¦æ¥çœ‹ï¼Œåº•å±‚è¡¨å’Œä¸€ä¸ªæ™®é€šè¡¨æ²¡æœ‰ä»»ä½•ä¸åŒï¼Œå­˜å‚¨å¼•æ“ä¹Ÿæ— é¡»çŸ¥é“è¿™æ˜¯ä¸€ä¸ªæ™®é€šè¡¨è¿˜æ˜¯ä¸€ä¸ªåˆ†åŒºè¡¨çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><p>ä¸€æ—¦åˆ†è¡¨ï¼Œä¸€ä¸ªåº“ä¸­çš„è¡¨ä¼šè¶Šæ¥è¶Šå¤š</p><blockquote><p>å°†æ•´ä¸ªæ•°æ®åº“æ¯”ä½œå›¾ä¹¦é¦†ï¼Œä¸€å¼ è¡¨å°±æ˜¯ä¸€æœ¬ä¹¦ã€‚å½“è¦åœ¨ä¸€æœ¬ä¹¦ä¸­æŸ¥æ‰¾æŸé¡¹å†…å®¹æ—¶ï¼Œå¦‚æœä¸åˆ†ç« èŠ‚ï¼ŒæŸ¥æ‰¾çš„æ•ˆç‡å°†ä¼šä¸‹é™ã€‚è€ŒåŒç†ï¼Œåœ¨æ•°æ®åº“ä¸­å°±æ˜¯åˆ†åŒºã€‚</p></blockquote><ul><li><strong>ä»€ä¹ˆæ—¶å€™è€ƒè™‘ä½¿ç”¨åˆ†åŒº</strong>ï¼šä¸€å¼ è¡¨çš„æŸ¥è¯¢é€Ÿåº¦å·²ç»æ…¢åˆ°å½±å“ä½¿ç”¨çš„æ—¶å€™ã€‚</li></ul><blockquote><ol><li>sqlç»è¿‡ä¼˜åŒ–</li><li>æ•°æ®é‡å¤§</li><li>è¡¨ä¸­çš„æ•°æ®æ˜¯åˆ†æ®µçš„</li><li>å¯¹æ•°æ®çš„æ“ä½œå¾€å¾€åªæ¶‰åŠä¸€éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„æ•°æ®</li></ol></blockquote><ul><li><p><strong>åˆ†åŒºè§£å†³çš„é—®é¢˜</strong>ï¼šä¸»è¦å¯ä»¥æå‡æŸ¥è¯¢æ•ˆç‡</p></li><li><p><strong>åˆ†åŒºçš„å®ç°æ–¹å¼</strong>ï¼ˆç®€å•ï¼‰ï¼š</p></li></ul><blockquote><p>mysql5 å¼€å§‹æ”¯æŒåˆ†åŒºåŠŸèƒ½</p><p>CREATE TABLE sales (</p><p>id INT AUTO_INCREMENT,</p><p>amount DOUBLE NOT NULL,</p><p>order_day DATETIME NOT NULL,</p><p>PRIMARY KEY(id, order_day)</p><p>) ENGINE=Innodb</p><p>PARTITION BY RANGE(YEAR(order_day)) (</p><p>PARTITION p_2010 VALUES LESS THAN (2010),</p><p>PARTITION p_2011 VALUES LESS THAN (2011),</p><p>PARTITION p_2012 VALUES LESS THAN (2012),</p><p>PARTITION p_catchall VALUES LESS THAN MAXVALUE);</p></blockquote><ul><li>äº‹å®ä¸Šï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¸é”™ï¼Œ<strong>å®ƒå¯¹ç”¨æˆ·å±è”½äº†shardingçš„ç»†èŠ‚ï¼Œå³ä½¿æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰sharding columnï¼Œå®ƒä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼ˆåªæ˜¯è¿™æ—¶å€™æ€§èƒ½ä¸€èˆ¬ï¼‰ã€‚</strong></li><li>ä¸è¿‡å®ƒçš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼š<strong>å¾ˆå¤šçš„èµ„æºéƒ½å—åˆ°å•æœºçš„é™åˆ¶ï¼Œä¾‹å¦‚è¿æ¥æ•°ï¼Œç½‘ç»œååç­‰</strong>ï¼è™½ç„¶æ¯ä¸ªåˆ†åŒºå¯ä»¥ç‹¬ç«‹å­˜å‚¨ï¼Œä½†æ˜¯åˆ†åŒºè¡¨çš„æ€»å…¥å£è¿˜æ˜¯ä¸€ä¸ªMySQLç¤ºä¾‹ã€‚ä»è€Œå¯¼è‡´å®ƒçš„å¹¶å‘èƒ½åŠ›éå¸¸ä¸€èˆ¬ï¼Œè¿œè¿œè¾¾ä¸åˆ°äº’è”ç½‘é«˜å¹¶å‘çš„è¦æ±‚ï¼</li><li>è‡³äºç½‘ä¸Šæåˆ°çš„ä¸€äº›å…¶ä»–ç¼ºç‚¹æ¯”å¦‚ï¼šæ— æ³•ä½¿ç”¨å¤–é”®ï¼Œä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚æˆ‘è®¤ä¸ºè¿™éƒ½ä¸ç®—ç¼ºç‚¹ï¼Œ21ä¸–çºªçš„é¡¹ç›®å¦‚æœè¿˜æ˜¯ä½¿ç”¨å¤–é”®å’Œæ•°æ®åº“çš„å…¨æ–‡ç´¢å¼•ï¼Œæˆ‘éƒ½æ‡’å¾—åæ§½äº†ï¼</li></ul><p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœä½¿ç”¨åˆ†åŒºè¡¨ï¼Œä½ çš„ä¸šåº”è¯¥å…·å¤‡å¦‚ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š</strong></p><blockquote><p>æ•°æ®ä¸æ˜¯æµ·é‡ï¼ˆåˆ†åŒºæ•°æœ‰é™ï¼Œå­˜å‚¨èƒ½åŠ›å°±æœ‰é™ï¼‰ï¼›</p><p>å¹¶å‘èƒ½åŠ›è¦æ±‚ä¸é«˜ï¼›</p></blockquote><h1 id="åˆ†åº“åˆ†è¡¨æ¦‚è¿°"><a href="#åˆ†åº“åˆ†è¡¨æ¦‚è¿°" class="headerlink" title="åˆ†åº“åˆ†è¡¨æ¦‚è¿°"></a>åˆ†åº“åˆ†è¡¨æ¦‚è¿°</h1><p><img src="åˆ†åº“åˆ†è¡¨æ¦‚è¿°.jpg" alt="åˆ†åº“åˆ†è¡¨æ¦‚è¿°"></p><blockquote><p>è¯»å†™åˆ†ç¦»ï¼šåˆ†æ•£æ•°æ®åº“è¯»å†™æ“ä½œå‹åŠ›</p><p>åˆ†åº“åˆ†è¡¨ï¼šåˆ†æ•£å­˜å‚¨å‹åŠ›</p></blockquote><h1 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h1><p><img src="é€‚ç”¨åœºæ™¯.png" alt="é€‚ç”¨åœºæ™¯"></p><ul><li>ç±»ä¼¼è¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨ä¹Ÿæ˜¯ç¡®å®šæ²¡æœ‰å…¶ä»–ä¼˜åŒ–ç©ºé—´ä¹‹åæ‰é‡‡å–çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</li><li>é‚£å¦‚æœä¸šåŠ¡çœŸçš„å‘å±•å¾ˆå¿«å²‚ä¸æ˜¯å¾ˆå¿«è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨äº†ï¼Ÿé‚£ä¸ºä½•ä¸ä¸€å¼€å§‹å°±è®¾è®¡å¥½å‘¢ï¼Ÿ</li></ul><p><strong>æŒ‰ç…§æ¶æ„è®¾è®¡çš„â€œä¸‰åŸåˆ™â€ï¼ˆç®€å•åŸåˆ™ï¼Œåˆé€‚åŸåˆ™ï¼Œæ¼”åŒ–åŸåˆ™ï¼‰</strong>ï¼Œç®€å•åˆ†æä¸€ä¸‹ï¼š</p><blockquote><p>é¦–å…ˆï¼Œ<strong>è¿™é‡Œçš„â€œå¦‚æœâ€äº‹å®ä¸Šå‘ç”Ÿçš„æ¦‚ç‡æ¯”è¾ƒä½</strong>ï¼Œåš10ä¸ªä¸šåŠ¡æœ‰ä¸€ä¸ªä¸šåŠ¡èƒ½æ´»ä¸‹å»å°±å¾ˆä¸é”™äº†ï¼Œæ›´ä½•å†µå¿«é€Ÿå‘å±•ï¼Œå’Œä¸­å½©ç¥¨çš„æ¦‚ç‡å·®ä¸å¤šã€‚å¦‚æœæˆ‘ä»¬æ¯ä¸ªä¸šåŠ¡ä¸Šæ¥å°±æŒ‰ç…§æ·˜å®ã€å¾®ä¿¡çš„è§„æ¨¡å»åšæ¶æ„è®¾è®¡ï¼Œä¸ä½†ä¼šç´¯æ­»è‡ªå·±ï¼Œè¿˜ä¼šå®³æ­»ä¸šåŠ¡ã€‚</p><p>å…¶æ¬¡ï¼Œ<strong>å¦‚æœä¸šåŠ¡çœŸçš„å‘å±•å¾ˆå¿«ï¼Œåé¢è¿›è¡Œåˆ†åº“åˆ†è¡¨ä¹Ÿä¸è¿Ÿ</strong>ã€‚å› ä¸ºä¸šåŠ¡å‘å±•å¥½ï¼Œç›¸åº”çš„èµ„æºæŠ•å…¥å°±ä¼šåŠ å¤§ï¼Œå¯ä»¥æŠ•å…¥æ›´å¤šçš„äººå’Œæ›´å¤šçš„é’±ï¼Œé‚£ä¸šåŠ¡åˆ†åº“å¸¦æ¥çš„ä»£ç å’Œä¸šåŠ¡å¤æ‚é—®é¢˜å°±å¯ä»¥é€šè¿‡åŠ äººæ¥è§£å†³ï¼Œæˆæœ¬é—®é¢˜ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ èµ„é‡‘æ¥è§£å†³ã€‚</p></blockquote><h1 id="åˆ†åº“åˆ†è¡¨çš„æ–¹å¼æ–¹æ³•"><a href="#åˆ†åº“åˆ†è¡¨çš„æ–¹å¼æ–¹æ³•" class="headerlink" title="åˆ†åº“åˆ†è¡¨çš„æ–¹å¼æ–¹æ³•"></a>åˆ†åº“åˆ†è¡¨çš„æ–¹å¼æ–¹æ³•</h1><blockquote><p>ä¸€èˆ¬å°±æ˜¯<strong>å‚ç›´åˆ‡åˆ†å’Œæ°´å¹³åˆ‡åˆ†</strong>ï¼Œè¿™æ˜¯ä¸€ç§ç»“æœé›†æè¿°çš„åˆ‡åˆ†æ–¹å¼ï¼Œæ˜¯ç‰©ç†ç©ºé—´ä¸Šçš„åˆ‡åˆ†ã€‚</p><p>æˆ‘ä»¬ä»é¢ä¸´çš„é—®é¢˜ï¼Œå¼€å§‹è§£å†³ï¼Œé˜è¿°ï¼š é¦–å…ˆæ˜¯ç”¨æˆ·è¯·æ±‚é‡å¤ªå¤§ï¼Œæˆ‘ä»¬å°±å †æœºå™¨æå®šï¼ˆè¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼‰ã€‚</p><p>ç„¶åæ˜¯å•ä¸ªåº“å¤ªå¤§ï¼Œè¿™æ—¶æˆ‘ä»¬è¦çœ‹æ˜¯å› ä¸º<strong>è¡¨å¤šè€Œå¯¼è‡´æ•°æ®å¤š</strong>ï¼Œè¿˜æ˜¯å› ä¸º<strong>å•å¼ è¡¨é‡Œé¢çš„æ•°æ®å¤š</strong>ã€‚</p><p>å¦‚æœæ˜¯å› ä¸ºè¡¨å¤šè€Œæ•°æ®å¤šï¼Œä½¿ç”¨å‚ç›´åˆ‡åˆ†ï¼Œæ ¹æ®ä¸šåŠ¡åˆ‡åˆ†æˆä¸åŒçš„åº“ã€‚</p><p>å¦‚æœæ˜¯å› ä¸ºå•å¼ è¡¨çš„æ•°æ®é‡å¤ªå¤§ï¼Œè¿™æ—¶è¦ç”¨æ°´å¹³åˆ‡åˆ†ï¼Œå³æŠŠè¡¨çš„æ•°æ®æŒ‰<strong>æŸç§è§„åˆ™</strong>åˆ‡åˆ†æˆå¤šå¼ è¡¨ï¼Œç”šè‡³å¤šä¸ªåº“ä¸Šçš„å¤šå¼ è¡¨ã€‚ </p><p><strong>åˆ†åº“åˆ†è¡¨çš„é¡ºåºåº”è¯¥æ˜¯å…ˆå‚ç›´åˆ†ï¼Œåæ°´å¹³åˆ†</strong>ã€‚ å› ä¸ºå‚ç›´åˆ†æ›´ç®€å•ï¼Œæ›´ç¬¦åˆæˆ‘ä»¬å¤„ç†ç°å®ä¸–ç•Œé—®é¢˜çš„æ–¹å¼ã€‚</p></blockquote><h2 id="å‚ç›´æ‹†åˆ†"><a href="#å‚ç›´æ‹†åˆ†" class="headerlink" title="å‚ç›´æ‹†åˆ†"></a>å‚ç›´æ‹†åˆ†</h2><h3 id="å‚ç›´åˆ†è¡¨"><a href="#å‚ç›´åˆ†è¡¨" class="headerlink" title="å‚ç›´åˆ†è¡¨"></a>å‚ç›´åˆ†è¡¨</h3><blockquote><p>ä¹Ÿå°±æ˜¯â€œå¤§è¡¨æ‹†å°è¡¨â€ï¼ŒåŸºäºåˆ—å­—æ®µè¿›è¡Œçš„ã€‚</p><p>ä¸€èˆ¬æ˜¯è¡¨ä¸­çš„å­—æ®µè¾ƒå¤šï¼Œå°†ä¸å¸¸ç”¨çš„ï¼Œ æ•°æ®è¾ƒå¤§ï¼Œé•¿åº¦è¾ƒé•¿ï¼ˆæ¯”å¦‚textç±»å‹å­—æ®µï¼‰çš„æ‹†åˆ†åˆ°â€œæ‰©å±•è¡¨â€œã€‚</p><p>ä¸€èˆ¬æ˜¯é’ˆå¯¹é‚£ç§å‡ ç™¾åˆ—çš„å¤§è¡¨ï¼Œä¹Ÿé¿å…æŸ¥è¯¢æ—¶ï¼Œæ•°æ®é‡å¤ªå¤§é€ æˆçš„â€œè·¨é¡µâ€é—®é¢˜ã€‚</p></blockquote><h4 id="å‚ç›´åˆ†åº“"><a href="#å‚ç›´åˆ†åº“" class="headerlink" title="å‚ç›´åˆ†åº“"></a>å‚ç›´åˆ†åº“</h4><blockquote><p>å‚ç›´åˆ†åº“é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿä¸­çš„ä¸åŒä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œæ¯”å¦‚ç”¨æˆ·Userä¸€ä¸ªåº“ï¼Œå•†å“Producetä¸€ä¸ªåº“ï¼Œè®¢å•Orderä¸€ä¸ªåº“ã€‚</p><p>åˆ‡åˆ†åï¼Œè¦æ”¾åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿ æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªè´­ç‰©ç½‘ç«™å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¼šæœ‰ç”¨æˆ·ï¼Œå•†å“ï¼Œè®¢å•ç­‰çš„CRUDã€‚æ²¡æ‹†åˆ†ä¹‹å‰ï¼Œ å…¨éƒ¨éƒ½æ˜¯è½åˆ°å•ä¸€çš„åº“ä¸Šçš„ï¼Œè¿™ä¼šè®©æ•°æ®åº“çš„<strong>å•åº“å¤„ç†èƒ½åŠ›æˆä¸ºç“¶é¢ˆ</strong>ã€‚</p><p>æŒ‰å‚ç›´åˆ†åº“åï¼Œå¦‚æœè¿˜æ˜¯æ”¾åœ¨ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œ éšç€ç”¨æˆ·é‡å¢å¤§ï¼Œè¿™ä¼šè®©<strong>å•ä¸ªæ•°æ®åº“çš„å¤„ç†èƒ½åŠ›æˆä¸ºç“¶é¢ˆ</strong>ï¼Œè¿˜æœ‰<strong>å•ä¸ªæœåŠ¡å™¨çš„ç£ç›˜ç©ºé—´ï¼Œå†…å­˜ï¼Œtpsç­‰éå¸¸åƒç´§</strong>ã€‚ æ‰€ä»¥æˆ‘ä»¬è¦æ‹†åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ä¸Šé¢çš„é—®é¢˜éƒ½è§£å†³äº†ï¼Œä»¥åä¹Ÿä¸ä¼šé¢å¯¹å•æœºèµ„æºé—®é¢˜ã€‚</p><p>æ•°æ®åº“ä¸šåŠ¡å±‚é¢çš„æ‹†åˆ†ï¼Œå’ŒæœåŠ¡çš„â€œæ²»ç†â€ï¼Œâ€œé™çº§â€æœºåˆ¶ç±»ä¼¼ï¼Œä¹Ÿèƒ½å¯¹ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†åˆ«çš„è¿›è¡Œç®¡ç†ï¼Œç»´æŠ¤ï¼Œç›‘æ§ï¼Œæ‰©å±•ç­‰ã€‚</p><p>æ•°æ®åº“å¾€å¾€æœ€å®¹æ˜“æˆä¸ºåº”ç”¨ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œ<strong>è€Œæ•°æ®åº“æœ¬èº«å±äºâ€œæœ‰çŠ¶æ€â€çš„ï¼Œç›¸å¯¹äºWebå’Œåº”ç”¨æœåŠ¡å™¨æ¥è®²ï¼Œæ˜¯æ¯”è¾ƒéš¾å®ç°â€œæ¨ªå‘æ‰©å±•â€çš„ã€‚</strong></p><p>æ•°æ®åº“çš„è¿æ¥èµ„æºæ¯”è¾ƒå®è´µä¸”å•æœºå¤„ç†èƒ½åŠ›ä¹Ÿæœ‰é™ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå‚ç›´åˆ†åº“ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿçªç ´IOã€è¿æ¥æ•°åŠå•æœºç¡¬ä»¶èµ„æºçš„ç“¶é¢ˆã€‚</p></blockquote><p><img src="ä¸šåŠ¡åˆ†åº“1.jpg" alt="ä¸šåŠ¡åˆ†åº“1"></p><p><img src="ä¸šåŠ¡åˆ†åº“2.jpg" alt="ä¸šåŠ¡åˆ†åº“2"></p><h2 id="æ°´å¹³æ‹†åˆ†"><a href="#æ°´å¹³æ‹†åˆ†" class="headerlink" title="æ°´å¹³æ‹†åˆ†"></a>æ°´å¹³æ‹†åˆ†</h2><h3 id="æ°´å¹³åˆ†è¡¨"><a href="#æ°´å¹³åˆ†è¡¨" class="headerlink" title="æ°´å¹³åˆ†è¡¨"></a>æ°´å¹³åˆ†è¡¨</h3><blockquote><p>é’ˆå¯¹æ•°æ®é‡å·¨å¤§çš„å•å¼ è¡¨ï¼ˆæ¯”å¦‚è®¢å•è¡¨ï¼‰ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™ï¼ˆ<strong>RANGEï¼ŒHASHå–æ¨¡</strong>ç­‰ï¼‰ï¼Œåˆ‡åˆ†åˆ°å¤šå¼ è¡¨é‡Œé¢å»ã€‚ ä½†æ˜¯è¿™äº›è¡¨è¿˜æ˜¯åœ¨åŒä¸€ä¸ªåº“ä¸­ï¼Œæ‰€ä»¥<strong>åº“çº§åˆ«çš„æ•°æ®åº“æ“ä½œè¿˜æ˜¯æœ‰IOç“¶é¢ˆ</strong>ã€‚ä¸å»ºè®®é‡‡ç”¨ã€‚</p></blockquote><h3 id="æ°´å¹³åˆ†åº“åˆ†è¡¨"><a href="#æ°´å¹³åˆ†åº“åˆ†è¡¨" class="headerlink" title="æ°´å¹³åˆ†åº“åˆ†è¡¨"></a>æ°´å¹³åˆ†åº“åˆ†è¡¨</h3><blockquote><p>å°†å•å¼ è¡¨çš„æ•°æ®åˆ‡åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šå»ï¼Œæ¯ä¸ªæœåŠ¡å™¨å…·æœ‰ç›¸åº”çš„åº“ä¸è¡¨ï¼Œåªæ˜¯è¡¨ä¸­æ•°æ®é›†åˆä¸åŒã€‚ æ°´å¹³åˆ†åº“åˆ†è¡¨èƒ½å¤Ÿæœ‰æ•ˆçš„ç¼“è§£å•æœºå’Œå•åº“çš„æ€§èƒ½ç“¶é¢ˆå’Œå‹åŠ›ï¼Œçªç ´IOã€è¿æ¥æ•°ã€ç¡¬ä»¶èµ„æºç­‰çš„ç“¶é¢ˆã€‚</p></blockquote><h3 id="æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™"><a href="#æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™" class="headerlink" title="æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™"></a>æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™</h3><p><strong>RANGE</strong></p><blockquote><p>ä»0åˆ°10000ä¸€ä¸ªè¡¨ï¼Œ10001åˆ°20000ä¸€ä¸ªè¡¨ï¼›</p></blockquote><p><strong>HASHå–æ¨¡</strong></p><blockquote><p>ä¸€ä¸ªå•†åœºç³»ç»Ÿï¼Œä¸€èˆ¬éƒ½æ˜¯å°†ç”¨æˆ·ï¼Œè®¢å•ä½œä¸ºä¸»è¡¨ï¼Œç„¶åå°†å’Œå®ƒä»¬ç›¸å…³çš„ä½œä¸ºé™„è¡¨ï¼Œè¿™æ ·ä¸ä¼šé€ æˆè·¨åº“äº‹åŠ¡ä¹‹ç±»çš„é—®é¢˜ã€‚ <strong>å–ç”¨æˆ·idï¼Œç„¶åhashå–æ¨¡</strong>ï¼Œåˆ†é…åˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šã€‚</p></blockquote><p><strong>åœ°ç†åŒºåŸŸ</strong></p><blockquote><p>æ¯”å¦‚æŒ‰ç…§åä¸œï¼Œåå—ï¼ŒååŒ—è¿™æ ·æ¥åŒºåˆ†ä¸šåŠ¡ï¼Œä¸ƒç‰›äº‘åº”è¯¥å°±æ˜¯å¦‚æ­¤ã€‚</p></blockquote><p><strong>æ—¶é—´</strong></p><blockquote><p>æŒ‰ç…§æ—¶é—´åˆ‡åˆ†ï¼Œå°±æ˜¯å°†6ä¸ªæœˆå‰ï¼Œç”šè‡³ä¸€å¹´å‰çš„æ•°æ®åˆ‡å‡ºå»æ”¾åˆ°å¦å¤–çš„ä¸€å¼ è¡¨ï¼Œå› ä¸ºéšç€æ—¶é—´æµé€ï¼Œè¿™äº›è¡¨çš„æ•°æ® è¢«æŸ¥è¯¢çš„æ¦‚ç‡å˜å°ï¼Œæ‰€ä»¥æ²¡å¿…è¦å’Œâ€œçƒ­æ•°æ®â€æ”¾åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªä¹Ÿæ˜¯â€œå†·çƒ­æ•°æ®åˆ†ç¦»â€ã€‚</p></blockquote><h2 id="ä¸šåŠ¡åˆ†è¡¨"><a href="#ä¸šåŠ¡åˆ†è¡¨" class="headerlink" title="ä¸šåŠ¡åˆ†è¡¨"></a>ä¸šåŠ¡åˆ†è¡¨</h2><p><img src="ä¸šåŠ¡åˆ†è¡¨.png" alt="ä¸šåŠ¡åˆ†è¡¨"></p><p><img src="ä¸šåŠ¡åˆ†è¡¨2.jpg" alt="ä¸šåŠ¡åˆ†è¡¨2"></p><h1 id="åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜"><a href="#åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜" class="headerlink" title="åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜"></a>åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜</h1><h2 id="äº‹åŠ¡æ”¯æŒ"><a href="#äº‹åŠ¡æ”¯æŒ" class="headerlink" title="äº‹åŠ¡æ”¯æŒ"></a>äº‹åŠ¡æ”¯æŒ</h2><blockquote><p>åˆ†åº“åˆ†è¡¨åï¼Œå°±æˆäº†<strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>äº†ã€‚</p><p>å¦‚æœä¾èµ–æ•°æ®åº“æœ¬èº«çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†åŠŸèƒ½å»æ‰§è¡Œäº‹åŠ¡ï¼Œå°†ä»˜å‡ºé«˜æ˜‚çš„æ€§èƒ½ä»£ä»·ï¼› å¦‚æœç”±åº”ç”¨ç¨‹åºå»ååŠ©æ§åˆ¶ï¼Œå½¢æˆç¨‹åºé€»è¾‘ä¸Šçš„äº‹åŠ¡ï¼Œåˆä¼šé€ æˆç¼–ç¨‹æ–¹é¢çš„è´Ÿæ‹…ã€‚</p></blockquote><h2 id="è·¯ç”±é—®é¢˜ï¼š"><a href="#è·¯ç”±é—®é¢˜ï¼š" class="headerlink" title="è·¯ç”±é—®é¢˜ï¼š"></a>è·¯ç”±é—®é¢˜ï¼š</h2><blockquote><p>å‚ç›´åˆ†è¡¨ï¼šå¢åŠ è¡¨æ“ä½œçš„æ¬¡æ•°</p><p>æ°´å¹³åˆ†è¡¨ï¼š<strong>è·¯ç”±é—®é¢˜</strong></p></blockquote><p> <img src="è·¯ç”±é—®é¢˜.jpg" alt="è·¯ç”±é—®é¢˜"></p><h2 id="æ•°æ®åº“æ“ä½œé—®é¢˜"><a href="#æ•°æ®åº“æ“ä½œé—®é¢˜" class="headerlink" title="æ•°æ®åº“æ“ä½œé—®é¢˜"></a>æ•°æ®åº“æ“ä½œé—®é¢˜</h2><h3 id="å¤šåº“ç»“æœé›†åˆå¹¶ï¼ˆgroup-byï¼Œorder-byï¼‰"><a href="#å¤šåº“ç»“æœé›†åˆå¹¶ï¼ˆgroup-byï¼Œorder-byï¼‰" class="headerlink" title="å¤šåº“ç»“æœé›†åˆå¹¶ï¼ˆgroup byï¼Œorder byï¼‰"></a>å¤šåº“ç»“æœé›†åˆå¹¶ï¼ˆgroup byï¼Œorder byï¼‰</h3><h3 id="è·¨åº“join"><a href="#è·¨åº“join" class="headerlink" title="è·¨åº“join"></a>è·¨åº“join</h3><blockquote><p>åˆ†åº“åˆ†è¡¨åè¡¨ä¹‹é—´çš„å…³è”æ“ä½œå°†å—åˆ°é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•joinä½äºä¸åŒåˆ†åº“çš„è¡¨ï¼Œä¹Ÿæ— æ³•joinåˆ†è¡¨ç²’åº¦ä¸åŒçš„è¡¨ï¼Œ ç»“æœåŸæœ¬ä¸€æ¬¡æŸ¥è¯¢èƒ½å¤Ÿå®Œæˆçš„ä¸šåŠ¡ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡æŸ¥è¯¢æ‰èƒ½å®Œæˆã€‚</p><p>ç²—ç•¥çš„è§£å†³æ–¹æ³•ï¼š å…¨å±€è¡¨ï¼šåŸºç¡€æ•°æ®ï¼Œæ‰€æœ‰åº“éƒ½æ‹·è´ä¸€ä»½ã€‚ å­—æ®µå†—ä½™ï¼šè¿™æ ·æœ‰äº›å­—æ®µå°±ä¸ç”¨joinå»æŸ¥è¯¢äº†ã€‚ ç³»ç»Ÿå±‚ç»„è£…ï¼šåˆ†åˆ«æŸ¥è¯¢å‡ºæ‰€æœ‰ï¼Œç„¶åç»„è£…èµ·æ¥ï¼Œè¾ƒå¤æ‚ã€‚</p></blockquote><p><img src="æ•°æ®åº“æ“ä½œé—®é¢˜.png" alt="æ•°æ®åº“æ“ä½œé—®é¢˜"></p><ul><li>è§£å†³æ–¹æ³•</li></ul><p><img src="è§£å†³æ–¹æ³•.png" alt="è§£å†³æ–¹æ³•"></p><p>ç±»ä¼¼è¯»å†™åˆ†ç¦»ï¼Œå…·ä½“å®ç°ä¹Ÿæ˜¯â€œç¨‹åºä»£ç å°è£…â€å’Œâ€œä¸­é—´ä»¶å°è£…â€ï¼Œä½†å…·ä½“å®ç°å¤æ‚ä¸€äº›ï¼Œå› ä¸ºè¿˜æœ‰è¦åˆ¤æ–­SQLä¸­å…·ä½“æ“ä½œçš„è¡¨ï¼Œå…·ä½“æ“ä½œï¼ˆä¾‹å¦‚countã€order byã€group byç­‰ï¼‰ï¼Œæ ¹æ®å…·ä½“æ“ä½œåšä¸åŒçš„å¤„ç†ã€‚</p><h2 id="å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆå¹¶ï¼ˆæ’åºï¼‰"><a href="#å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆå¹¶ï¼ˆæ’åºï¼‰" class="headerlink" title="å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆå¹¶ï¼ˆæ’åºï¼‰"></a>å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆå¹¶ï¼ˆæ’åºï¼‰</h2><h3 id="â‘ -Select-None-Aggregate-Functionçš„æœ‰åºè®°å½•åˆå¹¶æ’åº"><a href="#â‘ -Select-None-Aggregate-Functionçš„æœ‰åºè®°å½•åˆå¹¶æ’åº" class="headerlink" title="â‘  Select + None Aggregate Functionçš„æœ‰åºè®°å½•åˆå¹¶æ’åº"></a>â‘  Select + None Aggregate Functionçš„æœ‰åºè®°å½•åˆå¹¶æ’åº</h3><blockquote><p>è§£å†³æ€è·¯ï¼šå¯¹å„åˆ†ç‰‡è¿”å›çš„æœ‰åºè®°å½•ï¼Œè¿›è¡Œæ’åºå»é‡åˆå¹¶ã€‚æ­¤å¤„ä¸»è¦æ˜¯ç¼–å†™æ’åºå»é‡åˆå¹¶ç®—æ³•ã€‚</p></blockquote><h3 id="â‘¡-Select-None-Aggregate-Functionçš„æ— åºè®°å½•åˆå¹¶"><a href="#â‘¡-Select-None-Aggregate-Functionçš„æ— åºè®°å½•åˆå¹¶" class="headerlink" title="â‘¡ Select + None Aggregate Functionçš„æ— åºè®°å½•åˆå¹¶"></a>â‘¡ Select + None Aggregate Functionçš„æ— åºè®°å½•åˆå¹¶</h3><blockquote><p>è§£å†³æ€è·¯ï¼šå¯¹å„åˆ†ç‰‡è¿”å›çš„æ— åºè®°å½•ï¼Œè¿›è¡Œå»é‡åˆå¹¶ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šå®ç°æ¯”è¾ƒç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼šæ•°æ®é‡è¶Šå¤§ï¼Œå­—æ®µè¶Šå¤šï¼Œå»é‡å¤„ç†å°±ä¼šè¶Šè€—æ—¶ã€‚</li></ul></blockquote><h3 id="â‘¢-Select-Aggregate-Functionçš„è®°å½•åˆå¹¶ï¼ˆæ’åºï¼‰Oracleå¸¸ç”¨èšåˆå‡½æ•°ï¼šCountã€Maxã€Minã€Avgã€Sumã€‚"><a href="#â‘¢-Select-Aggregate-Functionçš„è®°å½•åˆå¹¶ï¼ˆæ’åºï¼‰Oracleå¸¸ç”¨èšåˆå‡½æ•°ï¼šCountã€Maxã€Minã€Avgã€Sumã€‚" class="headerlink" title="â‘¢ Select + Aggregate Functionçš„è®°å½•åˆå¹¶ï¼ˆæ’åºï¼‰Oracleå¸¸ç”¨èšåˆå‡½æ•°ï¼šCountã€Maxã€Minã€Avgã€Sumã€‚"></a>â‘¢ Select + Aggregate Functionçš„è®°å½•åˆå¹¶ï¼ˆæ’åºï¼‰Oracleå¸¸ç”¨èšåˆå‡½æ•°ï¼šCountã€Maxã€Minã€Avgã€Sumã€‚</h3><blockquote><ul><li>AFï¼šMaxã€Min<ul><li>æ€è·¯ï¼šé€šè¿‡ç®—æ³•å¯¹å„åˆ†ç‰‡è¿”å›ç»“æœå†æ±‚maxã€minå€¼ã€‚</li></ul></li><li>AFï¼šAvgã€Sumã€Count<ul><li>æ€è·¯ï¼šåˆ†ç‰‡é—´æ— é‡å¤è®°å½•æˆ–å­—æ®µæ—¶ï¼Œé€šè¿‡ç®—æ³•å¯¹å„åˆ†ç‰‡è¿”å›ç»“æœå†æ±‚avgã€sumã€countå€¼ã€‚åˆ†ç‰‡é—´æœ‰é‡å¤è®°å½•æˆ–å­—æ®µæ—¶ï¼Œå…ˆå¯¹å„åˆ†ç‰‡è®°å½•å»é‡åˆå¹¶ï¼Œå†é€šè¿‡ç®—æ³•æ±‚avgã€sumã€countå€¼ã€‚</li></ul></li></ul></blockquote><p>æ¯”å¦‚ï¼š</p><blockquote><p>select count(*) from user</p><p>select count(deptno) from user;</p><p>select count(distinct deptno) from user;</p></blockquote><h2 id="å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆ†é¡µ"><a href="#å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆ†é¡µ" class="headerlink" title="å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆ†é¡µ"></a>å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰è¿”å›ç»“æœåˆ†é¡µ</h2><blockquote><p>è§£å†³æ€è·¯ï¼šåˆå¹¶å„åˆ†ç‰‡è¿”å›ç»“æœï¼Œé€»è¾‘åˆ†é¡µã€‚</p><ul><li>ä¼˜ç‚¹ï¼š  å®ç°ç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼š  æ•°æ®é‡è¶Šå¤§ï¼Œç¼“å­˜å‹åŠ›å°±è¶Šå¤§ã€‚åˆ†ç‰‡æ•°æ®é‡è¶Šå¤§ï¼ŒæŸ¥è¯¢ä¹Ÿä¼šè¶Šæ…¢ã€‚</li></ul></blockquote><h2 id="å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰æŸ¥è¯¢æœ‰åˆ†ç»„è¯­æ³•çš„åˆå¹¶"><a href="#å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰æŸ¥è¯¢æœ‰åˆ†ç»„è¯­æ³•çš„åˆå¹¶" class="headerlink" title="å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰æŸ¥è¯¢æœ‰åˆ†ç»„è¯­æ³•çš„åˆå¹¶"></a>å¤šåˆ†ç‰‡ï¼ˆæ°´å¹³åˆ‡åˆ†ï¼‰æŸ¥è¯¢æœ‰åˆ†ç»„è¯­æ³•çš„åˆå¹¶</h2><h3 id="â‘ -Group-By-Having-None-Aggregate-Functionæ—¶"><a href="#â‘ -Group-By-Having-None-Aggregate-Functionæ—¶" class="headerlink" title="â‘  Group By Having + None Aggregate Functionæ—¶"></a>â‘  Group By Having + None Aggregate Functionæ—¶</h3><blockquote><ul><li>Select + None Aggregate Function<ul><li>æ¯”å¦‚ï¼šselect job user group by job;</li><li>æ€è·¯ï¼šç›´æ¥å»é‡ï¼ˆæ’åºï¼‰åˆå¹¶ã€‚</li></ul></li><li>Select + Aggregate Function<ul><li>æ¯”å¦‚ï¼šselect max(sal),job user group by job;</li><li>æ€è·¯ï¼šåŒSelect + Aggregate Functionçš„è®°å½•åˆå¹¶ï¼ˆæ’åºï¼‰ã€‚</li></ul></li></ul></blockquote><h3 id="â‘¡-Group-By-Having-Aggregate-Functionæ—¶"><a href="#â‘¡-Group-By-Having-Aggregate-Functionæ—¶" class="headerlink" title="â‘¡ Group By Having + Aggregate Functionæ—¶"></a>â‘¡ Group By Having + Aggregate Functionæ—¶</h3><blockquote><p>è§£å†³æ€è·¯ï¼šå»æ‰having AFæ¡ä»¶æŸ¥è¯¢å„åˆ†ç‰‡ï¼Œç„¶åæŠŠæ•°æ®æ”¾åˆ°ä¸€å¼ è¡¨é‡Œã€‚å†ç”¨group by having èšåˆå‡½æ•°æŸ¥è¯¢ã€‚</p></blockquote><h2 id="åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„â€”æ’åºåˆ†ç»„åˆ†é¡µå‚è€ƒè§£å†³æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„â€”æ’åºåˆ†ç»„åˆ†é¡µå‚è€ƒè§£å†³æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„â€”æ’åºåˆ†ç»„åˆ†é¡µå‚è€ƒè§£å†³æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„â€”æ’åºåˆ†ç»„åˆ†é¡µå‚è€ƒè§£å†³æ–¹æ¡ˆ</h2><blockquote><ul><li>è§£å†³æ–¹æ¡ˆ1ï¼šHadoop + Hiveã€‚<ul><li>æ€è·¯ï¼šä½¿ç”¨Hadoop HDFSæ¥å­˜å‚¨æ•°æ®ï¼Œé€šè¿‡Hdoop MapReduceå®Œæˆæ•°æ®è®¡ç®—ï¼Œé€šè¿‡Hive HQLè¯­è¨€ä½¿ç”¨éƒ¨åˆ†ä¸RDBBSä¸€æ ·çš„è¡¨æ ¼æŸ¥è¯¢ç‰¹æ€§å’Œåˆ†å¸ƒå¼å­˜å‚¨è®¡ç®—ç‰¹æ€§ã€‚</li><li>ä¼˜ç‚¹ï¼š<ul><li>å¯ä»¥è§£å†³é—®é¢˜</li><li>å…·æœ‰å¹¶å‘å¤„ç†èƒ½åŠ›</li><li>å¯ä»¥ç¦»çº¿å¤„ç†</li></ul></li><li>ç¼ºç‚¹ï¼š <ul><li>å®æ—¶æ€§ä¸èƒ½ä¿è¯</li><li>ç½‘ç»œå»¶è¿Ÿä¼šå¢åŠ </li><li>å¼‚å¸¸æ•è·éš¾åº¦å¢åŠ </li><li>Webåº”ç”¨èµ·æ¥æ¯”è¾ƒå¤æ‚</li></ul></li></ul></li><li>è§£å†³æ–¹æ¡ˆ2ï¼šæ€»åº“é›†ä¸­æŸ¥è¯¢ã€‚<ul><li>ä¼˜ç‚¹ï¼š<ul><li>å¯ä»¥è§£å†³é—®é¢˜</li><li>å®ç°ç®€å•</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>æ€»åº“æ•°æ®ä¸èƒ½å¤ªå¤§</li><li>å¹¶å‘å‹åŠ›å¤§</li></ul></li></ul></li></ul></blockquote><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å¯¹äºåˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„æ¥è¯´ï¼Œæ’åºã€åˆ†é¡µã€åˆ†ç»„ä¸€ç›´å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„é—®é¢˜ã€‚é¿å…æ­¤é—®é¢˜éœ€è¦å¥½å¥½åœ°è®¾è®¡åˆ†åº“ã€åˆ†è¡¨ç­–ç•¥ã€‚åŒæ—¶æ ¹æ®ç‰¹å®šçš„åœºæ™¯æ¥è§£å†³é—®é¢˜ã€‚ä¹Ÿå¯ä»¥ å……åˆ†åˆ©ç”¨æµ·é‡æ•°æ®å­˜å‚¨ï¼ˆHadoop-HDFS|Hive|HBseï¼‰ã€æœç´¢å¼•æ“ï¼ˆLucene|Solrï¼‰åŠåˆ†å¸ƒå¼è®¡ç®—ï¼ˆMapReduceï¼‰ç­‰æŠ€æœ¯æ¥ è§£å†³é—®é¢˜ã€‚</p><p>å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨NoSQLæŠ€æœ¯æ›¿ä»£å…³ç³»æ€§æ•°æ®åº“æ¥è§£å†³é—®é¢˜ï¼Œæ¯”å¦‚MogonDB/Redisã€‚</p><h1 id="å‚è€ƒï¼ˆCOPYï¼‰èµ„æ–™"><a href="#å‚è€ƒï¼ˆCOPYï¼‰èµ„æ–™" class="headerlink" title="å‚è€ƒï¼ˆCOPYï¼‰èµ„æ–™"></a>å‚è€ƒï¼ˆCOPYï¼‰èµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/fly910905/article/details/87090092">åˆ†åº“åˆ†è¡¨ï¼šåº”ç”¨åœºæ™¯ã€æ–¹å¼æ–¹æ³•ã€é¢ä¸´é—®é¢˜</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è¯»ä¹¦ç¬”è®°ã€‘ç”Ÿè€Œè´«ç©·</title>
      <link href="/2022/06/02/%E3%80%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%91%E7%94%9F%E8%80%8C%E8%B4%AB%E7%A9%B7/"/>
      <url>/2022/06/02/%E3%80%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%91%E7%94%9F%E8%80%8C%E8%B4%AB%E7%A9%B7/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€ä¸ªSpringåº”ç”¨</title>
      <link href="/2022/05/26/%E7%AC%AC%E4%B8%80%E4%B8%AASpring%E5%BA%94%E7%94%A8/"/>
      <url>/2022/05/26/%E7%AC%AC%E4%B8%80%E4%B8%AASpring%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬äººä»¥å‰å­¦è¿‡Springï¼Œä¹Ÿå†™è¿‡ç›¸å…³ä¸šåŠ¡ä»£ç ã€‚ä½†æ˜¯å¯¹Springç†è§£ä¸æ·±åˆ»ï¼Œæ•…é‡æ–°è®¤è¯†Spring</p></blockquote><h1 id="åˆå§‹åŒ–Springé¡¹ç›®"><a href="#åˆå§‹åŒ–Springé¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–Springé¡¹ç›®"></a>åˆå§‹åŒ–Springé¡¹ç›®</h1><p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯IDEAåˆå§‹åŒ–Springé¡¹ç›®ã€‚</p><p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶åšå¦‚ä¸‹è®¾ç½®ï¼Œé€‰æ‹©ä¸‹ä¸€æ­¥ã€‚</p><p><img src="image-20220526234222155.png" alt="init"></p><p>é…ç½®æ–°é¡¹ç›®ï¼š</p><p><img src="image-20220526234348424.png" alt="config1"></p><p>é€‰æ‹©Spring Bootçš„ç‰ˆæœ¬å’Œæ’ä»¶ï¼Œé€‰æ‹©ä¸‹ä¸€æ­¥ã€‚</p><p><img src="image-20220526234432034.png" alt="config2"></p><p>é…ç½®é¡¹ç›®åç§°ç­‰ã€‚é€‰æ‹©å®Œæˆã€‚</p><p><img src="image-20220526234505163.png" alt="config3"></p><blockquote><p>è¿™é‡Œé…ç½®æœ‰é—®é¢˜ä¹Ÿæ²¡å…³ç³»ï¼Œåœ¨pom.xmlæ–‡ä»¶ä¸­åšä¿®æ”¹å³å¯ã€‚</p></blockquote><h1 id="è®¤è¯†Springé¡¹ç›®"><a href="#è®¤è¯†Springé¡¹ç›®" class="headerlink" title="è®¤è¯†Springé¡¹ç›®"></a>è®¤è¯†Springé¡¹ç›®</h1><blockquote><p>æœ¬é¡¹ç›®ä¸Šä¼ åˆ°äº†GitHubï¼š<a href="https://github.com/guoyujian/spring-in-action5-code">https://github.com/guoyujian/spring-in-action5-code</a></p></blockquote><h2 id="mvnwå’Œmvnw-cmd"><a href="#mvnwå’Œmvnw-cmd" class="headerlink" title="mvnwå’Œmvnw.cmd"></a>mvnwå’Œmvnw.cmd</h2><p>mvnwå’Œmvnw.cmdæ˜¯MavenåŒ…è£…å™¨ï¼ˆwrapperï¼‰è„šæœ¬ã€‚å€ŸåŠ©è¿™äº›è„šæœ¬ï¼Œå³ä¾¿ä½ çš„æœºå™¨ä¸Šæ²¡æœ‰å®‰è£…Mavenï¼Œä¹Ÿå¯ä»¥æ„å»ºé¡¹ç›®ã€‚</p><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><p>ä¸‹é¢æ˜¯æˆ‘çš„pom.xmlé…ç½®</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;version&gt;2.7.0&lt;/version&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Taco Cloud Example<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ä»¥ä¸‹éƒ½æ˜¯æˆ‘åŠ çš„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å‡ ç‚¹ï¼š</p><ol><li>parent/versionæ ‡ç­¾æŒ‡å®šäº†æ‰€æœ‰Springç›¸å…³åŒ…çš„ç‰ˆæœ¬ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨åœ¨ä¸‹é¢çš„dependencyä¸­é…ç½®ç‰ˆæœ¬ã€‚</li><li>packagingæŒ‡å‡ºäº†æ‰“åŒ…æ–¹å¼ï¼Œç›¸æ¯”äºwarï¼Œjaræ›´åŠ æµè¡Œã€‚</li><li>properties/java.versionæŒ‡å®šäº†è¿è¡Œçš„javaç‰ˆæœ¬</li><li>dependenciesæ ‡ç­¾ä¸‹é¢å…¨æ˜¯ä¾èµ–ã€‚å…¶å®ä¸€ä¸ªæœ€åŸºæœ¬çš„é¡¹ç›®æ˜¯ä¸éœ€è¦è¿™ä¹ˆå¤šdependencyçš„ã€‚å¯ä»¥è‡ªè¡Œæ³¨é‡Šæ‰è¿™äº›dependencyæµ‹è¯•ä¸€ä¸‹ã€‚</li></ol></blockquote><h2 id="TacoCloudApplication"><a href="#TacoCloudApplication" class="headerlink" title="TacoCloudApplication"></a>TacoCloudApplication</h2><p>è¿™æ˜¯ä¸»ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoCloudApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æœ€é‡è¦çš„æ˜¯@SpringBootApplicationæ³¨è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå®ƒç»„åˆäº†3ä¸ªå…¶ä»–çš„æ³¨è§£ï¼š</p><ul><li>@SpringBootConfigurationï¼šå°†è¯¥ç±»å£°æ˜ä¸ºé…ç½®ç±»ã€‚å°½ç®¡è¿™ä¸ªç±»ç›®å‰è¿˜æ²¡æœ‰å¤ªå¤šçš„é…ç½®ï¼Œä½†æ˜¯åç»­æˆ‘ä»¬å¯ä»¥æŒ‰éœ€æ·»åŠ åŸºäºJavaçš„Springæ¡†æ¶é…ç½®ã€‚è¿™ä¸ªæ³¨è§£å®é™…ä¸Šæ˜¯@Configurationæ³¨è§£çš„ç‰¹æ®Šå½¢å¼ã€‚</li><li>@EnableAutoConfigurationï¼šå¯ç”¨Spring Bootçš„è‡ªåŠ¨é…ç½®ã€‚æˆ‘ä»¬éšåä¼šä»‹ç»è‡ªåŠ¨é…ç½®çš„æ›´å¤šåŠŸèƒ½ã€‚å°±ç°åœ¨æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™ä¸ªæ³¨è§£ä¼šå‘Šè¯‰Spring Bootè‡ªåŠ¨é…ç½®å®ƒè®¤ä¸ºæˆ‘ä»¬ä¼šç”¨åˆ°çš„ç»„ä»¶ã€‚</li><li>@ComponentScanï¼šå¯ç”¨ç»„ä»¶æ‰«æã€‚è¿™æ ·æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡åƒ@Componentã€@Controllerã€@Serviceè¿™æ ·çš„æ³¨è§£å£°æ˜å…¶ä»–ç±»ï¼ŒSpringä¼šè‡ªåŠ¨å‘ç°å®ƒä»¬å¹¶å°†å®ƒä»¬æ³¨å†Œä¸ºSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ç»„ä»¶ã€‚</li></ul><h2 id="TacoCloudApplicationTests"><a href="#TacoCloudApplicationTests" class="headerlink" title="TacoCloudApplicationTests"></a>TacoCloudApplicationTests</h2><p>æµ‹è¯•ç±»ã€‚åé¢ç»†è®²ã€‚</p><h2 id="resources"><a href="#resources" class="headerlink" title="resources/"></a>resources/</h2><p>è¯¥ç›®å½•ä¸‹ï¼Œæœ‰</p><p><code>templates/</code>ï¼šå­˜æ”¾thymeleafæ¨¡æ¿ï¼Œç”±äºç°åœ¨å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œthymeleafæ˜¯ç”¨æ¥ä»£æ›¿jspçš„ä¸€ä¸ªä¸œè¥¿ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶å¤¹å’Œthymeleafæ²¡é‚£ä¹ˆé‡è¦ã€‚</p><p><code>static/</code>ï¼šå­˜æ”¾é™æ€èµ„æºï¼Œå›¾ç‰‡ï¼ŒJSå•¥çš„ï¼ŒåŒä¸Šï¼Œä¸é‡è¦</p><p><code>application.properties</code>ï¼šSpringçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯ymlï¼Œé‡è¦</p><h1 id="ç¼–å†™ç®€å•çš„Springåº”ç”¨"><a href="#ç¼–å†™ç®€å•çš„Springåº”ç”¨" class="headerlink" title="ç¼–å†™ç®€å•çš„Springåº”ç”¨"></a>ç¼–å†™ç®€å•çš„Springåº”ç”¨</h1><h2 id="MyController"><a href="#MyController" class="headerlink" title="MyController"></a>MyController</h2><p>åœ¨<code>tacos</code>åŒ…ä¸‹é¢åŠ å…¥MyControllerï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/home&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯¥ç±»æœ‰ä¸€ä¸ª@Controlleræ³¨è§£æ‰€ä»¥Springçš„ç»„ä»¶æ‰«æåŠŸèƒ½ä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œå¹¶åˆ›å»ºä¸€ä¸ªHomeControllerå®ä¾‹ä½œä¸ºSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„beanã€‚å®é™…ä¸Šï¼Œæœ‰ä¸€äº›å…¶ä»–çš„æ³¨è§£ä¸@Controlleræœ‰ç€ç±»ä¼¼çš„ç›®çš„ï¼ˆåŒ…æ‹¬@Componentã€@Serviceå’Œ@Repositoryï¼‰ã€‚ä½ å¯ä»¥ä¸ºHomeControlleræ·»åŠ ä¸Šè¿°çš„ä»»æ„å…¶ä»–æ³¨è§£ï¼Œå…¶ä½œç”¨æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™é‡Œé€‰æ‹©ä½¿ç”¨@Controlleræ›´èƒ½æè¿°è¿™ä¸ªç»„ä»¶åœ¨åº”ç”¨ä¸­çš„è§’è‰²ã€‚</p><p>home()æ˜¯ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚å®ƒå¸¦æœ‰@GetMappingæ³¨è§£ï¼Œè¡¨æ˜å¦‚æœé’ˆå¯¹<code>/home</code>å‘é€HTTP GETè¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°†ä¼šå¤„ç†è¯·æ±‚ã€‚</p><p>è¯¥æ–¹æ³•æ‰€åšçš„åªæ˜¯è¿”å›Stringç±»å‹çš„homeå€¼ã€‚è¿™ä¸ªå€¼å°†ä¼šè¢«è§£æä¸ºè§†å›¾çš„é€»è¾‘åã€‚è§†å›¾å¦‚ä½•å®ç°å–å†³äºå¤šä¸ªå› ç´ ï¼Œä½†æ˜¯å› ä¸ºThymeleafä½äºç±»è·¯å¾„ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Thymeleafæ¥å®šä¹‰æ¨¡æ¿ã€‚</p><p>æ¨¡æ¿åç§°æ˜¯ç”±é€»è¾‘è§†å›¾åæ´¾ç”Ÿè€Œæ¥çš„ï¼Œå†åŠ ä¸Šâ€œ/templates/â€å‰ç¼€å’Œâ€œ.htmlâ€åç¼€ã€‚æœ€ç»ˆå½¢æˆçš„æ¨¡æ¿è·¯å¾„å°†æ˜¯â€œ/templates/home.htmlâ€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¨¡æ¿æ”¾åˆ°é¡¹ç›®çš„â€œ/src/main/resources/templates/home.htmlâ€ç›®å½•ä¸­ã€‚</p><h2 id="home-html"><a href="#home-html" class="headerlink" title="home.html"></a>home.html</h2><p>è¿™å—ä»£ç å¾ˆç®€å•ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">hello!</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™æµ‹è¯•ç±»"><a href="#ç¼–å†™æµ‹è¯•ç±»" class="headerlink" title="ç¼–å†™æµ‹è¯•ç±»"></a>ç¼–å†™æµ‹è¯•ç±»</h2><p>åœ¨ä¸Šé¢çš„TacoCloudApplicationTestsæµ‹è¯•ç±»ä¸­ç¼–å†™ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hamcrest.Matchers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.RequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(MyController.class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoCloudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHomePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/home&quot;</span>))</span><br><span class="line">                .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">                .andExpect(MockMvcResultMatchers.view().name(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">                .andExpect(MockMvcResultMatchers.content().string(Matchers.containsString(<span class="string">&quot;hello&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ªç±»å¸¦æœ‰@RunWith(SpringRunner.class)æ³¨è§£ã€‚@RunWithæ˜¯JUnitçš„æ³¨è§£ï¼Œå®ƒä¼šæä¾›ä¸€ä¸ªæµ‹è¯•è¿è¡Œå™¨ï¼ˆrunnerï¼‰æ¥æŒ‡å¯¼JUnitå¦‚ä½•è¿è¡Œæµ‹è¯•ã€‚å¯ä»¥å°†å…¶æƒ³è±¡ä¸ºç»™JUnitåº”ç”¨ä¸€ä¸ªæ’ä»¶ï¼Œä»¥æä¾›è‡ªå®šä¹‰çš„æµ‹è¯•è¡Œä¸ºã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä¸ºJUnitæä¾›çš„æ˜¯SpringRunnerï¼Œè¿™æ˜¯ä¸€ä¸ªSpringæä¾›çš„æµ‹è¯•è¿è¡Œå™¨ï¼Œå®ƒä¼šåˆ›å»ºæµ‹è¯•è¿è¡Œæ‰€éœ€çš„Springåº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p><p>@WebMvcTestæ³¨è§£ã€‚è¿™æ˜¯Spring Bootæ‰€æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæµ‹è¯•æ³¨è§£ï¼Œå®ƒä¼šè®©è¿™ä¸ªæµ‹è¯•åœ¨Spring MVCåº”ç”¨çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚æ›´å…·ä½“æ¥è®²ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒä¼šå°†MyControlleræ³¨å†Œåˆ°Spring MVCä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘å®ƒå‘é€è¯·æ±‚äº†ã€‚</p><p>æµ‹è¯•ç±»è¢«æ³¨å…¥äº†ä¸€ä¸ªMockMvcï¼Œèƒ½å¤Ÿè®©æµ‹è¯•å®ç°mockupã€‚é€šè¿‡testHomePage()æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰äº†é’ˆå¯¹ä¸»é¡µæƒ³è¦æ‰§è¡Œçš„æµ‹è¯•ã€‚å®ƒé¦–å…ˆä½¿ç”¨MockMvcå¯¹è±¡å¯¹â€œ/homeâ€ï¼ˆæ ¹è·¯å¾„ï¼‰å‘èµ·HTTP GETè¯·æ±‚ã€‚å¯¹äºè¿™ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬è®¾ç½®äº†å¦‚ä¸‹çš„é¢„æœŸï¼ˆassertï¼‰ï¼š</p><ul><li>å“åº”åº”è¯¥å…·å¤‡HTTP 200 (OK)çŠ¶æ€</li><li>è§†å›¾çš„é€»è¾‘åç§°åº”è¯¥æ˜¯home</li><li>æ¸²æŸ“åçš„è§†å›¾åº”è¯¥åŒ…å«æ–‡æœ¬hello</li></ul><blockquote><p>æ³¨æ„ï¼Œå¦‚æœSpringç‰ˆæœ¬ä¸º2.7.0ï¼Œè¿™é‡Œ@Autowiredä¼šæŠ¥é”™ï¼Œç›®å‰è¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p></blockquote><p>æ‰§è¡Œè¿™ä¸ªæµ‹è¯•ç±»ï¼Œå‘ç°ç¨‹åºæ‰§è¡ŒæˆåŠŸäº†ã€‚</p><p><img src="image-20220527003138947.png" alt="res"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¯¹æœ¬äººæ¥è¯´ï¼Œæœ€å¤§çš„æ”¶è·å°±æ˜¯å¦‚ä½•ç¼–å†™æµ‹è¯•ç±»ï¼Œå¯¹Springåº”ç”¨è¿›è¡Œå¿«é€Ÿæµ‹è¯•ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€ŠSpring å®æˆ˜ï¼ˆç¬¬äº”ç‰ˆï¼‰ã€‹</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Springy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 æµï¼ˆ1ï¼‰</title>
      <link href="/2022/05/22/Java8-%E6%B5%81%EF%BC%881%EF%BC%89/"/>
      <url>/2022/05/22/Java8-%E6%B5%81%EF%BC%881%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="æµæ˜¯ä»€ä¹ˆ"><a href="#æµæ˜¯ä»€ä¹ˆ" class="headerlink" title="æµæ˜¯ä»€ä¹ˆ"></a>æµæ˜¯ä»€ä¹ˆ</h1><p>æµæ˜¯Java APIçš„æ–°æˆå‘˜ï¼Œå®ƒå…è®¸ä½ ä»¥<strong>å£°æ˜æ€§</strong>æ–¹å¼å¤„ç†æ•°æ®é›†åˆï¼ˆé€šè¿‡æŸ¥è¯¢è¯­å¥æ¥è¡¨è¾¾ï¼Œè€Œä¸æ˜¯ä¸´æ—¶ç¼–å†™ä¸€ä¸ªå®ç°ï¼‰ã€‚å°±ç°åœ¨æ¥è¯´ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çœ‹æˆéå†æ•°æ®é›†çš„é«˜çº§è¿­ä»£å™¨ã€‚</p><p>æ­¤å¤–ï¼Œæµè¿˜å¯ä»¥é€æ˜çš„å¹¶è¡Œå¤„ç†ï¼Œä½ æ— éœ€å†™ä»»ä½•å¤šçº¿ç¨‹ä»£ç äº†ï¼</p><hr><p>åœ¨ç»§ç»­ä»‹ç»ä¹‹å‰ï¼Œå…ˆå®šä¹‰ä¸€ä¼šè¦ä½¿ç”¨åˆ°çš„é›†åˆå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Dish&gt; menu = Arrays.asList(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;pork&quot;</span>, <span class="literal">false</span>, <span class="number">800</span>, Dish.Type.MEAT),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;beef&quot;</span>, <span class="literal">false</span>, <span class="number">700</span>, Dish.Type.MEAT),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;chicken&quot;</span>, <span class="literal">false</span>, <span class="number">400</span>, Dish.Type.MEAT),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;french fries&quot;</span>, <span class="literal">true</span>, <span class="number">530</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;rice&quot;</span>, <span class="literal">true</span>, <span class="number">350</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;season fruit&quot;</span>, <span class="literal">true</span>, <span class="number">120</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;pizza&quot;</span>, <span class="literal">true</span>, <span class="number">550</span>, Dish.Type.OTHER),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;prawns&quot;</span>, <span class="literal">false</span>, <span class="number">300</span>, Dish.Type.FISH),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Dish</span>(<span class="string">&quot;salmon&quot;</span>, <span class="literal">false</span>, <span class="number">450</span>, Dish.Type.FISH) );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Dishå¯¹è±¡çš„å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dish</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> vegetarian;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> calories;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dish</span><span class="params">(String name, <span class="type">boolean</span> vegetarian, <span class="type">int</span> calories, Type type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.vegetarian = vegetarian;</span><br><span class="line">        <span class="built_in">this</span>.calories = calories;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getterã€setter</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;MEAT, FISH, OTHER&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æµç®€ä»‹"><a href="#æµç®€ä»‹" class="headerlink" title="æµç®€ä»‹"></a>æµç®€ä»‹</h1><blockquote><p>ç®€çŸ­çš„å®šä¹‰å°±æ˜¯â€œä»æ”¯æŒæ•°æ®å¤„ç†æ“ä½œçš„æºç”Ÿæˆçš„å…ƒç´ åºåˆ—â€</p></blockquote><ul><li><strong>å…ƒç´ åºåˆ—</strong>â€”â€”å°±åƒé›†åˆä¸€æ ·ï¼Œæµä¹Ÿæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥è®¿é—®ç‰¹å®šå…ƒç´ ç±»å‹çš„ä¸€ç»„æœ‰åºå€¼ã€‚å› ä¸ºé›†åˆæ˜¯æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä»¥ç‰¹å®šçš„æ—¶é—´/ç©ºé—´å¤æ‚åº¦å­˜å‚¨å’Œè®¿é—®å…ƒç´ ï¼ˆå¦‚ArrayList ä¸ LinkedListï¼‰ã€‚ä½†æµçš„ç›®çš„åœ¨äºè¡¨è¾¾è®¡ç®—ã€‚<strong>é›†åˆè®²çš„æ˜¯æ•°æ®ï¼Œæµè®²çš„æ˜¯è®¡ç®—</strong>ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢è¯¦ç»†è§£ é‡Šè¿™ä¸ªæ€æƒ³ã€‚</li><li><strong>æº</strong>â€”â€”æµä¼šä½¿ç”¨ä¸€ä¸ªæä¾›æ•°æ®çš„æºï¼Œå¦‚é›†åˆã€æ•°ç»„æˆ–è¾“å…¥/è¾“å‡ºèµ„æºã€‚ è¯·æ³¨æ„ï¼Œä»æœ‰åºé›†åˆç”Ÿæˆæµæ—¶ä¼šä¿ç•™åŸæœ‰çš„é¡ºåºã€‚ç”±åˆ—è¡¨ç”Ÿæˆçš„æµï¼Œå…¶å…ƒç´ é¡ºåºä¸åˆ—è¡¨ä¸€è‡´ã€‚</li><li><strong>æ•°æ®å¤„ç†æ“ä½œ</strong>â€”â€”æµçš„æ•°æ®å¤„ç†åŠŸèƒ½æ”¯æŒç±»ä¼¼äºæ•°æ®åº“çš„æ“ä½œï¼Œä»¥åŠå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ çš„å¸¸ç”¨æ“ä½œï¼Œå¦‚filterã€mapã€reduceã€findã€matchã€sortç­‰ã€‚æµæ“ä½œå¯ä»¥é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå¯å¹¶è¡Œæ‰§è¡Œã€‚</li></ul><p>æ­¤å¤–ï¼Œæµæ“ä½œæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹ç‚¹ã€‚</p><ul><li><strong>æµæ°´çº¿</strong>â€”â€”å¾ˆå¤šæµæ“ä½œæœ¬èº«ä¼šè¿”å›ä¸€ä¸ªæµï¼Œè¿™æ ·å¤šä¸ªæ“ä½œå°±å¯ä»¥é“¾æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå¤§çš„æµæ°´çº¿ã€‚è¿™è®©ä¸€äº›ä¼˜åŒ–æˆä¸ºå¯èƒ½ï¼Œå¦‚å»¶è¿Ÿå’ŒçŸ­è·¯ã€‚æµæ°´çº¿çš„æ“ä½œå¯ä»¥çœ‹ä½œå¯¹æ•°æ®æºè¿›è¡Œæ•°æ®åº“å¼æŸ¥è¯¢ã€‚</li><li><strong>å†…éƒ¨è¿­ä»£</strong>â€”â€”ä¸ä½¿ç”¨è¿­ä»£å™¨æ˜¾å¼è¿­ä»£çš„é›†åˆä¸åŒï¼Œæµçš„è¿­ä»£æ“ä½œæ˜¯åœ¨èƒŒåè¿›è¡Œçš„ã€‚</li></ul><p>ä¸¾ä¾‹ï¼šç­›é€‰èœå•ä¸­å¡è·¯é‡Œé«˜äº300çš„ä¸‰ä¸ªèœå</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; res = menu.stream()</span><br><span class="line">    .filter(d -&gt; d.getCalories() &gt; <span class="number">300</span>)</span><br><span class="line">    .map(d -&gt; d.getName())</span><br><span class="line">    .limit(<span class="number">3</span>)</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line">System.out.println(res);</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å…ˆæ˜¯å¯¹menuè°ƒç”¨streamæ–¹æ³•ï¼Œç”±èœå•å¾—åˆ°ä¸€ä¸ªæµã€‚<strong>æ•°æ®æº</strong>æ˜¯èœå•åˆ—è¡¨ï¼Œ å®ƒç»™æµæä¾›ä¸€ä¸ª<strong>å…ƒç´ åºåˆ—</strong>ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹æµåº”ç”¨ä¸€ç³»åˆ—æ•°æ®å¤„ç†æ“ä½œï¼šfilterã€mapã€limit å’Œcollectã€‚é™¤äº†collectä¹‹å¤–ï¼Œæ‰€æœ‰è¿™äº›æ“ä½œéƒ½ä¼šè¿”å›å¦ä¸€ä¸ªæµï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥æ¥æˆä¸€æ¡æµæ°´çº¿ï¼Œäºæ˜¯å°±å¯ä»¥çœ‹ä½œå¯¹æºçš„ä¸€ä¸ªæŸ¥è¯¢ã€‚æœ€åï¼Œcollectæ“ä½œå¼€å§‹å¤„ç†æµæ°´çº¿ï¼Œå¹¶è¿”å›ç»“æœï¼ˆå®ƒå’Œåˆ«çš„æ“ä½œä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒè¿”å›çš„ä¸æ˜¯æµï¼Œåœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªListï¼‰ã€‚åœ¨è°ƒç”¨collectä¹‹å‰ï¼Œæ²¡æœ‰ä»»ä½•ç»“æœäº§ç”Ÿï¼Œå®é™…ä¸Šæ ¹æœ¬å°±æ²¡æœ‰ä»menué‡Œé€‰æ‹©å…ƒç´ ã€‚ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼šé“¾ä¸­çš„æ–¹æ³•è°ƒç”¨éƒ½åœ¨æ’é˜Ÿç­‰å¾…ï¼Œç›´åˆ°è°ƒç”¨collectã€‚</p></blockquote><p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="img1.png" alt="æµå¯è§†åŒ–"></p><h1 id="æµä¸é›†åˆ"><a href="#æµä¸é›†åˆ" class="headerlink" title="æµä¸é›†åˆ"></a>æµä¸é›†åˆ</h1><blockquote><p>ç®€å•åœ°è¯´ï¼Œé›†åˆä¸æµä¹‹é—´çš„å·®å¼‚å°±åœ¨äºä»€ä¹ˆæ—¶å€™è¿›è¡Œè®¡ç®—ã€‚é›†åˆæ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„æ•°æ®ç»“æ„ï¼Œ å®ƒåŒ…å«æ•°æ®ç»“æ„ä¸­ç›®å‰æ‰€æœ‰çš„å€¼â€”â€”é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¾—å…ˆç®—å‡ºæ¥æ‰èƒ½æ·»åŠ åˆ°é›†åˆä¸­ã€‚ï¼ˆä½ å¯ ä»¥å¾€é›†åˆé‡ŒåŠ ä¸œè¥¿æˆ–è€…åˆ å‡ä¸œè¥¿ï¼Œä½†æ˜¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ï¼Œé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æ”¾åœ¨å†…å­˜é‡Œçš„ï¼Œå…ƒç´  éƒ½å¾—å…ˆç®—å‡ºæ¥æ‰èƒ½æˆä¸ºé›†åˆçš„ä¸€éƒ¨åˆ†ã€‚ï¼‰</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œæµåˆ™æ˜¯åœ¨æ¦‚å¿µä¸Šå›ºå®šçš„æ•°æ®ç»“æ„ï¼ˆä½ ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼‰ï¼Œå…¶å…ƒç´ åˆ™æ˜¯æŒ‰éœ€è®¡ ç®—çš„ã€‚</p></blockquote><ul><li>ä¸é›†åˆä¸åŒï¼Œæµåªèƒ½éå†ä¸€æ¬¡</li><li>é›†åˆæ˜¯å¤–éƒ¨è¿­ä»£ï¼Œè€Œæµä½¿ç”¨å†…éƒ¨è¿­ä»£â€”â€”å®ƒå¸®ä½ æŠŠè¿­ä»£åšäº†</li></ul><h1 id="æµæ“ä½œ"><a href="#æµæ“ä½œ" class="headerlink" title="æµæ“ä½œ"></a>æµæ“ä½œ</h1><p>streamå®šä¹‰äº†å¾ˆå¤šæ“ä½œï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p><ol><li>filterã€mapå’Œlimitå¯ä»¥è¿æˆä¸€æ¡æµæ°´çº¿ï¼›</li><li>collectè§¦å‘æµæ°´çº¿æ‰§è¡Œå¹¶å…³é—­å®ƒï¼›</li></ol><p>å¯ä»¥è¿æ¥èµ·æ¥çš„æµæ“ä½œç§°ä¸ºä¸­é—´æ“ä½œï¼Œå…³é—­æµçš„æ“ä½œç§°ä¸ºç»ˆç«¯æ“ä½œã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œæµçš„ä½¿ç”¨ä¸€èˆ¬åŒ…æ‹¬ä¸‰ä»¶äº‹ï¼š</p><ol><li>ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚é›†åˆï¼‰æ¥æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼›</li><li>ä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå½¢æˆä¸€æ¡æµçš„æµæ°´çº¿ï¼›</li><li>ä¸€ä¸ªä¸­é—´æ“ä½œï¼Œæ‰§è¡Œæµæ°´çº¿ï¼Œå¹¶èƒ½ç”Ÿæˆç»“æœã€‚</li></ol><h1 id="ä½¿ç”¨æµ"><a href="#ä½¿ç”¨æµ" class="headerlink" title="ä½¿ç”¨æµ"></a>ä½¿ç”¨æµ</h1><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>Streamsæ¥å£æ”¯æŒfilteræ–¹æ³•ï¼ˆä½ ç°åœ¨åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼‰ã€‚è¯¥æ“ä½œä¼šæ¥å—ä¸€ä¸ª<a href="https://geek-docs.com/java/java-tutorial/predicate.html">è°“è¯</a>ï¼ˆä¸€ä¸ªè¿”å› booleançš„å‡½æ•°ï¼‰ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…æ‹¬æ‰€æœ‰ç¬¦åˆè°“è¯çš„å…ƒç´ çš„æµã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç­›é€‰æ‰€æœ‰ç´ èœ</span></span><br><span class="line">List&lt;Dish&gt; vegetarianMenu = menu.stream() </span><br><span class="line">                .filter(Dish::isVegetarian) </span><br><span class="line">                .collect(toList());</span><br></pre></td></tr></table></figure><h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><p>å’Œæ•°æ®åº“çš„distinctå…³é”®è¯å¾ˆåƒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå…ƒç´ å„å¼‚ï¼ˆå³æ— é‡å¤çš„ï¼Œæ ¹æ®æµæ‰€ç”Ÿæˆå…ƒç´ çš„ hashCodeå’Œequalsæ–¹æ³•å®ç°ï¼‰çš„æµã€‚</p><h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><p>å’Œæ•°æ®åº“çš„limitå…³é”®è¯å¾ˆåƒï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªä¸è¶…è¿‡ç»™å®šé•¿åº¦çš„æµã€‚</p><h2 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h2><p>æµè¿˜æ”¯æŒskip(n)æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰nä¸ªå…ƒç´ çš„æµã€‚</p><h2 id="â˜†map"><a href="#â˜†map" class="headerlink" title="â˜†map"></a>â˜†map</h2><p><strong>å¯¹æµä¸­æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨å‡½æ•°</strong>ã€‚æµæ”¯æŒmapæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æµä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…¶æ˜  æˆä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬è€Œä¸æ˜¯ä¿®æ”¹åŸå§‹æµï¼‰ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æŠŠæ–¹æ³•å¼•ç”¨Dish::getNameä¼ ç»™äº†mapæ–¹æ³•ï¼Œ æ¥æå–æµä¸­èœè‚´çš„åç§°ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; dishNames = menu.stream() </span><br><span class="line">                             .map(Dish::getName) </span><br><span class="line">                             .collect(toList());</span><br></pre></td></tr></table></figure><h2 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h2><p>å½“ç»™å®šå•è¯åˆ—è¡¨<code>[&quot;Hello&quot;,&quot;World&quot;]</code>ï¼Œæƒ³è¦è¿”å›å„ä¸ç›¸åŒçš„å­—ç¬¦åˆ—è¡¨<code>[&quot;H&quot;,&quot;e&quot;,&quot;l&quot;, &quot;o&quot;,&quot;W&quot;,&quot;r&quot;,&quot;d&quot;]</code>ã€‚å¦‚æœä½ ä½¿ç”¨<code>map(word -&gt; word.split(&quot;&quot;))</code>ï¼Œä½ ä¼šå‘ç°è¿™æ ¹æœ¬ä¸èµ·ä½œç”¨ï¼Œè¿™ä¸ªæ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œä¼ é€’ç»™mapæ–¹æ³•çš„Lambdaï¼ˆword -&gt; word.split(â€œâ€)ï¼‰ä¸ºæ¯ä¸ªå•è¯è¿”å›äº†ä¸€ä¸ªString[]ï¼ˆString åˆ—è¡¨ï¼‰ã€‚å› æ­¤ï¼Œmapè¿”å›çš„æµå®é™…ä¸Šæ˜¯Stream<String[]>ç±»å‹çš„ã€‚ä½ çœŸæ­£æƒ³è¦çš„æ˜¯ç”¨ Streamæ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æµã€‚</p><p>æ­¤æ—¶ä½ å¯ä»¥ä½¿ç”¨flatMapã€‚ä½¿ç”¨flatMapæ–¹æ³•çš„æ•ˆæœæ˜¯ï¼Œå„ä¸ªæ•°ç»„å¹¶ä¸æ˜¯åˆ†åˆ«æ˜ å°„æˆä¸€ä¸ªæµï¼Œè€Œæ˜ å°„æˆæµçš„å†…å®¹ã€‚æ‰€ æœ‰ä½¿ç”¨map(Arrays::stream)æ—¶ç”Ÿæˆçš„å•ä¸ªæµéƒ½è¢«åˆå¹¶èµ·æ¥ï¼Œå³æ‰å¹³åŒ–ä¸ºä¸€ä¸ªæµã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; uniqueCharacters = words.stream() </span><br><span class="line">                                    .map(w -&gt; w.split(<span class="string">&quot;&quot;</span>)) </span><br><span class="line">                                    .flatMap(Arrays::stream) </span><br><span class="line">                                    .distinct() </span><br><span class="line">                                    .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾ä¸åŒ¹é…"><a href="#æŸ¥æ‰¾ä¸åŒ¹é…" class="headerlink" title="æŸ¥æ‰¾ä¸åŒ¹é…"></a>æŸ¥æ‰¾ä¸åŒ¹é…</h2><blockquote><p> å¦ä¸€ä¸ªå¸¸è§çš„æ•°æ®å¤„ç†æ“ä½œæ˜¯çœ‹çœ‹æ•°æ®é›†ä¸­çš„æŸäº›å…ƒç´ æ˜¯å¦åŒ¹é…ä¸€ä¸ªç»™å®šçš„å±æ€§ï¼Œ Stream APIé€šè¿‡allMatchã€anyMatchã€noneMatchã€findFirstå’ŒfindAnyæ–¹æ³•æä¾›äº†è¿™æ ·çš„å·¥å…·ã€‚</p></blockquote><h3 id="anyMatch"><a href="#anyMatch" class="headerlink" title="anyMatch"></a>anyMatch</h3><p>anyMatchæ–¹æ³•å¯ä»¥è§£å†³ â€œæµä¸­æ˜¯å¦æœ‰ä¸€ä¸ªå…ƒç´ èƒ½åŒ¹é…ç»™å®šçš„è°“è¯â€ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥çœ‹çœ‹èœå•é‡Œé¢æ˜¯å¦æœ‰ç´ é£Ÿå¯é€‰æ‹©ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">menu.stream().anyMatch(Dish::isVegetarian)</span><br></pre></td></tr></table></figure><p>anyMatchæ–¹æ³•è¿”å›ä¸€ä¸ªbooleanï¼Œå› æ­¤æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œ</p><h3 id="allMatch"><a href="#allMatch" class="headerlink" title="allMatch"></a>allMatch</h3><p>allMatchæ–¹æ³•ä¼šæ£€æŸ¥æµä¸­çš„å…ƒç´ æ˜¯å¦éƒ½èƒ½åŒ¹é…ç»™å®šçš„è°“è¯ã€‚</p><h3 id="noneMatch"><a href="#noneMatch" class="headerlink" title="noneMatch"></a>noneMatch</h3><p>noneMatchå®ƒå¯ä»¥ç¡®ä¿æµä¸­æ²¡æœ‰ä»»ä½•å…ƒç´ ä¸ç»™å®šçš„è°“è¯åŒ¹é…ã€‚</p><h3 id="findany"><a href="#findany" class="headerlink" title="findany"></a>findany</h3><p>findAnyæ–¹æ³•å°†è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ ï¼Œå®ƒè¿”å›çš„æ˜¯<code>Optional&lt;T&gt;</code></p><h3 id="findFirst"><a href="#findFirst" class="headerlink" title="findFirst"></a>findFirst</h3><p>findFirstæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…ƒç´ </p><h2 id="å½’çº¦"><a href="#å½’çº¦" class="headerlink" title="å½’çº¦"></a>å½’çº¦</h2><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>ä½¿ç”¨reduceï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·å¯¹æµä¸­æ‰€æœ‰çš„å…ƒç´ æ±‚å’Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int sum = numbers.stream().reduce(0, (a, b) -&gt; a + b);</span><br></pre></td></tr></table></figure><p>reduceæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>ä¸€ä¸ªåˆå§‹å€¼ï¼Œè¿™é‡Œæ˜¯0ï¼›</li><li>ä¸€ä¸ªBinaryOperatoræ¥å°†ä¸¤ä¸ªå…ƒç´ ç»“åˆèµ·æ¥äº§ç”Ÿä¸€ä¸ªæ–°å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯ lambda (a, b) -&gt; a + bã€‚</li></ul><p>ä½ ä¹Ÿå¾ˆå®¹æ˜“æŠŠæ‰€æœ‰çš„å…ƒç´ ç›¸ä¹˜ï¼Œåªéœ€è¦å°†å¦ä¸€ä¸ªLambdaï¼š(a, b) -&gt; a * bä¼ é€’ç»™reduce æ“ä½œå°±å¯ä»¥äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int product = numbers.stream().reduce(1, (a, b) -&gt; a * b);</span><br></pre></td></tr></table></figure><p>reduceè¿˜æœ‰ä¸€ä¸ªé‡è½½çš„å˜ä½“ï¼Œå®ƒä¸æ¥å—åˆå§‹å€¼ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸€ä¸ªOptionalå¯¹è±¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Optional&lt;Integer&gt; sum = numbers.stream().reduce((a, b) -&gt; (a + b));</span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆå®ƒè¿”å›ä¸€ä¸ªOptionalå‘¢ï¼Ÿè€ƒè™‘æµä¸­æ²¡æœ‰ä»»ä½•å…ƒç´ çš„æƒ…å†µã€‚reduceæ“ä½œæ—  æ³•è¿”å›å…¶å’Œï¼Œå› ä¸ºå®ƒæ²¡æœ‰åˆå§‹å€¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»“æœè¢«åŒ…è£¹åœ¨ä¸€ä¸ªOptionalå¯¹è±¡é‡Œï¼Œä»¥è¡¨æ˜å’Œå¯èƒ½ä¸å­˜åœ¨ã€‚</p><p>mapå’Œreduceçš„è¿æ¥é€šå¸¸ç§°ä¸ºmap-reduceæ¨¡å¼ï¼Œå› Googleç”¨å®ƒæ¥è¿›è¡Œç½‘ç»œæœç´¢è€Œå‡ºåï¼Œ å› ä¸ºå®ƒå¾ˆå®¹æ˜“å¹¶è¡ŒåŒ–ã€‚</p></blockquote><h3 id="ä¸­é—´æ“ä½œå’Œç»ˆç«¯æ“ä½œè¡¨"><a href="#ä¸­é—´æ“ä½œå’Œç»ˆç«¯æ“ä½œè¡¨" class="headerlink" title="ä¸­é—´æ“ä½œå’Œç»ˆç«¯æ“ä½œè¡¨"></a>ä¸­é—´æ“ä½œå’Œç»ˆç«¯æ“ä½œè¡¨</h3><p><img src="img2.png" alt="æ“ä½œè¡¨"></p><h2 id="æ•°å€¼æµ"><a href="#æ•°å€¼æµ" class="headerlink" title="æ•°å€¼æµ"></a>æ•°å€¼æµ</h2><p>æˆ‘ä»¬åœ¨å‰é¢çœ‹åˆ°äº†å¯ä»¥ä½¿ç”¨reduceæ–¹æ³•è®¡ç®—æµä¸­å…ƒç´ çš„æ€»å’Œã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·è®¡ ç®—èœå•çš„çƒ­é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int calories = menu.stream() </span><br><span class="line">                .map(Dish::getCalories) </span><br><span class="line">                .reduce(0, Integer::sum);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„é—®é¢˜æ˜¯ï¼Œå®ƒæœ‰ä¸€ä¸ªæš—å«çš„è£…ç®±æˆæœ¬ã€‚æ¯ä¸ªIntegeréƒ½å¿…é¡»æ‹†ç®±æˆä¸€ä¸ªåŸå§‹ç±»å‹ï¼Œ å†è¿›è¡Œæ±‚å’Œã€‚ä½†æ˜¯Streamä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¥½çš„è§£å†³åŠæ³•</p><h3 id="åŸå§‹ç±»å‹æµç‰¹åŒ–"><a href="#åŸå§‹ç±»å‹æµç‰¹åŒ–" class="headerlink" title="åŸå§‹ç±»å‹æµç‰¹åŒ–"></a>åŸå§‹ç±»å‹æµç‰¹åŒ–</h3><p>Java 8å¼•å…¥äº†ä¸‰ä¸ªåŸå§‹ç±»å‹ç‰¹åŒ–æµæ¥å£æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šIntStreamã€DoubleStreamå’Œ LongStreamï¼Œåˆ†åˆ«å°†æµä¸­çš„å…ƒç´ ç‰¹åŒ–ä¸ºintã€longå’Œdoubleï¼Œä»è€Œé¿å…äº†æš—å«çš„è£…ç®±æˆæœ¬ã€‚</p><h3 id="æ˜ å°„åˆ°æ•°å€¼æµ"><a href="#æ˜ å°„åˆ°æ•°å€¼æµ" class="headerlink" title="æ˜ å°„åˆ°æ•°å€¼æµ"></a>æ˜ å°„åˆ°æ•°å€¼æµ</h3><p>å°†æµè½¬æ¢ä¸ºç‰¹åŒ–ç‰ˆæœ¬çš„å¸¸ç”¨æ–¹æ³•æ˜¯mapToIntã€mapToDoubleå’ŒmapToLongã€‚è¿™äº›æ–¹æ³•å’Œå‰ é¢è¯´çš„mapæ–¹æ³•çš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œåªæ˜¯å®ƒä»¬è¿”å›çš„æ˜¯ä¸€ä¸ªç‰¹åŒ–æµï¼Œè€Œä¸æ˜¯Streamã€‚</p><p>ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ç”¨mapToIntå¯¹menuä¸­çš„å¡è·¯é‡Œæ±‚å’Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int calories = menu.stream() </span><br><span class="line">                .mapToInt(Dish::getCalories) </span><br><span class="line">                .sum();</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œï¼ŒmapToIntä¼šä»æ¯é“èœä¸­æå–çƒ­é‡ï¼ˆç”¨ä¸€ä¸ªIntegerè¡¨ç¤ºï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªIntStream ï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªStreamï¼‰ã€‚ç„¶åä½ å°±å¯ä»¥è°ƒç”¨IntStreamæ¥å£ä¸­å®šä¹‰çš„sumæ–¹æ³•ï¼Œå¯¹å¡ è·¯é‡Œæ±‚å’Œäº†ï¼è¯·æ³¨æ„ï¼Œå¦‚æœæµæ˜¯ç©ºçš„ï¼Œsumé»˜è®¤è¿”å›0ã€‚IntStreamè¿˜æ”¯æŒå…¶ä»–çš„æ–¹ä¾¿æ–¹æ³•ï¼Œå¦‚ maxã€minã€averageç­‰ã€‚</p></blockquote><h3 id="è½¬æ¢å›å¯¹è±¡æµ"><a href="#è½¬æ¢å›å¯¹è±¡æµ" class="headerlink" title="è½¬æ¢å›å¯¹è±¡æµ"></a>è½¬æ¢å›å¯¹è±¡æµ</h3><p>åŒæ ·ï¼Œä¸€æ—¦æœ‰äº†æ•°å€¼æµï¼Œä½ å¯èƒ½ä¼šæƒ³æŠŠå®ƒè½¬æ¢å›éç‰¹åŒ–æµã€‚ä¾‹å¦‚ï¼ŒIntStreamä¸Šçš„æ“ä½œåªèƒ½ äº§ç”ŸåŸå§‹æ•´æ•°ï¼š IntStream çš„ map æ“ä½œæ¥å—çš„ Lambda å¿…é¡»æ¥å— int å¹¶è¿”å› int ï¼ˆä¸€ä¸ªIntUnaryOperatorï¼‰ã€‚ä½†æ˜¯ä½ å¯èƒ½æƒ³è¦ç”Ÿæˆå¦ä¸€ç±»å€¼ï¼Œæ¯”å¦‚Dishã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦è®¿é—®Stream æ¥å£ä¸­å®šä¹‰çš„é‚£äº›æ›´å¹¿ä¹‰çš„æ“ä½œã€‚è¦æŠŠåŸå§‹æµè½¬æ¢æˆä¸€èˆ¬æµï¼ˆæ¯ä¸ªintéƒ½ä¼šè£…ç®±æˆä¸€ä¸ª Integerï¼‰ï¼Œå¯ä»¥ä½¿ç”¨boxedæ–¹æ³•</p><h3 id="æ•°å€¼èŒƒå›´"><a href="#æ•°å€¼èŒƒå›´" class="headerlink" title="æ•°å€¼èŒƒå›´"></a>æ•°å€¼èŒƒå›´</h3><p>å‡è®¾ä½ æƒ³è¦ç”Ÿæˆ1å’Œ100ä¹‹é—´çš„æ‰€æœ‰æ•°å€¼ï¼Œ Java 8å¼•å…¥äº†ä¸¤ä¸ªå¯ä»¥ç”¨äºIntStreamå’ŒLongStreamçš„é™æ€æ–¹æ³•ï¼Œå¸®åŠ©ç”Ÿæˆè¿™ç§èŒƒå›´ï¼š rangeå’ŒrangeClosedã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ¥å—èµ·å§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥å—ç»“æŸå€¼ã€‚ä½† rangeæ˜¯ä¸åŒ…å«ç»“æŸå€¼çš„ï¼Œè€ŒrangeClosedåˆ™åŒ…å«ç»“æŸå€¼ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„èŒƒå›´æ˜¯[1,100] ç»“æœä¸º50ä¸ª</span></span><br><span class="line"><span class="type">int</span> <span class="variable">evenNumbers</span> <span class="operator">=</span> IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                            .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                            .count();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œçš„èŒƒå›´æ˜¯[1,100) ä¸åŒ…å«100 ç»“æœä¸º49</span></span><br><span class="line"><span class="type">int</span> <span class="variable">evenNumbers2</span> <span class="operator">=</span> IntStream.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                            .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">                            .count();</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨ï¼šå‹¾è‚¡æ•°"><a href="#åº”ç”¨ï¼šå‹¾è‚¡æ•°" class="headerlink" title="åº”ç”¨ï¼šå‹¾è‚¡æ•°"></a>åº”ç”¨ï¼šå‹¾è‚¡æ•°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”ŸæˆNä¸ªå‹¾è‚¡æ•°ä¸‰å…ƒç»„ï¼Œä¾‹(3,4,5), (5,12,13)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Stream&lt;<span class="type">double</span>[]&gt; stream = IntStream.rangeClosed(<span class="number">1</span>, <span class="number">100</span>) <span class="comment">// ç”Ÿæˆ1-100çš„int(a)</span></span><br><span class="line">    .boxed() <span class="comment">//å°è£…ä¸ºStream&lt;Integer&gt;æ‰èƒ½ç»§ç»­æµçš„æ“ä½œ</span></span><br><span class="line">    .flatMap(a -&gt; IntStream.rangeClosed(a, <span class="number">100</span>) <span class="comment">//// ç”Ÿæˆa-100çš„int(b)</span></span><br><span class="line">             .mapToObj(b -&gt; <span class="keyword">new</span> <span class="title class_">double</span>[]&#123;a, b, Math.sqrt(a * a + b * b)&#125;)) <span class="comment">//ç”Ÿæˆä¸‰å…ƒç»„ a,b,a^2+b^2çš„å¼€æ–¹</span></span><br><span class="line">    .filter(t -&gt; t[<span class="number">2</span>] % <span class="number">1</span> == <span class="number">0</span>); <span class="comment">// ç­›é€‰æ‰éæ•´æ•°</span></span><br><span class="line">stream.limit(<span class="number">4</span>).forEach(t -&gt; System.out.println(t[<span class="number">0</span>] + <span class="string">&quot;, &quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;, &quot;</span> + t[<span class="number">2</span>])); <span class="comment">//æ‰“å°å‰å››ä¸ª</span></span><br></pre></td></tr></table></figure><h2 id="æ„å»ºæµ"><a href="#æ„å»ºæµ" class="headerlink" title="æ„å»ºæµ"></a>æ„å»ºæµ</h2><h3 id="ç”±å€¼åˆ›å»ºæµ"><a href="#ç”±å€¼åˆ›å»ºæµ" class="headerlink" title="ç”±å€¼åˆ›å»ºæµ"></a>ç”±å€¼åˆ›å»ºæµ</h3><p>ä½ å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•<code>Stream.of</code>ï¼Œé€šè¿‡æ˜¾å¼å€¼åˆ›å»ºä¸€ä¸ªæµã€‚å®ƒå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;Java 8 &quot;</span>, <span class="string">&quot;Lambdas &quot;</span>, <span class="string">&quot;In &quot;</span>, <span class="string">&quot;Action&quot;</span>); </span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä½¿ç”¨emptyå¾—åˆ°ä¸€ä¸ªç©ºæµï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt; emptyStream = Stream.empty();</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„åˆ›å»ºæµ"><a href="#æ•°ç»„åˆ›å»ºæµ" class="headerlink" title="æ•°ç»„åˆ›å»ºæµ"></a>æ•°ç»„åˆ›å»ºæµ</h3><p>ä½ å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•<code>Arrays.stream</code>ä»æ•°ç»„åˆ›å»ºä¸€ä¸ªæµã€‚å®ƒæ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼Œ ä½ å¯ä»¥å°†ä¸€ä¸ªåŸå§‹ç±»å‹intçš„æ•°ç»„è½¬æ¢æˆä¸€ä¸ªIntStreamï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;; </span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> Arrays.stream(numbers).sum();</span><br></pre></td></tr></table></figure><h3 id="ç”±æ–‡ä»¶ç”Ÿæˆæµ"><a href="#ç”±æ–‡ä»¶ç”Ÿæˆæµ" class="headerlink" title="ç”±æ–‡ä»¶ç”Ÿæˆæµ"></a>ç”±æ–‡ä»¶ç”Ÿæˆæµ</h3><p>Javaä¸­ç”¨äºå¤„ç†æ–‡ä»¶ç­‰I/Oæ“ä½œçš„NIO APIï¼ˆéé˜»å¡I/Oï¼‰å·²æ›´æ–°ï¼Œä»¥ä¾¿åˆ©ç”¨Stream APIã€‚ java.nio.file.Filesä¸­çš„å¾ˆå¤šé™æ€æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªæµã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æ–¹æ³•æ˜¯Files.linesï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªç”±æŒ‡å®šæ–‡ä»¶ä¸­çš„å„è¡Œæ„æˆçš„å­—ç¬¦ä¸²æµã€‚ä½¿ç”¨ä½ è¿„ä»Šæ‰€å­¦çš„å†…å®¹ï¼Œ ä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•çœ‹çœ‹ä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰å¤šå°‘å„ä¸ç›¸åŒçš„è¯ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">uniqueWords</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line">Stream&lt;String&gt; lines = Files.lines(Paths.get(<span class="string">&quot;data.txt&quot;</span>), </span><br><span class="line">uniqueWords = lines.flatMap(line -&gt; Arrays.stream(line.split(<span class="string">&quot; &quot;</span>)))</span><br><span class="line">                .distinct() </span><br><span class="line">                .count(); </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”±å‡½æ•°ç”Ÿæˆæ— é™æµ"><a href="#ç”±å‡½æ•°ç”Ÿæˆæ— é™æµ" class="headerlink" title="ç”±å‡½æ•°ç”Ÿæˆæ— é™æµ"></a>ç”±å‡½æ•°ç”Ÿæˆæ— é™æµ</h3><p>Stream APIæä¾›äº†ä¸¤ä¸ªé™æ€æ–¹æ³•æ¥ä»å‡½æ•°ç”Ÿæˆæµï¼šStream.iterateå’ŒStream.generateã€‚ è¿™ä¸¤ä¸ªæ“ä½œå¯ä»¥åˆ›å»ºæ‰€è°“çš„æ— é™æµï¼šä¸åƒä»å›ºå®šé›†åˆåˆ›å»ºçš„æµé‚£æ ·æœ‰å›ºå®šå¤§å°çš„æµã€‚ç”±iterate å’Œgenerateäº§ç”Ÿçš„æµä¼šç”¨<strong>ç»™å®šçš„å‡½æ•°æŒ‰éœ€åˆ›å»ºå€¼</strong>ï¼Œå› æ­¤å¯ä»¥æ— ç©·æ— å°½åœ°è®¡ç®—ä¸‹å»ï¼ä¸€èˆ¬æ¥è¯´ï¼Œ åº”è¯¥ä½¿ç”¨limit(n)æ¥å¯¹è¿™ç§æµåŠ ä»¥é™åˆ¶</p><h4 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªiterateçš„ç®€å•ä¾‹å­ï¼Œç„¶åå†è§£é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream.iterate(<span class="number">0</span>, n -&gt; n + <span class="number">2</span>) </span><br><span class="line">    .limit(<span class="number">10</span>) </span><br><span class="line">    .forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>iterateæ–¹æ³•æ¥å—ä¸€ä¸ªåˆå§‹å€¼ï¼ˆåœ¨è¿™é‡Œæ˜¯0ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªä¾æ¬¡åº”ç”¨åœ¨æ¯ä¸ªäº§ç”Ÿçš„æ–°å€¼ä¸Šçš„ Lambdaï¼ˆUnaryOperatorç±»å‹ï¼‰ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨Lambda n -&gt; n + 2ï¼Œè¿”å›çš„æ˜¯å‰ä¸€ä¸ªå…ƒ ç´ åŠ ä¸Š2</p><h4 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h4><p>ä¸iterateæ–¹æ³•ç±»ä¼¼ï¼Œgenerateæ–¹æ³•ä¹Ÿå¯è®©ä½ æŒ‰éœ€ç”Ÿæˆä¸€ä¸ªæ— é™æµã€‚ä½†generateä¸æ˜¯ä¾æ¬¡ å¯¹æ¯ä¸ªæ–°ç”Ÿæˆçš„å€¼åº”ç”¨å‡½æ•°çš„ã€‚å®ƒæ¥å—ä¸€ä¸ªSupplierç±»å‹çš„Lambdaæä¾›æ–°çš„å€¼ã€‚æˆ‘ä»¬å…ˆæ¥ çœ‹ä¸€ä¸ªç®€å•çš„ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream.generate(Math::random) </span><br><span class="line">    .limit(<span class="number">5</span>) </span><br><span class="line">    .forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°†ç”Ÿæˆä¸€ä¸ªæµï¼Œå…¶ä¸­æœ‰äº”ä¸ª0åˆ°1ä¹‹é—´çš„éšæœºåŒç²¾åº¦æ•°ã€‚ä¾‹å¦‚ï¼Œè¿è¡Œä¸€æ¬¡å¾—åˆ°äº†ä¸‹é¢ çš„ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0.9410810294106129 </span><br><span class="line">0.6586270755634592 </span><br><span class="line">0.9592859117266873 </span><br><span class="line">0.13743396659487006 </span><br><span class="line">0.3942776037651241</span><br></pre></td></tr></table></figure><p>Math.Randomé™æ€æ–¹æ³•è¢«ç”¨ä½œæ–°å€¼ç”Ÿæˆå™¨ã€‚</p><p>è¯¦ç•¥ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€ŠJava8 å®æˆ˜ã€‹</li><li><a href="https://github.com/caotinging/Java8Action#%E6%B5%81%E6%98%AF%E4%BB%80%E4%B9%88">ã€Šjava8å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»å…¸å†…æ’åºç®—æ³•æ±‡æ€»</title>
      <link href="/2022/05/18/%E7%BB%8F%E5%85%B8%E5%86%85%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%B1%87%E6%80%BB/"/>
      <url>/2022/05/18/%E7%BB%8F%E5%85%B8%E5%86%85%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡ä»‹ç»å‡ ç§ç»å…¸ã€å¸¸è€ƒçš„å†…æ’åºç®—æ³•ã€‚</p><p>æœ¬æ–‡è¯•å›¾å»ºç«‹ä¸€ä¸ªæ¯”è¾ƒæ ‡å‡†çš„å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€å †æ’åºç®—æ³•ä»£ç ã€‚</p><h1 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h1><p>äº†è§£ã€‚</p><h2 id="ç®—æ³•æ€æƒ³"><a href="#ç®—æ³•æ€æƒ³" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>æ¯ä¸€è½®é€‰å–æœªæ’å®šçš„éƒ¨åˆ†ä¸­<strong>æœ€å°</strong>çš„éƒ¨åˆ†äº¤æ¢åˆ°æœªæ’å®šéƒ¨åˆ†çš„æœ€å¼€å¤´ï¼Œç»è¿‡è‹¥å¹²ä¸ªæ­¥éª¤ï¼Œå°±èƒ½æ’å®šæ•´ä¸ªæ•°ç»„ã€‚å³ï¼šå…ˆé€‰å‡ºæœ€å°çš„ï¼Œå†é€‰å‡ºç¬¬ 2 å°çš„ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç•¥</p><h1 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h1><p>äº†è§£</p><h2 id="ç®—æ³•æ€æƒ³-1"><a href="#ç®—æ³•æ€æƒ³-1" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>æ¯æ¬¡å°†ä¸€ä¸ªæ•°å­—æ’å…¥ä¸€ä¸ªæœ‰åºçš„æ•°ç»„é‡Œï¼Œæˆä¸ºä¸€ä¸ªé•¿åº¦æ›´é•¿çš„æœ‰åºæ•°ç»„ï¼Œæœ‰é™æ¬¡æ“ä½œä»¥åï¼Œæ•°ç»„æ•´ä½“æœ‰åºã€‚</p><p><img src="æ’å…¥æ’åº.gif" alt="æ’å…¥æ’åºæ’åº"></p><h2 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç•¥</p><h1 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h1><p>äº†è§£</p><h2 id="ç®—æ³•æ€æƒ³-2"><a href="#ç®—æ³•æ€æƒ³-2" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>å¤–å±‚å¾ªç¯æ¯ä¸€æ¬¡ç»è¿‡ä¸¤ä¸¤æ¯”è¾ƒï¼ŒæŠŠæ¯ä¸€è½®æœªæ’å®šéƒ¨åˆ†æœ€å¤§çš„å…ƒç´ æ”¾åˆ°äº†æ•°ç»„çš„æœ«å°¾ï¼›<br>ã€Œå†’æ³¡æ’åºã€æœ‰ä¸ªç‰¹ç‚¹ï¼šåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œæå‰æ£€æµ‹åˆ°æ•°ç»„æ˜¯æœ‰åºçš„ï¼Œä»è€Œç»“æŸæ’åºï¼Œè€Œä¸åƒã€Œé€‰æ‹©æ’åºã€é‚£æ ·ï¼Œå³ä½¿è¾“å…¥æ•°æ®æ˜¯æœ‰åºçš„ï¼Œã€Œé€‰æ‹©æ’åºã€ä¾ç„¶éœ€è¦ã€Œå‚»ä¹ä¹ã€åœ°èµ°å®Œæ‰€æœ‰çš„æµç¨‹ã€‚</p><h2 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç•¥</p><h1 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h1><p>äº†è§£</p><h2 id="ç®—æ³•æ€æƒ³-3"><a href="#ç®—æ³•æ€æƒ³-3" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>æ’å…¥æ’åºçš„ä¼˜åŒ–ã€‚åœ¨æ’å…¥æ’åºé‡Œï¼Œå¦‚æœé åçš„æ•°å­—è¾ƒå°ï¼Œå®ƒæ¥åˆ°å‰é¢å°±å¾—äº¤æ¢å¤šæ¬¡ã€‚ã€Œå¸Œå°”æ’åºã€æ”¹è¿›äº†è¿™ç§åšæ³•ã€‚å¸¦é—´éš”åœ°ä½¿ç”¨æ’å…¥æ’åºï¼Œç›´åˆ°æœ€åã€Œé—´éš”ã€ä¸º 11 çš„æ—¶å€™ï¼Œå°±æ˜¯æ ‡å‡†çš„ã€Œæ’å…¥æ’åºã€ï¼Œæ­¤æ—¶æ•°ç»„é‡Œçš„å…ƒç´ å·²ç»ã€Œå‡ ä¹æœ‰åºã€äº†ã€‚</p><h2 id="å®ç°-3"><a href="#å®ç°-3" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ç•¥</p><h1 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h1><p>é‡è¦</p><h2 id="ç®—æ³•æ€æƒ³-4"><a href="#ç®—æ³•æ€æƒ³-4" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>å¿«é€Ÿæ’åºæ¯ä¸€æ¬¡éƒ½æ’å®šä¸€ä¸ªå…ƒç´ ï¼ˆè¿™ä¸ªå…ƒç´ å‘†åœ¨äº†å®ƒæœ€ç»ˆåº”è¯¥å‘†çš„ä½ç½®ï¼‰ï¼Œç„¶åé€’å½’åœ°å»æ’å®ƒå·¦è¾¹çš„éƒ¨åˆ†å’Œå³è¾¹çš„éƒ¨åˆ†ï¼Œä¾æ¬¡è¿›è¡Œä¸‹å»ï¼Œç›´åˆ°æ•°ç»„æœ‰åºã€‚</p><h2 id="å®ç°ï¼ˆé€’å½’ï¼‰"><a href="#å®ç°ï¼ˆé€’å½’ï¼‰" class="headerlink" title="å®ç°ï¼ˆé€’å½’ï¼‰"></a>å®ç°ï¼ˆé€’å½’ï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//https://mp.weixin.qq.com/s/8ZTMhvHJK_He48PpSt_AmQ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Quick</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸ºäº†é¿å…å‡ºç°è€—æ—¶çš„æç«¯æƒ…å†µï¼Œå…ˆéšæœºæ‰“ä¹±</span></span><br><span class="line">        shuffle(nums);</span><br><span class="line">        <span class="comment">// æ’åºæ•´ä¸ªæ•°ç»„ï¼ˆåŸåœ°ä¿®æ”¹ï¼‰</span></span><br><span class="line">        sort(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lo &gt;= hi) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¯¹ nums[lo..hi] è¿›è¡Œåˆ‡åˆ†</span></span><br><span class="line">        <span class="comment">// ä½¿å¾— nums[lo..p-1] &lt;= nums[p] &lt; nums[p+1..hi]</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> partition(nums, lo, hi);</span><br><span class="line"></span><br><span class="line">        sort(nums, lo, p - <span class="number">1</span>);</span><br><span class="line">        sort(nums, p + <span class="number">1</span>, hi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹ nums[lo..hi] è¿›è¡Œåˆ‡åˆ†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> nums[lo];</span><br><span class="line">        <span class="comment">// å…³äºåŒºé—´çš„è¾¹ç•Œæ§åˆ¶éœ€æ ¼å¤–å°å¿ƒï¼Œç¨æœ‰ä¸æ…å°±ä¼šå‡ºé”™</span></span><br><span class="line">        <span class="comment">// æˆ‘è¿™é‡ŒæŠŠ i, j å®šä¹‰ä¸ºå¼€åŒºé—´ï¼ŒåŒæ—¶å®šä¹‰ï¼š</span></span><br><span class="line">        <span class="comment">// [lo, i) &lt;= pivotï¼›(j, hi] &gt; pivot</span></span><br><span class="line">        <span class="comment">// ä¹‹åéƒ½è¦æ­£ç¡®ç»´æŠ¤è¿™ä¸ªè¾¹ç•ŒåŒºé—´çš„å®šä¹‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo + <span class="number">1</span>, j = hi;</span><br><span class="line">        <span class="comment">// å½“ i &gt; j æ—¶ç»“æŸå¾ªç¯ï¼Œä»¥ä¿è¯åŒºé—´ [lo, hi] éƒ½è¢«è¦†ç›–</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; hi &amp;&amp; nums[i] &lt;= pivot) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="comment">// æ­¤ while ç»“æŸæ—¶æ°å¥½ nums[i] &gt; pivot</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (j &gt; lo &amp;&amp; nums[j] &gt; pivot) &#123;</span><br><span class="line">                j--;</span><br><span class="line">                <span class="comment">// æ­¤ while ç»“æŸæ—¶æ°å¥½ nums[j] &lt;= pivot</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ­¤æ—¶ [lo, i) &lt;= pivot &amp;&amp; (j, hi] &gt; pivot</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i &gt;= j) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(nums, i, j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°† pivot æ”¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œå³ pivot å·¦è¾¹å…ƒç´ è¾ƒå°ï¼Œå³è¾¹å…ƒç´ è¾ƒå¤§</span></span><br><span class="line">        swap(nums, lo, j);</span><br><span class="line">        <span class="keyword">return</span> j;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ´—ç‰Œç®—æ³•ï¼Œå°†è¾“å…¥çš„æ•°ç»„éšæœºæ‰“ä¹±</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shuffle</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// ç”Ÿæˆ [i, n - 1] çš„éšæœºæ•°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> i + rand.nextInt(n - i);</span><br><span class="line">            swap(nums, i, r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸåœ°äº¤æ¢æ•°ç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">        nums[i] = nums[j];</span><br><span class="line">        nums[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°ï¼ˆéé€’å½’ï¼‰"><a href="#å®ç°ï¼ˆéé€’å½’ï¼‰" class="headerlink" title="å®ç°ï¼ˆéé€’å½’ï¼‰"></a>å®ç°ï¼ˆéé€’å½’ï¼‰</h2><p>æš‚ç•¥</p><h1 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h1><p>é‡è¦</p><h2 id="ç®—æ³•æ€æƒ³-5"><a href="#ç®—æ³•æ€æƒ³-5" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>å€ŸåŠ©é¢å¤–ç©ºé—´ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼Œå¾—åˆ°æ›´é•¿çš„æœ‰åºæ•°ç»„ã€‚</p><h2 id="å®ç°-4"><a href="#å®ç°-4" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Merge</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºè¾…åŠ©åˆå¹¶æœ‰åºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆç»™è¾…åŠ©æ•°ç»„å¼€è¾Ÿå†…å­˜ç©ºé—´</span></span><br><span class="line">        temp = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="comment">// æ’åºæ•´ä¸ªæ•°ç»„ï¼ˆåŸåœ°ä¿®æ”¹ï¼‰</span></span><br><span class="line">        sort(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ï¼šå°†å­æ•°ç»„ nums[lo..hi] è¿›è¡Œæ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lo == hi) &#123;</span><br><span class="line">            <span class="comment">// å•ä¸ªå…ƒç´ ä¸ç”¨æ’åº</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿™æ ·å†™æ˜¯ä¸ºäº†é˜²æ­¢æº¢å‡ºï¼Œæ•ˆæœç­‰åŒäº (hi + lo) / 2</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// å…ˆå¯¹å·¦åŠéƒ¨åˆ†æ•°ç»„ nums[lo..mid] æ’åº</span></span><br><span class="line">        sort(nums, lo, mid);</span><br><span class="line">        <span class="comment">// å†å¯¹å³åŠéƒ¨åˆ†æ•°ç»„ nums[mid+1..hi] æ’åº</span></span><br><span class="line">        sort(nums, mid + <span class="number">1</span>, hi);</span><br><span class="line">        <span class="comment">// å°†ä¸¤éƒ¨åˆ†æœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line">        merge(nums, lo, mid, hi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† nums[lo..mid] å’Œ nums[mid+1..hi] è¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lo, <span class="type">int</span> mid, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆæŠŠ nums[lo..hi] å¤åˆ¶åˆ°è¾…åŠ©æ•°ç»„ä¸­</span></span><br><span class="line">        <span class="comment">// ä»¥ä¾¿åˆå¹¶åçš„ç»“æœèƒ½å¤Ÿç›´æ¥å­˜å…¥ nums</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo; i &lt;= hi; i++) &#123;</span><br><span class="line">            temp[i] = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo, j = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> lo; p &lt;= hi; p++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == mid + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// å·¦åŠè¾¹æ•°ç»„å·²å…¨éƒ¨è¢«åˆå¹¶</span></span><br><span class="line">                nums[p] = temp[j++];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == hi + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// å³åŠè¾¹æ•°ç»„å·²å…¨éƒ¨è¢«åˆå¹¶</span></span><br><span class="line">                nums[p] = temp[i++];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (temp[i] &gt; temp[j]) &#123;</span><br><span class="line">                nums[p] = temp[j++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                nums[p] = temp[i++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h1><p>é‡è¦</p><h2 id="ç®—æ³•æ€æƒ³-6"><a href="#ç®—æ³•æ€æƒ³-6" class="headerlink" title="ç®—æ³•æ€æƒ³"></a>ç®—æ³•æ€æƒ³</h2><p>å°†å¾…æ’åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ï¼Œæ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æ ¹èŠ‚ç‚¹ã€‚å°†å…¶ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å°±ä¸ºæœ€å¤§å€¼ã€‚ç„¶åå°†å‰©ä½™n-1ä¸ªå…ƒç´ é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·ä¼šå¾—åˆ°nä¸ªå…ƒç´ çš„æ¬¡å°å€¼ã€‚å¦‚æ­¤åå¤æ‰§è¡Œï¼Œä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</p><h2 id="å®ç°-5"><a href="#å®ç°-5" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortArray(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="comment">// å°†æ•°ç»„æ•´ç†æˆå †</span></span><br><span class="line">        heapify(nums);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯ä¸å˜é‡ï¼šåŒºé—´ [0, i] å †æœ‰åº</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> len - <span class="number">1</span>; i &gt;= <span class="number">1</span>; ) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå †é¡¶å…ƒç´ ï¼ˆå½“å‰æœ€å¤§ï¼‰äº¤æ¢åˆ°æ•°ç»„æœ«å°¾</span></span><br><span class="line">            swap(nums, <span class="number">0</span>, i);</span><br><span class="line">            <span class="comment">// é€æ­¥å‡å°‘å †æœ‰åºçš„éƒ¨åˆ†</span></span><br><span class="line">            i--;</span><br><span class="line">            <span class="comment">// ä¸‹æ ‡ 0 ä½ç½®ä¸‹æ²‰æ“ä½œï¼Œä½¿å¾—åŒºé—´ [0, i] å †æœ‰åº</span></span><br><span class="line">            siftDown(nums, <span class="number">0</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°ç»„æ•´ç†æˆå †ï¼ˆå †æœ‰åºï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="comment">// åªéœ€è¦ä» i = (len - 1) / 2 è¿™ä¸ªä½ç½®å¼€å§‹é€å±‚ä¸‹ç§»</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (len - <span class="number">1</span>) / <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            siftDown(nums, i, len - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k    å½“å‰ä¸‹æ²‰å…ƒç´ çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end  [0, end] æ˜¯ nums çš„æœ‰æ•ˆéƒ¨åˆ†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">siftDown</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">2</span> * k + <span class="number">1</span> &lt;= end) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span> * k + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (j + <span class="number">1</span> &lt;= end &amp;&amp; nums[j + <span class="number">1</span>] &gt; nums[j]) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &gt; nums[k]) &#123;</span><br><span class="line">                swap(nums, j, k);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            k = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> index1, <span class="type">int</span> index2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[index1];</span><br><span class="line">        nums[index1] = nums[index2];</span><br><span class="line">        nums[index2] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ’åºå¤æ‚åº¦æ¯”è¾ƒ"><a href="#æ’åºå¤æ‚åº¦æ¯”è¾ƒ" class="headerlink" title="æ’åºå¤æ‚åº¦æ¯”è¾ƒ"></a>æ’åºå¤æ‚åº¦æ¯”è¾ƒ</h1><p><img src="https://www.runoob.com/wp-content/uploads/2019/03/sort.png" alt="å›¾ç‰‡æ¥æºï¼šèœé¸Ÿæ•™ç¨‹/åå¤§ç»å…¸æ’åº"></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://leetcode-cn.com/problems/sort-an-array/solution/fu-xi-ji-chu-pai-xu-suan-fa-java-by-liweiwei1419/">å¤ä¹ åŸºç¡€æ’åºç®—æ³•</a></li><li><a href="https://www.runoob.com/w3cnote/ten-sorting-algorithm.html">èœé¸Ÿæ•™ç¨‹ï¼šåå¤§æ’åºç®—æ³•</a></li><li>ã€Šç®—æ³• ç¬¬å››ç‰ˆã€‹</li><li><a href="https://mp.weixin.qq.com/s/8ZTMhvHJK_He48PpSt_AmQ">å¿«é€Ÿæ’åºçš„æ­£ç¡®ç†è§£æ–¹å¼åŠè¿ç”¨</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzAxODQxMDM0Mw==&amp;mid=2247495989&amp;idx=1&amp;sn=30e34ac75dd1c724205e9c8b0f488e35&amp;scene=21#wechat_redirect">å½’å¹¶æ’åºçš„æ­£ç¡®ç†è§£æ–¹å¼åŠè¿ç”¨</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> æ’åº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8æ–°ç‰¹æ€§1ï¼šè¡Œä¸ºå‚æ•°åŒ–</title>
      <link href="/2022/05/05/Java8%E6%96%B0%E7%89%B9%E6%80%A71%EF%BC%9A%E8%A1%8C%E4%B8%BA%E5%8F%82%E6%95%B0%E5%8C%96/"/>
      <url>/2022/05/05/Java8%E6%96%B0%E7%89%B9%E6%80%A71%EF%BC%9A%E8%A1%8C%E4%B8%BA%E5%8F%82%E6%95%B0%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜å°±æ˜¯ï¼Œ<strong>ä¸ç®¡ä½ åšä»€ä¹ˆï¼Œç”¨æˆ·çš„éœ€æ±‚è‚¯å®šä¼šå˜</strong>ã€‚<br><strong>è¡Œä¸ºå‚æ•°åŒ–</strong>å°±æ˜¯å¯ä»¥å¸®åŠ©ä½ å¤„ç†é¢‘ç¹å˜æ›´çš„éœ€æ±‚çš„ä¸€ç§è½¯ä»¶å¼€å‘æ¨¡å¼ã€‚ä¸€è¨€ä»¥è”½ä¹‹ï¼Œå®ƒæ„å‘³ç€æ‹¿å‡ºä¸€ä¸ªä»£ç å—ï¼ŒæŠŠå®ƒå‡†å¤‡å¥½å´ä¸å»æ‰§è¡Œå®ƒã€‚è¿™ä¸ªä»£ç å—ä»¥åå¯ä»¥è¢«ä½ ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†è°ƒç”¨ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥æ¨è¿Ÿè¿™å—ä»£ç çš„æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†ä»£ç å—ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªæ–¹æ³•ï¼Œç¨åå†å»æ‰§è¡Œå®ƒã€‚è¿™æ ·ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºå°±åŸºäºé‚£å—ä»£ç è¢«å‚æ•°åŒ–äº†ã€‚</p><h1 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h1><p>é€šè¿‡é€æ­¥æ”¹è¿›æ¡ˆä¾‹ï¼Œæ¥ç†Ÿæ‚‰ä»€ä¹ˆæ˜¯â€œè¡Œä¸ºå‚æ•°åŒ–â€ã€‚</p><blockquote><p>éœ€æ±‚ï¼šå†œæ°‘å¸Œæœ›ç­›é€‰å‡º1. ç»¿è‰²çš„è‹¹æœï¼Œ2. é‡é‡å¤§äº150çš„è‹¹æœ 3â€¦.</p></blockquote><h2 id="æ–¹æ¡ˆ1"><a href="#æ–¹æ¡ˆ1" class="headerlink" title="æ–¹æ¡ˆ1"></a>æ–¹æ¡ˆ1</h2><p>å¯èƒ½çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®é¢œè‰²ç­›é€‰è‹¹æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> apples</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Apple&gt; <span class="title function_">filterByColor</span><span class="params">(List&lt;Apple&gt; apples, String color)</span> &#123;</span><br><span class="line">    List&lt;Apple&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Apple apple : apples) &#123;</span><br><span class="line">        <span class="keyword">if</span>(apple.getColor().equals(color)) &#123;</span><br><span class="line">            res.add(apple);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®é‡é‡ç­›é€‰è‹¹æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> apples</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> weight</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Apple&gt; <span class="title function_">filterByWeight</span><span class="params">(List&lt;Apple&gt; apples, <span class="type">int</span> weight)</span> &#123;</span><br><span class="line">    List&lt;Apple&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Apple apple : apples) &#123;</span><br><span class="line">        <span class="keyword">if</span>(apple.getWeight() &gt; weight) &#123;</span><br><span class="line">            res.add(apple);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†œæ°‘é€šè¿‡è°ƒç”¨æ¥è·å¾—ç­”æ¡ˆ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterByColor(apples, <span class="string">&quot;green&quot;</span>);</span><br><span class="line">filterByWeight(apples, <span class="number">150</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšæ‰“ç ´äº†<strong>DRYï¼ˆDonâ€™t RepeatYourselfï¼Œä¸è¦é‡å¤è‡ªå·±ï¼‰çš„è½¯ä»¶å·¥ç¨‹åŸåˆ™</strong>ã€‚è¿™æ ·åšå‡ºç°äº†å¤§é‡çš„é‡å¤ä»£ç ï¼Œå½“ä½ æƒ³è¦ä¿®æ”¹æŸäº›é€»è¾‘ï¼Œæ¯”å¦‚ä¼˜åŒ–éå†è¯­å¥æ—¶ï¼Œä½ éœ€è¦ä¿®æ”¹æ‰€æœ‰æ–¹æ³•ä¸­çš„ä»£ç ã€‚</p><p>å¦ä¸€ç§æ–¹æ¡ˆæ˜¯ï¼ŒæŠŠæ‰€æœ‰å‚æ•°éƒ½æ•´åˆåˆ°ä¸€ä¸ªæ–¹æ³•ä¸­å»ï¼Œç­¾åå¦‚ä¸‹ï¼š<code>public static List&lt;Apple&gt; filterByColor(List&lt;Apple&gt; apples, String color, int weight)</code></p><p>è¿™æ ·åšä¸ä»…ç¬¨æ‹™ï¼Œè€Œä¸”é¢å¯¹å˜åŒ–ä¸èƒ½åšå‡ºè°ƒæ•´ï¼Œå¦‚æœæœ‰æ–°çš„ç­›é€‰æ¡ä»¶ï¼Œæ¯”å¦‚äº§åœ°ï¼Œå¤§å°ï¼Œå½¢çŠ¶ç­‰æ€ä¹ˆåŠï¼Ÿ</p><h2 id="æ–¹æ¡ˆ2ï¼šè¡Œä¸ºå‚æ•°åŒ–"><a href="#æ–¹æ¡ˆ2ï¼šè¡Œä¸ºå‚æ•°åŒ–" class="headerlink" title="æ–¹æ¡ˆ2ï¼šè¡Œä¸ºå‚æ•°åŒ–"></a>æ–¹æ¡ˆ2ï¼šè¡Œä¸ºå‚æ•°åŒ–</h2><p>è®©æˆ‘ä»¬åé€€ä¸€æ­¥æ¥çœ‹çœ‹æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ã€‚ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯å¯¹ä½ çš„é€‰æ‹©æ ‡å‡†å»ºæ¨¡ï¼šä½ è€ƒè™‘çš„æ˜¯è‹¹æœï¼Œéœ€è¦æ ¹æ®Appleçš„æŸäº›å±æ€§ï¼ˆæ¯”å¦‚å®ƒæ˜¯ç»¿è‰²çš„å—ï¼Ÿé‡é‡è¶…è¿‡150å…‹å—ï¼Ÿï¼‰æ¥è¿”å›ä¸€ä¸ªbooleanå€¼ã€‚æˆ‘ä»¬æŠŠå®ƒç§°ä¸º<strong>è°“è¯</strong>ï¼ˆå³ä¸€ä¸ªè¿”å›booleanå€¼çš„å‡½æ•°ï¼‰ã€‚è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£æ¥å¯¹é€‰æ‹©æ ‡å‡†å»ºæ¨¡ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApplePredicate</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Apple apple)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ç”¨ApplePredicateçš„å¤šä¸ªå®ç°ä»£è¡¨ä¸åŒçš„é€‰æ‹©æ ‡å‡†ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppleGreenColorPredicate</span> <span class="keyword">implements</span> <span class="title class_">ApplePredicate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Apple apple)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;green&quot;</span>.equals(apple.getColor());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppleHeavyWeightPredicate</span> <span class="keyword">implements</span> <span class="title class_">ApplePredicate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Apple apple)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> apple.getWeight() &gt; <span class="number">150</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥æŠŠè¿™äº›æ ‡å‡†çœ‹ä½œfilteræ–¹æ³•çš„ä¸åŒè¡Œä¸ºã€‚ä½ åˆšåšçš„è¿™äº›å’Œâ€œ<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>â€ç›¸å…³ï¼Œå®ƒè®©ä½ å®šä¹‰ä¸€æ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬å°è£…èµ·æ¥ï¼ˆç§°ä¸ºâ€œç­–ç•¥â€ï¼‰ï¼Œç„¶ååœ¨è¿è¡Œæ—¶é€‰æ‹©ä¸€ä¸ªç®—æ³•ã€‚åœ¨è¿™é‡Œï¼Œç®—æ³•æ—å°±æ˜¯ApplePredicateï¼Œä¸åŒçš„ç­–ç•¥å°±æ˜¯AppleHeavyWeightPredicateå’ŒAppleGreenColorPredicateã€‚</p><p>ä½†æ˜¯ï¼Œè¯¥æ€ä¹ˆåˆ©ç”¨ApplePredicateçš„ä¸åŒå®ç°å‘¢ï¼Ÿä½ éœ€è¦filterApplesæ–¹æ³•æ¥å—ApplePredicateå¯¹è±¡ï¼Œå¯¹Appleåšæ¡ä»¶æµ‹è¯•ã€‚è¿™å°±æ˜¯è¡Œä¸ºå‚æ•°åŒ–ï¼š<strong>è®©æ–¹æ³•æ¥å—å¤šç§è¡Œä¸ºï¼ˆæˆ–æˆ˜ç•¥ï¼‰ä½œä¸ºå‚æ•°</strong>ï¼Œå¹¶åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œæ¥å®Œæˆä¸åŒçš„è¡Œä¸ºã€‚è¿™åœ¨è½¯ä»¶å·¥ç¨‹ä¸Šæœ‰å¾ˆå¤§å¥½å¤„ï¼šç°åœ¨ä½ æŠŠfilterApplesæ–¹æ³•è¿­ä»£é›†åˆçš„é€»è¾‘ä¸ä½ è¦åº”ç”¨åˆ°é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„è¡Œä¸ºï¼ˆè¿™é‡Œæ˜¯ä¸€ä¸ªè°“è¯ï¼‰åŒºåˆ†å¼€äº†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Apple&gt; <span class="title function_">filterApples</span><span class="params">(List&lt;Apple&gt; apples, ApplePredicate p)</span> &#123;</span><br><span class="line">    List&lt;Apple&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Apple apple : apples) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p.test(apple)) &#123;</span><br><span class="line">            res.add(apple);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šè¿™æ ·åšæœ‰ä¸€ç‚¹ç¼ºæ†¾å°±æ˜¯ï¼Œæˆ‘æ˜æ˜é‡è¦çš„åªæœ‰ä¸€ä¸ªtestæ–¹æ³•ï¼Œä½†æ˜¯filterApplesåªèƒ½æ¥å—å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸æŠŠtestæ–¹æ³•å°è£…åœ¨ApplePredicateå¯¹è±¡ä¸­è¿›è¡Œä¼ é€’ã€‚åé¢ä¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼è¿›è¡Œç®€åŒ–ã€‚</p><h2 id="æ–¹æ¡ˆ2-1ï¼šä½¿ç”¨åŒ¿åç±»æ”¹è¿›"><a href="#æ–¹æ¡ˆ2-1ï¼šä½¿ç”¨åŒ¿åç±»æ”¹è¿›" class="headerlink" title="æ–¹æ¡ˆ2-1ï¼šä½¿ç”¨åŒ¿åç±»æ”¹è¿›"></a>æ–¹æ¡ˆ2-1ï¼šä½¿ç”¨åŒ¿åç±»æ”¹è¿›</h2><p>å¯¹äºä»¥ä¸Šä»£ç çš„è°ƒç”¨æˆ‘ä»¬è¦è´¹å¾ˆå¤§åŠ²ï¼Œåˆ›å»ºApplePredicateçš„ä¸¤ä¸ªå®ç°ç±»ï¼Œç„¶åæŠŠè¿™ä¸¤ä¸ªç±»å®ä¾‹åŒ–ä¼ å…¥åˆ°filterApplesæ–¹æ³•ä¸­å»ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterApples(apples, <span class="keyword">new</span> <span class="title class_">AppleGreenColorPredicate</span>());</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ¿åç±»ç®€åŒ–è¿™ä¸€æµç¨‹ã€‚ä»¥ç­›é€‰å‡ºç»¿è‰²è‹¹æœä¸ºä¾‹ï¼Œæ”¹è¿›åçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterApples(apples, <span class="keyword">new</span> <span class="title class_">ApplePredicate</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Apple apple)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;green&quot;</span>.equals(apple.getColor());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä½†åŒ¿åç±»è¿˜ä¸å¤Ÿå¥½ï¼š</p><ul><li>ç¬¨é‡ï¼šæ¯æ¬¡å®ç°æ–°çš„<code>new ApplePredicate()</code>éƒ½è¦å†™å¾ˆå¤šæ¨¡æ¿ä»£ç <code>...test...</code></li><li>è´¹è§£ï¼šè¿™é‡Œä¸è¿‡å¤šè§£é‡Š</li></ul><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼è®©ä»£ç æ›´å¹²å‡€</p><h2 id="æ–¹æ¡ˆ2-2ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼"><a href="#æ–¹æ¡ˆ2-2ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼" class="headerlink" title="æ–¹æ¡ˆ2-2ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼"></a>æ–¹æ¡ˆ2-2ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼</h2><p>ä½¿ç”¨Lambdaè¡¨è¾¾å¼è®©ä¸Šè¿°ä»£ç é‡å†™ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterApples(apples, (Apple apple) -&gt; <span class="string">&quot;green&quot;</span>.equals(apple.getColor()) );</span><br></pre></td></tr></table></figure><h1 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>å°†è‹¹æœæŒ‰ç…§é‡é‡ç”±å¤§åˆ°å°æ’åº</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¯¹è‹¹æœæŒ‰é‡é‡æ’åºï¼Œä½¿ç”¨java8 Collections.sort</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨åŒ¿åç±»</span></span><br><span class="line">Collections.sort(apples, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Apple&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Apple a1, Apple a2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a1.getWeight() - a2.getWeight();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨lambdaè¡¨è¾¾å¼</span></span><br><span class="line">Collections.sort(apples, (Apple a1, Apple a2) -&gt; a1.getWeight() - a2.getWeight() );</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€ŠJava 8å®æˆ˜ã€‹</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker åŸºç¡€çŸ¥è¯†æ•´ç†</title>
      <link href="/2022/05/02/Docker-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"/>
      <url>/2022/05/02/Docker-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-èƒ½åšä»€ä¹ˆ"><a href="#Docker-èƒ½åšä»€ä¹ˆ" class="headerlink" title="Docker èƒ½åšä»€ä¹ˆ"></a>Docker èƒ½åšä»€ä¹ˆ</h1><p>ä»¥å‰å­¦ä¹ çš„æ—¶å€™ï¼Œæƒ³è¦æ­å»ºä¸€ä¸ªHadoopé›†ç¾¤ï¼Œé‚£å°±è¦å®‰è£…ä¸€ä¸ªVMWareï¼Œç„¶åè£…è‡³å°‘ä¸‰ä¸ªè™šæ‹Ÿæœºã€‚æ¯ä¸ªè™šæ‹Ÿæœºè‡³å°‘20GBä»¥ä¸Šï¼Œæœ‰äº†Dockerï¼Œä½ åªéœ€è¦å®‰è£…ä¸€å°è™šæ‹Ÿæœºï¼ˆLinuxæ“ä½œç³»ç»Ÿï¼‰ï¼Œåœ¨è¿™å°è™šæ‹Ÿæœºä¸Šå¯åŠ¨å¤šä¸ªDockerå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨åªæœ‰å‡ ç™¾å…†ã€‚</p><p>Dockerå°†ç¡¬ä»¶è¦æ±‚å’Œåº”ç”¨ç¯å¢ƒä¹‹é—´è¿›ä¸€æ­¥è§£è€¦ï¼Œå¤§å¤§æå‡äº†ç¨‹åºğŸ’çš„ç”Ÿäº§åŠ›å’Œå¹¸ç¦æŒ‡æ•°ã€‚</p><p>Dockerçš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>æœ¬åœ°ä¾èµ–ï¼šå¿«é€Ÿå°è¯•å¼€æºé¡¹ç›®è€Œä¸ç”¨æ“å¿ƒç¯å¢ƒé…ç½®ã€‚</li><li>æ­å»ºç¯å¢ƒï¼šåŒä¸€ä¸ªDockeré…ç½®å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­è¿è¡Œã€‚</li><li>å¾®æœåŠ¡</li><li>æ‰©å®¹ï¼šDockeræ”¯æŒæ°´å¹³æ‰©å®¹ã€‚</li><li>â€¦â€¦</li></ul><h1 id="Dockerå’Œè™šæ‹ŸæœºæŠ€æœ¯çš„æ¯”è¾ƒ"><a href="#Dockerå’Œè™šæ‹ŸæœºæŠ€æœ¯çš„æ¯”è¾ƒ" class="headerlink" title="Dockerå’Œè™šæ‹ŸæœºæŠ€æœ¯çš„æ¯”è¾ƒ"></a>Dockerå’Œè™šæ‹ŸæœºæŠ€æœ¯çš„æ¯”è¾ƒ</h1><p>è‡ªå·±æŸ¥ã€‚</p><h1 id="Dockeræ ¸å¿ƒç»„ä»¶"><a href="#Dockeræ ¸å¿ƒç»„ä»¶" class="headerlink" title="Dockeræ ¸å¿ƒç»„ä»¶"></a>Dockeræ ¸å¿ƒç»„ä»¶</h1><ul><li>Dockerå®¢æˆ·ç«¯ï¼šClient</li><li>DockeræœåŠ¡å™¨ï¼šDocker daemon</li><li>Dockeré•œåƒï¼šImage</li><li>Registry</li><li>Dockerå®¹å™¨ï¼šContainer</li></ul><p><img src="image-20220428230419609.png" alt="Dockeræ¶æ„"></p><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><p>Dockerå®¢æˆ·ç«¯æ˜¯æ‰§è¡ŒDockerå‘½ä»¤çš„åœ°æ–¹ã€‚<code>docker run</code>ç­‰ç­‰</p><p>Dockerå®¢æˆ·ç«¯ä¹Ÿæ”¯æŒREST API</p><h2 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h2><p>Docker daemonè¿è¡Œåœ¨Docker hostä¸Šï¼Œè´Ÿè´£åˆ›å»ºã€è¿è¡Œã€ç›‘æ§å®¹å™¨ï¼Œæ„å»ºã€å­˜å‚¨é•œåƒã€‚</p><p>DockeræœåŠ¡å™¨é»˜è®¤æƒ…å†µä¸‹åªå“åº”æ¥è‡ªæœ¬åœ°Hostçš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¦‚æœè¦å…è®¸è¿œç¨‹å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåˆ™éœ€è¦ä¿®æ”¹é…ç½®ï¼ˆGoogleï¼‰</p><h2 id="Dockeré•œåƒ"><a href="#Dockeré•œåƒ" class="headerlink" title="Dockeré•œåƒ"></a>Dockeré•œåƒ</h2><p>Dockeré•œåƒçœ‹æˆåªè¯»æ¨¡æ¿ï¼Œé€šè¿‡å®ƒå¯ä»¥åˆ›å»ºDockerå®¹å™¨ã€‚</p><p>ä¾‹å¦‚æŸä¸ªé•œåƒå¯èƒ½åŒ…å«ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€ä¸€ä¸ªApache HTTP Serverä»¥åŠç”¨æˆ·å¼€å‘çš„Webåº”ç”¨ã€‚</p><p>é•œåƒæœ‰å¤šç§ç”Ÿæˆæ–¹æ³•ï¼šï¼ˆ1ï¼‰ä»æ— åˆ°æœ‰å¼€å§‹åˆ›å»ºé•œåƒï¼›ï¼ˆ2ï¼‰ä¸‹è½½å¹¶ä½¿ç”¨åˆ«äººåˆ›å»ºå¥½çš„ç°æˆçš„é•œåƒï¼›ï¼ˆ3ï¼‰åœ¨ç°æœ‰é•œåƒä¸Šåˆ›å»ºæ–°çš„é•œåƒã€‚å¯ä»¥å°†é•œåƒçš„å†…å®¹å’Œåˆ›å»ºæ­¥éª¤æè¿°åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆDockerfileï¼‰ä¸­ï¼Œé€šè¿‡æ‰§è¡Œdockerbuild å‘½ä»¤å¯ä»¥æ„å»ºå‡ºDockeré•œåƒï¼Œåé¢è®¨è®ºã€‚</p><h2 id="Docker-å®¹å™¨"><a href="#Docker-å®¹å™¨" class="headerlink" title="Docker å®¹å™¨"></a>Docker å®¹å™¨</h2><p>Dockerå®¹å™¨å°±æ˜¯Dockeré•œåƒçš„è¿è¡Œå®ä¾‹ã€‚</p><p>å¦‚æœé•œåƒæ˜¯è½¯ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ„å»ºå’Œæ‰“åŒ…é˜¶æ®µï¼Œé‚£ä¹ˆå®¹å™¨åˆ™æ˜¯å¯åŠ¨å’Œè¿è¡Œé˜¶æ®µã€‚ï¼ˆç±»ä¼¼äºç¨‹åºä¸çº¿ç¨‹çš„å…³ç³»ã€‚ï¼‰</p><h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><p>Registryæ˜¯å­˜æ”¾Dockeré•œåƒçš„ä»“åº“ã€‚</p><h1 id="hello-word"><a href="#hello-word" class="headerlink" title="hello-word"></a>hello-word</h1><p>æœ¬èŠ‚ä»‹ç»Dockerå®‰è£…åˆ°è¿è¡Œä¸€ä¸ªContainerçš„åŸºæœ¬æµç¨‹ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£…</span></span><br><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨DockeræœåŠ¡å™¨"><a href="#å¯åŠ¨DockeræœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨DockeræœåŠ¡å™¨"></a>å¯åŠ¨DockeræœåŠ¡å™¨</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="æ‹‰å–hello-worldé•œåƒ"><a href="#æ‹‰å–hello-worldé•œåƒ" class="headerlink" title="æ‹‰å–hello-worldé•œåƒ"></a>æ‹‰å–hello-worldé•œåƒ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull hello-world </span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹imageä¿¡æ¯"><a href="#æŸ¥çœ‹imageä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹imageä¿¡æ¯"></a>æŸ¥çœ‹imageä¿¡æ¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 ~]# docker images hello-world</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   7 months ago   13.3kB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œhello-world"><a href="#è¿è¡Œhello-world" class="headerlink" title="è¿è¡Œhello-world"></a>è¿è¡Œhello-world</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 ~]# docker run hello-world</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹Dockerfile"><a href="#æŸ¥çœ‹Dockerfile" class="headerlink" title="æŸ¥çœ‹Dockerfile"></a>æŸ¥çœ‹Dockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> hello/</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;hello/&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>åªæœ‰çŸ­çŸ­ä¸‰æ¡æŒ‡ä»¤ã€‚</p><ol><li>FROM scratchï¼šé•œåƒæ˜¯ä»ç™½æ‰‹èµ·å®¶ï¼Œä»0å¼€å§‹æ„å»ºã€‚</li><li>COPY hello/ï¼šå°†å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶â€œhelloâ€å¤åˆ¶åˆ°é•œåƒçš„æ ¹ç›®å½•ã€‚</li><li>CMD[â€œ/helloâ€]ï¼šå®¹å™¨å¯åŠ¨æ—¶ï¼Œæ‰§è¡Œ/helloã€‚</li></ol><h1 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h1><h2 id="base-é•œåƒ"><a href="#base-é•œåƒ" class="headerlink" title="base é•œåƒ"></a>base é•œåƒ</h2><p>hello-worldè™½ç„¶æ˜¯ä¸€ä¸ªå®Œæ•´çš„é•œåƒï¼Œä½†å®ƒå¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…ç”¨é€”ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›é•œåƒèƒ½æä¾›ä¸€ä¸ªåŸºæœ¬çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å®‰è£…å’Œé…ç½®è½¯ä»¶ã€‚è¿™æ ·çš„é•œåƒæˆ‘ä»¬ç§°ä½œbaseé•œåƒã€‚</p><p>baseé•œåƒæœ‰ä¸¤å±‚å«ä¹‰ï¼šï¼ˆ1ï¼‰ä¸ä¾èµ–å…¶ä»–é•œåƒï¼Œä»scratchæ„å»ºï¼›ï¼ˆ2ï¼‰å…¶ä»–é•œåƒå¯ä»¥ä»¥ä¹‹ä¸ºåŸºç¡€è¿›è¡Œæ‰©å±•ã€‚</p><p>èƒ½ç§°ä½œbaseé•œåƒçš„é€šå¸¸éƒ½æ˜¯å„ç§Linuxå‘è¡Œç‰ˆçš„Dockeré•œåƒï¼Œæ¯”å¦‚Ubuntuã€Debianã€CentOSç­‰ã€‚</p><p>æˆ‘ä»¬å°è¯•ä¸‹è½½å¹¶æŸ¥çœ‹centosçš„é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 ~]# docker pull centos</span><br><span class="line">...</span><br><span class="line">[root@hadoop01 ~]# docker images centos</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">centos       latest    5d0da3dc9764   7 months ago   231MB</span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆä¸€ä¸ªcentosé•œåƒåªæœ‰200MBï¼Ÿ</p><p>ç­”ï¼šLinuxæ“ä½œç³»ç»Ÿç”±å†…æ ¸ç©ºé—´ï¼ˆbootfs/kernelï¼‰å’Œç”¨æˆ·ç©ºé—´ï¼ˆrootfsï¼‰ç»„æˆã€‚</p><p>Linuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿï¼Œä¹‹åbootfsä¼šè¢«å¸è½½æ‰ã€‚</p><p>ç”¨æˆ·ç©ºé—´çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯rootfsï¼ŒåŒ…å«æˆ‘ä»¬ç†Ÿæ‚‰çš„/devã€/procã€/binç­‰ç›®å½•ã€‚å¯¹äºbaseé•œåƒæ¥è¯´ï¼Œåº•å±‚ç›´æ¥ç”¨Hostçš„kernelï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±è¡Œäº†ã€‚<strong>è€Œå¯¹äºä¸€ä¸ªç²¾ç®€çš„OS, rootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ã€‚</strong></p><p>å› æ­¤ï¼Œbaseé•œåƒåªæ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸å‘è¡Œç‰ˆä¸€è‡´ï¼Œkernelç‰ˆæœ¬ä¸å‘è¡Œç‰ˆæ˜¯ä¸åŒçš„ã€‚é•œåƒçš„Kernelç‰ˆæœ¬å–å†³äºDocker Hostï¼ˆDockerè£…åœ¨å“ªå°æœºå™¨ä¸Šï¼Œè¿™å°æœºå™¨å°±æ˜¯Docker Hostï¼‰ã€‚æ‰€ä»¥å®¹å™¨åªèƒ½ä½¿ç”¨Hostçš„kernelï¼Œå¹¶ä¸”ä¸èƒ½ä¿®æ”¹</p><p>baseé•œåƒæä¾›çš„æ˜¯æœ€å°å®‰è£…çš„Linuxå‘è¡Œç‰ˆã€‚</p></blockquote><h2 id="é•œåƒåˆ†å±‚"><a href="#é•œåƒåˆ†å±‚" class="headerlink" title="é•œåƒåˆ†å±‚"></a>é•œåƒåˆ†å±‚</h2><p>æˆ‘ä»¬æ‹¿ä¸€ä¸ªDockerfileæ¥ä¸¾ä¾‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install emacs</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install apach2</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ„å»ºè¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="image-20220428234124163.png" alt="æ„å»º"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ–°é•œåƒæ˜¯ä»baseé•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€å±‚ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆDockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢ï¼Ÿ</p><ul><li>æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼šå…±äº«èµ„æºã€‚æ¯”å¦‚ï¼šæœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„baseé•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆDocker Hoståªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½baseé•œåƒï¼›åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½baseé•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ï¼Œè€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ï¼Œæˆ‘ä»¬å°†åœ¨åé¢æ›´æ·±å…¥åœ°è®¨è®ºè¿™ä¸ªç‰¹æ€§ã€‚</li></ul><p>å¦‚æœå¤šä¸ªå®¹å™¨å…±äº«ä¸€ä»½åŸºç¡€é•œåƒï¼Œå½“æŸä¸ªå®¹å™¨ä¿®æ”¹äº†åŸºç¡€é•œåƒçš„å†…å®¹ï¼Œæ¯”å¦‚/etcä¸‹çš„æ–‡ä»¶ï¼Œè¿™æ—¶å…¶ä»–å®¹å™¨çš„ /etcæ˜¯å¦ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Ÿ</p><ul><li>ç­”æ¡ˆæ˜¯ä¸ä¼šï¼ä¿®æ”¹ä¼šè¢«é™åˆ¶åœ¨å•ä¸ªå®¹å™¨å†…ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„å®¹å™¨Copy-on-Writeç‰¹æ€§ã€‚</li></ul></blockquote><h2 id="Copy-on-Writeç‰¹æ€§"><a href="#Copy-on-Writeç‰¹æ€§" class="headerlink" title="Copy-on-Writeç‰¹æ€§"></a>Copy-on-Writeç‰¹æ€§</h2><p>å¯¹äºDockerfileçš„æ¯ä¸€è¡Œæ„å»ºè¯­å¥éƒ½ä¼šå¢åŠ ä¸€å±‚é•œåƒï¼Œè€Œå½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„<strong>å¯å†™å±‚</strong>è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚è¿™æ˜¯ç‰¹æ®Šçš„ä¸€å±‚ï¼Œè¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€œå®¹å™¨å±‚â€ï¼Œâ€œå®¹å™¨å±‚â€ä¹‹ä¸‹çš„éƒ½å«â€œé•œåƒå±‚â€ã€‚æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ï¼Œæ— è®ºæ·»åŠ ã€åˆ é™¤ï¼Œè¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚<strong>åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ã€‚</strong></p><ol><li>æ·»åŠ æ–‡ä»¶ã€‚åœ¨å®¹å™¨ä¸­åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œæ–°æ–‡ä»¶è¢«æ·»åŠ åˆ°å®¹å™¨å±‚ä¸­ã€‚</li><li>è¯»å–æ–‡ä»¶ã€‚åœ¨å®¹å™¨ä¸­è¯»å–æŸä¸ªæ–‡ä»¶æ—¶ï¼ŒDockerä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡åœ¨å„é•œåƒå±‚ä¸­æŸ¥æ‰¾æ­¤æ–‡ä»¶ã€‚ä¸€æ—¦æ‰¾åˆ°ï¼Œæ‰“å¼€å¹¶è¯»å…¥å†…å­˜ã€‚</li><li>ä¿®æ”¹æ–‡ä»¶ã€‚åœ¨å®¹å™¨ä¸­ä¿®æ”¹å·²å­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼ŒDockerä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡åœ¨å„é•œåƒå±‚ä¸­æŸ¥æ‰¾æ­¤æ–‡ä»¶ã€‚ä¸€æ—¦æ‰¾åˆ°ï¼Œ<strong>ç«‹å³å°†å…¶å¤åˆ¶åˆ°å®¹å™¨å±‚</strong>ï¼Œç„¶åä¿®æ”¹ä¹‹ã€‚</li><li>åˆ é™¤æ–‡ä»¶ã€‚åœ¨å®¹å™¨ä¸­åˆ é™¤æ–‡ä»¶æ—¶ï¼ŒDockerä¹Ÿæ˜¯ä»ä¸Šå¾€ä¸‹ä¾æ¬¡åœ¨é•œåƒå±‚ä¸­æŸ¥æ‰¾æ­¤æ–‡ä»¶ã€‚æ‰¾åˆ°åï¼Œä¼šåœ¨å®¹å™¨å±‚ä¸­è®°å½•ä¸‹æ­¤åˆ é™¤æ“ä½œã€‚</li></ol><p>åªæœ‰å½“éœ€è¦ä¿®æ”¹æ—¶æ‰å¤åˆ¶ä¸€ä»½æ•°æ®ï¼Œè¿™ç§ç‰¹æ€§è¢«ç§°ä½œCopy-on-Writeã€‚å¯è§ï¼Œå®¹å™¨å±‚ä¿å­˜çš„æ˜¯é•œåƒå˜åŒ–çš„éƒ¨åˆ†ï¼Œä¸ä¼šå¯¹é•œåƒæœ¬èº«è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚</p><p>è¿™æ ·å°±è§£é‡Šäº†æˆ‘ä»¬å‰é¢æå‡ºçš„é—®é¢˜ï¼šå®¹å™¨å±‚è®°å½•å¯¹é•œåƒçš„ä¿®æ”¹ï¼Œæ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œä¸ä¼šè¢«å®¹å™¨ä¿®æ”¹ï¼Œæ‰€ä»¥é•œåƒå¯ä»¥è¢«å¤šä¸ªå®¹å™¨å…±äº«ã€‚</p><h2 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h2><p>Dockeræä¾›äº†ä¸¤ç§æ„å»ºé•œåƒçš„æ–¹æ³•ï¼š <code>docker commit</code>å‘½ä»¤ä¸Dockerfileæ„å»ºæ–‡ä»¶ã€‚</p><h3 id="docker-commitï¼ˆä¸æ¨èï¼‰"><a href="#docker-commitï¼ˆä¸æ¨èï¼‰" class="headerlink" title="docker commitï¼ˆä¸æ¨èï¼‰"></a>docker commitï¼ˆä¸æ¨èï¼‰</h3><p>docker commitå‘½ä»¤æ˜¯åˆ›å»ºæ–°é•œåƒæœ€ç›´è§‚çš„æ–¹æ³•ï¼Œå…¶è¿‡ç¨‹åŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼šè¿è¡Œå®¹å™¨ã€‚ä¿®æ”¹å®¹å™¨ã€‚å°†å®¹å™¨ä¿å­˜ä¸ºæ–°çš„é•œåƒã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å°†åœ¨CentOS baseé•œåƒä¸­å®‰è£…vimå¹¶ä¿å­˜ä¸ºæ–°é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it ubuntu # å¯åŠ¨Containerå¹¶è¿›å…¥å®¹å™¨</span><br><span class="line">vim # command not found</span><br><span class="line">apt-get install -y vim # å®‰è£…vim</span><br><span class="line">vim # å‘ç°å‘½ä»¤å¯ä»¥æ‰§è¡ŒæˆåŠŸäº†</span><br></pre></td></tr></table></figure><p>åœ¨æ–°çª—å£ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">013be1649d31   centos:7.2.1511   &quot;/bin/bash&quot;   54 seconds ago   Up 53 seconds             frosty_kowalevski</span><br></pre></td></tr></table></figure><p>frosty_kowalevskiæ˜¯Dockerä¸ºæˆ‘ä»¬çš„å®¹å™¨éšæœºåˆ†é…çš„åå­—ã€‚</p><p>æ‰§è¡Œdocker commitå‘½ä»¤å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼Œç„¶åæŸ¥çœ‹é•œåƒ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 ~]# docker commit frosty_kowalevski centos_test</span><br><span class="line">sha256:5889b0d6ca05e96a7d1ba31dcc732d36b0651ebf7725bf0fb91def9aa2211420</span><br><span class="line">[root@hadoop01 ~]# docker images</span><br><span class="line">REPOSITORY    TAG        IMAGE ID       CREATED         SIZE</span><br><span class="line">centos_test   latest     5889b0d6ca05   6 seconds ago   409MB</span><br><span class="line">httpd         latest     c30a46771695   10 days ago     144MB</span><br><span class="line">hello-world   latest     feb5d9fea6a5   7 months ago    13.3kB</span><br><span class="line">centos        7.2.1511   9aec5c5fe4ba   3 years ago     195MB</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ¼”ç¤ºäº†å¦‚ä½•ç”¨docker commitåˆ›å»ºæ–°é•œåƒã€‚ç„¶è€Œï¼ŒDockerå¹¶ä¸å»ºè®®ç”¨æˆ·é€šè¿‡è¿™ç§æ–¹å¼æ„å»ºé•œåƒã€‚åŸå› å¦‚ä¸‹ï¼š</p><ol><li>è¿™æ˜¯ä¸€ç§æ‰‹å·¥åˆ›å»ºé•œåƒçš„æ–¹å¼ï¼Œå®¹æ˜“å‡ºé”™ï¼Œæ•ˆç‡ä½ä¸”å¯é‡å¤æ€§å¼±ã€‚æ¯”å¦‚è¦åœ¨debian baseé•œåƒä¸­ä¹ŸåŠ å…¥viï¼Œè¿˜å¾—é‡å¤å‰é¢çš„æ‰€æœ‰æ­¥éª¤ã€‚</li><li>æ›´é‡è¦çš„ï¼šä½¿ç”¨è€…å¹¶ä¸çŸ¥é“é•œåƒæ˜¯å¦‚ä½•åˆ›å»ºå‡ºæ¥çš„ï¼Œé‡Œé¢æ˜¯å¦æœ‰æ¶æ„ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´æ— æ³•å¯¹é•œåƒè¿›è¡Œå®¡è®¡ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚</li></ol><p>æ—¢ç„¶docker commitä¸æ˜¯æ¨èçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦èŠ±æ—¶é—´å­¦ä¹ å‘¢ï¼ŸåŸå› æ˜¯ï¼šå³ä¾¿æ˜¯ç”¨Dockerfileï¼ˆæ¨èæ–¹æ³•ï¼‰æ„å»ºé•œåƒï¼Œåº•å±‚ä¹Ÿæ˜¯docker commitä¸€å±‚ä¸€å±‚æ„å»ºæ–°é•œåƒçš„ã€‚å­¦ä¹ docker commitèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´åŠ æ·±å…¥åœ°ç†è§£æ„å»ºè¿‡ç¨‹å’Œé•œåƒçš„åˆ†å±‚ç»“æ„ã€‚</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>ä½¿ç”¨Dockerfileåˆ›å»ºä¸Šä¸€èŠ‚çš„centos_testé•œåƒ</p><h4 id="ç¼–è¾‘Dockerfileæ–‡ä»¶"><a href="#ç¼–è¾‘Dockerfileæ–‡ä»¶" class="headerlink" title="ç¼–è¾‘Dockerfileæ–‡ä»¶"></a>ç¼–è¾‘Dockerfileæ–‡ä»¶</h4><p>åˆ›å»ºä¸€ä¸ªDockerfileï¼Œå†…å®¹ä¸º</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7.2</span>.<span class="number">1511</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„è¿™é‡Œ<code>-y</code>å¿…é¡»åŠ ï¼Œå¦åˆ™åœ¨æ‰§è¡Œyum installæ—¶ï¼Œå¾ˆå¯èƒ½å› ä¸ºéœ€è¦ç”¨æˆ·è¾“å…¥<code>yes</code>è€Œå¤±è´¥</p></blockquote><p>æ‰§è¡Œbuildå‘½ä»¤ï¼Œå¹¶è¿›è¡Œåˆ†æï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 docker]# pwd</span><br><span class="line">/root/docker</span><br><span class="line">[root@hadoop01 docker]# ls</span><br><span class="line">Dockerfile</span><br><span class="line">[root@hadoop01 docker]# docker build -t centos-vim-dockerfile-image .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/2 : FROM centos:7.2.1511</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">9aec5c5fe4ba</span></span><br><span class="line">Step 2/2 : RUN yum install vim</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 1caec46cd6a4</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">â€¦â€¦</span><br><span class="line">Successfully built b93576fddd48</span><br><span class="line">Successfully tagged centos-vim-dockerfile-image:latest</span><br></pre></td></tr></table></figure><ol><li>ç¬¬ä¸‰è¡Œæ˜¾ç¤ºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™é‡Œåªæœ‰æˆ‘ä»¬ç¼–å†™å¥½çš„Dockerfileï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ–‡ä»¶åå¿…é¡»å«â€œDockerfileâ€å¦åˆ™æ‰§è¡Œdocker buildæ—¶ä¼šæ˜¾ç¤ºæ–‡ä»¶ä¸å­˜åœ¨ã€‚</li><li>ç¬¬äº”è¡Œæ‰§è¡Œdocker buildå‘½ä»¤ï¼Œ-tå‚æ•°æŒ‡å®šäº†é•œåƒçš„åå­—ï¼Œæœ€åçš„ç‚¹è¡¨ç¤ºæŒ‡å®šdocker contextä¸ºå½“å‰ç›®å½•ã€‚</li><li>å…³äºdocker contextï¼šDockeré»˜è®¤ä¼šä»build contextä¸­æŸ¥æ‰¾Dockerfileæ–‡ä»¶ï¼›Dockerå°†build contextä¸­çš„æ‰€æœ‰æ–‡ä»¶å‘é€ç»™Docker daemonï¼›Dockerfileä¸­çš„ADDã€COPYç­‰å‘½ä»¤å¯ä»¥å°†build contextä¸­çš„æ–‡ä»¶æ·»åŠ åˆ°é•œåƒã€‚å› æ­¤ä¸è¦åœ¨docker contextåŠ å…¥ä¸éœ€è¦çš„æ–‡ä»¶ã€‚</li><li>ç¬¬7åˆ°14è¡Œæ˜¾ç¤ºäº†æ‰§è¡Œdocker buildçš„å…·ä½“è¿‡ç¨‹ã€‚</li></ol><p>æ„å»ºå¥½çš„é•œåƒå¯ä»¥é€šè¿‡docker historyå‘½ä»¤æŸ¥çœ‹æ„å»ºè¿‡ç¨‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@hadoop01 docker]# docker history centos-vim-dockerfile-image:latest </span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">b93576fddd48   6 minutes ago   /bin/sh -c yum -y install vim                   214MB     </span><br><span class="line">9aec5c5fe4ba   3 years ago     /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span><br><span class="line">&lt;missing&gt;      3 years ago     /bin/sh -c #(nop)  LABEL license=GPLv2          0B        </span><br><span class="line">&lt;missing&gt;      3 years ago     /bin/sh -c #(nop)  LABEL vendor=CentOS          0B        </span><br><span class="line">&lt;missing&gt;      3 years ago     /bin/sh -c #(nop)  LABEL name=CentOS Base Imâ€¦   0B        </span><br><span class="line">&lt;missing&gt;      3 years ago     /bin/sh -c #(nop) ADD file:e76000d9816e4e380â€¦   195MB     </span><br><span class="line">&lt;missing&gt;      3 years ago     /bin/sh -c #(nop)  MAINTAINER The CentOS Proâ€¦   0B        </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="é•œåƒçš„ç¼“å­˜ç‰¹æ€§"><a href="#é•œåƒçš„ç¼“å­˜ç‰¹æ€§" class="headerlink" title="é•œåƒçš„ç¼“å­˜ç‰¹æ€§"></a>é•œåƒçš„ç¼“å­˜ç‰¹æ€§</h4><p>Dockerä¼šç¼“å­˜å·²æœ‰é•œåƒçš„é•œåƒå±‚ï¼Œæ„å»ºæ–°é•œåƒæ—¶ï¼Œå¦‚æœæŸé•œåƒå±‚å·²ç»å­˜åœ¨ï¼Œå°±ç›´æ¥ä½¿ç”¨ï¼Œæ— é¡»é‡æ–°åˆ›å»ºã€‚</p><p>ä¾‹å¦‚åœ¨ä¹‹å‰çš„Dockerfileä¸­åŠ å…¥ä¸€è¡Œï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7.2</span>.<span class="number">1511</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="built_in">test</span>/</span></span><br></pre></td></tr></table></figure><p>åˆ™åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¹‹å‰å·²ç»è¿è¡Œè¿‡ç›¸åŒçš„RUNæŒ‡ä»¤ï¼Œè¿™æ¬¡ç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„é•œåƒå±‚</p><h4 id="Dockerfileæ„å»ºè¿‡ç¨‹"><a href="#Dockerfileæ„å»ºè¿‡ç¨‹" class="headerlink" title="Dockerfileæ„å»ºè¿‡ç¨‹"></a>Dockerfileæ„å»ºè¿‡ç¨‹</h4><p>æ€»ç»“ä¸€ä¸‹é€šè¿‡Dockerfileæ„å»ºé•œåƒçš„è¿‡ç¨‹ï¼š</p><ol><li>ä»baseé•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚</li><li>æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œå¯¹å®¹å™¨åšä¿®æ”¹ã€‚</li><li>æ‰§è¡Œç±»ä¼¼docker commitçš„æ“ä½œï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒå±‚ã€‚</li><li>Dockerå†åŸºäºåˆšåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ã€‚</li><li>é‡å¤2ï½4æ­¥ï¼Œç›´åˆ°Dockerfileä¸­çš„æ‰€æœ‰æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ã€‚</li></ol><p>ä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœDockerfileç”±äºæŸç§åŸå› æ‰§è¡Œåˆ°æŸä¸ªæŒ‡ä»¤å¤±è´¥äº†ï¼Œæˆ‘ä»¬ä¹Ÿå°†èƒ½å¤Ÿå¾—åˆ°å‰ä¸€ä¸ªæŒ‡ä»¤æˆåŠŸæ‰§è¡Œæ„å»ºå‡ºçš„é•œåƒï¼Œè¿™å¯¹è°ƒè¯•Dockerfileéå¸¸æœ‰å¸®åŠ©ã€‚</p><h4 id="è°ƒè¯•Dockerfile"><a href="#è°ƒè¯•Dockerfile" class="headerlink" title="è°ƒè¯•Dockerfile"></a>è°ƒè¯•Dockerfile</h4><p>ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šå¯åŠ¨å¤±è´¥çš„å‰ä¸€å±‚æ„å»ºæˆåŠŸé•œåƒçš„å®¹å™¨ï¼Œè¿›å…¥å®¹å™¨ï¼Œæ‰§è¡Œå¤±è´¥çš„è¯­å¥ï¼Œä»è€ŒæŸ¥çœ‹é—®é¢˜æ‰€åœ¨ã€‚</p><h2 id="åˆ†å‘é•œåƒ"><a href="#åˆ†å‘é•œåƒ" class="headerlink" title="åˆ†å‘é•œåƒ"></a>åˆ†å‘é•œåƒ</h2><h3 id="docker-tag"><a href="#docker-tag" class="headerlink" title="docker tag"></a>docker tag</h3><p>è¿™é‡Œæ³¨æ„tagä¸ºlastestï¼Œæ³¨æ„docker tagçš„åˆå¹¶æ–¹å¼ã€‚</p><h3 id="ä½¿ç”¨å…¬å…±çš„Registry"><a href="#ä½¿ç”¨å…¬å…±çš„Registry" class="headerlink" title="ä½¿ç”¨å…¬å…±çš„Registry"></a>ä½¿ç”¨å…¬å…±çš„Registry</h3><p>çœ‹å®˜æ–¹æ–‡æ¡£å»ã€‚</p><h1 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h1><h2 id="è¿è¡Œå®¹å™¨çš„ä¸‰ç§æ–¹æ³•"><a href="#è¿è¡Œå®¹å™¨çš„ä¸‰ç§æ–¹æ³•" class="headerlink" title="è¿è¡Œå®¹å™¨çš„ä¸‰ç§æ–¹æ³•"></a>è¿è¡Œå®¹å™¨çš„ä¸‰ç§æ–¹æ³•</h2><ul><li>CMDæŒ‡ä»¤</li><li>ENTRYPOINTæŒ‡ä»¤</li><li>åœ¨docker runå‘½ä»¤è¡Œä¸­æŒ‡å®šï¼Œä¾‹å¦‚ï¼Œ<code>docker run ubuntu pwd</code></li></ul><h2 id="é•¿æœŸè¿è¡Œå®¹å™¨"><a href="#é•¿æœŸè¿è¡Œå®¹å™¨" class="headerlink" title="é•¿æœŸè¿è¡Œå®¹å™¨"></a>é•¿æœŸè¿è¡Œå®¹å™¨</h2><p>å®¹å™¨åœ¨æ‰§è¡Œå®Œå¯åŠ¨æ—¶çš„æŒ‡ä»¤åå°±ä¼šé€€å‡ºã€‚æƒ³è¦è®©å®¹å™¨ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œé‚£è¿è¡Œçš„å‘½ä»¤ä¸é€€å‡ºå°±å¥½äº†ã€‚ã€‚</p><h2 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h2><p>åœ¨å®¹å™¨runningæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥å®¹å™¨workï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œ</p><ul><li>docker attach</li><li>docker exec</li></ul><p>è¯¦ç»†è§å¸¸ç”¨å‘½ä»¤æ€»ç»“ç« èŠ‚</p><p>docker attachå’Œdocker execåŒºåˆ«ï¼š</p><ol><li>attachç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</li><li>execåˆ™æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</li><li>å¦‚æœæƒ³ç›´æ¥åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹å¯åŠ¨å‘½ä»¤çš„è¾“å‡ºï¼Œç”¨attachï¼›å…¶ä»–æƒ…å†µä½¿ç”¨execã€‚</li></ol><h2 id="docker-start-stop-restart"><a href="#docker-start-stop-restart" class="headerlink" title="docker start/stop/restart"></a>docker start/stop/restart</h2><p>å®¹å™¨åœ¨docker hostä¸­å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡<code>docker start/stop/restart &lt;container id&gt;</code>å‘½ä»¤å¯åŠ¨ï¼Œåœæ­¢å’Œé‡å¯å®¹å™¨ã€‚</p><h2 id="docker-pause-unpause"><a href="#docker-pause-unpause" class="headerlink" title="docker pause/unpause"></a>docker pause/unpause</h2><p>é€šè¿‡<code>docker pause/unpause &lt;container id&gt;</code>å‘½ä»¤æš‚åœå’Œæ¢å¤å®¹å™¨ã€‚</p><h2 id="docker-rm"><a href="#docker-rm" class="headerlink" title="docker rm"></a>docker rm</h2><p>é€šè¿‡<code>docker rm &lt;container id&gt;</code>å‘½ä»¤åˆ é™¤å®¹å™¨ã€‚</p><h2 id="dockerç”Ÿå‘½å‘¨æœŸ"><a href="#dockerç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="dockerç”Ÿå‘½å‘¨æœŸ"></a>dockerç”Ÿå‘½å‘¨æœŸ</h2><p><img src="image-20220502225040947.png" alt="dockerç”Ÿå‘½å‘¨æœŸ"></p><h2 id="èµ„æºé™åˆ¶"><a href="#èµ„æºé™åˆ¶" class="headerlink" title="èµ„æºé™åˆ¶"></a>èµ„æºé™åˆ¶</h2><p>ä¸€ä¸ªdocker host ä¼šè¿è¡Œè‹¥å¹²å®¹å™¨ï¼Œå¯¹äºå®¹å™¨ï¼ŒDockerä¹Ÿæä¾›äº†ç±»ä¼¼çš„æœºåˆ¶é¿å…æŸä¸ªå®¹å™¨å› å ç”¨å¤ªå¤šèµ„æºè€Œå½±å“å…¶ä»–å®¹å™¨ä¹ƒè‡³æ•´ä¸ªhostçš„æ€§èƒ½ã€‚</p><p>docker æä¾›å‘½ä»¤ä»¥é™åˆ¶å®¹å™¨çš„å†…å­˜ï¼ŒCPUï¼ŒBlockIOï¼ˆç£ç›˜è¯»å†™ï¼‰ç­‰ã€‚</p><p>å…·ä½“è¯·æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚</p><h2 id="å®ç°å®¹å™¨çš„åº•å±‚æŠ€æœ¯"><a href="#å®ç°å®¹å™¨çš„åº•å±‚æŠ€æœ¯" class="headerlink" title="å®ç°å®¹å™¨çš„åº•å±‚æŠ€æœ¯"></a>å®ç°å®¹å™¨çš„åº•å±‚æŠ€æœ¯</h2><p>cgroupå’Œnamespaceæ˜¯æœ€é‡è¦çš„ä¸¤ç§æŠ€æœ¯ã€‚cgroupå®ç°èµ„æºé™é¢ï¼Œnamespaceå®ç°èµ„æºéš”ç¦»ã€‚</p><p>Linuxä½¿ç”¨äº†6ç§namespaceï¼Œåˆ†åˆ«å¯¹åº”6ç§èµ„æºï¼šMountã€UTSã€IPCã€PIDã€Networkå’ŒUserã€‚</p><p>å…·ä½“ç”¨åˆ°å†è¯´ã€‚</p><h1 id="Docker-ç½‘ç»œ"><a href="#Docker-ç½‘ç»œ" class="headerlink" title="Docker ç½‘ç»œ"></a>Docker ç½‘ç»œ</h1><p>4ç§ç½‘ç»œï¼š</p><ul><li>noneï¼šå°é—­ç½‘ç»œï¼Œå¯¹å®‰å…¨æ€§è¦æ±‚é«˜å¹¶ä¸”ä¸éœ€è¦è”ç½‘çš„åº”ç”¨å¯ä»¥ä½¿ç”¨noneç½‘ç»œã€‚</li><li>hostï¼š è¿æ¥åˆ°hostç½‘ç»œçš„å®¹å™¨å…±äº«Docker hostçš„ç½‘ç»œæ ˆï¼Œå®¹å™¨çš„ç½‘ç»œé…ç½®ä¸hostå®Œå…¨ä¸€æ ·ã€‚å¯ä»¥é€šè¿‡ â€”network=hostæŒ‡å®šä½¿ç”¨hostç½‘ç»œã€‚</li><li>bridgeï¼šDockerå®‰è£…æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå‘½åä¸ºdocker0çš„Linuxbridgeã€‚å¦‚æœä¸æŒ‡å®šâ€”networkï¼Œåˆ›å»ºçš„å®¹å™¨é»˜è®¤éƒ½ä¼šæŒ‚åˆ°docker0ä¸Šã€‚</li><li>user-definedï¼šé™¤äº†noneã€hostã€bridgeè¿™ä¸‰ä¸ªè‡ªåŠ¨åˆ›å»ºçš„ç½‘ç»œï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ›å»ºuser-definedç½‘ç»œã€‚</li></ul><h2 id="å®¹å™¨é—´é€šä¿¡"><a href="#å®¹å™¨é—´é€šä¿¡" class="headerlink" title="å®¹å™¨é—´é€šä¿¡"></a>å®¹å™¨é—´é€šä¿¡</h2><p>å¾…è¡¥å……</p><h2 id="å°†å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥"><a href="#å°†å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥" class="headerlink" title="å°†å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥"></a>å°†å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥</h2><p>å¾…è¡¥å……</p><h1 id="Docker-å­˜å‚¨"><a href="#Docker-å­˜å‚¨" class="headerlink" title="Docker å­˜å‚¨"></a>Docker å­˜å‚¨</h1><p>å¾…è¡¥å……</p><h1 id="å¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#å¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="å¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>å¸¸ç”¨å‘½ä»¤æ€»ç»“</h1><h2 id="Dockeré•œåƒ-1"><a href="#Dockeré•œåƒ-1" class="headerlink" title="Dockeré•œåƒ"></a>Dockeré•œåƒ</h2><h3 id="docker-images"><a href="#docker-images" class="headerlink" title="docker  images"></a>docker  images</h3><p>åˆ—å‡ºé•œåƒ</p><p><code>docker images [OPTIONS] [REPOSITORY[:TAG]]</code></p><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-a :</strong>åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«ä¸­é—´æ˜ åƒå±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ»¤æ‰ä¸­é—´æ˜ åƒå±‚ï¼‰ï¼›</li></ul><h3 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h3><p><code>docker rmi [OPTIONS] IMAGE [IMAGE...]</code></p><p>åˆ é™¤æœ¬åœ°é•œåƒ</p><h3 id="docker-build"><a href="#docker-build" class="headerlink" title="docker build"></a>docker build</h3><p>ä½¿ç”¨ Dockerfile åˆ›å»ºé•œåƒã€‚</p><p><code>docker build [OPTIONS] PATH | URL | -</code></p><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>â€”build-arg=[] :</strong>è®¾ç½®é•œåƒåˆ›å»ºæ—¶çš„å˜é‡ï¼›</li><li><strong>â€”cpu-shares :</strong>è®¾ç½® cpu ä½¿ç”¨æƒé‡ï¼›</li><li><strong>-f :</strong>æŒ‡å®šè¦ä½¿ç”¨çš„Dockerfileè·¯å¾„ï¼›</li><li><strong>â€”force-rm :</strong>è®¾ç½®é•œåƒè¿‡ç¨‹ä¸­åˆ é™¤ä¸­é—´å®¹å™¨ï¼›</li><li><strong>â€”isolation :</strong>ä½¿ç”¨å®¹å™¨éš”ç¦»æŠ€æœ¯ï¼›</li><li><strong>-m :</strong>è®¾ç½®å†…å­˜æœ€å¤§å€¼ï¼›</li><li><strong>â€”memory-swap :</strong>è®¾ç½®Swapçš„æœ€å¤§å€¼ä¸ºå†…å­˜+swapï¼Œâ€-1â€è¡¨ç¤ºä¸é™swapï¼›</li><li><strong>â€”no-cache :</strong>åˆ›å»ºé•œåƒçš„è¿‡ç¨‹ä¸ä½¿ç”¨ç¼“å­˜ï¼›</li><li><strong>â€”pull :</strong>å°è¯•å»æ›´æ–°é•œåƒçš„æ–°ç‰ˆæœ¬ï¼›</li><li><strong>â€”quiet, -q :</strong>å®‰é™æ¨¡å¼ï¼ŒæˆåŠŸååªè¾“å‡ºé•œåƒ IDï¼›</li><li><strong>â€”rm :</strong>è®¾ç½®é•œåƒæˆåŠŸååˆ é™¤ä¸­é—´å®¹å™¨ï¼›</li><li><strong>â€”tag, -t:</strong> é•œåƒçš„åå­—åŠæ ‡ç­¾ï¼Œé€šå¸¸ name:tag æˆ–è€… name æ ¼å¼ï¼›å¯ä»¥åœ¨ä¸€æ¬¡æ„å»ºä¸­ä¸ºä¸€ä¸ªé•œåƒè®¾ç½®å¤šä¸ªæ ‡ç­¾ã€‚</li><li><strong>â€”network:</strong> é»˜è®¤ defaultã€‚åœ¨æ„å»ºæœŸé—´è®¾ç½®RUNæŒ‡ä»¤çš„ç½‘ç»œæ¨¡å¼</li></ul><h3 id="docker-history"><a href="#docker-history" class="headerlink" title="docker history"></a>docker history</h3><p>æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å²ã€‚</p><p><code>docker history [OPTIONS] IMAGE</code></p><hr><h3 id="docker-login"><a href="#docker-login" class="headerlink" title="docker login"></a>docker login</h3><p> ç™»é™†åˆ°ä¸€ä¸ªDockeré•œåƒä»“åº“ï¼Œå¦‚æœæœªæŒ‡å®šé•œåƒä»“åº“åœ°å€ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ä»“åº“ Docker Hub</p><h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><p>æ‹‰å–é•œåƒ</p><h3 id="docker-push"><a href="#docker-push" class="headerlink" title="docker push"></a>docker push</h3><p>æ¨é€é•œåƒ</p><h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h3><p>æŸ¥æ‰¾é•œåƒ</p><h2 id="Docker-å®¹å™¨-1"><a href="#Docker-å®¹å™¨-1" class="headerlink" title="Docker å®¹å™¨"></a>Docker å®¹å™¨</h2><h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><p><strong>docker run ï¼š</strong>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤</p><p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-d:</strong> åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›</li><li><strong>-i:</strong> ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›</li><li><strong>-p:</strong> æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼š<strong>ä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£</strong></li><li><strong>-t:</strong> ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›</li><li><strong>â€”name=â€nginx-lbâ€:</strong> ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›</li><li><strong>â€”dns 8.8.8.8:</strong> æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›</li><li><strong>â€”dns-search example.com:</strong> æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›</li><li><strong>-h â€œmarsâ€:</strong> æŒ‡å®šå®¹å™¨çš„hostnameï¼›</li><li><strong>-e username=â€ritchieâ€:</strong> è®¾ç½®ç¯å¢ƒå˜é‡ï¼›</li><li><strong>-m :</strong>è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼ï¼›</li><li><strong>â€”net=â€bridgeâ€:</strong> æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container: å››ç§ç±»å‹ï¼›</li><li><strong>â€”expose=[]:</strong> å¼€æ”¾ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£ï¼›</li></ul><h3 id="docker-start-stop-restart-1"><a href="#docker-start-stop-restart-1" class="headerlink" title="docker start/stop/restart"></a>docker start/stop/restart</h3><p><strong>docker start</strong> :å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»è¢«åœæ­¢çš„å®¹å™¨</p><p><strong>docker stop</strong> :åœæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨</p><p><strong>docker restart</strong> :é‡å¯å®¹å™¨</p><h3 id="docker-rm-1"><a href="#docker-rm-1" class="headerlink" title="docker rm"></a>docker rm</h3><p><strong>docker rm ï¼š</strong>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚</p><h3 id="docker-pause-unpause-1"><a href="#docker-pause-unpause-1" class="headerlink" title="docker pause/unpause"></a>docker pause/unpause</h3><p><strong>docker pause</strong> :æš‚åœå®¹å™¨ä¸­æ‰€æœ‰çš„è¿›ç¨‹ã€‚</p><p><strong>docker unpause</strong> :æ¢å¤å®¹å™¨ä¸­æ‰€æœ‰çš„è¿›ç¨‹ã€‚</p><h3 id="docker-create"><a href="#docker-create" class="headerlink" title="docker create"></a>docker create</h3><p><strong>docker create ï¼š</strong>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ä½†ä¸å¯åŠ¨å®ƒï¼›ç”¨æ³•åŒdocker run</p><h3 id="docker-attach"><a href="#docker-attach" class="headerlink" title="docker attach"></a>docker attach</h3><p><strong>docker attach :</strong>è¿æ¥åˆ°æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨ã€‚</p><p>è¦attachä¸Šå»çš„å®¹å™¨å¿…é¡»æ­£åœ¨è¿è¡Œï¼Œå¯ä»¥åŒæ—¶è¿æ¥ä¸ŠåŒä¸€ä¸ªcontaineræ¥å…±äº«å±å¹•ï¼ˆä¸screenå‘½ä»¤çš„attachç±»ä¼¼ï¼‰ã€‚</p><h3 id="docker-exec"><a href="#docker-exec" class="headerlink" title="docker exec"></a>docker exec</h3><p><strong>docker exec ï¼š</strong>åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</p><p><code>docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</code></p><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-d :</strong>åˆ†ç¦»æ¨¡å¼: åœ¨åå°è¿è¡Œ</li><li><strong>-t :</strong>åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</li></ul><h3 id="docker-ps"><a href="#docker-ps" class="headerlink" title="docker ps"></a>docker ps</h3><p>åˆ—å‡ºå®¹å™¨</p><p><code>docker ps [OPTIONS]</code></p><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-a :</strong>æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„ã€‚</li><li><strong>-n :</strong>åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„nä¸ªå®¹å™¨ã€‚</li><li><strong>-q :</strong>é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚</li></ul><h3 id="docker-inspect"><a href="#docker-inspect" class="headerlink" title="docker inspect"></a>docker inspect</h3><p><strong>docker inspect :</strong> è·å–å®¹å™¨/é•œåƒçš„å…ƒæ•°æ®ã€‚</p><h3 id="docker-top"><a href="#docker-top" class="headerlink" title="docker top"></a>docker top</h3><p>æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œæ”¯æŒ ps å‘½ä»¤å‚æ•°ã€‚</p><p>å®¹å™¨è¿è¡Œæ—¶ä¸ä¸€å®šæœ‰/bin/bashç»ˆç«¯æ¥äº¤äº’æ‰§è¡Œtopå‘½ä»¤ï¼Œè€Œä¸”å®¹å™¨è¿˜ä¸ä¸€å®šæœ‰topå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨docker topæ¥å®ç°æŸ¥çœ‹containerä¸­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚</p><h3 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h3><p>è·å–å®¹å™¨çš„æ—¥å¿—</p><h3 id="docker-commit"><a href="#docker-commit" class="headerlink" title="docker commit"></a>docker commit</h3><p>ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</p><p><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></p><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-a :</strong>æäº¤çš„é•œåƒä½œè€…ï¼›</li><li><strong>-c :</strong>ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼›</li><li><strong>-m :</strong>æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼›</li><li><strong>-p :</strong>åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœã€‚</li></ul><h3 id="docker-cp"><a href="#docker-cp" class="headerlink" title="docker cp"></a>docker cp</h3><p>ç”¨äºå®¹å™¨ä¸ä¸»æœºä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚</p><p>ä¾‹å¦‚ï¼šå°†ä¸»æœº/www/runoobç›®å½•æ‹·è´åˆ°å®¹å™¨96f7f14e99abçš„/wwwç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker cp /www/runoob 96f7f14e99ab:/www/</span><br></pre></td></tr></table></figure><h2 id="Dockerfile-1"><a href="#Dockerfile-1" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><ul><li>FROMæŒ‡å®šbaseé•œåƒã€‚</li><li>MAINTAINERè®¾ç½®é•œåƒçš„ä½œè€…ï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ã€‚</li><li>COPYå°†æ–‡ä»¶ä»build contextå¤åˆ¶åˆ°é•œåƒã€‚COPYæ”¯æŒä¸¤ç§å½¢å¼ï¼š COPY src destä¸COPY [â€œsrcâ€, â€œdestâ€]ã€‚æ³¨æ„ï¼šsrcåªèƒ½æŒ‡å®šbuild contextä¸­çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li>ADDä¸COPYç±»ä¼¼ï¼Œä»build contextå¤åˆ¶æ–‡ä»¶åˆ°é•œåƒã€‚ä¸åŒçš„æ˜¯ï¼Œå¦‚æœsrcæ˜¯å½’æ¡£æ–‡ä»¶ï¼ˆtarã€zipã€tgzã€xzç­‰ï¼‰ï¼Œæ–‡ä»¶ä¼šè¢«è‡ªåŠ¨è§£å‹åˆ°destã€‚</li><li>ENVè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡å¯è¢«åé¢çš„æŒ‡ä»¤ä½¿ç”¨ã€‚</li><li>EXPOSEæŒ‡å®šå®¹å™¨ä¸­çš„è¿›ç¨‹ä¼šç›‘å¬æŸä¸ªç«¯å£ï¼ŒDockerå¯ä»¥å°†è¯¥ç«¯å£æš´éœ²å‡ºæ¥ã€‚æˆ‘ä»¬ä¼šåœ¨å®¹å™¨ç½‘ç»œéƒ¨åˆ†è¯¦ç»†è®¨è®ºã€‚</li><li>VOLUMEå°†æ–‡ä»¶æˆ–ç›®å½•å£°æ˜ä¸ºvolumeã€‚æˆ‘ä»¬ä¼šåœ¨å®¹å™¨å­˜å‚¨éƒ¨åˆ†è¯¦ç»†è®¨è®ºã€‚</li><li>WORKDIRä¸ºåé¢çš„RUNã€CMDã€ENTRYPOINTã€ADDæˆ–COPYæŒ‡ä»¤è®¾ç½®é•œåƒä¸­çš„å½“å‰å·¥ä½œç›®å½•ã€‚</li><li>RUNåœ¨å®¹å™¨ä¸­è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚</li><li>CMDå®¹å™¨å¯åŠ¨æ—¶è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚CMDå¯ä»¥è¢«dockerrunä¹‹åçš„å‚æ•°æ›¿æ¢ã€‚</li><li>ENTRYPOINTè®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªENTRYPOINTæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚CMDæˆ–docker runä¹‹åçš„å‚æ•°ä¼šè¢«å½“ä½œå‚æ•°ä¼ é€’ç»™ENTRYPOINTã€‚</li></ul><h3 id="RUN-vs-CMD-vs-ENTRYPOINT"><a href="#RUN-vs-CMD-vs-ENTRYPOINT" class="headerlink" title="RUN vs CMD vs ENTRYPOINT"></a>RUN vs CMD vs ENTRYPOINT</h3><p>ç•¥</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€Šæ¯å¤©äº”åˆ†é’Ÿç©è½¬Dockerå®¹å™¨æŠ€æœ¯ã€‹</li></ol>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMapçŸ¥è¯†æ•´ç†</title>
      <link href="/2022/04/21/HashMap%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/"/>
      <url>/2022/04/21/HashMap%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Javaä¸ºæ•°æ®ç»“æ„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæ¥å£java.util.Mapï¼Œæ­¤æ¥å£ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/f7fe16a2.png" alt="Mapç±»å›¾"></p><ol><li><strong>HashMap</strong>ï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œ<strong>éå†é¡ºåºä¸ç¡®å®š</strong>ã€‚ HashMap<strong>æœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„keyä¸ºnull</strong>ï¼Œå…è®¸å¤šæ¡è®°å½•çš„valueä¸ºnullã€‚HashMap<strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚</li><li><strong>Hashtable</strong>ï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œä¸å†æ¨èä½¿ç”¨ã€‚</li><li><strong>LinkedHashMap</strong>ï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œ<strong>ä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåº</strong>ï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚</li><li><strong>TreeMap</strong>ï¼šTreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤Ÿ<strong>æŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åº</strong>ï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparator**ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚</li></ol><p>å¯¹äºä¸Šè¿°å››ç§Mapç±»å‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯<strong>ä¸å¯å˜å¯¹è±¡</strong>ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚</p><h1 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h1><p>ä»ç»“æ„å®ç°æ¥è®²ï¼ŒHashMapæ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJDK1.8å¢åŠ äº†çº¢é»‘æ ‘éƒ¨åˆ†ï¼‰å®ç°çš„ï¼Œå¦‚ä¸‹å¦‚æ‰€ç¤ºã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/e4a19398.png" alt="HashMapå­˜å‚¨ç»“æ„"></p><h2 id="ä»€ä¹ˆæ˜¯Node"><a href="#ä»€ä¹ˆæ˜¯Node" class="headerlink" title="ä»€ä¹ˆæ˜¯Node"></a>ä»€ä¹ˆæ˜¯Node</h2><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> hash;    <span class="comment">//ç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½®</span></span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;   <span class="comment">//é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnode</span></span><br><span class="line"></span><br><span class="line">        Node(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123; ... &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> K <span class="title function_">getKey</span><span class="params">()</span>&#123; ... &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getValue</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">toString</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">setValue</span><span class="params">(V newValue)</span> &#123; ... &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº†Map.Entryæ¥å£ï¼Œæœ¬è´¨æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹)ã€‚ä¸Šå›¾ä¸­çš„æ¯ä¸ªé»‘è‰²åœ†ç‚¹å°±æ˜¯ä¸€ä¸ªNodeå¯¹è±¡ã€‚</p><blockquote><p>Map.Entryæ˜¯Mapå£°æ˜çš„ä¸€ä¸ªå†…éƒ¨æ¥å£ï¼Œæ­¤æ¥å£ä¸ºæ³›å‹ï¼Œå®šä¹‰ä¸ºEntry<K,V>ã€‚å®ƒè¡¨ç¤ºMapä¸­çš„ä¸€ä¸ªå®ä½“ï¼ˆä¸€ä¸ªkey-valueå¯¹ï¼‰ã€‚æ¥å£ä¸­æœ‰getKey(), getValueæ–¹æ³•ã€‚</p></blockquote><h2 id="HashMapå­˜å‚¨"><a href="#HashMapå­˜å‚¨" class="headerlink" title="HashMapå­˜å‚¨"></a>HashMapå­˜å‚¨</h2><p>HashMapå°±æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨çš„ã€‚å“ˆå¸Œè¡¨ä¸ºè§£å†³å†²çªï¼Œå¯ä»¥é‡‡ç”¨å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•ç­‰æ¥è§£å†³é—®é¢˜ï¼ŒJavaä¸­HashMapé‡‡ç”¨äº†<strong>é“¾åœ°å€æ³•</strong>ã€‚é“¾åœ°å€æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ•°ç»„åŠ é“¾è¡¨çš„ç»“åˆã€‚åœ¨æ¯ä¸ªæ•°ç»„å…ƒç´ ä¸Šéƒ½ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå½“æ•°æ®è¢«Hashåï¼Œå¾—åˆ°æ•°ç»„ä¸‹æ ‡ï¼ŒæŠŠæ•°æ®æ”¾åœ¨å¯¹åº”ä¸‹æ ‡å…ƒç´ çš„é“¾è¡¨ä¸Šã€‚</p><p>å¯¹äºHashMapæ¥è¯´ï¼Œè°ƒç”¨<code>map.put(key, value)</code>æ–¹æ³•æ—¶ï¼Œå…ˆé€šè¿‡<code>key.hashCode()</code>å¾—åˆ°hashCodeå€¼ï¼ˆè¯¥æ–¹æ³•é€‚ç”¨äºæ¯ä¸ªJavaå¯¹è±¡ï¼‰ï¼Œåœ¨å¯¹hashCodeå€¼è¿›è¡ŒHashè¿ç®—æ¥ç¡®å®šè¯¥é”®å€¼å¯¹åœ¨å“ˆå¸Œæ¡¶æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ã€‚å¦‚æœä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†Hashå†²çªã€‚</p><p>HashMapçš„å­˜å‚¨æ•ˆç‡å–å†³äºHashç®—æ³•å’Œå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ã€‚å¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºç°è¾ƒå¤šç¢°æ’ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®å°±æ˜¯åœ¨æ ¹æ®å®é™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘Hashç¢°æ’ã€‚é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æ§åˆ¶mapä½¿å¾—Hashç¢°æ’çš„æ¦‚ç‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„<strong>Hashç®—æ³•</strong>å’Œ<strong>æ‰©å®¹æœºåˆ¶</strong>ã€‚</p><h2 id="HashMapå…³é”®å˜é‡"><a href="#HashMapå…³é”®å˜é‡" class="headerlink" title="HashMapå…³é”®å˜é‡"></a>HashMapå…³é”®å˜é‡</h2><p>åœ¨ç†è§£Hashå’Œæ‰©å®¹æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£ä¸‹HashMapçš„å‡ ä¸ªå­—æ®µã€‚ä»HashMapçš„é»˜è®¤æ„é€ å‡½æ•°æºç å¯çŸ¥ï¼Œæ„é€ å‡½æ•°å°±æ˜¯å¯¹ä¸‹é¢å‡ ä¸ªå­—æ®µè¿›è¡Œåˆå§‹åŒ–ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"><span class="type">int</span> threshold;             <span class="comment">// æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æé™ </span></span><br><span class="line"><span class="keyword">final</span> <span class="type">float</span> loadFactor;    <span class="comment">// è´Ÿè½½å› å­</span></span><br><span class="line"><span class="type">int</span> modCount;  </span><br><span class="line"><span class="type">int</span> size;</span><br></pre></td></tr></table></figure><ul><li>tableæ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œå®ƒé»˜è®¤åˆå§‹åŒ–é•¿åº¦lengthä¸º16</li><li>loadFactorä¸ºè´Ÿè½½å› å­(é»˜è®¤å€¼æ˜¯0.75)</li><li>thresholdæ˜¯HashMapæ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡çš„Node(é”®å€¼å¯¹)ä¸ªæ•°</li><li>threshold = length * Load factorï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°ç»„å®šä¹‰å¥½é•¿åº¦ä¹‹åï¼Œè´Ÿè½½å› å­è¶Šå¤§ï¼Œæ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹ä¸ªæ•°è¶Šå¤šã€‚</li><li>è´Ÿè½½å› å­çš„å®šä¹‰å…¬å¼å¯çŸ¥ï¼Œthresholdå°±æ˜¯åœ¨æ­¤Load factorå’Œlength(æ•°ç»„é•¿åº¦)å¯¹åº”ä¸‹å…è®¸çš„<strong>æœ€å¤§å…ƒç´ æ•°ç›®</strong>ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–°resize(æ‰©å®¹)ï¼Œ<strong>æ‰©å®¹åçš„HashMapå®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€</strong>ã€‚é»˜è®¤çš„è´Ÿè½½å› å­0.75æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­Load factorçš„å€¼ï¼›ç›¸åï¼Œå¦‚æœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­loadFactorçš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äº1ã€‚</li><li>sizeå°±æ˜¯HashMapä¸­<strong>å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡</strong>ã€‚</li><li>modCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼ˆæ¯”å¦‚æ‰©å®¹ï¼Œ æˆ–è€…é“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘ï¼‰ï¼Œä¸»è¦ç”¨äºè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±äºç»“æ„å˜åŒ–ã€‚</li></ul><h2 id="å“ˆå¸Œæ¡¶æ•°ç»„çš„è®¾è®¡"><a href="#å“ˆå¸Œæ¡¶æ•°ç»„çš„è®¾è®¡" class="headerlink" title="å“ˆå¸Œæ¡¶æ•°ç»„çš„è®¾è®¡"></a>å“ˆå¸Œæ¡¶æ•°ç»„çš„è®¾è®¡</h2><p>åœ¨HashMapä¸­ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„tableçš„é•¿åº¦lengthå¤§å°å¿…é¡»ä¸º2çš„næ¬¡æ–¹(ä¸€å®šæ˜¯åˆæ•°)ï¼Œè¿™æ˜¯ä¸€ç§<strong>éå¸¸è§„</strong>çš„è®¾è®¡ï¼Œå¸¸è§„çš„è®¾è®¡æ˜¯æŠŠæ¡¶çš„å¤§å°è®¾è®¡ä¸ºç´ æ•°ã€‚ç›¸å¯¹æ¥è¯´ç´ æ•°å¯¼è‡´å†²çªçš„æ¦‚ç‡è¦å°äºåˆæ•°ï¼Œå…·ä½“è¯æ˜å¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/liuqiyao_01/article/details/14475159">è¿™ç¯‡æ–‡ç« </a>ï¼ŒHashtableåˆå§‹åŒ–æ¡¶å¤§å°ä¸º11ï¼Œå°±æ˜¯æ¡¶å¤§å°è®¾è®¡ä¸ºç´ æ•°çš„åº”ç”¨ï¼ˆHashtableæ‰©å®¹åä¸èƒ½ä¿è¯è¿˜æ˜¯ç´ æ•°ï¼‰ã€‚HashMapé‡‡ç”¨è¿™ç§éå¸¸è§„è®¾è®¡ï¼Œä¸»è¦æ˜¯<strong>ä¸ºäº†åœ¨å–æ¨¡å’Œæ‰©å®¹æ—¶åšä¼˜åŒ–</strong>ã€‚åŒæ—¶ä¸ºäº†å‡å°‘å†²çªï¼ŒHashMapå®šä½å“ˆå¸Œæ¡¶ç´¢å¼•ä½ç½®æ—¶ï¼Œä¹ŸåŠ å…¥äº†é«˜ä½å‚ä¸è¿ç®—çš„è¿‡ç¨‹ã€‚</p><p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿è´Ÿè½½å› å­å’ŒHashç®—æ³•è®¾è®¡çš„å†åˆç†ï¼Œä¹Ÿå…ä¸äº†ä¼šå‡ºç°æ‹‰é“¾è¿‡é•¿çš„æƒ…å†µï¼ˆå³é“¾è¡¨å¾ˆé•¿ï¼‰ï¼Œä¸€æ—¦å‡ºç°æ‹‰é“¾è¿‡é•¿ï¼Œåˆ™ä¼šä¸¥é‡å½±å“HashMapçš„æ€§èƒ½ã€‚äºæ˜¯ï¼Œåœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ•°æ®ç»“æ„åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿ï¼ˆé»˜è®¤è¶…è¿‡8ï¼‰æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹æé«˜HashMapçš„æ€§èƒ½ï¼Œå…¶ä¸­ä¼šç”¨åˆ°çº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰ç®—æ³•ã€‚æœ¬æ–‡ä¸å†å¯¹çº¢é»‘æ ‘å±•å¼€è®¨è®ºï¼Œæƒ³äº†è§£æ›´å¤šçº¢é»‘æ ‘æ•°æ®ç»“æ„çš„å·¥ä½œåŸç†å¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/v_july_v/article/details/6105630">è¿™ç¯‡æ–‡ç« </a>ã€‚</p><h1 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h1><h2 id="hashç®—æ³•"><a href="#hashç®—æ³•" class="headerlink" title="hashç®—æ³•"></a>hashç®—æ³•</h2><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•ä¸€ï¼š</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;   <span class="comment">//jdk1.8 &amp; jdk1.7</span></span><br><span class="line">     <span class="type">int</span> h;</span><br><span class="line">     <span class="comment">// h = key.hashCode() ä¸ºç¬¬ä¸€æ­¥ å–hashCodeå€¼</span></span><br><span class="line">     <span class="comment">// h ^ (h &gt;&gt;&gt; 16)  ä¸ºç¬¬äºŒæ­¥ é«˜ä½å‚ä¸è¿ç®—</span></span><br><span class="line">     <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line">æ–¹æ³•äºŒï¼š</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">indexFor</span><span class="params">(<span class="type">int</span> h, <span class="type">int</span> length)</span> &#123;  <span class="comment">//jdk1.7çš„æºç ï¼Œjdk1.8æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å®ç°åŸç†ä¸€æ ·çš„</span></span><br><span class="line">     <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);  <span class="comment">//ç¬¬ä¸‰æ­¥ å–æ¨¡è¿ç®—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„Hashç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼š<strong>å–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®—</strong>ã€‚</p><p>å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œ<strong>æ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§</strong>çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨æ–¹æ³•äºŒæ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ï¼ˆæ–¹æ³•äºŒï¼‰éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œ<strong>h&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹lengthå–æ¨¡</strong>ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</p><p>åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚</p><p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ä¸‹ï¼Œnä¸ºtableçš„é•¿åº¦</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/45205ec2.png" alt="hashç®—æ³•"></p><h2 id="HashMapçš„putæ–¹æ³•"><a href="#HashMapçš„putæ–¹æ³•" class="headerlink" title="HashMapçš„putæ–¹æ³•"></a>HashMapçš„putæ–¹æ³•</h2><p>HashMapçš„putæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥ç†è§£</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/d669d29c.png" alt="HashMapçš„putæ–¹æ³•ï¼ˆ1.7ï¼Œ1.8æœ‰å˜åŒ–ï¼‰"></p><ol><li>åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„tableæ˜¯å¦ä¸ºç©ºæˆ–é•¿åº¦ä¸º0ï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼›ï¼ˆè¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œ<code>new HashMap()</code>çš„æ—¶å€™å¹¶ä¸ä¼šåˆå§‹åŒ–å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œè€Œæ˜¯å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œputæ“ä½œçš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ã€‚ï¼‰</li><li>æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘6ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘3</li><li>åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘4ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼›</li><li>åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘5ï¼›</li><li>éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼› </li><li>æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</li></ol><p>putæ–¹æ³•æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹keyçš„hashCode()åšhash</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† </span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>) </span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key,value,<span class="literal">null</span>);</span><br><span class="line">                     <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç†</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st  </span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                 <span class="comment">// keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k)))) </span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h2><p>æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªä¸å¤§ä¸å°çš„è´¨ç–‘ï¼Œå¦‚æœæ‰€æœ‰çš„sizeåˆ°è¾¾äº†thresholdï¼Œä½†æ˜¯æ‰€æœ‰çš„é”®å€¼å¯¹éƒ½è£…åœ¨äº†ä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ï¼Œé‚£ä¹ˆå…¶å®å…¶ä»–æ¡¶æ˜¯ç©ºçš„ï¼Œä¹Ÿæ˜¯å¯ä»¥ç»§ç»­æ”¾æ›´å¤šçš„é”®å€¼å¯¹ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸èƒ½è¯´<HashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ >ï¼Œä½†ä¾ç„¶ä¼šæ‰©å®¹</p></blockquote><p>æˆ‘ä»¬åˆ†æä¸‹resizeçš„æºç ï¼Œé‰´äºJDK1.8èå…¥äº†çº¢é»‘æ ‘ï¼Œè¾ƒå¤æ‚ï¼Œä¸ºäº†ä¾¿äºç†è§£æˆ‘ä»¬ä»ç„¶ä½¿ç”¨JDK1.7çš„ä»£ç ï¼Œå¥½ç†è§£ä¸€äº›ï¼Œæœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ï¼Œå…·ä½“åŒºåˆ«åæ–‡å†è¯´ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">resize</span><span class="params">(<span class="type">int</span> newCapacity)</span> &#123;   <span class="comment">//ä¼ å…¥æ–°çš„å®¹é‡</span></span><br><span class="line">    Entry[] oldTable = table;    <span class="comment">//å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> oldTable.length;         </span><br><span class="line">    <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;  <span class="comment">//æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº†</span></span><br><span class="line">        threshold = Integer.MAX_VALUE; <span class="comment">//ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼(2^31-1)ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šæ‰©å®¹äº†</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    Entry[] newTable = <span class="keyword">new</span> <span class="title class_">Entry</span>[newCapacity];  <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„</span></span><br><span class="line">    transfer(newTable);                         <span class="comment">//ï¼ï¼å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ</span></span><br><span class="line">    table = newTable;                           <span class="comment">//HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„</span></span><br><span class="line">    threshold = (<span class="type">int</span>)(newCapacity * loadFactor);<span class="comment">//ä¿®æ”¹é˜ˆå€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable)</span> &#123;</span><br><span class="line">    Entry[] src = table;                   <span class="comment">//srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; src.length; j++) &#123; <span class="comment">//éå†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">        Entry&lt;K,V&gt; e = src[j];             <span class="comment">//å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            src[j] = <span class="literal">null</span>;<span class="comment">//é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§çš„Entryæ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity); <span class="comment">//ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">                e.next = newTable[i]; <span class="comment">//æ ‡è®°[1]ï¼Œè¿™å¥ä¸å¤ªç†è§£</span></span><br><span class="line">                newTable[i] = e;      <span class="comment">//å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š</span></span><br><span class="line">                e = next;             <span class="comment">//è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šçš„å…ƒç´ </span></span><br><span class="line">            &#125; <span class="keyword">while</span> (e != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.nextï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„<strong>å¤´æ’</strong>å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®ï¼›è¿™æ ·å…ˆæ”¾åœ¨ä¸€ä¸ªç´¢å¼•ä¸Šçš„å…ƒç´ ç»ˆä¼šè¢«æ”¾åˆ°Entryé“¾çš„å°¾éƒ¨(å¦‚æœå‘ç”Ÿäº†hashå†²çªçš„è¯ï¼‰ï¼Œè¿™ä¸€ç‚¹å’ŒJdk1.8æœ‰åŒºåˆ«ï¼Œä¸‹æ–‡è¯¦è§£ã€‚åœ¨æ—§æ•°ç»„ä¸­åŒä¸€æ¡Entryé“¾ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Šã€‚</p><p>ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸‹æ‰©å®¹è¿‡ç¨‹ã€‚å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨key mod ä¸€ä¸‹è¡¨çš„å¤§å°ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚å…¶ä¸­çš„å“ˆå¸Œæ¡¶æ•°ç»„tableçš„size=2ï¼Œ æ‰€ä»¥key = 3ã€7ã€5ï¼Œputé¡ºåºä¾æ¬¡ä¸º 5ã€7ã€3ã€‚åœ¨mod 2ä»¥åéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚è¿™é‡Œå‡è®¾è´Ÿè½½å› å­ loadFactor=1ï¼Œå³å½“é”®å€¼å¯¹çš„å®é™…å¤§å°size å¤§äº tableçš„å®é™…å¤§å°æ—¶è¿›è¡Œæ‰©å®¹ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ resizeæˆ4ï¼Œç„¶åæ‰€æœ‰çš„Nodeé‡æ–°rehashçš„è¿‡ç¨‹ã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/b2330062.png" alt="JDK7 HashMapæ‰©å®¹"></p><p>ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸‹JDK1.8åšäº†å“ªäº›ä¼˜åŒ–ã€‚ç»è¿‡è§‚æµ‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<strong>2æ¬¡å¹‚</strong>çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œ<strong>å…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®</strong>ã€‚çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/4d8022db.png" alt="img"></p><p>å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/d773f86e.png" alt="img"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œ<strong>åªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€</strong>ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/3cc9813a.png" alt="img"></p><p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚æœ‰ä¸€ç‚¹æ³¨æ„åŒºåˆ«ï¼ŒJDK1.7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®ï¼Œä½†æ˜¯ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ<strong>JDK1.8ä¸ä¼šå€’ç½®</strong>ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸‹JDK1.8çš„resizeæºç ï¼Œå†™çš„å¾ˆèµï¼Œå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">    <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¡ç®—æ–°çš„resizeä¸Šé™</span></span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> (<span class="type">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="type">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;ï¼Œ&quot;unchecked&quot;&#125;)</span></span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// é“¾è¡¨ä¼˜åŒ–é‡hashçš„ä»£ç å—</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="comment">// åŸç´¢å¼•</span></span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// åŸç´¢å¼•+oldCap</span></span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h1><h2 id="çº¿ç¨‹å®‰å…¨æ€§"><a href="#çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€§"></a>çº¿ç¨‹å®‰å…¨æ€§</h2><p>åœ¨å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„HashMapï¼Œè€Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸‹é¢ä¸¾ä¾‹å­è¯´æ˜åœ¨å¹¶å‘çš„å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ä½¿ç”¨HashMapå¯èƒ½é€ æˆæ­»å¾ªç¯ã€‚ä»£ç ä¾‹å­å¦‚ä¸‹(ä¾¿äºç†è§£ï¼Œä»ç„¶ä½¿ç”¨JDK1.7çš„ç¯å¢ƒ)ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMapInfiniteLoop</span> &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;Integer,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer,String&gt;(<span class="number">2</span>ï¼Œ<span class="number">0.75f</span>);  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        map.put(<span class="number">5</span>ï¼Œ <span class="string">&quot;C&quot;</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;Thread1&quot;</span>) &#123;  </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">                map.put(<span class="number">7</span>, <span class="string">&quot;B&quot;</span>);  </span><br><span class="line">                System.out.println(map);  </span><br><span class="line">            &#125;;  </span><br><span class="line">        &#125;.start();  </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;Thread2&quot;</span>) &#123;  </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">                map.put(<span class="number">3</span>, <span class="string">&quot;A);  </span></span><br><span class="line"><span class="string">                System.out.println(map);  </span></span><br><span class="line"><span class="string">            &#125;;  </span></span><br><span class="line"><span class="string">        &#125;.start();        </span></span><br><span class="line"><span class="string">    &#125;  </span></span><br><span class="line"><span class="string">&#125; </span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œmapåˆå§‹åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼ŒloadFactor=0.75ï¼Œthreshold=2*0.75=1ï¼Œä¹Ÿå°±æ˜¯è¯´å½“putç¬¬äºŒä¸ªkeyçš„æ—¶å€™ï¼Œmapå°±éœ€è¦è¿›è¡Œresizeã€‚</p><p>é€šè¿‡è®¾ç½®æ–­ç‚¹è®©çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶debugåˆ°transferæ–¹æ³•(3.3å°èŠ‚ä»£ç å—)çš„é¦–è¡Œã€‚æ³¨æ„æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹å·²ç»æˆåŠŸæ·»åŠ æ•°æ®ã€‚æ”¾å¼€thread1çš„æ–­ç‚¹è‡³transferæ–¹æ³•çš„â€œEntry next = e.next;â€ è¿™ä¸€è¡Œï¼›ç„¶åæ”¾å¼€çº¿ç¨‹2çš„çš„æ–­ç‚¹ï¼Œè®©çº¿ç¨‹2è¿›è¡Œresizeã€‚ç»“æœå¦‚ä¸‹å›¾ã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/7df99266.png" alt="img"></p><p>æ³¨æ„ï¼ŒThread1çš„ e æŒ‡å‘äº†key(3)ï¼Œè€ŒnextæŒ‡å‘äº†key(7)ï¼Œå…¶åœ¨çº¿ç¨‹äºŒrehashåï¼ŒæŒ‡å‘äº†çº¿ç¨‹äºŒé‡ç»„åçš„é“¾è¡¨ã€‚</p><p>çº¿ç¨‹ä¸€è¢«è°ƒåº¦å›æ¥æ‰§è¡Œï¼Œå…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = eï¼Œ ç„¶åæ˜¯e = nextï¼Œå¯¼è‡´äº†eæŒ‡å‘äº†key(7)ï¼Œè€Œä¸‹ä¸€æ¬¡å¾ªç¯çš„next = e.nextå¯¼è‡´äº†nextæŒ‡å‘äº†key(3)ã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/4c3c28fb.png" alt="img"></p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/6c8d086a.png" alt="img"></p><p>e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7)ã€‚æ³¨æ„ï¼šæ­¤æ—¶çš„key(7).next å·²ç»æŒ‡å‘äº†key(3)ï¼Œ ç¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºç°äº†ã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/6eed9aaf.png" alt="img"></p><p>äºæ˜¯ï¼Œå½“æˆ‘ä»¬ç”¨çº¿ç¨‹ä¸€è°ƒç”¨map.get(11)æ—¶ï¼Œæ‚²å‰§å°±å‡ºç°äº†â€”â€”Infinite Loopã€‚</p><h1 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h1><p>JDK1.8åšäº†å¤šæ–¹é¢çš„ä¼˜åŒ–ï¼Œæ€»ä½“æ€§èƒ½ä¼˜äºJDK1.7ã€‚å…·ä½“è¯¦è§å‚è€ƒèµ„æ–™1</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://tech.meituan.com/2016/06/24/java-hashmap.html">Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap</a></li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é›†åˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒ»å­¦å½±åƒå¤„ç†ï¼šå°†NIIæ ¼å¼çš„CTå›¾è½¬æ¢ä¸ºPNG</title>
      <link href="/2022/04/12/%E5%8C%BB%E5%AD%A6%E5%BD%B1%E5%83%8F%E5%A4%84%E7%90%86%EF%BC%9A%E5%B0%86NII%E6%A0%BC%E5%BC%8F%E7%9A%84CT%E5%9B%BE%E8%BD%AC%E6%8D%A2%E4%B8%BAPNG/"/>
      <url>/2022/04/12/%E5%8C%BB%E5%AD%A6%E5%BD%B1%E5%83%8F%E5%A4%84%E7%90%86%EF%BC%9A%E5%B0%86NII%E6%A0%BC%E5%BC%8F%E7%9A%84CT%E5%9B%BE%E8%BD%AC%E6%8D%A2%E4%B8%BAPNG/</url>
      
        <content type="html"><![CDATA[<h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><p>æœ¬æ–‡ä½¿ç”¨Pythonè¿›è¡ŒåŒ»å­¦å½±åƒå¤„ç†ï¼šé€šè¿‡æ—‹è½¬ã€åˆ‡ç‰‡ã€è°ƒæ•´çª—å®½çª—ä½ï¼Œå°†3D NIIæ ¼å¼çš„<strong>è‚ºéƒ¨</strong>CTå½±åƒè½¬ä¸º2D PNGæ ¼å¼å›¾åƒã€‚</p><p>ä¸‹é¢ä»‹ç»æµç¨‹ã€‚</p><p>===</p><h1 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h1><p>==</p><h2 id="è¯»å–NIIå›¾åƒ"><a href="#è¯»å–NIIå›¾åƒ" class="headerlink" title="è¯»å–NIIå›¾åƒ"></a>è¯»å–NIIå›¾åƒ</h2><p>ä¸€èˆ¬ä½¿ç”¨<code>nibabel</code>æ¥è¯»NIIæ ¼å¼å›¾åƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> nibabel <span class="keyword">as</span> nib</span><br><span class="line">img = nib.load(img_path)</span><br><span class="line"><span class="comment"># è·å¾—å›¾åƒçš„ndarray</span></span><br><span class="line">img_fdata = img.get_fdata()</span><br></pre></td></tr></table></figure><p>==</p><h2 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h2><p>å°†3Då›¾ä»¥zè½´åˆ†ç‰‡ä¸ºè‹¥å¹²2Då›¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(x, y, z) = img.shape</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(z):</span><br><span class="line">silce = img_fdata[:, :, i]</span><br></pre></td></tr></table></figure><p>==</p><h2 id="è°ƒæ•´çª—å®½çª—ä½1"><a href="#è°ƒæ•´çª—å®½çª—ä½1" class="headerlink" title="è°ƒæ•´çª—å®½çª—ä½1"></a>è°ƒæ•´çª—å®½çª—ä½1</h2><p>çª—å®½çª—ä½çš„åŸºæœ¬æ¦‚å¿µè¯¦è§ï¼š<a href="https://www.zhihu.com/question/33587197">https://www.zhihu.com/question/33587197</a></p><p>ç®€å•æ¥è¯´ï¼Œä¸åŒçš„çª—å®½çª—ä½ä½¿å¾—ä¸åŒçš„ç»„ç»‡å™¨å®˜å±•ç¤ºçš„æ›´æ¸…æ¥šã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å¤„ç†çš„æ˜¯è‚ºéƒ¨CTï¼Œä¸åŒéƒ¨ä½çš„å¯¹åº”ä¸åŒçš„çª—å®½çª—ä½ã€‚</p><p>==</p><h2 id="è°ƒæ•´çª—å®½çª—ä½2"><a href="#è°ƒæ•´çª—å®½çª—ä½2" class="headerlink" title="è°ƒæ•´çª—å®½çª—ä½2"></a>è°ƒæ•´çª—å®½çª—ä½2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">center = -<span class="number">500</span> <span class="comment">#è‚ºéƒ¨çš„çª—å®½çª—ä½</span></span><br><span class="line">width = <span class="number">1500</span></span><br><span class="line"><span class="built_in">min</span> = (<span class="number">2</span> * center - width) / <span class="number">2.0</span> + <span class="number">0.5</span></span><br><span class="line"><span class="built_in">max</span> = (<span class="number">2</span> * center + width) / <span class="number">2.0</span> + <span class="number">0.5</span></span><br><span class="line">dFactor = <span class="number">255.0</span> / (<span class="built_in">max</span> - <span class="built_in">min</span>)</span><br><span class="line"></span><br><span class="line">silce = silce - <span class="built_in">min</span></span><br><span class="line">silce =np.trunc( silce * dFactor)</span><br><span class="line"><span class="comment"># ç”±äºRGBæ ¼å¼çš„è¦æ±‚ï¼Œè¿™é‡Œå¯¹ä¸åœ¨[0~255]çš„åƒç´ å€¼è¿›è¡Œæˆªæ–­</span></span><br><span class="line">silce[silce &lt; <span class="number">0.0</span>] = <span class="number">0</span></span><br><span class="line">silce[silce &gt; <span class="number">255.0</span>] = <span class="number">255</span>  <span class="comment"># è½¬æ¢ä¸ºçª—ä½çª—ä½ä¹‹åçš„æ•°æ®</span></span><br></pre></td></tr></table></figure><p>==</p><h2 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h2><p>æ—‹è½¬90Â°è®©å›¾åƒâ€œæ­£â€è¿‡æ¥</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">silce = np.fliplr(np.rot90(silce,-<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>==</p><h2 id="ä¿å­˜PNG"><a href="#ä¿å­˜PNG" class="headerlink" title="ä¿å­˜PNG"></a>ä¿å­˜PNG</h2><p>ç•¥</p><p>=== </p><h1 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h1><p>==</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> nibabel <span class="keyword">as</span> nib</span><br><span class="line"><span class="keyword">import</span> imageio  </span><br><span class="line"></span><br><span class="line"><span class="comment">#è‚ºéƒ¨çš„çª—å®½çª—ä½</span></span><br><span class="line">center = -<span class="number">500</span> </span><br><span class="line">width = <span class="number">1500</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nii_to_image</span>(<span class="params">src_path, dst_path</span>):</span><br><span class="line"><span class="keyword">for</span> p, d, f <span class="keyword">in</span> os.walk(src_path):</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(f) &gt; <span class="number">0</span>:</span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> f:</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> file_name.endswith(<span class="string">&quot;.nii&quot;</span>):</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="comment"># å¼€å§‹è¯»å–niiæ–‡ä»¶</span></span><br><span class="line">img_path = os.path.join(p, file_name)</span><br><span class="line">img = nib.load(img_path)</span><br><span class="line">img_fdata = img.get_fdata()</span><br><span class="line"><span class="comment"># æ–°å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dst_path):</span><br><span class="line">os.mkdir(dst_path)</span><br><span class="line"><span class="comment"># è½¬æ¢æˆçª—å®½çª—ä½</span></span><br><span class="line"><span class="built_in">min</span> = (<span class="number">2</span> * center - width) / <span class="number">2.0</span> + <span class="number">0.5</span></span><br><span class="line"><span class="built_in">max</span> = (<span class="number">2</span> * center + width) / <span class="number">2.0</span> + <span class="number">0.5</span></span><br><span class="line">dFactor = <span class="number">255.0</span> / (<span class="built_in">max</span> - <span class="built_in">min</span>)</span><br><span class="line"><span class="comment"># å¼€å§‹è½¬æ¢ä¸ºå›¾åƒ</span></span><br><span class="line">(x, y, z) = img.shape</span><br><span class="line"><span class="comment"># zæ˜¯å›¾åƒçš„åºåˆ—</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(z):</span><br><span class="line">silce = img_fdata[:, :, i]</span><br><span class="line"><span class="comment"># åè½¬ï¼Œæ—‹è½¬90Â°</span></span><br><span class="line">silce = np.fliplr(np.rot90(silce,-<span class="number">1</span>)) </span><br><span class="line">silce = silce - <span class="built_in">min</span></span><br><span class="line">silce =np.trunc( silce * dFactor)</span><br><span class="line">silce[silce &lt; <span class="number">0.0</span>] = <span class="number">0</span></span><br><span class="line">silce[silce &gt; <span class="number">255.0</span>] = <span class="number">255</span> </span><br><span class="line"><span class="comment"># maskimg_slice = maskimg_fdata[:,:,i]</span></span><br><span class="line">temp = file_name.replace(<span class="string">&quot;.nii&quot;</span>, <span class="string">&quot;&quot;</span>)+<span class="string">&quot;_&quot;</span> + <span class="string">&#x27;&#123;&#125;.png&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">imageio.imwrite(os.path.join(dst_path, temp), silce.astype(<span class="string">&#x27;uint8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src_path = <span class="string">&#x27;NIIä¿å­˜æ–‡ä»¶å¤¹&#x27;</span></span><br><span class="line">dst_path = <span class="string">&#x27;PNGä¿å­˜æ–‡ä»¶å¤¹&#x27;</span></span><br><span class="line">nii_to_image(src_path, dst_path)</span><br></pre></td></tr></table></figure><p>===</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>==</p><ol><li><a href="https://www.zhihu.com/question/33587197">CTçš„çª—å®½ï¼Œçª—ä½åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</a></li><li><a href="https://blog.csdn.net/Zzhouzhou237/article/details/105345048">python nii å›¾åƒè¯»å–ï¼Œè½¬æ¢æˆCT å€¼ï¼Œè®¾ç½®çª—å®½çª—ä½ï¼Œä¿å­˜æˆpng å›¾åƒ</a></li></ol><p>===</p><h1 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks~"></a>Thanks~</h1>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®Œç¾è§£å†³ChromeDriverä¸Chromeç‰ˆæœ¬åŒ¹é…é—®é¢˜</title>
      <link href="/2022/04/11/%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3ChromeDriver%E4%B8%8EChrome%E7%89%88%E6%9C%AC%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/"/>
      <url>/2022/04/11/%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3ChromeDriver%E4%B8%8EChrome%E7%89%88%E6%9C%AC%E5%8C%B9%E9%85%8D%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Seleniumè°ƒç”¨Chromeæµè§ˆå™¨çˆ¬å–äº’è”ç½‘æ•°æ®æ—¶ï¼Œä¼šé‡åˆ°Chromeå’ŒChromeDriverç‰ˆæœ¬ä¸å…¼å®¹çš„é—®é¢˜ï¼Œå¯¼è‡´çˆ¬å–å¤±è´¥ã€‚</p><p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œè¿›è¡Œç‰ˆæœ¬åŒ¹é…ã€‚ä½†æ˜¯éšç€æœ¬æœºChromeçš„æ›´æ–°ï¼Œæ¯æ¬¡éƒ½éœ€è¦éšä¹‹æ›´æ–°ChromeDriverç‰ˆæœ¬ã€‚</p><p>æ›´å¥½çš„æ–¹æ¡ˆæ˜¯ï¼Œé€šè¿‡ä½¿ç”¨<code>webdriver-manager</code>æ¥è‡ªåŠ¨åŒ¹é…ChromeDriverï¼Œå®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install webdriver-manager</span><br></pre></td></tr></table></figure><p>Usageï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> webdriver_manager.chrome <span class="keyword">import</span> ChromeDriverManager</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(ChromeDriverManager().install())</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://stackoverflow.com/questions/60296873/sessionnotcreatedexception-message-session-not-created-this-version-of-chrome">SessionNotCreatedException: Message: session not created: This version of ChromeDriver only supports Chrome version 81</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œçˆ¬è™« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œçˆ¬è™« </tag>
            
            <tag> Selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>test_slides</title>
      <link href="/2022/04/11/test-slides/"/>
      <url>/2022/04/11/test-slides/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿™æ˜¯ä¸€ä¸ªslidesæµ‹è¯•åšå®¢"><a href="#è¿™æ˜¯ä¸€ä¸ªslidesæµ‹è¯•åšå®¢" class="headerlink" title="è¿™æ˜¯ä¸€ä¸ªslidesæµ‹è¯•åšå®¢"></a>è¿™æ˜¯ä¸€ä¸ªslidesæµ‹è¯•åšå®¢</h1><p>===</p><p>å®ƒå¯ä»¥æŠŠmarkdownæ¸²æŸ“çš„åƒå¹»ç¯ç‰‡ä¸€æ ·</p><p>==</p><p>è¿˜æœ‰å‚ç›´åˆ‡æ¢</p><p>==</p><p>è¿˜å¯ä»¥åˆ‡æ¢èƒŒæ™¯ç­‰ã€‚</p><p>===</p><p>Have Fun~</p>]]></content>
      
      
      
        <tags>
            
            <tag> æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºResNetçš„æ ‘å¶åˆ†ç±»ä»»åŠ¡</title>
      <link href="/2022/04/04/%E5%9F%BA%E4%BA%8EResNet%E7%9A%84%E6%A0%91%E5%8F%B6%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/"/>
      <url>/2022/04/04/%E5%9F%BA%E4%BA%8EResNet%E7%9A%84%E6%A0%91%E5%8F%B6%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote><p>æœ¬æ–‡ä»»åŠ¡ã€æ•°æ®é›†æ¥æºäºã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹è¯¾ç¨‹ä¸­çš„æ ‘å¶åˆ†ç±»ç«èµ›ã€‚è¯¦è§å‚è€ƒèµ„æ–™1</p><p>æœ¬æ–‡ä»£ç ä¸»è¦å‚è€ƒkaggleç”¨æˆ·nekokikuç»™å‡ºçš„resnet baselineã€‚è¯¦è§å‚è€ƒèµ„æ–™2</p><p>é€šè¿‡æœ¬æ¬¡ç«èµ›å’Œä»£ç å¯ä»¥å­¦ä¹ åˆ°ï¼š</p><ul><li>ç®€å•çš„PyTorchæ·±åº¦å­¦ä¹ é¡¹ç›®ä»£ç ã€ç»“æ„æ˜¯æ€æ ·çš„</li><li>å¦‚ä½•ç»§æ‰¿PyTorchä¸­çš„Dataset, DataLoaderå®ç°è‡ªå·±çš„Dataset, DataLoaderç±»</li><li>å¦‚ä½•ä½¿ç”¨PyTorchå¿«é€Ÿå®ç°ResNetæ¨¡å‹ã€‚</li></ul></blockquote><h1 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h1><p>åˆ†æbaseline codeï¼Œæ€»ç»“ä¸€ä¸‹æ·±åº¦å­¦ä¹ çš„ä»£ç æµç¨‹ã€‚</p><ol><li>å¤„ç†æ•°æ®ï¼šåŒ…æ‹¬å…ƒæ•°æ®å’Œå›¾åƒæ•°æ®ã€‚æ¯”å¦‚çœ‹çœ‹æ•°æ®çš„æ ·å­ï¼Œæ ‡ç­¾çš„åˆ†å¸ƒï¼Œunique æ ‡ç­¾çš„æ•°é‡ç­‰ã€‚</li><li>å®ç°è‡ªå·±çš„Datasetã€DataLoaderç±»</li><li>CPU OR GPU</li><li>å®šä¹‰æ¨¡å‹</li><li>å®šä¹‰è¶…å‚æ•°ï¼šå­¦ä¹ ç‡ç­‰</li><li>train&amp;valid</li><li>ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚</li></ol><h1 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h1><p>é’ˆå¯¹æœ¬æ¬¡ä»»åŠ¡é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">leaves_classification_competition/</span><br><span class="line">â””â”€data/</span><br><span class="line">    â””â”€classify-leaves/</span><br><span class="line">        â””â”€images/</span><br><span class="line">â””â”€train.csv</span><br><span class="line">â””â”€test.csv</span><br><span class="line">â””â”€script.ipynb</span><br></pre></td></tr></table></figure><p><code>data/</code>ç›®å½•ä¸‹æ˜¯æœ¬æ¬¡ä»»åŠ¡ç”¨åˆ°çš„æ•°æ®ã€‚å°†ä»kaggleä¸Šä¸‹è½½çš„æ•°æ®å‹ç¼©åŒ…è§£å‹åˆ°æœ¬æ–‡ä»¶å¤¹ã€‚</p><p><code>script.ipynb</code>æ˜¯ä»£ç è„šæœ¬ã€‚</p><p>åœ¨æ›´å¤§çš„è®­ç»ƒä¸­ï¼Œä»£ç åº”è¯¥æ‹†åˆ†ä¸ºå„ç§<code>.py</code>æ–‡ä»¶ã€‚</p><h1 id="baseline"><a href="#baseline" class="headerlink" title="baseline"></a>baseline</h1><h2 id="å¯¼å…¥åŒ…"><a href="#å¯¼å…¥åŒ…" class="headerlink" title="å¯¼å…¥åŒ…"></a>å¯¼å…¥åŒ…</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆå¯¼å…¥åŒ…</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset, DataLoader</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models</span><br><span class="line"><span class="comment"># This is for the progress bar.</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><p>çœ‹ä¸€çœ‹train.csvé•¿ä»€ä¹ˆæ ·</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DATA_BASE_PATH = <span class="string">&#x27;./data/classify-leaves/&#x27;</span></span><br><span class="line"><span class="comment"># labelæ–‡ä»¶</span></span><br><span class="line">labels_df = pd.read_csv(os.path.join(DATA_BASE_PATH, <span class="string">&#x27;train.csv&#x27;</span>))</span><br><span class="line">labels_df.head()</span><br><span class="line"><span class="comment"># len(labels_df)</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">labels_df.describe()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŠŠæ ‘å¶çš„æ ‡ç­¾å»é‡æ˜ å°„ä¸ºæ•°å€¼</span></span><br><span class="line">leaves_labels = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(labels_df[<span class="string">&#x27;label&#x27;</span>])))</span><br><span class="line">n_classes = <span class="built_in">len</span>(leaves_labels)</span><br><span class="line">class2num = <span class="built_in">dict</span>(<span class="built_in">zip</span>(leaves_labels, <span class="built_in">range</span>(n_classes)))</span><br><span class="line">class2num</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;abies_concolor&#x27;: 0,</span><br><span class="line"> &#x27;abies_nordmanniana&#x27;: 1,</span><br><span class="line"> &#x27;acer_campestre&#x27;: 2,</span><br><span class="line">â€¦â€¦</span><br><span class="line"> &#x27;zelkova_serrata&#x27;: 175&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è½¬æ¢æˆkeyä¸ºæ•°å­—ï¼Œvalä¸ºæ ‘å¶ç±»å‹ï¼Œæ–¹ä¾¿é¢„æµ‹ã€‚</span></span><br><span class="line">num2class = &#123;v:k <span class="keyword">for</span> k, v <span class="keyword">in</span> class2num.items()&#125;</span><br><span class="line">num2class</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;0: &#x27;abies_concolor&#x27;,</span><br><span class="line"> 1: &#x27;abies_nordmanniana&#x27;,</span><br><span class="line"> 2: &#x27;acer_campestre&#x27;,</span><br><span class="line"> 3: &#x27;acer_ginnala&#x27;,</span><br><span class="line"> 4: &#x27;acer_griseum&#x27;,</span><br><span class="line">â€¦â€¦</span><br><span class="line"> 175: &#x27;zelkova_serrata&#x27;&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°Dataset"><a href="#å®ç°Dataset" class="headerlink" title="å®ç°Dataset"></a>å®ç°Dataset</h2><p>ç»§æ‰¿Datasetç±»ï¼Œå®ç°è‡ªå·±çš„Datasetã€‚ç»§æ‰¿ä¹‹åï¼Œéœ€è¦å®ç°ä¸‰ä¸ªå‡½æ•°</p><ul><li><code>__init__</code>ï¼šä¼ å…¥å¿…è¦çš„å‚æ•°ï¼Œåˆå§‹åŒ–ï¼›</li><li><code>__getitem__</code>ï¼šè¿”å›itemï¼Œå¦‚æœæ˜¯trainæˆ–è€…validåˆ™è¿”å›imgå’Œlabelï¼Œå¦‚æœæ˜¯teståˆ™è¿”å›img</li><li><code>__len__</code>ï¼šæ•°æ®é›†é•¿åº¦</li><li>æ›´å¤šå‚è§å‚è€ƒèµ„æ–™3</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»§æ‰¿Datasetç±»ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LeaveDataSet</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, csv_path, img_path, mode=<span class="string">&#x27;train&#x27;</span>, valid_ratio = <span class="number">0.2</span>, resize_height = <span class="number">256</span>, resize_width = <span class="number">256</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">          csv_path: labelæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">          img_path: å›¾ç‰‡å­˜æ”¾è·¯å¾„</span></span><br><span class="line"><span class="string">          mode: è®­ç»ƒæ¨¡å¼è¿˜æ˜¯æµ‹è¯•æ¨¡å¼</span></span><br><span class="line"><span class="string">          valid_ratio: éªŒè¯é›†æ¯”ä¾‹</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.img_path = img_path</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.data_info = pd.read_csv(csv_path)</span><br><span class="line">        self.data_len = <span class="built_in">len</span>(self.data_info)</span><br><span class="line">        self.train_len = <span class="built_in">int</span>(self.data_len * (<span class="number">1</span> - valid_ratio))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mode == <span class="string">&#x27;train&#x27;</span>:</span><br><span class="line">            <span class="comment"># ä¸ºå•¥è¦è½¬æˆnparray</span></span><br><span class="line">            self.train_image = np.asarray(self.data_info.iloc[:self.train_len, <span class="number">0</span>])</span><br><span class="line">            self.train_label = np.asarray(self.data_info.iloc[:self.train_len, <span class="number">1</span>])</span><br><span class="line">            <span class="comment"># ä¸ºäº†åœ¨ä¸åŒæ¨¡å¼ä¸‹ç»Ÿä¸€å˜é‡</span></span><br><span class="line">            self.image_arr = self.train_image</span><br><span class="line">            self.label_arr = self.train_label</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> mode == <span class="string">&#x27;valid&#x27;</span>:</span><br><span class="line">            self.valid_image = np.asarray(self.data_info.iloc[self.train_len:,<span class="number">0</span>])</span><br><span class="line">            self.valid_label = np.asarray(self.data_info.iloc[self.train_len:,<span class="number">1</span>])</span><br><span class="line">            self.image_arr = self.valid_image</span><br><span class="line">            self.label_arr = self.valid_label</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.test_image = np.asarray(self.data_info.iloc[:,<span class="number">0</span>])</span><br><span class="line">            self.image_arr = self.test_image</span><br><span class="line">            <span class="comment">#test æ²¡æœ‰label</span></span><br><span class="line">        self.real_len = <span class="built_in">len</span>(self.image_arr)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Finished reading the &#123;&#125; set of Leaves Dataset. (&#123;&#125; samples found)&quot;</span>.<span class="built_in">format</span>(mode, self.real_len))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line"></span><br><span class="line">        single_image_name = self.image_arr[index]</span><br><span class="line">        img_as_img = Image.<span class="built_in">open</span>(os.path.join(self.img_path, single_image_name))</span><br><span class="line">        <span class="keyword">if</span> self.mode == <span class="string">&#x27;train&#x27;</span>:</span><br><span class="line">            transform = transforms.Compose([</span><br><span class="line">                transforms.Resize((<span class="number">224</span>, <span class="number">224</span>)),</span><br><span class="line">                transforms.RandomHorizontalFlip(p=<span class="number">0.5</span>),   <span class="comment">#éšæœºæ°´å¹³ç¿»è½¬ é€‰æ‹©ä¸€ä¸ªæ¦‚ç‡</span></span><br><span class="line">                transforms.ToTensor()</span><br><span class="line">            ])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># validå’Œtestä¸åšæ•°æ®å¢å¼º</span></span><br><span class="line">            transform = transforms.Compose([</span><br><span class="line">                transforms.Resize((<span class="number">224</span>, <span class="number">224</span>)),</span><br><span class="line">                transforms.ToTensor()</span><br><span class="line">            ])</span><br><span class="line">        img_as_img = transform(img_as_img)</span><br><span class="line">        <span class="comment"># å…ˆä¸åšå›¾åƒè£å‰ªï¼Œå¢å¼ºå’Œç°åº¦å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> self.mode == <span class="string">&#x27;test&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> img_as_img</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            label = self.label_arr[index]</span><br><span class="line">            <span class="comment"># labelè½¬æ•°å­—</span></span><br><span class="line">            number_label = class2num[label]</span><br><span class="line">            <span class="keyword">return</span> img_as_img, number_label</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.real_len</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ç”Ÿæˆdatasetå¯¹è±¡</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">train_csv_path = <span class="string">&#x27;./data/classify-leaves/train.csv&#x27;</span></span><br><span class="line">test_csv_path = <span class="string">&#x27;./data/classify-leaves/test.csv&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># csvæ–‡ä»¶ä¸­å·²ç»imagesçš„è·¯å¾„äº†ï¼Œå› æ­¤è¿™é‡Œåªåˆ°ä¸Šä¸€çº§ç›®å½•</span></span><br><span class="line"></span><br><span class="line">img_path = <span class="string">&#x27;./data/classify-leaves/&#x27;</span></span><br><span class="line"></span><br><span class="line">train_dataset = LeaveDataSet(train_csv_path, img_path, mode=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">test_dataset = LeaveDataSet(train_csv_path, img_path, mode=<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">valid_dataset = LeaveDataSet(train_csv_path, img_path, mode=<span class="string">&#x27;valid&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Finished reading the train set of Leaves Dataset (14681 samples found)</span><br><span class="line">Finished reading the test set of Leaves Dataset (18353 samples found)</span><br><span class="line">Finished reading the valid set of Leaves Dataset (3672 samples found)</span><br></pre></td></tr></table></figure><h2 id="å®ç°Dataloader"><a href="#å®ç°Dataloader" class="headerlink" title="å®ç°Dataloader"></a>å®ç°Dataloader</h2><p>å®šä¹‰trainï¼Œvalidï¼Œtestçš„dataloaderï¼Œå‚æ•°è¯¦è§å‚è€ƒèµ„æ–™4</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ data loader</span></span><br><span class="line"><span class="comment"># dataloader å‚æ•°è¯¦è§£ï¼šhttps://blog.csdn.net/qq_36653505/article/details/84728855</span></span><br><span class="line"></span><br><span class="line">train_loader = DataLoader(</span><br><span class="line">    dataset=train_dataset,</span><br><span class="line">    batch_size=<span class="number">8</span>,</span><br><span class="line">    shuffle=<span class="literal">False</span>,</span><br><span class="line">    num_workers=<span class="number">5</span> <span class="comment"># ä½¿ç”¨nums_workersä¸ªçº¿ç¨‹è¯»æ•°æ®</span></span><br><span class="line">)</span><br><span class="line">valid_loader = DataLoader(</span><br><span class="line">    dataset=valid_dataset,</span><br><span class="line">    batch_size=<span class="number">8</span>,</span><br><span class="line">    shuffle=<span class="literal">False</span>,</span><br><span class="line">    num_workers=<span class="number">5</span></span><br><span class="line">)</span><br><span class="line">test_loader = DataLoader(</span><br><span class="line">    dataset=test_dataset,</span><br><span class="line">    batch_size=<span class="number">8</span>,</span><br><span class="line">    shuffle=<span class="literal">False</span>,</span><br><span class="line">    num_workers=<span class="number">5</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="è·å–GPU"><a href="#è·å–GPU" class="headerlink" title="è·å–GPU"></a>è·å–GPU</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># CPU OR GPU</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_device</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line"></span><br><span class="line">device = get_device()</span><br><span class="line"><span class="built_in">print</span>(device)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cuda</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h2><p>è¿™é‡Œæ¨¡å‹ä½¿ç”¨resnet34</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰resnet34</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">num_classes: ä¼ å…¥åˆ†ç±»ä»»åŠ¡çš„ç±»åˆ«æ•°ï¼Œç”±ä¸Šé¢çš„æ•°æ®å¯çŸ¥ï¼Œä¸€å…±æœ‰176ç§æ ‘å¶ï¼Œæ‰€ä»¥ä¸€ä¼šè°ƒç”¨è¯¥å‡½æ•°è¿”å›æ¨¡å‹æ—¶ï¼Œä¼ å…¥çš„num_classeså‚æ•°ä¸º176</span></span><br><span class="line"><span class="string">use_pretrained: æ˜¯å¦ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">res_model</span>(<span class="params">num_classes, feature_extract = <span class="literal">False</span>, use_pretrained = <span class="literal">False</span></span>):</span><br><span class="line">    model_ft = models.resnet34(pretrained=use_pretrained)</span><br><span class="line">    <span class="comment"># set_parameter_requires_grad(model_ft, feature_extract)</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œæ˜¯æƒ³è¦æŠŠåŸå§‹æ¨¡å‹çš„æœ€åä¸€å±‚å…¨è¿æ¥å±‚æ›¿æ¢æ‰ï¼Œæ›¿æ¢æˆè¾“å‡ºç±»åˆ«ä¸ºnum_classesçš„å…¨è¿æ¥å±‚ã€‚</span></span><br><span class="line">    <span class="comment"># ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹æˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“åŸå§‹æ¨¡å‹çš„å…¨è¿æ¥å±‚çš„è¾“å…¥featureç»´åº¦ã€‚</span></span><br><span class="line">    num_ftrs = model_ft.fc.in_features</span><br><span class="line">    model_ft.fc = nn.Sequential(nn.Linear(num_ftrs, num_classes))</span><br><span class="line">    <span class="keyword">return</span> model_ft</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰è¶…å‚æ•°"><a href="#å®šä¹‰è¶…å‚æ•°" class="headerlink" title="å®šä¹‰è¶…å‚æ•°"></a>å®šä¹‰è¶…å‚æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¶…å‚æ•°</span></span><br><span class="line">lr = <span class="number">3e-4</span> <span class="comment">#å­¦ä¹ ç‡</span></span><br><span class="line">weight_decay = <span class="number">1e-3</span></span><br><span class="line">num_epoch = <span class="number">50</span> <span class="comment">#è¿­ä»£è½®æ•°</span></span><br><span class="line">model_path = <span class="string">&#x27;./pre_res_model.ckpt&#x27;</span> <span class="comment"># æ¨¡å‹ä¿å­˜ä½ç½®</span></span><br></pre></td></tr></table></figure><h2 id="train-amp-valid"><a href="#train-amp-valid" class="headerlink" title="train&amp;valid"></a>train&amp;valid</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å‹åˆå§‹åŒ–ï¼Œå¹¶æ”¾åˆ°å…·ä½“çš„è®¾å¤‡ä¸­</span></span><br><span class="line">model = res_model(<span class="number">176</span>)</span><br><span class="line"><span class="comment"># å°†æ¨¡å‹æ”¾åˆ°deviceä¸Šã€‚</span></span><br><span class="line">model = model.to(device)</span><br><span class="line">model.device = device <span class="comment"># è¿™è¡Œä»£ç è²Œä¼¼æ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç±»ä»»åŠ¡ä½¿ç”¨äº¤å‰ç†µæŸå¤±ä½œä¸ºè¯„ä¼°æ ‡å‡†</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Adamä¼˜åŒ–å™¨</span></span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr = lr, weight_decay= weight_decay)</span><br><span class="line"></span><br><span class="line">n_epochs = num_epoch</span><br><span class="line"></span><br><span class="line">best_acc = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(n_epochs):</span><br><span class="line">    <span class="comment"># ------- train --------</span></span><br><span class="line">    <span class="comment"># è®­ç»ƒçš„æ—¶å€™ï¼Œè¦è°ƒç”¨è¯¥å‡½æ•°ï¼Œä½¿æ¨¡å‹å¤„äºè®­ç»ƒæ¨¡å¼</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="comment"># è®°å½•æ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªbatchè®­ç»ƒåï¼Œæ¨¡å‹çš„æŸå¤±å’Œç²¾ç¡®ç‡ã€‚</span></span><br><span class="line">    train_loss = []</span><br><span class="line">    train_accs = []</span><br><span class="line">    <span class="comment"># tqdmæ˜¯ä¸€ä¸ªæ˜¾ç¤ºè¿›åº¦æ¡çš„å·¥å…·åŒ…ï¼Œä¸ç”¨ç®¡ã€‚</span></span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> tqdm(train_loader):</span><br><span class="line">        <span class="comment"># A batch consists of image data and corresponding labels.</span></span><br><span class="line">        imgs, labels = batch</span><br><span class="line">        <span class="comment"># æŠŠæ•°æ®éƒ½æ”¾åˆ°åŒä¸€ä¸ªdeviceä¸Š</span></span><br><span class="line">        imgs = imgs.to(device)</span><br><span class="line">        labels = labels.to(device)</span><br><span class="line"></span><br><span class="line">        logits = model(imgs)</span><br><span class="line">        <span class="comment"># è®¡ç®—æ¨¡å‹è¾“å‡ºå’ŒçœŸå®labelä¹‹é—´çš„æŸå¤±ï¼Œåå‘ä¼ æ’­ã€‚ã€‚</span></span><br><span class="line">        loss = criterion(logits, labels)</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        <span class="comment">#è¿™è¡Œcodeä¸æ˜¯å¾ˆæ‡‚ï¼Œå¤§æ¦‚å°±æ˜¯ç»Ÿè®¡é¢„æµ‹æ­£ç¡®æ ‡ç­¾çš„å æ¯”</span></span><br><span class="line">        <span class="comment"># å¼„æ˜ç™½ï¼šhttps://csbwang.github.io/dl_ch2#2161</span></span><br><span class="line">        acc = (logits.argmax(dim = -<span class="number">1</span>) == labels).<span class="built_in">float</span>().mean()</span><br><span class="line">        </span><br><span class="line">        train_loss.append(loss.item())</span><br><span class="line">        train_accs.append(acc)</span><br><span class="line">    <span class="comment"># è®¡ç®—æœ¬æ¬¡epochåçš„losså’Œacc</span></span><br><span class="line">    train_loss = <span class="built_in">sum</span>(train_loss) / <span class="built_in">len</span>(train_loss)</span><br><span class="line">    train_acc = <span class="built_in">sum</span>(train_accs) / <span class="built_in">len</span>(train_accs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[ Train | <span class="subst">&#123;epoch + <span class="number">1</span>:03d&#125;</span>/<span class="subst">&#123;n_epochs:03d&#125;</span> ] loss = <span class="subst">&#123;train_loss:<span class="number">.5</span>f&#125;</span>, acc = <span class="subst">&#123;train_acc:<span class="number">.5</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># ------- valid --------</span></span><br><span class="line">    <span class="comment"># éªŒè¯æ—¶ï¼ŒæŠŠæ¨¡å‹è°ƒæˆè¯„ä¼°æ¨¡å¼</span></span><br><span class="line">    model.<span class="built_in">eval</span>()  <span class="comment"># evalå…·ä½“æ˜¯åšä»€ä¹ˆ?</span></span><br><span class="line"></span><br><span class="line">    valid_loss = []</span><br><span class="line">    valid_accs = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> tqdm(valid_loader):</span><br><span class="line">        imgs, labels = batch</span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            logits = model(imgs.to(device))</span><br><span class="line">        loss = criterion(logits, labels.to(device))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># acc = (logits.argmax(dim = -1) == labels).float().mean()</span></span><br><span class="line">        acc = (logits.argmax(dim = -<span class="number">1</span>) == labels.to(device)).<span class="built_in">float</span>().mean()</span><br><span class="line"></span><br><span class="line">        valid_loss.append(loss.item())</span><br><span class="line">        valid_accs.append(acc)</span><br><span class="line">    </span><br><span class="line">    valid_loss = <span class="built_in">sum</span>(valid_loss) / <span class="built_in">len</span>(valid_loss)</span><br><span class="line">    valid_acc = <span class="built_in">sum</span>(valid_accs) / <span class="built_in">len</span>(valid_accs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[ Valid | <span class="subst">&#123;epoch + <span class="number">1</span>:03d&#125;</span>/<span class="subst">&#123;n_epochs:03d&#125;</span> ] loss = <span class="subst">&#123;valid_loss:<span class="number">.5</span>f&#125;</span>, acc = <span class="subst">&#123;valid_acc:<span class="number">.5</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœåœ¨éªŒè¯é›†å¾—åˆ°çš„accå¤§äºå·²çŸ¥æœ€å¥½çš„accï¼Œåˆ™ä¿å­˜æ¨¡å‹ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> valid_acc &gt; best_acc:</span><br><span class="line">        best_acc = valid_acc</span><br><span class="line">        torch.save(model.state_dict(), model_path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;saving model with acc &#123;:.3f&#125;&#x27;</span>.<span class="built_in">format</span>(best_acc))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>//æ§åˆ¶å°è¾“å‡º</p><h2 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h2><p>ä¸Šé¢å°±æ˜¯è®­ç»ƒè¿‡ç¨‹ï¼Œä¸‹é¢ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">################ </span></span><br><span class="line">saveFileName = <span class="string">&#x27;./data/classify-leaves/submission.csv&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">## predict</span></span><br><span class="line">model = res_model(<span class="number">176</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create model and load weights from checkpoint</span></span><br><span class="line">model = model.to(device)</span><br><span class="line">model.load_state_dict(torch.load(model_path))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make sure the model is in eval mode.</span></span><br><span class="line"><span class="comment"># Some modules like Dropout or BatchNorm affect if the model is in training mode.</span></span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize a list to store the predictions.</span></span><br><span class="line">predictions = []</span><br><span class="line"><span class="comment"># Iterate the testing set by batches.</span></span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> tqdm(test_loader):</span><br><span class="line">    </span><br><span class="line">    imgs = batch</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        logits = model(imgs.to(device))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Take the class with greatest logit as prediction and record it.</span></span><br><span class="line">    predictions.extend(logits.argmax(dim=-<span class="number">1</span>).cpu().numpy().tolist())</span><br><span class="line"></span><br><span class="line">preds = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> predictions:</span><br><span class="line">    preds.append(num2class[i])</span><br><span class="line"></span><br><span class="line">test_data = pd.read_csv(test_path)</span><br><span class="line">test_data[<span class="string">&#x27;label&#x27;</span>] = pd.Series(preds)</span><br><span class="line">submission = pd.concat([test_data[<span class="string">&#x27;image&#x27;</span>], test_data[<span class="string">&#x27;label&#x27;</span>]], axis=<span class="number">1</span>)</span><br><span class="line">submission.to_csv(saveFileName, index=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Done!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="æ”¹è¿›æ¨¡å‹"><a href="#æ”¹è¿›æ¨¡å‹" class="headerlink" title="æ”¹è¿›æ¨¡å‹"></a>æ”¹è¿›æ¨¡å‹</h1><p>//TODO</p><h1 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h1><p>åˆå­¦æ·±åº¦å­¦ä¹ ï¼Œä»£ç ä¸ŠçŠ¯äº†å¾ˆå¤šç»†èŠ‚ä¸Šçš„é”™è¯¯ã€‚å…¶æ¬¡ï¼Œå¾ˆå¤šç»†èŠ‚é—®é¢˜ä¸æ˜ç™½ï¼Œä¾‹å¦‚ï¼Œä¼˜åŒ–å™¨ï¼Ÿå„ç§è®¡ç®—å…¬å¼ç­‰ã€‚ä»¥åè¦å¼„æ‡‚ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.bilibili.com/video/BV1z64y1o7iz">ç¬¬äºŒéƒ¨åˆ†å®Œç»“ç«èµ›ï¼šå›¾ç‰‡åˆ†ç±»ã€åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ v2ã€‘</a></li><li><a href="https://www.kaggle.com/code/nekokiku/simple-resnet-baseline">nekokiku/simple-resnet-baseline</a></li><li><a href="https://blog.csdn.net/leviopku/article/details/99958182">Pytorchä¸­çš„datasetç±»â€”â€”åˆ›å»ºé€‚åº”ä»»æ„æ¨¡å‹çš„æ•°æ®é›†æ¥å£</a></li><li><a href="https://blog.csdn.net/qq_36653505/article/details/84728855">Pytorch ä¸­çš„æ•°æ®ç±»å‹ torch.utils.data.DataLoader å‚æ•°è¯¦è§£</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤ç°ResNet50ï¼ˆPyTorchï¼‰</title>
      <link href="/2022/03/29/%E5%A4%8D%E7%8E%B0ResNet50%EF%BC%88PyTorch%EF%BC%89/"/>
      <url>/2022/03/29/%E5%A4%8D%E7%8E%B0ResNet50%EF%BC%88PyTorch%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬ç¯‡åšå®¢ä»‹ç»äº† ResNet50 ç½‘ç»œ PyTorch å¤ç°ï¼ˆå¤ç°ä»£ç ä¸º PyTorch æºç ï¼‰</p></blockquote><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>Residual Netï¼šæ®‹å·®ç½‘ç»œã€‚</p><p>å°†é å‰è‹¥å¹²å±‚çš„æŸä¸€å±‚æ•°æ®è¾“å‡ºç›´æ¥è·³è¿‡å¤šå±‚å¼•å…¥åˆ°åé¢æ•°æ®å±‚çš„è¾“å…¥éƒ¨åˆ†ã€‚æ„å‘³ç€åé¢çš„ç‰¹å¾å±‚çš„å†…å®¹ä¼šæœ‰ä¸€éƒ¨åˆ†ç”±å…¶å‰é¢çš„æŸä¸€å±‚çº¿æ€§è´¡çŒ®ã€‚</p><p><img src="image-20220329215711900.png" alt="æ®‹å·®å—"></p><p>æ·±åº¦æ®‹å·®ç½‘ç»œçš„è®¾è®¡æ˜¯ä¸ºäº†å…‹æœç”±äºç½‘ç»œæ·±åº¦åŠ æ·±è€Œäº§ç”Ÿçš„å­¦ä¹ æ•ˆç‡å˜ä½ä¸å‡†ç¡®ç‡æ— æ³•æœ‰æ•ˆæå‡çš„é—®é¢˜ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾æ¥è‡ªå‚è€ƒæ–‡çŒ®[1]ï¼Œç»™å‡ºäº†ResNet18ã€ResNet34ã€ResNet50ã€ResNet101ã€ResNet152çš„å—ç»“æ„ã€‚</p><p><img src="image-20220329220108463.png" alt="ResNet-XX ç½‘ç»œç»“æ„"></p><p>æ ¹æ®è¯¥å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”»å‡ºResNet50çš„ç½‘ç»œç»“æ„ï¼Œ</p><p><img src="image-20220329220245960.png" alt="ResNet-50 ç½‘ç»œç»“æ„"></p><p>ç”±ä¸Šè¿°ç½‘ç»œç»“æ„å¯ä»¥çœ‹åˆ°ï¼ŒResNetåŒ…å«ä¸¤ç§Blockï¼šåˆ†åˆ«ä¸º<strong>Conv Block</strong>å’Œ<strong>Identity Block</strong>ã€‚</p><ul><li><strong>Conv Block</strong>è¾“å…¥å’Œè¾“å‡ºçš„ç»´åº¦ï¼ˆé€šé“æ•°å’Œsizeï¼‰æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›¸åŒçš„Conv Blockä¸èƒ½è¿ç»­ä¸²è”ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ”¹å˜ç½‘ç»œçš„ç»´åº¦ï¼›</li><li><strong>Identity Block</strong>è¾“å…¥ç»´åº¦å’Œè¾“å‡ºç»´åº¦ï¼ˆé€šé“æ•°å’Œsizeï¼‰ç›¸åŒï¼Œå¯ä»¥ä¸²è”ï¼Œç”¨äºåŠ æ·±ç½‘ç»œçš„ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸¤ç§å—çš„ç»“æ„ï¼š</p><p><img src="image-20220329221454060.png" alt="Conv Block"></p><p><img src="image-20220329221531582.png" alt="Identity Block"></p><p>è¿™ä¸¤ç§å—çš„åŒºåˆ«åœ¨äºæ®‹å·®è¾¹æ˜¯å¦å·ç§¯ã€‚å¦‚æœç»è¿‡$1*1$å·ç§¯ã€‚ç»è¿‡å·ç§¯çš„æ˜¯Conv Blockï¼Œç›´è¿çš„æ˜¯Identity Blockã€‚</p><p>ç¨åç”¨ä¸€ä¸ªç±»<code>Bottleneck</code>å®ç°è¿™ä¸¤ç§å—ã€‚</p><p>ä¸‹é¢å‚è€ƒPyTorchæ¡†æ¶æºç ï¼Œå¯¹ ResNet50  ä¸€æ­¥æ­¥å¤ç°ã€‚</p><h1 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h1><h2 id="å¯¼åŒ…"><a href="#å¯¼åŒ…" class="headerlink" title="å¯¼åŒ…"></a>å¯¼åŒ…</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br></pre></td></tr></table></figure><h2 id="ResNet50-ç”Ÿæˆå‡½æ•°"><a href="#ResNet50-ç”Ÿæˆå‡½æ•°" class="headerlink" title="ResNet50 ç”Ÿæˆå‡½æ•°"></a>ResNet50 ç”Ÿæˆå‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">resnet50</span>(<span class="params">pretrained = <span class="literal">False</span>, **kwargs</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Constructs a ResNet-50 model.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        pretrained:(bool): If True, return a model pretrained on ImageNet</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    model = ResNet(Bottleneck, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">3</span>], **kwargs)</span><br><span class="line">    <span class="keyword">if</span> pretrained:</span><br><span class="line">        <span class="comment"># model.load_state_dict(model_zoo.load_url(model_urls[&#x27;resnet50&#x27;]))</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line">net = resnet50()</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>model = ResNet(Bottleneck, [3, 4, 6, 3], **kwargs)</code> æ„é€ ç½‘ç»œç»“æ„ï¼Œä¸»è¦åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†å³ <code>Bottleneck</code>å’Œ <code>[3,4,6,3]</code> ç”±è¿™ä¸¤ä¸ªå‚æ•°å…±åŒå†³å®šäº†ResNet50çš„ç½‘ç»œç»“æ„ ï¼Œå½“<code>pretrained</code>ä¸º<code>True</code>æ—¶ï¼ŒmodelåŠ è½½ImageNetä¸­é¢„è®­ç»ƒçš„å‚æ•°ã€‚ï¼ˆè¿™å—æœ¬ç¯‡æ–‡ç« å…ˆä¸è€ƒè™‘ï¼‰</p><p><code>[3,4,6,3]</code>å¯¹åº”äºä¸Šå›¾ä¸­ResNet50ä¸­ conv2_xä¸­æœ‰ä¸‰ä¸ªï¼ˆ$1<em>1, 64$ï¼Œ$3</em>3, 64$ï¼Œ$1<em>1, 256$ï¼‰å·ç§¯å±‚çš„å †å  ï¼ŒåŒç†conv3_xä¸­æœ‰4ä¸ªï¼ˆ$1</em>1, 128$ï¼Œ$3<em>3, 128$ï¼Œ$1</em>1, 512$ï¼‰å·ç§¯å±‚çš„å †å ï¼ŒResNet50å°†å·ç§¯å±‚åˆ†ä¸º4ä¸ªå¤§å±‚ï¼Œ<code>[3,4,6,3]</code>ä»£è¡¨æ¯ä¸€ä¸ªå¤§å±‚ä¸­$1<em>1$ï¼Œ$3</em>3$ï¼Œ$1<em>1$å·ç§¯å±‚ç»„åˆçš„é‡å¤æ¬¡æ•°æ€»å…±1ï¼ˆç¬¬ä¸€ä¸ªå·ç§¯å±‚ï¼‰+1ï¼ˆç¬¬ä¸€ä¸ªæ± åŒ–å±‚ï¼‰+ï¼ˆ3+4+6+3ï¼‰</em>3 = 50å±‚ã€‚</p><p>è¿™é‡Œ<code>Bottleneck</code>ç±»ï¼Œå°±æ˜¯ä¸€ä¸ªåŸºç¡€å—ã€‚å¯¹åº”ä¸Šå›¾ï¼ˆ$1<em>1$ï¼Œ$3</em>3$ï¼Œ$1*1$ï¼‰çš„ä¸‰ä¸ªå·ç§¯å±‚ç»„åˆã€‚</p><h2 id="ResNetç±»"><a href="#ResNetç±»" class="headerlink" title="ResNetç±»"></a>ResNetç±»</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ResNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_make_layer</span>(<span class="params">self, block, planes, blocks, stride=<span class="number">1</span></span>):</span><br><span class="line">        downsample = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> stride != <span class="number">1</span> <span class="keyword">or</span> self.inplanes != planes * block.expansion:</span><br><span class="line">            downsample = nn.Sequential(</span><br><span class="line">                nn.Conv2d(self.inplanes, planes * block.expansion,</span><br><span class="line">                kernel_size=<span class="number">1</span>, stride=stride, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(planes * block.expansion)</span><br><span class="line">            )</span><br><span class="line">        layers = []</span><br><span class="line">        layers.append(block(self.inplanes, planes, stride, downsample))</span><br><span class="line">        self.inplanes = planes * block.expansion</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, blocks): <span class="comment"># for (blocks - 1)</span></span><br><span class="line">            layers.append(block(self.inplanes, planes))</span><br><span class="line">        <span class="keyword">return</span> nn.Sequential(*layers)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, block, layers, num_classes = <span class="number">1000</span></span>):</span><br><span class="line">        self.inplanes = <span class="number">64</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet, self).__init__() <span class="comment"># ?</span></span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">        self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        self.maxpool = nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.layer1 = self._make_layer(block, <span class="number">64</span>, layers[<span class="number">0</span>])</span><br><span class="line">        self.layer2 = self._make_layer(block, <span class="number">128</span>, layers[<span class="number">1</span>], stride=<span class="number">2</span>)</span><br><span class="line">        self.layer3 = self._make_layer(block, <span class="number">256</span>, layers[<span class="number">2</span>], stride=<span class="number">2</span>)</span><br><span class="line">        self.layer4 = self._make_layer(block, <span class="number">512</span>, layers[<span class="number">3</span>], stride=<span class="number">2</span>)</span><br><span class="line">        self.avgpool = nn.AvgPool2d(<span class="number">7</span>, stride=<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#å› ä¸ºæœ€åfeature mapåœ¨è¾“å…¥ä¸º224æ—¶ï¼Œç»è¿‡layer4ä¹‹åå¤§å°ä¸º7*7ï¼Œæ­¤æ—¶ç»è¿‡nn.AvgPool2d(7, stride=1)å¤§å°å˜ä¸º1*1ï¼Œå†ç»è¿‡å…¨è¿æ¥å±‚æ—¶ï¼Œself.fc = nn.Linear(512 * block.expansion, num_classes) å‰è€…æ˜¯è¾“å‡ºçš„æ‰€æœ‰channelæ•°ç›®ï¼Œå®é™…åº”è¯¥ä¸ºchannel*1*1ï¼Œåè€…ä¸ºåˆ†ç±»æ•°</span></span><br><span class="line">        self.fc = nn.Linear(<span class="number">512</span> * block.expansion, num_classes)</span><br><span class="line"><span class="comment"># ?</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> self.modules():</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(m, nn.Conv2d):</span><br><span class="line">                nn.init.kaiming_normal_(m.weight, mode=<span class="string">&#x27;fan_out&#x27;</span>, nonlinearity=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(m, nn.BatchNorm2d):</span><br><span class="line">                nn.init.constant_(m.weight, <span class="number">1</span>)</span><br><span class="line">                nn.init.constant_(m.bias, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">       self.avgpool = nn.AvgPool2d(<span class="number">7</span>, stride=<span class="number">1</span>)</span><br><span class="line">  x = self.avgpool(x)  </span><br><span class="line"></span><br><span class="line">  x = x.view(x.size(<span class="number">0</span>), -<span class="number">1</span>)     </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># é¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œ7*7çš„å·ç§¯</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.bn1(x)</span><br><span class="line">        x = self.relu(x)</span><br><span class="line">        <span class="comment"># ç„¶åå¯¹xè¿›è¡Œ3*3çš„æœ€å¤§æ± åŒ–</span></span><br><span class="line">        x = self.maxpool(x)</span><br><span class="line"><span class="comment"># æ¥ç€è¿›å…¥å››ä¸ªlayer/stage</span></span><br><span class="line">        x = self.layer1(x)</span><br><span class="line">        x = self.layer2(x)</span><br><span class="line">        x = self.layer3(x)</span><br><span class="line">        x = self.layer4(x)</span><br><span class="line"><span class="comment">#æœ€åå¹³å‡æ± åŒ–</span></span><br><span class="line"></span><br><span class="line">        x = self.avgpool(x)</span><br><span class="line">        <span class="comment"># å°†æ•°æ®æ‹‰ä¼¸æˆbatchsize * channel * 1 * 1 ?</span></span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœè¾“å…¥å¤§å°ä¸ä¸º224  é‚£ä¹ˆç›¸åº”çš„å¯ä»¥ä¿®æ”¹AvgPool2d æˆ–è€…åœ¨å…¨è¿æ¥å±‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ä¹˜ä¸Šæœ€ç»ˆçš„width å’Œheight</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>ResNet æ˜¯ç”±<code>__init__</code>å’Œ<code>forward</code>æ„æˆï¼Œä¸ºäº†æ–¹ä¾¿åˆ†æè¿™é‡Œé¦–å…ˆåˆ†æ<code>__init__</code>å‡½æ•°ã€‚</p><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>åœ¨<code>__init__</code>ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯<code>_make_layer</code>å‡½æ•°ï¼Œä»¥<code>layer1</code>ä¸ºä¾‹ï¼Œblockä¸ºBottleneckï¼Œplanes=64ï¼ˆå³channelæ•°ç›®ï¼‰blocks=3 ï¼ˆ<code>[3,4,6,3]</code>åˆ†åˆ«ä»£è¡¨æ¯ä¸€å±‚çš„blocksæ•°ç›®ï¼‰è¿™é‡Œè¦æ³¨æ„<code>layer1</code>çš„strideä¸º1ï¼Œå…¶ä»–layerçš„strideä¸º2ã€‚</p><p>å¯¹äº<code>layer1</code>è€Œè¨€ï¼Œ<code>inplanes=64</code>ï¼Œ <code>planes=64</code>ï¼Œ <code>block.expansion=4</code>ï¼Œå› æ­¤éœ€è¦ç»è¿‡downsampleæ‰èƒ½å¤Ÿä½¿å¾—æ®‹å·®å’Œç»è¿‡è¯¥å±‚çš„feature mapèƒ½å¤Ÿç›¸åŠ ï¼Œdownsampleå³ä¸ºå³è·¯éƒ¨åˆ†ã€‚ï¼ˆå¯ä»¥çœ‹<code>Bottleneck</code>çš„å®ç°ï¼‰</p><h3 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h3><p>è§ä¸Šé¢çš„ä»£ç æ³¨é‡Šã€‚</p><h2 id="Bottleneck"><a href="#Bottleneck" class="headerlink" title="Bottleneck"></a>Bottleneck</h2><p>æ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹Bottleneckçš„å®ç°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Blockçš„å„ä¸ªplaneå€¼ï¼š</span></span><br><span class="line"><span class="string">        inplanesï¼šè¾“å‡ºblockçš„ä¹‹å‰çš„é€šé“æ•°</span></span><br><span class="line"><span class="string">        planesï¼šåœ¨blockä¸­é—´å¤„ç†çš„æ—¶å€™çš„é€šé“æ•°ï¼ˆè¿™ä¸ªå€¼æ˜¯è¾“å‡ºç»´åº¦çš„1/4ï¼‰</span></span><br><span class="line"><span class="string">        midplane*self.expansionï¼šè¾“å‡ºçš„ç»´åº¦</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bottleneck</span>(nn.Module):</span><br><span class="line">    <span class="comment">#æ¯ä¸ªstageä¸­ç»´åº¦æ‹“å±•çš„å€æ•°</span></span><br><span class="line">    expansion = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1 * 1å·ç§¯æ ¸ä¸æ”¹å˜feature mapçš„å¤§å°ï¼Œ3 * 3å·ç§¯æ ¸padding=1&amp;&amp;stride=1ä¹Ÿä¸æ”¹å˜è¾“å…¥feature mapçš„å¤§å°ï¼Œå› æ­¤ç»è¿‡ä¸€ä¸ªBottleneckç»„æˆçš„å·ç§¯å±‚ç»„æ“ä½œåfeature mapå¤§å°ä¸ä¼šæ”¹å˜</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inplanes, planes, stride = <span class="number">1</span>, downsample=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(Bottleneck, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(inplanes, planes, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(planes)</span><br><span class="line">        self.conv2 = nn.Conv2d(planes, planes, kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.bn2 = nn.BatchNorm2d(planes)</span><br><span class="line">        self.conv3 = nn.Conv2d(planes, planes * self.expansion, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.bn3 = nn.BatchNorm2d(planes * self.expansion)</span><br><span class="line">        self.relu = nn.ReLU(inplace= <span class="literal">True</span>)</span><br><span class="line">        self.downsample = downsample</span><br><span class="line">        self.stride = stride</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        residual = x</span><br><span class="line">        out = self.conv1(x)</span><br><span class="line">        out = self.bn1(out)</span><br><span class="line">        out = self.conv2(out)</span><br><span class="line">        out = self.bn2(out)</span><br><span class="line">        out = self.conv3(out)</span><br><span class="line">        out = self.bn3(out)</span><br><span class="line">        <span class="keyword">if</span> self.downsample <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            residual = self.downsample(x)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        out += residual</span><br><span class="line">        out = self.relu(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å½“<code>downsample</code>ä¸ºNoneæ—¶ï¼Œæ®‹å·®è¾¹ç›´è¿ï¼Œæ­¤æ—¶ä¸ºIdentify Blockï¼Œå½“<code>downsample</code>ä¸ä¸ºNoneæ—¶ï¼Œæ®‹å·®è¾¹è¿›è¡Œå·ç§¯å†ç›¸åŠ ï¼Œæ­¤æ—¶ä¸ºConv Blockã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦å…ˆå·ç§¯å†ç›¸åŠ å‘¢ï¼Ÿ</p><p>å› ä¸ºfeature mapçš„å¤§å°ä¸å˜ ä½†æ˜¯åœ¨ç»è¿‡Bottleneck ä¹‹åchannelå˜æˆäº†åŸæ¥çš„å››å€ï¼Œå› æ­¤æƒ³è¦å’ŒåŸå§‹çš„feature mapç›¸åŠ éœ€è¦å°†åŸå§‹çš„feature mapä¹Ÿå˜ä¸ºåŸæ¥çš„å››å€ ï¼Œdownsampleä½œç”¨æ˜¯residual+å½“å‰feature mapæ—¶å°†ç»´åº¦ç»Ÿä¸€ã€‚</p></blockquote><h1 id="ä»è¾“å…¥åˆ°layers"><a href="#ä»è¾“å…¥åˆ°layers" class="headerlink" title="ä»è¾“å…¥åˆ°layers"></a>ä»è¾“å…¥åˆ°layers</h1><p>é¦–å…ˆè¾“å…¥(3, 224, 224)ï¼Œå³ä¸‰ä¸ªé€šé“ï¼Œ224<em>224åƒç´ çš„è¾“å…¥ï¼Œç»è¿‡ä¸€ä¸ªè¾“å‡ºé€šé“æ•°ä¸º64çš„7\</em>7å·ç§¯å±‚ï¼Œä¸€ä¸ª3*3æ± åŒ–ï¼Œå¾—åˆ°(64, 56, 56)ã€‚ç„¶åå°†å…¶è¾“å…¥åˆ°layer1ã€2ã€3ã€4ã€‚</p><blockquote><p>è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯(64, 56, 56)</p><p>å› ä¸ºResNetæ¥å—çš„å›¾åƒå¤§å°ä¸º224 * 224 ç»è¿‡ç¬¬ä¸€å±‚å·ç§¯å±‚<code>self.conv1 = nn.Conv2d(3, 64, kernel_size=7, stride=2, padding=3, bias=False)</code></p><script type="math/tex; mode=display">floor((224-7+3*2)/2)+1=112</script><p>ç»è¿‡ç¬¬ä¸€å±‚æ± åŒ–ä¹‹åï¼Œ<code>self.maxpool = nn.MaxPool2d(kernel_size=3, stride=2, padding=1)</code></p><script type="math/tex; mode=display">floor((112+2*1-3)/2)+1=56</script><p>å› æ­¤åœ¨è¾“å…¥åˆ°Bottleneckä¹‹å‰å¾—åˆ°ä¸€ä¸ª64(channel), 56(height)ï¼Œ56(weight)å¤§å°çš„feature mapã€‚</p></blockquote><h2 id="layer1-Bottleneck1"><a href="#layer1-Bottleneck1" class="headerlink" title="layer1/Bottleneck1"></a>layer1/Bottleneck1</h2><p>è¾“å…¥ ï¼š[batch_size,64,56,56]</p><p>è°ƒç”¨<code>_make_layer(block, 64, layers[0])</code>æ„é€ äº†layer1ï¼Œæ­¤æ—¶<code>self.inplanes</code>ä¸º64ï¼Œ<code>planes * block.expansion</code>=64 <em> 4ï¼Œä¸ç›¸ç­‰ï¼ˆä¹‹æ‰€ä»¥è¦äºŒè€…ç›¸ç­‰ï¼Œæ˜¯å› ä¸ºåœ¨<code>Bottleneck</code>ä¸»ä½“åˆ†æ”¯æœ€åä¸€ä¸ªå·ç§¯å±‚ä¼šå°†<code>channel</code>å˜ä¸º`planes</em>block.expansion<code>ï¼Œå¦‚æœ</code>inplanes<code>ï¼ˆå®é™…å°±æ˜¯è¾“å…¥çš„channelï¼‰ä¸ä¹‹ä¸ç›¸ç­‰åˆ™ä¸å¯ç›¸åŠ å› æ­¤æ„é€ å³è·¯</code>downsample` ï¼ˆ1*1å·ç§¯æ ¸çš„å·ç§¯å±‚æ‰©å±•channel+BNå±‚ï¼‰</p><p><img src="20181108104951863.png" alt="ä¸»ä½“åˆ†æ”¯"></p><p><img src="20181108105037539.png" alt="downsampleåˆ†æ”¯"></p><p>æ›´æ–° inplanes=64*4=256</p><h2 id="layer1-Bottleneck2"><a href="#layer1-Bottleneck2" class="headerlink" title="layer1/Bottleneck2"></a>layer1/Bottleneck2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.conv1 = nn.Conv2d(<span class="number">256</span>, <span class="number">64</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn1 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">self.conv2 = nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn2 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">self.conv3 = nn.Conv2d(<span class="number">64</span>,<span class="number">256</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn3 = nn.BatchNorm2d(planes * self.expansion)</span><br><span class="line">self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">self.downsample = <span class="literal">None</span></span><br><span class="line">self.stride = <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="layer1-Bottleneck3"><a href="#layer1-Bottleneck3" class="headerlink" title="layer1/Bottleneck3"></a>layer1/Bottleneck3</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.conv1 = nn.Conv2d(<span class="number">256</span>, <span class="number">64</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn1 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">self.conv2 = nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=stride,padding=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn2 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">self.conv3 = nn.Conv2d(<span class="number">64</span>,<span class="number">256</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn3 = nn.BatchNorm2d(planes * self.expansion)</span><br><span class="line">self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">self.downsample = <span class="literal">None</span></span><br><span class="line">self.stride = <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="layer2-Bottleneck1"><a href="#layer2-Bottleneck1" class="headerlink" title="layer2/Bottleneck1"></a>layer2/Bottleneck1</h2><p>æ­¤æ—¶<code>stride</code>=2ï¼Œ<code>self.inplanes</code>=256ï¼Œ <code>planes * block.expansion</code>=128*4ï¼Œéœ€è¦ç”Ÿæˆdownsampleå±‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">downsample = nn.Sequential(</span><br><span class="line">nn.Conv2d(<span class="number">256</span>, <span class="number">512</span>,kernel_size=<span class="number">1</span>, stride=<span class="number">2</span>, bias=<span class="literal">False</span>),</span><br><span class="line">nn.BatchNorm2d(<span class="number">512</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆç¬¬ä¸€ä¸ªBottleneckçš„ä¸»å¹²</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.conv1 = nn.Conv2d(<span class="number">256</span>, <span class="number">128</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn1 = nn.BatchNorm2d(planes)</span><br><span class="line"><span class="comment"># æ­¤æ—¶feature map å¤§å°ç”±56å˜æˆ28</span></span><br><span class="line">self.conv2 = nn.Conv2d(<span class="number">128</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn2 = nn.BatchNorm2d(planes)</span><br><span class="line">self.conv3 = nn.Conv2d(<span class="number">128</span>, <span class="number">512</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn3 = nn.BatchNorm2d(planes * self.expansion)</span><br><span class="line">self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">self.downsample = downsample</span><br><span class="line">self.stride = stride</span><br></pre></td></tr></table></figure><p>æ›´æ–°inplanes=512</p><h2 id="layer2-Bottleneck234"><a href="#layer2-Bottleneck234" class="headerlink" title="layer2/Bottleneck234"></a>layer2/Bottleneck234</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.conv1 = nn.Conv2d(<span class="number">512</span>, <span class="number">128</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn1 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">self.conv2 = nn.Conv2d(<span class="number">128</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>,padding=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn2 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">self.conv3 = nn.Conv2d(<span class="number">128</span>,<span class="number">256</span>, kernel_size=<span class="number">1</span>, bias=<span class="literal">False</span>)</span><br><span class="line">self.bn3 = nn.BatchNorm2d(planes * self.expansion)</span><br><span class="line">self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">self.downsample = <span class="literal">None</span></span><br><span class="line">self.stride = <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="layer3-4"><a href="#layer3-4" class="headerlink" title="layer3/4"></a>layer3/4</h2><p>å¯¹äºlayer3å’Œlayer4åŒç†ã€‚</p><h2 id="æ‰“å°å®Œæ•´çš„ç½‘ç»œç»“æ„"><a href="#æ‰“å°å®Œæ•´çš„ç½‘ç»œç»“æ„" class="headerlink" title="æ‰“å°å®Œæ•´çš„ç½‘ç»œç»“æ„"></a>æ‰“å°å®Œæ•´çš„ç½‘ç»œç»“æ„</h2><p>æœ€åï¼Œæˆ‘ä»¬æ‰“å°å®Œæ•´çš„ç½‘ç»œç»“æ„ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">net</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ResNet(</span><br><span class="line">  (conv1): Conv2d(3, 64, kernel_size=(7, 7), stride=(2, 2), padding=(3, 3), bias=False)</span><br><span class="line">  (bn1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">  (relu): ReLU(inplace=True)</span><br><span class="line">  (maxpool): MaxPool2d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)</span><br><span class="line">  (layer1): Sequential(</span><br><span class="line">    (0): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(64, 64, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(64, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">      (downsample): Sequential(</span><br><span class="line">        (0): Conv2d(64, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">        (1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">    (1): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(256, 64, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(64, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (2): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(256, 64, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(64, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">  (layer2): Sequential(</span><br><span class="line">    (0): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(256, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(128, 128, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">      (downsample): Sequential(</span><br><span class="line">        (0): Conv2d(256, 512, kernel_size=(1, 1), stride=(2, 2), bias=False)</span><br><span class="line">        (1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">    (1): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(512, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (2): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(512, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (3): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(512, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">  (layer3): Sequential(</span><br><span class="line">    (0): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(512, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(256, 1024, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">      (downsample): Sequential(</span><br><span class="line">        (0): Conv2d(512, 1024, kernel_size=(1, 1), stride=(2, 2), bias=False)</span><br><span class="line">        (1): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">    (1): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(1024, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(256, 1024, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (2): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(1024, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(256, 1024, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (3): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(1024, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(256, 1024, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (4): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(1024, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(256, 1024, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (5): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(1024, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(256, 1024, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">  (layer4): Sequential(</span><br><span class="line">    (0): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(1024, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(2048, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">      (downsample): Sequential(</span><br><span class="line">        (0): Conv2d(1024, 2048, kernel_size=(1, 1), stride=(2, 2), bias=False)</span><br><span class="line">        (1): BatchNorm2d(2048, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">    (1): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(2048, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(2048, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">    (2): Bottleneck(</span><br><span class="line">      (conv1): Conv2d(2048, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn1): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv2): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)</span><br><span class="line">      (bn2): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (conv3): Conv2d(512, 2048, kernel_size=(1, 1), stride=(1, 1), bias=False)</span><br><span class="line">      (bn3): BatchNorm2d(2048, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span><br><span class="line">      (relu): ReLU(inplace=True)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">  (avgpool): AvgPool2d(kernel_size=7, stride=1, padding=0)</span><br><span class="line">  (fc): Linear(in_features=2048, out_features=1000, bias=True)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>He K, Zhang X, Ren S, et al. Deep residual learning for image recognition[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2016: 770-778.</li><li><a href="https://blog.csdn.net/a940902940902/article/details/83858694">ResNetç»“æ„åˆ†æ</a></li><li><a href="https://www.bilibili.com/video/BV1154y1S7WC">å²ä¸Šæœ€è¯¦ç»†ResNet50å¤ç°è§£æï¼ˆé¢å‘å°ç™½ï¼‰</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> ResNet </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> ResNet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç¬”è®°ã€‘BFS ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶</title>
      <link href="/2022/03/09/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91BFS-%E7%AE%97%E6%B3%95%E8%A7%A3%E9%A2%98%E5%A5%97%E8%B7%AF%E6%A1%86%E6%9E%B6/"/>
      <url>/2022/03/09/%E3%80%90%E7%AC%94%E8%AE%B0%E3%80%91BFS-%E7%AE%97%E6%B3%95%E8%A7%A3%E9%A2%98%E5%A5%97%E8%B7%AF%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡FROMã€Šlabuladong ç®—æ³•ç§˜ç±ã€‹</p></blockquote><h1 id="ä»€ä¹ˆæ˜¯-BFS"><a href="#ä»€ä¹ˆæ˜¯-BFS" class="headerlink" title="ä»€ä¹ˆæ˜¯ BFS"></a>ä»€ä¹ˆæ˜¯ BFS</h1><p>BFS(Breadth First Search)ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œèµ·æºäº<strong>æ ‘çš„å±‚æ¬¡éå†</strong>ã€‚å…¶æ ¸å¿ƒæ˜¯åˆ©ç”¨<strong>é˜Ÿåˆ—</strong>è¿™ç§æ•°æ®ç»“æ„ã€‚</p><p>BFS çš„æ ¸å¿ƒæ€æƒ³åº”è¯¥ä¸éš¾ç†è§£çš„ï¼Œå°±æ˜¯æŠŠâ¼€äº›é—®é¢˜æŠ½è±¡æˆå›¾ï¼Œä»â¼€ä¸ªç‚¹å¼€å§‹ï¼Œå‘å››å‘¨å¼€å§‹æ‰©æ•£ã€‚ </p><h1 id="BFS-çš„åº”ç”¨åœºæ™¯"><a href="#BFS-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="BFS çš„åº”ç”¨åœºæ™¯"></a>BFS çš„åº”ç”¨åœºæ™¯</h1><p>BFS ç®—æ³•å¸¸è§äºæ±‚æœ€å€¼çš„åœºæ™¯ï¼Œå› ä¸º BFS çš„ç®—æ³•é€»è¾‘ä¿è¯äº†ç®—æ³•ç¬¬â¼€æ¬¡åˆ°è¾¾ç›®æ ‡æ—¶çš„ä»£ä»·æ˜¯æœ€å°çš„ï¼ˆï¼Ÿï¼‰ã€‚</p><p>ä¸¾ä¾‹â¼€ä¸‹ BFS å‡ºç°çš„å¸¸è§åœºæ™¯å¥½å§ï¼Œé—®é¢˜çš„æœ¬è´¨å°±æ˜¯è®©ä½ åœ¨â¼€å¹…ã€Œå›¾ã€ä¸­æ‰¾åˆ°ä»èµ·ç‚¹ start åˆ°ç»ˆç‚¹ target çš„æœ€è¿‘è·ç¦»ã€‚</p><p>è¿™ä¸ªå¹¿ä¹‰çš„æè¿°å¯ä»¥æœ‰å„ç§å˜ä½“ï¼Œæ¯”å¦‚èµ°è¿·å®«ï¼Œæœ‰çš„æ ¼å­æ˜¯å›´å¢™ä¸èƒ½èµ°ï¼Œä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·ç¦»æ˜¯å¤šå°‘ï¼Ÿå¦‚æœè¿™ä¸ªè¿·å®«å¸¦ã€Œä¼ é€é—¨ã€å¯ä»¥ç¬é—´ä¼ é€å‘¢ï¼Ÿå†æ¯”å¦‚è¯´ä¸¤ä¸ªå•è¯ï¼Œè¦æ±‚ä½ é€šè¿‡æŸäº›æ›¿æ¢ï¼ŒæŠŠå…¶ä¸­ä¸€ä¸ªå˜æˆå¦ä¸€ä¸ªï¼Œæ¯æ¬¡åªèƒ½æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ï¼Œæœ€å°‘è¦æ›¿æ¢å‡ æ¬¡ï¼Ÿå†æ¯”å¦‚è¯´è¿è¿çœ‹æ¸¸æˆï¼Œä¸¤ä¸ªæ–¹å—æ¶ˆé™¤çš„æ¡ä»¶ä¸ä»…ä»…æ˜¯å›¾æ¡ˆç›¸åŒï¼Œè¿˜å¾—ä¿è¯ä¸¤ä¸ªæ–¹å—ä¹‹é—´çš„æœ€çŸ­è¿çº¿ä¸èƒ½å¤šäºä¸¤ä¸ªæ‹ç‚¹ã€‚ä½ ç©è¿è¿çœ‹ï¼Œç‚¹å‡»ä¸¤ä¸ªåæ ‡ï¼Œæ¸¸æˆæ˜¯å¦‚ä½•åˆ¤æ–­å®ƒä¿©çš„æœ€çŸ­è¿çº¿æœ‰å‡ ä¸ªæ‹ç‚¹çš„ï¼Ÿ</p><h1 id="BFS-æ¡†æ¶ä»£ç "><a href="#BFS-æ¡†æ¶ä»£ç " class="headerlink" title="BFS æ¡†æ¶ä»£ç "></a>BFS æ¡†æ¶ä»£ç </h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—ä»èµ·ç‚¹ start åˆ°ç»ˆç‚¹ target çš„æœ€è¿‘è·ç¦»</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">BFS</span><span class="params">(Node start, Node target)</span> &#123;</span><br><span class="line">    Queue&lt;Node&gt; q; <span class="comment">// æ ¸å¿ƒæ•°æ®ç»“æ„</span></span><br><span class="line">    Set&lt;Node&gt; visited; <span class="comment">// é¿å…èµ°å›å¤´è·¯</span></span><br><span class="line">    </span><br><span class="line">    q.offer(start); <span class="comment">// å°†èµ·ç‚¹åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">    visited.add(start);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// è®°å½•æ‰©æ•£çš„æ­¥æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (q not empty) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> q.size();</span><br><span class="line">        <span class="comment">/* å°†å½“å‰é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‘å››å‘¨æ‰©æ•£ */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sz; i++) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            <span class="comment">/* åˆ’é‡ç‚¹ï¼šè¿™é‡Œåˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹ */</span></span><br><span class="line">            <span class="keyword">if</span> (cur is target)</span><br><span class="line">                <span class="keyword">return</span> step;</span><br><span class="line">            <span class="comment">/* å°† cur çš„ç›¸é‚»èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ— */</span></span><br><span class="line">            <span class="keyword">for</span> (Node x : cur.adj()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x not in visited) &#123;</span><br><span class="line">                    q.offer(x);</span><br><span class="line">                    visited.add(x);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* åˆ’é‡ç‚¹ï¼šæ›´æ–°æ­¥æ•°åœ¨è¿™é‡Œ */</span></span><br><span class="line">        step++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é˜Ÿåˆ— <code>q</code> å°±ä¸è¯´äº†ï¼ŒBFS çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼›<code>cur.adj()</code> æ³›æŒ‡ <code>cur</code> ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚è¯´äºŒç»´æ•°ç»„ä¸­ï¼Œ<code>cur</code> ä¸Šä¸‹å·¦å³å››é¢çš„ä½ç½®å°±æ˜¯ç›¸é‚»èŠ‚ç‚¹ï¼›<code>visited</code> çš„ä¸»è¦ä½œç”¨æ˜¯é˜²æ­¢èµ°å›å¤´è·¯ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åƒä¸€èˆ¬çš„äºŒå‰æ ‘ç»“æ„ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¸ä¼šèµ°å›å¤´è·¯å°±ä¸éœ€è¦ <code>visited</code>ã€‚</p><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><p>LeetCode 111ã€752</p><h1 id="åŒå‘BFSï¼ˆäº†è§£ï¼‰"><a href="#åŒå‘BFSï¼ˆäº†è§£ï¼‰" class="headerlink" title="åŒå‘BFSï¼ˆäº†è§£ï¼‰"></a>åŒå‘BFSï¼ˆäº†è§£ï¼‰</h1><p>ä¼ ç»Ÿçš„ BFS æ¡†æ¶å°±æ˜¯ä»èµ·ç‚¹å¼€å§‹å‘å››å‘¨æ‰©æ•£ï¼Œé‡åˆ°ç»ˆç‚¹æ—¶åœæ­¢ï¼›è€ŒåŒå‘ BFS åˆ™æ˜¯ä»èµ·ç‚¹å’Œç»ˆç‚¹åŒæ—¶å¼€å§‹æ‰©æ•£ï¼Œå½“ä¸¤è¾¹æœ‰äº¤é›†çš„æ—¶å€™åœæ­¢ã€‚</p><h1 id="BFS-ä¸-DFS"><a href="#BFS-ä¸-DFS" class="headerlink" title="BFS ä¸ DFS"></a>BFS ä¸ DFS</h1><blockquote><p>è¿™éƒ¨åˆ†ä¸æ˜¯å¾ˆæ‡‚ï¼Œåé¢å†çœ‹</p></blockquote><p>BFS ç›¸å¯¹ DFS çš„æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼šBFS æ‰¾åˆ°çš„è·¯å¾„â¼€å®šæ˜¯æœ€çŸ­çš„ï¼Œä½†ä»£ä»·å°±æ˜¯ç©ºé—´å¤æ‚åº¦å¯èƒ½æ¯” DFS å¤§å¾ˆå¤šã€‚</p><p><strong>1ã€ä¸ºä»€ä¹ˆ BFS å¯ä»¥æ‰¾åˆ°æœ€çŸ­è·ç¦»ï¼ŒDFS ä¸è¡Œå—</strong>ï¼Ÿ</p><p>é¦–å…ˆï¼Œä½ çœ‹ BFS çš„é€»è¾‘ï¼Œ<code>depth</code> æ¯å¢åŠ ä¸€æ¬¡ï¼Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å‘å‰è¿ˆä¸€æ­¥ï¼Œè¿™ä¿è¯äº†ç¬¬ä¸€æ¬¡åˆ°è¾¾ç»ˆç‚¹çš„æ—¶å€™ï¼Œèµ°çš„æ­¥æ•°æ˜¯æœ€å°‘çš„ã€‚</p><p>DFS ä¸èƒ½æ‰¾æœ€çŸ­è·¯å¾„å—ï¼Ÿå…¶å®ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦ç›¸å¯¹é«˜å¾ˆå¤šã€‚ä½ æƒ³å•Šï¼ŒDFS å®é™…ä¸Šæ˜¯é é€’å½’çš„å †æ ˆè®°å½•èµ°è¿‡çš„è·¯å¾„ï¼Œä½ è¦æ‰¾åˆ°æœ€çŸ­è·¯å¾„ï¼Œè‚¯å®šå¾—æŠŠäºŒå‰æ ‘ä¸­æ‰€æœ‰æ ‘æˆéƒ½æ¢ç´¢å®Œæ‰èƒ½å¯¹æ¯”å‡ºæœ€çŸ­çš„è·¯å¾„æœ‰å¤šé•¿å¯¹ä¸å¯¹ï¼Ÿè€Œ BFS å€ŸåŠ©é˜Ÿåˆ—åšåˆ°ä¸€æ¬¡ä¸€æ­¥ã€Œé½å¤´å¹¶è¿›ã€ï¼Œæ˜¯å¯ä»¥åœ¨ä¸éå†å®Œæ•´æ£µæ ‘çš„æ¡ä»¶ä¸‹æ‰¾åˆ°æœ€çŸ­è·ç¦»çš„ã€‚</p><p>å½¢è±¡ç‚¹è¯´ï¼ŒDFS æ˜¯çº¿ï¼ŒBFS æ˜¯é¢ï¼›DFS æ˜¯å•æ‰“ç‹¬æ–—ï¼ŒBFS æ˜¯é›†ä½“è¡ŒåŠ¨ã€‚è¿™ä¸ªåº”è¯¥æ¯”è¾ƒå®¹æ˜“ç†è§£å§ã€‚</p><p><strong>2ã€æ—¢ç„¶ BFS é‚£ä¹ˆå¥½ï¼Œä¸ºå•¥ DFS è¿˜è¦å­˜åœ¨</strong>ï¼Ÿ</p><p>BFS å¯ä»¥æ‰¾åˆ°æœ€çŸ­è·ç¦»ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦é«˜ï¼Œè€Œ DFS çš„ç©ºé—´å¤æ‚åº¦è¾ƒä½ã€‚</p><p>è¿˜æ˜¯æ‹¿åˆšæ‰æˆ‘ä»¬å¤„ç†äºŒå‰æ ‘é—®é¢˜çš„ä¾‹å­ï¼Œå‡è®¾ç»™ä½ çš„è¿™ä¸ªäºŒå‰æ ‘æ˜¯æ»¡äºŒå‰æ ‘ï¼ŒèŠ‚ç‚¹æ•°ä¸º <code>N</code>ï¼Œå¯¹äº DFS ç®—æ³•æ¥è¯´ï¼Œç©ºé—´å¤æ‚åº¦æ— éå°±æ˜¯é€’å½’å †æ ˆï¼Œæœ€åæƒ…å†µä¸‹é¡¶å¤šå°±æ˜¯æ ‘çš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯ <code>O(logN)</code>ã€‚</p><p>ä½†æ˜¯ä½ æƒ³æƒ³ BFS ç®—æ³•ï¼Œé˜Ÿåˆ—ä¸­æ¯æ¬¡éƒ½ä¼šå‚¨å­˜ç€äºŒå‰æ ‘ä¸€å±‚çš„èŠ‚ç‚¹ï¼Œè¿™æ ·çš„è¯æœ€åæƒ…å†µä¸‹ç©ºé—´å¤æ‚åº¦åº”è¯¥æ˜¯æ ‘çš„æœ€åº•å±‚èŠ‚ç‚¹çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ <code>N/2</code>ï¼Œç”¨ Big O è¡¨ç¤ºçš„è¯ä¹Ÿå°±æ˜¯ <code>O(N)</code>ã€‚</p><p>ç”±æ­¤è§‚ä¹‹ï¼ŒBFS è¿˜æ˜¯æœ‰ä»£ä»·çš„ï¼Œä¸€èˆ¬æ¥è¯´åœ¨æ‰¾æœ€çŸ­è·¯å¾„çš„æ—¶å€™ä½¿ç”¨ BFSï¼Œå…¶ä»–æ—¶å€™è¿˜æ˜¯ DFS ä½¿ç”¨å¾—å¤šä¸€äº›ï¼ˆä¸»è¦æ˜¯é€’å½’ä»£ç å¥½å†™ï¼‰ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://labuladong.gitee.io/algo/4/30/113/">BFS ç®—æ³•è§£é¢˜å¥—è·¯æ¡†æ¶</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> BFS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> BFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯ï¼ˆend-to-endï¼‰çš„å­¦ä¹ æ¨¡å‹</title>
      <link href="/2022/03/07/%E4%BB%80%E4%B9%88%E6%98%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%EF%BC%88end-to-end%EF%BC%89%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B/"/>
      <url>/2022/03/07/%E4%BB%80%E4%B9%88%E6%98%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%EF%BC%88end-to-end%EF%BC%89%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p><strong>ç«¯åˆ°ç«¯çš„å­¦ä¹ æ¨¡å‹</strong>æ˜¯æŒ‡å°†åŸå§‹æ•°æ®ä¸åšä»»ä½•çš„é¢„å¤„ç†ç›´æ¥å°†åŸå§‹æ•°æ®è¾“å…¥åˆ°æ¨¡å‹å½“ä¸­ï¼Œæœ€åå¾—åˆ°çš„è¾“å‡ºç»“æœä¸æœŸæœ›ç»“æœæœ‰è¯¯å·®ï¼Œè¿™è¯¯å·®åœ¨åå‘ä¼ æ’­æ¨¡å‹çš„å„å±‚ä¸­ï¼Œå°†å‚æ•°è¿›è¡Œä¼˜åŒ–ï¼Œä¸€ç›´åˆ°æœŸæœ›ç»“æœç»“æŸã€‚<strong>éç«¯åˆ°ç«¯</strong>æ˜¯å°†åŸå§‹æ•°æ®è¿›è¡Œæ ‡æ³¨ï¼Œå¾—åˆ°å…·æœ‰ç‰¹å¾çš„å¤„ç†åçš„æ•°æ®ï¼Œç„¶ååœ¨ä½œä¸ºè¾“å…¥ï¼Œè¿™æ ·çš„å¼Šç«¯æ˜¯å¦‚æœæå–æ•°æ®ç‰¹å¾æ—¶å‡ºç°é”™è¯¯ï¼Œå°†æ— æ³•è°ƒæ•´ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.its203.com/article/qq_42514225/108835224?2022-03-07">ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯çš„å­¦ä¹ æ¨¡å‹</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å¤§Må¯¹é½å­é›†</title>
      <link href="/2022/03/01/%E6%9C%80%E5%A4%A7M%E5%AF%B9%E9%BD%90%E5%AD%90%E9%9B%86/"/>
      <url>/2022/03/01/%E6%9C%80%E5%A4%A7M%E5%AF%B9%E9%BD%90%E5%AD%90%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p>æœ‰ N ä¸ªç‚¹ä½äºä¸€æ¡çº¿ä¸Šï¼Œç¼–å·ä» 0 åˆ° N-1 ï¼Œå…¶åæ ‡åœ¨æ•°ç»„ A ä¸­ç»™å‡ºã€‚å¯¹äºæ¯ä¸ªI (0 â‰¤ l &lt;N)ï¼Œç›´çº¿ä¸Šç‚¹æ•° I çš„åæ ‡ä¸º A[l] ã€‚ç‚¹çš„åæ ‡å¯èƒ½ç›¸åŒã€‚</p><p>å¯¹äºç»™å®šçš„æ•´æ•° M ï¼Œå¦‚æœå­é›†å†…ä»»æ„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¯è¢«Mæ•´é™¤ï¼Œåˆ™ç§°è¿™äº›ç‚¹çš„å­é›†ä¸ºM<strong>å¯¹é½</strong>ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯æŸ¥æ‰¾ç»™å®š N ä¸ªç‚¹é›†çš„æœ€å¤§ M å¯¹é½å­é›†çš„å¤§å°ã€‚</p><p>ä¾‹å¦‚ï¼Œè€ƒè™‘æ•´æ•° M=3 å’Œæ•°ç»„ Aï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><blockquote><p>A[0] = -3  A[1] = -2  A[2] = 1  A[3] = 0  A[4] = 8  A[5] = 7  A[6] = 1</p></blockquote><p>åŒ…å«ç¼–å·ä¸º1ã€2ã€5å’Œ6çš„ç‚¹çš„å­é›†ï¼Œåæ ‡åˆ†åˆ«ä¸º-2ã€1ã€7å’Œ1ï¼Œæ˜¯3å¯¹é½å­é›†çš„ç¤ºä¾‹ï¼Œå› ä¸ºï¼š</p><ul><li>ç¼–å·ä¸º1å’Œ2çš„ç‚¹ä¹‹é—´çš„è·ç¦»ä¸ºabs(A[1] - A[2]) = 3ï¼Œ</li><li>ä»5å·ç‚¹åˆ°ç¼–å·1å’Œ2çš„ç‚¹çš„è·ç¦»åˆ†åˆ«ä¸º9å’Œ6ï¼Œ</li><li>ä»6å·ç‚¹åˆ°ç¼–å·ä¸º1ã€2å’Œ5çš„ç‚¹çš„è·ç¦»åˆ†åˆ«ä¸º3ã€0å’Œ6ï¼Œ</li></ul><p>è¿™äº›è·ç¦»éƒ½å¯ä»¥è¢« M=3 æ•´é™¤ã€‚æ­¤å­é›†çš„å¤§å°ä¸º4ï¼Œå¹¶ä¸”æ²¡æœ‰æ›´å¤§çš„3å¯¹é½å­é›†ã€‚</p><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">solution</span><span class="params">(<span class="type">int</span>[] A, <span class="type">int</span> M)</span>;</span><br></pre></td></tr></table></figure><p>ç»™å®šä¸€ä¸ªç”± N ä¸ªæ•´æ•°å’Œä¸€ä¸ªæ•´æ•° M ç»„æˆçš„æ•°ç»„ Aï¼Œè¿”å›æœ€å¤§ M å¯¹é½å­é›†çš„å¤§å°ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®š M=3 ä¸” A=[-3ï¼Œ-2ï¼Œ1ï¼Œ0ï¼Œ8ï¼Œ7ï¼Œ1]ï¼Œå‡½æ•°åº”è¿”å›4ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼›</p><p>ç»™å®š M=8 ä¸” A=[7ï¼Œ1ï¼Œ11ï¼Œ8,4ï¼Œ10]ï¼Œå‡½æ•°åº”è¿”å›1ã€‚</p><h1 id="è§£"><a href="#è§£" class="headerlink" title="è§£"></a>è§£</h1><p>æŠŠæ‰€æœ‰æŒ‰ M çš„ä½™æ•°å­˜æˆä¸€ç»„å°±å¯ä»¥ï¼Œ<strong>åŒç»„çš„åˆšå¥½æŠŠä½™æ•°æ¶ˆæ‰å°±æ˜¯è·ç¦»æ•´é™¤</strong>ã€‚è¿”å›æœ€å¤§å³ä¸ºæ‰€æ±‚ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šä½™æ•°ä¸ºè´Ÿçš„ï¼Œéœ€è¦è½¬ä¸ºæœ€å°æ­£ä½™æ•°ï¼ˆ+Mï¼‰</p><h2 id="Javaå®ç°"><a href="#Javaå®ç°" class="headerlink" title="Javaå®ç°"></a>Javaå®ç°</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">solution</span><span class="params">(<span class="type">int</span>[] A, <span class="type">int</span> M)</span>&#123;</span><br><span class="line">    <span class="comment">//remainders[i] = j, è¡¨ç¤ºä½™æ•°ä¸ºiçš„é¢‘æ¬¡æ˜¯j</span></span><br><span class="line">    <span class="type">int</span>[] remainders = <span class="keyword">new</span> <span class="title class_">int</span>[M];</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// è®°å½•æœ€å¤§çš„é¢‘æ¬¡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> A.length;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">remainder</span> <span class="operator">=</span> A[i] % M;</span><br><span class="line">        <span class="keyword">if</span>(remainder &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            remainder += M;</span><br><span class="line">        &#125;</span><br><span class="line">        remainders[remainder] ++;</span><br><span class="line">        ans = Math.max(ans, remainders[remainder]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> æ•°è®º </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ±‚æ•°å­—1åœ¨æ‰€æœ‰ä¸è¶…è¿‡Nçš„åè¿›åˆ¶æ­£æ•´æ•°ä¸­å‡ºç°çš„æ¬¡æ•°</title>
      <link href="/2022/03/01/%E6%B1%82%E6%95%B0%E5%AD%971%E5%9C%A8%E6%89%80%E6%9C%89%E4%B8%8D%E8%B6%85%E8%BF%87N%E7%9A%84%E5%8D%81%E8%BF%9B%E5%88%B6%E6%AD%A3%E6%95%B4%E6%95%B0%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0/"/>
      <url>/2022/03/01/%E6%B1%82%E6%95%B0%E5%AD%971%E5%9C%A8%E6%89%80%E6%9C%89%E4%B8%8D%E8%B6%85%E8%BF%87N%E7%9A%84%E5%8D%81%E8%BF%9B%E5%88%B6%E6%AD%A3%E6%95%B4%E6%95%B0%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p>å†™ä¸€ä¸ªå‡½æ•°</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">solution</span><span class="params">(<span class="type">int</span> N)</span>;</span><br></pre></td></tr></table></figure><p>å³ç»™å®šä¸€ä¸ªæ•´æ•°Nï¼Œè¿”å›æ•°å­—1åœ¨æ‰€æœ‰ä¸è¶…è¿‡ N çš„æ­£æ•´æ•°çš„åè¿›åˆ¶è¡¨ç¤ºä¸­å‡ºç°çš„æ¬¡æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šN = 13ï¼Œè¯¥å‡½æ•°åº”è¿”å›6ï¼Œå› ä¸ºï¼š</p><ul><li>æ‰€æœ‰ä¸è¶…è¿‡13çš„æ­£æ•´æ•°æ˜¯1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ã€10ã€11ã€12 å’Œ13ï¼›</li><li>æ•°å­—1å…±å‡ºç°å…­æ¬¡ï¼šä¸€æ¬¡åœ¨æ•°å­—1ä¸­ï¼Œä¸€æ¬¡åœ¨æ•°å­—10ä¸­ï¼Œä¸¤æ¬¡åœ¨æ•°å­—11ä¸­ï¼Œä¸€æ¬¡åœ¨æ•°å­—12ä¸­ï¼Œä¸€æ¬¡åœ¨æ•°å­—13ä¸­ã€‚</li></ul><p>N æ˜¯[0.. 100,000,000]èŒƒå›´å†…çš„æ•´æ•°ã€‚</p><h1 id="è§£æ³•1"><a href="#è§£æ³•1" class="headerlink" title="è§£æ³•1"></a>è§£æ³•1</h1><p>æš´åŠ›æ±‚è§£ï¼šéå†æ¯ä¸€ä¸ªæ•°ï¼Œå¯¹æ¯ä¸€ä¸ªæ•°æ±‚1çš„ä¸ªæ•°ï¼Œç„¶ååŠ èµ·æ¥å¾—å’Œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">solution</span><span class="params">(<span class="type">int</span> N)</span><span class="comment">//ç»Ÿè®¡1-nä¸­1çš„ä¸ªæ•°</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j=i; j&gt;<span class="number">0</span>; j/=<span class="number">10</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(j%<span class="number">10</span>==<span class="number">1</span>)</span><br><span class="line">ans ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®—æ³•æ—¶é—´å¤æ‚åº¦ï¼š$O(nlgn)$</p><h1 id="è§£æ³•2"><a href="#è§£æ³•2" class="headerlink" title="è§£æ³•2"></a>è§£æ³•2</h1><p>è€ƒè™‘ä¸¤ä½æ•°ã€‚å°†ä¸€ä¸ªæ­£æ•´æ•°ä¸­1çš„ä¸ªæ•°åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ä¸ªä½ä¸Šå‡ºç°1çš„æ•°ç›®f1(n)ï¼Œä¸€éƒ¨åˆ†æ˜¯åä½ä¸Šå‡ºç°1çš„æ•°ç›®f2(n) ã€‚</p><p>n=10ï¼Œ f1(10)=1ï¼ˆ1-10ä¸ªä½å‡ºç°çš„1çš„ä¸ªæ•°ä¸º1ï¼‰ï¼Œf2(10)=1ï¼ˆ1-10ä¸ªä½å‡ºç°çš„1çš„åæ•°ä¸º1ï¼‰ã€‚</p><p>ä¸¾ä¸€äº›ä»£è¡¨æ€§çš„æ•°ï¼š</p><div class="table-container"><table><thead><tr><th>n</th><th>f1(n)</th><th>f2(n)</th><th>f(n)</th></tr></thead><tbody><tr><td>10</td><td>1</td><td>1</td><td>2</td></tr><tr><td>11</td><td>2</td><td>2</td><td>4</td></tr><tr><td>12</td><td>2</td><td>3</td><td>5</td></tr><tr><td>13</td><td>2</td><td>4</td><td>6</td></tr><tr><td>20</td><td>2</td><td>10</td><td>12</td></tr><tr><td>21</td><td>3</td><td>10</td><td>13</td></tr><tr><td>22</td><td>3</td><td>10</td><td>13</td></tr><tr><td>23</td><td>3</td><td>10</td><td>13</td></tr><tr><td>30</td><td>3</td><td>10</td><td>13</td></tr><tr><td>31</td><td>4</td><td>10</td><td>14</td></tr><tr><td>32</td><td>4</td><td>10</td><td>14</td></tr><tr><td>33</td><td>4</td><td>10</td><td>14</td></tr></tbody></table></div><p>å…ˆæ¥çœ‹åä½ï¼Œå½“åä½ä¸Šçš„æ•°ä¸º1æ—¶ï¼Œ</p><div class="table-container"><table><thead><tr><th>n</th><th>f2(n)</th></tr></thead><tbody><tr><td>10</td><td>1</td></tr><tr><td>11</td><td>2</td></tr><tr><td>12</td><td>3</td></tr><tr><td>13</td><td>4</td></tr></tbody></table></div><p>f2(n)=å½“å‰æ•°ä¸ªä½æ•°å­—+1ï¼›</p><p>å½“åä½ä¸Šçš„æ•°å¤§äº1æ—¶ï¼Œ</p><div class="table-container"><table><thead><tr><th>n</th><th>f2(n)</th></tr></thead><tbody><tr><td>20</td><td>10</td></tr><tr><td>21</td><td>10</td></tr><tr><td>22</td><td>10</td></tr><tr><td>23</td><td>10</td></tr><tr><td>30</td><td>10</td></tr><tr><td>31</td><td>10</td></tr><tr><td>32</td><td>10</td></tr><tr><td>33</td><td>10</td></tr></tbody></table></div><p>f2(n) = 10ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶åä½ä¸Š1çš„æ•°ç›®ä»…ä»…å’Œåä½æœ‰å…³ç³»ï¼Œä¹Ÿå°±æ˜¯<strong>åä½çš„ä½å› å­</strong>10ã€‚</p><p>å†æ¥çœ‹ä¸ªä½ï¼Œå½“ä¸ªä½ä¸Šçš„æ•°ä¸º1çš„æ—¶å€™</p><div class="table-container"><table><thead><tr><th>n</th><th>f1(n)</th></tr></thead><tbody><tr><td>11</td><td>2</td></tr><tr><td>21</td><td>3</td></tr><tr><td>31</td><td>4</td></tr></tbody></table></div><p>f1(n) = å½“å‰æ•°åä½æ•°å­—+1ï¼›</p><p>å½“ä¸ªä½ä¸Šçš„æ•°å¤§äº1æ—¶ï¼Œ</p><div class="table-container"><table><thead><tr><th>n</th><th>f1(n)</th></tr></thead><tbody><tr><td>22</td><td>3</td></tr><tr><td>23</td><td>3</td></tr><tr><td>32</td><td>4</td></tr><tr><td>33</td><td>4</td></tr></tbody></table></div><p>f1(n) = å½“å‰æ•°åä½æ•°å­—+1ï¼›</p><p>è¿˜æœ‰å½“ä¸ªä½ä¸Šçš„æ•°ç­‰äº0æ—¶ï¼Œ</p><div class="table-container"><table><thead><tr><th>n</th><th>f1(n)</th></tr></thead><tbody><tr><td>10</td><td>1</td></tr><tr><td>20</td><td>2</td></tr><tr><td>30</td><td>3</td></tr></tbody></table></div><p>f1(n) = å½“å‰æ•°åä½æ•°å­—ã€‚</p><p>è¿™è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰åˆ†æä¸¤ä½æ•°ä»¥ä¸Šçš„æ•°å­—ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å°†å½“å‰ä½åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š=0ï¼Œ=1ï¼Œ&gt;1ã€‚</p><p>å½“ç™¾ä½ä¸Šçš„æ•°å­—æ˜¯0çš„æ—¶å€™ï¼Œå‡è®¾n=12013ã€‚æ­¤æ—¶1-12013çš„æ‰€æœ‰æ•´æ•°ä¸­ï¼Œç™¾ä½ä¸Šå‡ºç°1çš„æ•°æ˜¯100~199ï¼Œ1100~1199ï¼Œ2100~2199â€¦â€¦11100~11199ã€‚ä¹Ÿå°±æ˜¯12ä¸ª100ï¼Œ1200ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ç™¾ä½ä¸Š1çš„æ•°ç›®æ˜¯ç”±é«˜ä½ï¼ˆ12ï¼‰å†³å®šçš„ï¼Œè€Œä¸”ç­‰äºé«˜ä½ï¼ˆ12ï¼‰* å½“å‰ä½å› å­ï¼ˆ100ï¼‰ã€‚</p><p>å½“ç™¾ä½ä¸Šçš„æ•°å­—æ˜¯1çš„æ—¶å€™ï¼Œå‡è®¾n=12113ã€‚æ­¤æ—¶1-12113çš„æ‰€æœ‰æ•´æ•°ä¸­ï¼Œç™¾ä½ä¸Šå‡ºç°1çš„æ•°æ˜¯100~199ï¼Œ1100~1199ï¼Œ2100~2199â€¦â€¦11100~11199ï¼Œ12100~12113ã€‚ä¹Ÿå°±æ˜¯13ä¸ª100ï¼Œ1300ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ç™¾ä½ä¸Š1çš„æ•°ç›®æ˜¯ç”±é«˜ä½ï¼ˆ12ï¼‰å†³å®šçš„ï¼Œè€Œä¸”ç­‰äºï¼ˆé«˜ä½ï¼ˆ12ï¼‰+1ï¼‰* å½“å‰ä½å› å­ï¼ˆ100ï¼‰ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜å°±æ˜¯å¦‚ä½•æ±‚ä¸€ä¸ªæ•°çš„é«˜ä½å’Œä½ä½ï¼Œè¿˜æœ‰å½“å‰ä½ã€‚è¿™å’Œå½“å‰ä½çš„ä½å› å­æœ‰å…³ç³»ã€‚</p><p>å¯¹äº12345ï¼Œå‡è®¾å½“å‰ä½æ˜¯ç™¾ä½ï¼ˆ100ï¼‰ï¼Œåˆ™</p><ul><li>ä½ä½æ•°å­—ï¼š12345 - (12345 / 100) *100 = 45</li><li>é«˜ä½æ•°å­—ï¼š12345 / (100 * 10) = 12</li><li>å½“å‰ä½æ•°å­—ï¼š12345 / 100 = 123ï¼Œ123 % 10 = 3ã€‚</li></ul><p>ä»¥ä¸Šåˆ†æå¯ä»¥å†™å‡ºå®Œæ•´ä»£ç ã€‚</p><h2 id="Javaå®ç°"><a href="#Javaå®ç°" class="headerlink" title="Javaå®ç°"></a>Javaå®ç°</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">solution</span><span class="params">(<span class="type">int</span> N)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">lowNum</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å½“å‰ä½çš„ä½ä½çš„æ•°å­—</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">currNum</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å½“å‰ä½æ•°å­—</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">highNum</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å½“å‰ä½çš„é«˜ä½çš„æ•°å­—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">factor</span> <span class="operator">=</span> <span class="number">1</span>; factor &lt;= N; factor *= <span class="number">10</span>) &#123; <span class="comment">// ä½å› å­</span></span><br><span class="line">        lowNum = N - (N / factor) * factor;</span><br><span class="line">        currNum = (N / factor) % <span class="number">10</span>;</span><br><span class="line">        highNum = N / (factor * <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span>(currNum == <span class="number">0</span>) &#123;</span><br><span class="line">            ans += highNum * factor;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(currNum == <span class="number">1</span>) &#123;</span><br><span class="line">            ans += highNum * factor + lowNum +<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ans += (highNum + <span class="number">1</span>) * factor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦åªä¸Nçš„ä½æ•°æœ‰å…³ï¼Œä¸º$O(lgn)$ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/liangbopirates/article/details/9323727">æ±‚1-Nä¸­åè¿›åˆ¶æ­£æ•´æ•°1çš„ä¸ªæ•°</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ä¸ä¼šåšã€‘çŸ©é˜µè·¯å¾„å½¢æˆçš„æœ€å¤§æ•´æ•°</title>
      <link href="/2022/03/01/%E3%80%90%E4%B8%8D%E4%BC%9A%E5%81%9A%E3%80%91%E7%9F%A9%E9%98%B5%E8%B7%AF%E5%BE%84%E5%BD%A2%E6%88%90%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B4%E6%95%B0/"/>
      <url>/2022/03/01/%E3%80%90%E4%B8%8D%E4%BC%9A%E5%81%9A%E3%80%91%E7%9F%A9%E9%98%B5%E8%B7%AF%E5%BE%84%E5%BD%A2%E6%88%90%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B4%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p>æ‚¨å°†è·å¾—ä¸€ä¸ªç”± N è¡Œå’Œ M åˆ—ç»„æˆçš„æ¿ã€‚ç”µè·¯æ¿çš„æ¯ä¸ªå­—æ®µï¼ˆå…¶å®å°±æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªåæ ‡ç‚¹ï¼Œä½œè€…æ³¨ï¼‰éƒ½åŒ…å«ä¸€ä¸ªæ•°å­— (0-9)ã€‚</p><p>æ‚¨å¸Œæœ›æŸ¥æ‰¾ç”±å››ä¸ªç›¸é‚»å­—æ®µç»„æˆçš„è·¯å¾„ã€‚å¦‚æœä¸¤ä¸ªå­—æ®µå…±äº«ä¸€ä¸ªå…±åŒç‚¹ï¼Œåˆ™å®ƒä»¬æ˜¯ç›¸é‚»çš„ã€‚æ­¤å¤–ï¼Œè·¯å¾„ä¸­çš„å­—æ®µåº”è¯¥æ˜¯ä¸åŒçš„ï¼ˆä¸èƒ½ä¸¤æ¬¡è®¿é—®åŒä¸€å­—æ®µï¼‰ã€‚</p><p>è·¯å¾„çš„å››ä½æ•°å­—ï¼ˆæŒ‰æ‚¨è®¿é—®å®ƒä»¬çš„é¡ºåºï¼‰åˆ›å»ºä¸€ä¸ª æ•´æ•°ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å®ç°çš„æœ€å¤§æ•´æ•°æ˜¯å¤šå°‘?</p><p>ç¼–å†™å‡½æ•°</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">solution</span> <span class="params">(<span class="type">int</span>[][] board)</span> ;</span><br></pre></td></tr></table></figure><p>ç»™å®šè¡¨ç¤ºä¸ºç”± N è¡Œå’Œ M åˆ—ç»„æˆçš„æ•´æ•°çŸ©é˜µçš„æ¿ï¼Œåˆ™è¿”å›åœ¨é•¿åº¦ä¸º 4 çš„è·¯å¾„ä¸­è¿æ¥å€¼æ—¶å¯ä»¥å®ç°çš„æœ€å¤§æ•´æ•°ã€‚<br>ä¾‹å­ï¼šç»™å®šä»¥ä¸‹æ¿ï¼ˆN=3, M=5ï¼‰ :</p><p><img src="image-20220228105252210.png" alt="å›¾1"></p><p>è¯¥å‡½æ•°åº”è¿”å›9121ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹è·¯å¾„ï¼ˆç¬¬ä¸€ ä¸ªå­—æ®µç”¨çº¢è‰²è¡¨ç¤º)ï¼š</p><p><img src="image-20220228105416502.png" alt="å›¾2"></p><h1 id="è§£"><a href="#è§£" class="headerlink" title="è§£"></a>è§£</h1><p>çŸ¥é“ç”¨å›æº¯æˆ–è€…BFSï¼Œä½†æ˜¯ä»£ç å†™ä¸å‡ºæ¥ã€‚ğŸ˜“</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> å›æº¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„å¥èº«åŠ¨ä½œ</title>
      <link href="/2022/02/28/%E4%B8%AA%E4%BA%BA%E6%AF%94%E8%BE%83%E5%96%9C%E6%AC%A2%E7%9A%84%E5%81%A5%E8%BA%AB%E5%8A%A8%E4%BD%9C/"/>
      <url>/2022/02/28/%E4%B8%AA%E4%BA%BA%E6%AF%94%E8%BE%83%E5%96%9C%E6%AC%A2%E7%9A%84%E5%81%A5%E8%BA%AB%E5%8A%A8%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ•´ç†ä¸€ä¸‹ä¸ªäººæ¯”è¾ƒå–œæ¬¢å¥èº«åŠ¨ä½œã€‚å¹¶å¤‡æ³¨åŠ¨ä½œè¦ç‚¹</p></blockquote><h1 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a>æ ¸å¿ƒ</h1><h2 id="å¹³æ¿æ”¯æ’‘"><a href="#å¹³æ¿æ”¯æ’‘" class="headerlink" title="å¹³æ¿æ”¯æ’‘"></a>å¹³æ¿æ”¯æ’‘</h2><p>æ”¹å–„çš„å¹³æ¿æ”¯æ’‘ï¼š</p><ol><li>èº«ä½“åç§»</li><li>éª¨ç›†åå€¾ï¼šæ”¶ç´§è‡€éƒ¨ï¼Œæ„Ÿè§‰ä¸Šå‘åé¡¶</li><li>çº æ­£èº«ä½“ä½ç½®ã€‚è‚©è†€ç”¨åŠ›å‘å‰æ¨ï¼Œä¸Šè‚¢ç¦»åœ°æ›´è¿œã€‚</li></ol><p>æ–°æ‰‹å…ˆåšåˆ°ç¬¬äºŒç‚¹å»¶é•¿åˆ°60ç§’ï¼Œå†ä¸¤ç‚¹ä¸€èµ·åšã€‚</p><p>ç¦å¿Œï¼š</p><ol><li>æ‰‹è‡‚åç¼©</li><li>æè‡€æˆ–è€…è‡€å¤ªä½ã€‚ç›¸åè¦ç”¨åŠ›æ”¶ç´§éª¨ç›†</li></ol><h1 id="è‡€è…¿"><a href="#è‡€è…¿" class="headerlink" title="è‡€è…¿"></a>è‡€è…¿</h1><h2 id="æ·±è¹²"><a href="#æ·±è¹²" class="headerlink" title="æ·±è¹²"></a>æ·±è¹²</h2><p>ä½¿ç”¨å¼¹åŠ›å¸¦åŠ å¤§æ·±è¹²çš„é˜»åŠ›ã€‚</p><h2 id="å•è…¿ç½—é©¬å°¼äºšç¡¬æ‹‰"><a href="#å•è…¿ç½—é©¬å°¼äºšç¡¬æ‹‰" class="headerlink" title="å•è…¿ç½—é©¬å°¼äºšç¡¬æ‹‰"></a>å•è…¿ç½—é©¬å°¼äºšç¡¬æ‹‰</h2><p>é”»ç‚¼è‡€è‚Œã€è…˜ç»³è‚Œï¼Œé”»ç‚¼å•è…¿ç«™ç«‹çš„ç¨³å®šæ€§ï¼Œè†å…³èŠ‚å¾—ç¨³å®šæ€§ã€‚</p><p>è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1Ci4y1R72o?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1Ci4y1R72o?spm_id_from=333.999.0.0</a></p><h1 id="èƒŒéƒ¨"><a href="#èƒŒéƒ¨" class="headerlink" title="èƒŒéƒ¨"></a>èƒŒéƒ¨</h1><h2 id="å¼•ä½“å‘ä¸Š"><a href="#å¼•ä½“å‘ä¸Š" class="headerlink" title="å¼•ä½“å‘ä¸Š"></a>å¼•ä½“å‘ä¸Š</h2><p>å¦‚æœåšä¸æ¥å¯ä»¥ä½¿ç”¨å¼¹åŠ›ç»³è¾…åŠ©ã€‚</p><h1 id="å‰é”¯è‚Œ"><a href="#å‰é”¯è‚Œ" class="headerlink" title="å‰é”¯è‚Œ"></a>å‰é”¯è‚Œ</h1><p>å¾…æ•´ç†ï¼š<a href="https://www.bilibili.com/video/BV1qq4y1k7oP?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1qq4y1k7oP?spm_id_from=333.999.0.0</a></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.bilibili.com/video/BV1SP4y1j71R?spm_id_from=333.999.0.0">æ ¸å¿ƒå¤ªå¼±ï¼Œè‚šå­è‚¯å®šå¤§ï¼ˆ3ä¸ªæŠ€å·§å¿«é€Ÿæ”¹å–„ï¼‰</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ–¹æ³•è®º </category>
          
          <category> å¥èº« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¥èº« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keepä¸Šä¸é”™çš„è¯¾ç¨‹åˆé›†</title>
      <link href="/2022/02/28/Keep%E4%B8%8A%E4%B8%8D%E9%94%99%E7%9A%84%E8%AF%BE%E7%A8%8B%E5%90%88%E9%9B%86/"/>
      <url>/2022/02/28/Keep%E4%B8%8A%E4%B8%8D%E9%94%99%E7%9A%84%E8%AF%BE%E7%A8%8B%E5%90%88%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ•´ç†äº†ä¸€äº›é€‚åˆè‡ªå·±çš„Keepè¯¾ç¨‹ï¼Œè¿™äº›è¯¾ç¨‹éƒ½äº²è‡ªåšè¿‡ä¸€éã€‚</p><p>æœ¬æ–‡ä¼šä¸æ–­æ›´æ–°ã€‚</p></blockquote><div class="table-container"><table><thead><tr><th>è¯¾ç¨‹åç§°</th><th>è¯¾ç¨‹é“¾æ¥</th><th>éš¾åº¦</th><th>éƒ¨ä½</th><th>å™¨æ¢°</th><th>æ„Ÿå—</th></tr></thead><tbody><tr><td>HIIT - è…¹è‚Œå¡‘é€ </td><td><a href="https://show.gotokeep.com/course/607fefaa1310a35004149bc4">https://show.gotokeep.com/course/607fefaa1310a35004149bc4</a></td><td>3</td><td>è…¹éƒ¨</td><td>ä¸éœ€è¦</td><td>æŒºç´¯çš„ï¼Œä½†æ˜¯ä¸éš¾ã€‚åšå®Œè…¹éƒ¨æœ‰æ˜æ˜¾é…¸ç—›</td></tr><tr><td>å“‘é“ƒå…¨æ–¹ä½èƒ¸éƒ¨åˆºæ¿€-ç½—æ´ªRic</td><td><a href="https://show.gotokeep.com/course/6051a1b41310a33405483f53">https://show.gotokeep.com/course/6051a1b41310a33405483f53</a></td><td>4</td><td>èƒ¸éƒ¨</td><td>å“‘é“ƒ</td><td>å¾ˆæœ‰æ„Ÿè§‰ã€‚</td></tr><tr><td>å“‘é“ƒæ‰‹è‡‚è½°ç‚¸</td><td><a href="https://show.gotokeep.com/course/59ddde95a29e342161e42290">https://show.gotokeep.com/course/59ddde95a29e342161e42290</a></td><td>3</td><td>æ‰‹è‡‚</td><td>å“‘é“ƒ</td><td>ç»ƒäº†å¥½å‡ æ¬¡ï¼Œå¿«æ²¡æ„Ÿè§‰äº†ï¼Œå¯èƒ½éœ€è¦åŠ å¤§é‡é‡</td></tr><tr><td>è·ƒåŠ¨ç‡ƒè„‚å¼ºåŒ–</td><td><a href="https://show.gotokeep.com/course/5b1e349aa29e343df182c7c0">https://show.gotokeep.com/course/5b1e349aa29e343df182c7c0</a></td><td>4</td><td>å…¨èº«</td><td>ä¸éœ€è¦</td><td>æŒºç´¯çš„ã€‚ã€‚</td></tr><tr><td>å®¶åº­å“‘é“ƒå¢è‚Œç‰¹è®­ Â· å¼ºåŠ›è‡€è…¿</td><td><a href="https://show.gotokeep.com/course/601696ae627efb1bdd12ae13">https://show.gotokeep.com/course/601696ae627efb1bdd12ae13</a></td><td>3</td><td>è‡€è…¿</td><td>å“‘é“ƒ</td><td>å¿˜è®°äº†ã€‚</td></tr><tr><td>æ ¸å¿ƒåŠŸèƒ½å¼ºåŒ–</td><td><a href="https://show.gotokeep.com/course/5b90af2da29e342ee240c94f">https://show.gotokeep.com/course/5b90af2da29e342ee240c94f</a></td><td>4</td><td>è…°è…¹</td><td>ä¸éœ€è¦</td><td>å’Œâ€œHIIT - è…¹è‚Œå¡‘é€ â€æœ‰ç‚¹é‡å¤</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> æ–¹æ³•è®º </category>
          
          <category> å¥èº« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¥èº« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é“¶è¡Œè½¬è´¦</title>
      <link href="/2022/02/27/%E9%93%B6%E8%A1%8C%E8%BD%AC%E8%B4%A6/"/>
      <url>/2022/02/27/%E9%93%B6%E8%A1%8C%E8%BD%AC%E8%B4%A6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡FROM å¾®è½¯ è½¯å¼€ ç¬”è¯•é¢˜</p></blockquote><h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p>æ‚¨å°†è·å¾—ä¸¤ä¸ªé“¶è¡Œä¹‹é—´çš„Næ¬¡è½¬è´¦åˆ—è¡¨ï¼ˆç¼–å·0åˆ°N-1ï¼‰ï¼šé“¶è¡ŒAå’Œé“¶è¡ŒBï¼Œç¬¬Kæ¬¡ä¼ è¾“ç”±ä¸¤ä¸ªå€¼æè¿°ï¼š</p><ul><li>R[K]ï¼ˆAæˆ–Bï¼‰ä»£è¡¨æ”¶æ¬¾äººï¼ˆè½¬è´¦å‘é€åˆ°çš„é“¶è¡Œï¼‰ï¼›</li><li>V[K]è¡¨ç¤ºé€šè¿‡ä¼ è¾“å‘é€çš„å€¼ã€‚</li></ul><p>æ‰€æœ‰è½¬ç§»å‡æŒ‰ä»–ä»¬åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„é¡ºåºå®Œæˆã€‚é“¶è¡Œä¸æƒ³è´Ÿå€ºï¼ˆå³ä»–ä»¬çš„è´¦æˆ·ä½™é¢å¯èƒ½ä¸ä¼šä½äº0ï¼‰ã€‚æ¯å®¶é“¶è¡Œçš„åˆå§‹è´¦æˆ·ä½™é¢æœ€ä½æ˜¯å¤šå°‘æ‰èƒ½å®Œæˆè½¬è´¦ï¼Ÿ</p><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] solution(String R, <span class="type">int</span>[] V);</span><br></pre></td></tr></table></figure><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Rå’Œä¸€ä¸ªé•¿åº¦å‡ä¸ºNçš„æ•´æ•°æ•°ç»„Vï¼Œè¿”å›ä¸€ä¸ªç”±ä¸¤ä¸ªæ•´æ•°ç»„æˆçš„æ•°ç»„ã€‚è¯ä¹¦åº”æŒ‰ä»¥ä¸‹é¡ºåºè¡¨ç¤ºé“¶è¡ŒAå’ŒBçš„æœ€å°åˆå§‹è´¦æˆ·ä½™é¢ï¼š[é“¶è¡ŒA, é“¶è¡ŒB]ã€‚</p><p>ç»“æœæ•°ç»„åº”ä½œä¸ºæ•´æ•°å‘é‡è¿”å›ã€‚</p><p>ä¾‹å­ï¼š</p><ol><li>ç»™å®šR = â€œBAABAâ€ä¸”V=[2,4,1,1,2]ï¼Œå‡½æ•°åº”è¯¥è¿”å›[2, 4]ã€‚æ¯æ¬¡è½¬è´¦åçš„é“¶è¡Œè´¦æˆ·ä½™é¢å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</li></ol><div class="table-container"><table><thead><tr><th></th><th>A</th><th>B</th></tr></thead><tbody><tr><td>åˆå§‹ä½™é¢</td><td>2</td><td>4</td></tr><tr><td>A -&gt; Bï¼šè½¬ç§» 2</td><td>0</td><td>6</td></tr><tr><td>B -&gt; Aï¼šè½¬ç§» 4</td><td>4</td><td>2</td></tr><tr><td>B -&gt; Aï¼šè½¬ç§» 1</td><td>5</td><td>1</td></tr><tr><td>A -&gt; Bï¼šè½¬ç§» 1</td><td>4</td><td>2</td></tr><tr><td>B -&gt; Aï¼šè½¬ç§» 2</td><td>6</td><td>0</td></tr></tbody></table></div><ol><li>ç»™å®šR = â€œABABâ€ä¸”V=[10,5,10,15]ï¼Œå‡½æ•°åº”è¿”å›[0, 15]ã€‚</li><li>ç»™å®šR = â€œBâ€ä¸”V=[100]ï¼Œå‡½æ•°åº”è¿”å›[100, 0]ã€‚</li></ol><p>ä¸ºä»¥ä¸‹å‡è®¾ç¼–å†™æœ‰æ•ˆç®—æ³•ã€‚</p><h1 id="è§£"><a href="#è§£" class="headerlink" title="è§£"></a>è§£</h1><p>ä»¥ä¾‹1ä¸ºä¾‹ï¼Œè®¾è®¡é“¶è¡ŒAçš„åˆå§‹ä½™é¢ä¸ºXï¼Œé“¶è¡ŒBçš„åˆå§‹ä½™é¢ä¸ºYã€‚åˆ™æ¯ä¸€æ¬¡è½¬è´¦åAçš„ä½™é¢åˆ†åˆ«ä¸ºï¼š</p><p>X-2, X+2, X+3, X+2, X+4ï¼›Bçš„ä½™é¢åˆ†åˆ«ä¸ºï¼š</p><p>Y+2, Y-2, Y-3, Y-2, Y-4ï¼›</p><p>æ ¹æ®é¢˜ç›®è¦æ±‚å¾—any(X, X-2, X+2, X+3, X+2, X+4) &gt;=0 &amp;&amp; any(Y, Y+2, Y-2, Y-3, Y-2, Y-4)&gt;=0</p><p>å³è¦æ±‚X-2&gt;=0; Y-4&gt;=0;</p><p>é¢˜ç›®æ±‚æœ€å°åˆå§‹ä½™é¢ï¼Œå¯å¾—ï¼ŒX=2ï¼› Y=4</p><p>ä¸‹é¢æ˜¯ä»£ç å®ç°ã€‚</p><h2 id="Javaå®ç°"><a href="#Javaå®ç°" class="headerlink" title="Javaå®ç°"></a>Javaå®ç°</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] solution(String R, <span class="type">int</span>[] V) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> V.length;</span><br><span class="line">    <span class="type">int</span>[] A = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="type">int</span>[] B = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//base case</span></span><br><span class="line">    <span class="keyword">if</span>(R.charAt(<span class="number">0</span>) == <span class="string">&#x27;B&#x27;</span>) &#123;</span><br><span class="line">        B[<span class="number">0</span>] = V[<span class="number">0</span>];</span><br><span class="line">        A[<span class="number">0</span>] = -V[<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        B[<span class="number">0</span>] = -V[<span class="number">0</span>];</span><br><span class="line">        A[<span class="number">0</span>] = V[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">min_A</span> <span class="operator">=</span> A[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">min_B</span> <span class="operator">=</span> B[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(R.charAt(i) == <span class="string">&#x27;B&#x27;</span>) &#123;</span><br><span class="line">            A[i] = A[i-<span class="number">1</span>] - V[i];</span><br><span class="line">            B[i] = B[i-<span class="number">1</span>] + V[i];</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            A[i] = A[i-<span class="number">1</span>] + V[i];</span><br><span class="line">            B[i] = B[i-<span class="number">1</span>] - V[i];</span><br><span class="line">        &#125;</span><br><span class="line">        min_A = Math.min(min_A, A[i]);</span><br><span class="line">        min_B = Math.min(min_B, B[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//min_Aå’Œmin_Bä¸èƒ½æ˜¯è´Ÿæ•°</span></span><br><span class="line">    min_A = Math.max(<span class="number">0</span>, -min_A);</span><br><span class="line">    min_B = Math.max(<span class="number">0</span>, -min_B);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;min_A, min_B&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> æ•°ç»„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰¾åˆ°æ•°ç»„ä¸­æ¯”å·¦è¾¹å…ƒç´ éƒ½å¤§åŒæ—¶æ¯”å³è¾¹å…ƒç´ éƒ½å°çš„å…ƒç´ </title>
      <link href="/2022/02/23/%E6%89%BE%E5%88%B0%E6%95%B0%E7%BB%84%E4%B8%AD%E6%AF%94%E5%B7%A6%E8%BE%B9%E5%85%83%E7%B4%A0%E9%83%BD%E5%A4%A7%E5%90%8C%E6%97%B6%E6%AF%94%E5%8F%B3%E8%BE%B9%E5%85%83%E7%B4%A0%E9%83%BD%E5%B0%8F%E7%9A%84%E5%85%83%E7%B4%A0/"/>
      <url>/2022/02/23/%E6%89%BE%E5%88%B0%E6%95%B0%E7%BB%84%E4%B8%AD%E6%AF%94%E5%B7%A6%E8%BE%B9%E5%85%83%E7%B4%A0%E9%83%BD%E5%A4%A7%E5%90%8C%E6%97%B6%E6%AF%94%E5%8F%B3%E8%BE%B9%E5%85%83%E7%B4%A0%E9%83%BD%E5%B0%8F%E7%9A%84%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>æ±‚æ•°ç»„ä¸­æ¯”å·¦è¾¹å…ƒç´ éƒ½å¤§åŒæ—¶æ¯”å³è¾¹å…ƒç´ éƒ½å°çš„å…ƒç´ ï¼Œè¿”å›è¿™äº›å…ƒç´ çš„ç´¢å¼•ã€‚è¦æ±‚æ—¶é—´å¤æ‚åº¦$O(N)$</p><blockquote><p>è¾“å…¥ï¼š[2, 3, 1, 8, 9, 20, 12]<br>è¾“å‡ºï¼š3, 4<br>è§£é‡Šï¼šæ•°ç»„ä¸­ 8, 9 æ»¡è¶³é¢˜ç›®è¦æ±‚ï¼Œä»–ä»¬çš„ç´¢å¼•åˆ†åˆ«æ˜¯ 3ã€4</p></blockquote><h1 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æœ€ç®€å•æœ€æš´åŠ›çš„å°±æ˜¯æ²¡ä»å¤´åˆ°å°¾éå†å…ƒç´ ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ åˆ†åˆ«å¾€å‰ã€å¾€åéå†ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦å®ƒæ˜¯å¦æ»¡è¶³æ¡ä»¶ã€‚</p><p>è¿™ç§è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(N^2)$ï¼Œä¸ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚</p><p>é€šè¿‡åˆ†æå¯ä»¥å¾—åˆ°ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒæ¯”<strong>å·¦ä¾§æœ€å¤§çš„å€¼</strong>è¦å¤§ï¼ŒåŒæ—¶æ¯”<strong>å³ä¾§æœ€å°çš„å€¼</strong>è¦å°ï¼Œå°±æ»¡è¶³æ¡ä»¶ã€‚</p><p>é‚£å¦‚æœæœ‰è¿™æ ·ä¸¤ä¸ªæ•°ç»„ï¼Œ</p><p><code>left_max[i]</code> è¡¨ç¤ºåŸæ•°ç»„ [0, i) çš„æœ€å¤§å€¼</p><p><code>right_min[i]</code> è¡¨ç¤ºåŸæ•°ç»„ (i, n) çš„æœ€å°å€¼</p><p>å†…å¾ªç¯å°±å¯ä»¥é€šè¿‡ <code>left_max[i] &lt; nums[i] &amp;&amp; nums[i] &lt; right_min[i]</code> æ¥åˆ¤æ–­äº†ã€‚</p><p>å¯¹äº left_max å’Œ right_min è¿™ä¸¤æ•°ç»„ï¼Œæå‰å…ˆç®—å¥½ï¼Œæ¯ä¸ªæ•°ç»„éƒ½èƒ½$O(N)$å¾—åˆ°ã€‚</p><p>left_max å’Œ right_min é€’æ¨å¼å¦‚ä¸‹ï¼š</p><blockquote><p>left_max[i] = max(left_max[i-1], nums[i])</p><p>right_min[i] = min(right_min[i-1], nums[i])</p></blockquote><p>æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(N)$</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">find</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] left_max = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span>[] right_min = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        Arrays.fill(left_max, Integer.MIN_VALUE);</span><br><span class="line">        Arrays.fill(right_min, Integer.MAX_VALUE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            left_max[i] = Math.max(left_max[i-<span class="number">1</span>], nums[i-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            right_min[i] = Math.min(right_min[i+<span class="number">1</span>], nums[i+<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n-<span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; left_max[i] &amp;&amp; nums[i] &lt; right_min[i]) &#123;</span><br><span class="line">                res.add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://mp.weixin.qq.com/s/ilOdw4qdu_EJZNXvybqdag">ä¸€é“çƒ­ä¹çš„å­—èŠ‚ä¸‰é¢åŸåˆ›é¢˜</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> æ•°ç»„/é“¾è¡¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è¯»è®ºæ–‡</title>
      <link href="/2022/02/22/%E5%A6%82%E4%BD%95%E8%AF%BB%E8%AE%BA%E6%96%87/"/>
      <url>/2022/02/22/%E5%A6%82%E4%BD%95%E8%AF%BB%E8%AE%BA%E6%96%87/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>ä¸€ç¯‡è®ºæ–‡å¾€å¾€åˆ†ä¸º<strong>æ ‡é¢˜ï¼Œæ‘˜è¦ï¼Œå¯¼è¨€ï¼Œç®—æ³•ï¼Œå®éªŒï¼Œç»“è®º</strong>ã€‚</p><p><strong>ç®—æ³•</strong>å°±æ˜¯è®ºæ–‡ä½œè€…æå‡ºçš„æ–°çš„æ–¹æ³•ï¼›<strong>å®éªŒ</strong>æ˜¯ä¸ºäº†è¯æ˜æå‡ºçš„ç®—æ³•ã€‚</p><h2 id="è¯»ç¬¬ä¸€é"><a href="#è¯»ç¬¬ä¸€é" class="headerlink" title="è¯»ç¬¬ä¸€é"></a>è¯»ç¬¬ä¸€é</h2><p>å…³æ³¨<strong>æ ‡é¢˜</strong>ï¼Œ<strong>æ‘˜è¦</strong>å’Œ<strong>ç»“è®º</strong>ï¼›ç»“è®ºå’Œæ‘˜è¦å¾€å¾€æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯ç»“è®ºä¼šæŠŠæ‘˜è¦çš„é—®é¢˜ç»™è¯æ˜ä¸€ä¸‹ï¼›é¡ºä¾¿çœ‹ä¸€ä¸‹ç®—æ³•å’Œå®éªŒéƒ¨åˆ†çš„å›¾æ ‡ã€‚</p><p><strong>ç›®çš„</strong>ï¼š</p><ul><li>è¿™ç¯‡è®ºæ–‡ä»‹ç»äº†ä»€ä¹ˆ</li><li>æ˜¯å¦ä¸è‡ªå·±ç›¸å…³</li><li>è´¨é‡æ€ä¹ˆæ ·</li><li>æ˜¯å¦ç»§ç»­è¯»ä¸‹å»</li></ul><h2 id="è¯»ç¬¬äºŒé"><a href="#è¯»ç¬¬äºŒé" class="headerlink" title="è¯»ç¬¬äºŒé"></a>è¯»ç¬¬äºŒé</h2><p>å¦‚æœç¬¬ä¸€éè®¤ä¸ºè¯¥è®ºæ–‡éœ€è¦è¯»ä¸‹å»ï¼Œåˆ™è¿›è¡Œç¬¬äºŒéé€šè¯»ï¼Œå¯ä»¥å¿½ç•¥å¾ˆç»†èŠ‚çš„éƒ¨åˆ†ï¼Œä¾‹å¦‚å…¬å¼è¯æ˜ã€‚</p><p>åœˆå‡ºå¼•ç”¨çš„é‡è¦çš„ç›¸å…³çš„æ–‡çŒ®ï¼Œä¾‹å¦‚ï¼Œä½œè€…è§£å†³çš„é—®é¢˜æ˜¯å“ªç¯‡è®ºæ–‡æå‡ºçš„ï¼Œä½œè€…çš„æ–¹æ³•æ˜¯å“ªç¯‡è®ºæ–‡æ”¹è¿›æ¥çš„ã€‚</p><p><strong>ç›®çš„ï¼š</strong></p><ul><li>æŒæ¡è®ºæ–‡ä¸­çš„æ¯ä¸€ä¸ªå›¾ã€è¡¨æ˜¯ä»€ä¹ˆæ„æ€ï¼›</li><li>ä½œè€…çš„æ–¹æ³•å’Œåˆ«äººçš„æ–¹æ³•æ˜¯æ€ä¹ˆå¯¹æ¯”çš„ï¼Œå·®è·æœ‰å¤šå¤§</li></ul><h2 id="è¯»ç¬¬ä¸‰é"><a href="#è¯»ç¬¬ä¸‰é" class="headerlink" title="è¯»ç¬¬ä¸‰é"></a>è¯»ç¬¬ä¸‰é</h2><p>è¯¦ç»†é˜…è¯»ç¬¬ä¸‰éï¼Œè¯»æ‡‚æ¯ä¸€å¥è¯ï¼Œæ¯ä¸€ä¸ªç»†èŠ‚ã€‚æ„ŸåŒèº«å—çš„å»è¯»ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.bilibili.com/video/BV1H44y1t75x">å¦‚ä½•è¯»è®ºæ–‡ - ææ²</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ–¹æ³•è®º </category>
          
          <category> é˜…è¯»AIè®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–¹æ³•è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>_Python æŠ›å‡ºå¼‚å¸¸åç¨‹åºç»§ç»­æ‰§è¡Œ</title>
      <link href="/2022/02/22/Python-%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E5%90%8E%E7%A8%8B%E5%BA%8F%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C/"/>
      <url>/2022/02/22/Python-%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E5%90%8E%E7%A8%8B%E5%BA%8F%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ˜¯ä¸€ä¸ªçŸ¥è¯†ç¢ç‰‡</p></blockquote><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>å½“é‡åˆ°å¼‚å¸¸æ—¶ï¼Œä¸ºäº†è®©ç¨‹åºç»§ç»­æ‰§è¡Œè€Œä¸ä¸­æ–­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç å—</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼š<strong>è¿™æ ·åšéœ€è¦è°¨æ…</strong>ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li>è¿™æ ·åšæŠ›å‡ºå¼‚å¸¸çš„ç±»å‹ä¸æ˜ç¡®ã€‚å¯èƒ½æŠ›å‡ºäº†ä½ å¹¶ä¸æƒ³å¿½ç•¥çš„å¼‚å¸¸ï¼›</li><li>è¿™æ ·åšè¿‡äºæ•·è¡ï¼ˆé™¤éä½ æ˜¯æœ‰ç›®çš„çš„è¿™ä¹ˆåšï¼‰</li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/weixin_43307577/article/details/87710251">Pythonå¼‚å¸¸å¤„ç† -è·³è¿‡å¼‚å¸¸ç»§ç»­æ‰§è¡Œ</a></li><li><a href="https://developer.aliyun.com/article/803360">é—®é¢˜ï¼šä¸ºä»€ä¹ˆâ€œexcept:passâ€æ˜¯ä¸€ä¸ªä¸å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Ÿ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> å¼‚å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰CNNçš„å¡«å……ã€æ­¥å¹…ã€é€šé“ã€æ± åŒ–</title>
      <link href="/2022/02/15/%E3%80%8A%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89CNN%E7%9A%84%E5%A1%AB%E5%85%85%E3%80%81%E6%AD%A5%E5%B9%85%E3%80%81%E9%80%9A%E9%81%93%E3%80%81%E6%B1%A0%E5%8C%96/"/>
      <url>/2022/02/15/%E3%80%8A%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89CNN%E7%9A%84%E5%A1%AB%E5%85%85%E3%80%81%E6%AD%A5%E5%B9%85%E3%80%81%E9%80%9A%E9%81%93%E3%80%81%E6%B1%A0%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡FROMã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ç¬¬å…­ç«  å·ç§¯ç¥ç»ç½‘ç»œ 6.3ã€6.4å’Œ6.5å°èŠ‚</p><p>è™½ç„¶æ ‡é¢˜ä¸­ï¼Œå¡«å……ã€æ­¥å¹…ã€é€šé“ã€æ± åŒ–æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯å®é™…è¿™å››è€…å¹¶éå¹¶åˆ—å…³ç³»ã€‚</p></blockquote><h1 id="å¡«å……"><a href="#å¡«å……" class="headerlink" title="å¡«å……"></a>å¡«å……</h1><p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼Œå·ç§¯çš„è¾“å‡ºå½¢çŠ¶å–å†³äºè¾“å…¥å½¢çŠ¶å’Œå·ç§¯æ ¸çš„å½¢çŠ¶ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ª 240Ã—240 åƒç´ çš„å›¾åƒï¼Œç»è¿‡ 10 å±‚ 5Ã—5 çš„å·ç§¯åï¼Œå°†å‡å°‘åˆ° 200Ã—200 åƒç´ ã€‚å¦‚æ­¤ä¸€æ¥ï¼ŒåŸå§‹å›¾åƒçš„è¾¹ç•Œä¸¢å¤±äº†è®¸å¤šæœ‰ç”¨ä¿¡æ¯ã€‚è€Œ<strong>å¡«å……</strong>æ˜¯è§£å†³æ­¤é—®é¢˜æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p><p>ä¸‹é¢çš„å›¾å±•ç¤ºäº†å¸¦å¡«å……çš„äºŒç»´äº’ç›¸å…³ã€‚</p><p><img src="conv-pad.svg" alt="å¸¦å¡«å……çš„äºŒç»´äº’ç›¸å…³"></p><p>è®¾ç½‘ç»œè¾“å…¥å®½é«˜åˆ†åˆ«ä¸º $n_w$ å’Œ $n_h$ï¼Œå·ç§¯æ ¸å®½é«˜åˆ†åˆ«ä¸º $k_w$ å’Œ $k_h$ï¼Œå¦‚æœæˆ‘ä»¬æ·»åŠ  $p_h$ è¡Œå¡«å……ï¼ˆå¤§çº¦ä¸€åŠåœ¨é¡¶éƒ¨ï¼Œä¸€åŠåœ¨åº•éƒ¨ï¼‰å’Œ $p_w$ åˆ—å¡«å……ï¼ˆå·¦ä¾§å¤§çº¦ä¸€åŠï¼Œå³ä¾§ä¸€åŠï¼‰ï¼Œåˆ™è¾“å‡ºå½¢çŠ¶å°†ä¸º</p><script type="math/tex; mode=display">(n_h-k_h+p_h+1)\times(n_w-k_w+p_w+1)ã€‚</script><p>è¿™æ„å‘³ç€è¾“å‡ºçš„é«˜åº¦å’Œå®½åº¦å°†åˆ†åˆ«å¢åŠ  $p_h$ å’Œ $p_w$ã€‚</p><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® $p_h=k_h-1$ å’Œ $p_w=k_w-1$ï¼Œä½¿è¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜åº¦å’Œå®½åº¦ã€‚è¿™æ ·å¯ä»¥åœ¨æ„å»ºç½‘ç»œæ—¶æ›´å®¹æ˜“åœ°é¢„æµ‹æ¯ä¸ªå›¾å±‚çš„è¾“å‡ºå½¢çŠ¶ã€‚å‡è®¾ $k_h$ æ˜¯å¥‡æ•°ï¼Œæˆ‘ä»¬å°†åœ¨é«˜åº¦çš„ä¸¤ä¾§å¡«å…… $p_h/2$ è¡Œã€‚<br>å¦‚æœ $k_h$ æ˜¯å¶æ•°ï¼Œåˆ™ä¸€ç§å¯èƒ½æ€§æ˜¯åœ¨è¾“å…¥é¡¶éƒ¨å¡«å…… $\lceil p_h/2\rceil$ è¡Œï¼Œåœ¨åº•éƒ¨å¡«å…… $\lfloor p_h/2\rfloor$ è¡Œã€‚å¡«å……å®½åº¦çš„ä¸¤ä¾§åŒç†ã€‚</p><p>å·ç§¯ç¥ç»ç½‘ç»œä¸­å·ç§¯æ ¸çš„é«˜åº¦å’Œå®½åº¦é€šå¸¸ä¸ºå¥‡æ•°ï¼Œä¾‹å¦‚ 1ã€3ã€5 æˆ– 7ã€‚é€‰æ‹©å¥‡æ•°çš„å¥½å¤„æ˜¯ï¼Œä¿æŒç©ºé—´ç»´åº¦çš„åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……ç›¸åŒæ•°é‡çš„è¡Œï¼Œåœ¨å·¦ä¾§å’Œå³ä¾§å¡«å……ç›¸åŒæ•°é‡çš„åˆ—ã€‚</p><p>æ­¤å¤–ï¼Œä½¿ç”¨å¥‡æ•°æ ¸å’Œå¡«å……ä¹Ÿæä¾›äº†ä¹¦å†™ä¸Šçš„ä¾¿åˆ©ã€‚å¯¹äºä»»ä½•äºŒç»´å¼ é‡ $X$ï¼Œå½“æ»¡è¶³ï¼š</p><ol><li>å†…æ ¸çš„å¤§å°æ˜¯å¥‡æ•°ï¼›</li><li>æ‰€æœ‰è¾¹çš„å¡«å……è¡Œæ•°å’Œåˆ—æ•°ç›¸åŒï¼›</li><li>è¾“å‡ºä¸è¾“å…¥å…·æœ‰ç›¸åŒé«˜åº¦å’Œå®½åº¦</li></ol><p>åˆ™å¯ä»¥å¾—å‡ºï¼šè¾“å‡º $Y[i, j]$ æ˜¯é€šè¿‡ä»¥è¾“å…¥ $X[i, j]$ ä¸ºä¸­å¿ƒï¼Œä¸å·ç§¯æ ¸è¿›è¡Œäº’ç›¸å…³è®¡ç®—å¾—åˆ°çš„ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé«˜åº¦å’Œå®½åº¦ä¸º3çš„äºŒç»´å·ç§¯å±‚ï¼Œå¹¶<strong>åœ¨æ‰€æœ‰ä¾§è¾¹å¡«å……1ä¸ªåƒç´ </strong>ã€‚ç»™å®šé«˜åº¦å’Œå®½åº¦ä¸º8çš„è¾“å…¥ï¼Œåˆ™è¾“å‡ºçš„é«˜åº¦å’Œå®½åº¦ä¹Ÿæ˜¯8ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè®¡ç®—å·ç§¯å±‚çš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment"># æ­¤å‡½æ•°åˆå§‹åŒ–å·ç§¯å±‚æƒé‡ï¼Œå¹¶å¯¹è¾“å…¥å’Œè¾“å‡ºæé«˜å’Œç¼©å‡ç›¸åº”çš„ç»´æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">comp_conv2d</span>(<span class="params">conv2d, X</span>):</span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„ï¼ˆ1ï¼Œ1ï¼‰è¡¨ç¤ºæ‰¹é‡å¤§å°å’Œé€šé“æ•°éƒ½æ˜¯1</span></span><br><span class="line">    X = X.reshape((<span class="number">1</span>, <span class="number">1</span>) + X.shape)</span><br><span class="line">    Y = conv2d(X)  <span class="comment"># å°†Xè¾“å…¥åˆ°å·ç§¯å±‚ä¸­ï¼Œè¾“å‡ºY</span></span><br><span class="line">    <span class="comment"># çœç•¥å‰ä¸¤ä¸ªç»´åº¦ï¼šæ‰¹é‡å¤§å°å’Œé€šé“</span></span><br><span class="line">    <span class="keyword">return</span> Y.reshape(Y.shape[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ³¨æ„ï¼Œè¿™é‡Œæ¯è¾¹éƒ½å¡«å……äº†1è¡Œæˆ–1åˆ—ï¼Œå› æ­¤æ€»å…±æ·»åŠ äº†2è¡Œæˆ–2åˆ—</span></span><br><span class="line">conv2d = nn.Conv2d(<span class="number">1</span>, <span class="number">1</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)  <span class="comment"># è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå·ç§¯å±‚</span></span><br><span class="line">X = torch.rand(size=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">comp_conv2d(conv2d, X).shape</span><br></pre></td></tr></table></figure><pre><code>torch.Size([8, 8])</code></pre><p>å½“å·ç§¯æ ¸çš„é«˜åº¦å’Œå®½åº¦ä¸åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¡«å……ä¸åŒçš„é«˜åº¦å’Œå®½åº¦ï¼Œä½¿è¾“å‡ºå’Œè¾“å…¥å…·æœ‰ç›¸åŒçš„é«˜åº¦å’Œå®½åº¦ã€‚åœ¨å¦‚ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é«˜åº¦ä¸º5ï¼Œå®½åº¦ä¸º3çš„å·ç§¯æ ¸ï¼Œé«˜åº¦å’Œå®½åº¦ä¸¤è¾¹çš„å¡«å……åˆ†åˆ«ä¸º2å’Œ1ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conv2d = nn.Conv2d(<span class="number">1</span>, <span class="number">1</span>, kernel_size=(<span class="number">5</span>, <span class="number">3</span>), padding=(<span class="number">2</span>, <span class="number">1</span>))</span><br><span class="line">comp_conv2d(conv2d, X).shape</span><br></pre></td></tr></table></figure><pre><code>torch.Size([8, 8])</code></pre><h1 id="æ­¥å¹…"><a href="#æ­¥å¹…" class="headerlink" title="æ­¥å¹…"></a>æ­¥å¹…</h1><p>åœ¨è®¡ç®—äº’ç›¸å…³æ—¶ï¼Œå·ç§¯çª—å£ä»è¾“å…¥å¼ é‡çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œå‘ä¸‹ã€å‘å³æ»‘åŠ¨ã€‚ åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é»˜è®¤æ¯æ¬¡æ»‘åŠ¨ä¸€ä¸ªå…ƒç´ ã€‚ ä½†æ˜¯ï¼Œæœ‰æ—¶å€™ä¸ºäº†é«˜æ•ˆè®¡ç®—æˆ–æ˜¯ç¼©å‡é‡‡æ ·æ¬¡æ•°ï¼Œå·ç§¯çª—å£å¯ä»¥è·³è¿‡ä¸­é—´ä½ç½®ï¼Œæ¯æ¬¡æ»‘åŠ¨å¤šä¸ªå…ƒç´ ã€‚</p><p>æˆ‘ä»¬å°†æ¯æ¬¡æ»‘åŠ¨å…ƒç´ çš„æ•°é‡ç§°ä¸ºæ­¥å¹…ï¼ˆstrideï¼‰ã€‚ä¸‹å›¾å±•ç¤ºäº†å‚ç›´æ­¥å¹…ä¸º 3 ï¼Œæ°´å¹³æ­¥å¹…ä¸º 2 çš„äºŒç»´äº’ç›¸å…³è¿ç®—ã€‚</p><p><img src="conv-stride.svg" alt="å‚ç›´æ­¥å¹…ä¸º $3$ï¼Œæ°´å¹³æ­¥å¹…ä¸º $2$ çš„äºŒç»´äº’ç›¸å…³è¿ç®—"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ºäº†è®¡ç®—è¾“å‡ºä¸­ç¬¬ä¸€åˆ—çš„ç¬¬äºŒä¸ªå…ƒç´ å’Œç¬¬ä¸€è¡Œçš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå·ç§¯çª—å£åˆ†åˆ«å‘ä¸‹æ»‘åŠ¨ä¸‰è¡Œå’Œå‘å³æ»‘åŠ¨ä¸¤åˆ—ã€‚ä½†æ˜¯ï¼Œå½“å·ç§¯çª—å£ç»§ç»­å‘å³æ»‘åŠ¨ä¸¤åˆ—æ—¶ï¼Œæ²¡æœ‰è¾“å‡ºï¼Œå› ä¸ºè¾“å…¥å…ƒç´ æ— æ³•å¡«å……çª—å£ï¼ˆé™¤éæˆ‘ä»¬æ·»åŠ å¦ä¸€åˆ—å¡«å……ï¼‰ã€‚</p><p>é€šå¸¸ï¼Œå½“å‚ç›´æ­¥å¹…ä¸º $s_h$ ã€æ°´å¹³æ­¥å¹…ä¸º $s_w$ æ—¶ï¼Œè¾“å‡ºå½¢çŠ¶ä¸º</p><script type="math/tex; mode=display">\lfloor(n_h-k_h+p_h+s_h)/s_h\rfloor \times \lfloor(n_w-k_w+p_w+s_w)/s_w\rfloor.</script><p>å¦‚æœæˆ‘ä»¬è®¾ç½®äº† $p_h=k_h-1$ å’Œ $p_w=k_w-1$ï¼Œåˆ™è¾“å‡ºå½¢çŠ¶å°†ç®€åŒ–ä¸º $\lfloor(n_h+s_h-1)/s_h\rfloor \times \lfloor(n_w+s_w-1)/s_w\rfloor$ã€‚<br>æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœè¾“å…¥çš„é«˜åº¦å’Œå®½åº¦å¯ä»¥è¢«å‚ç›´å’Œæ°´å¹³æ­¥å¹…æ•´é™¤ï¼Œåˆ™è¾“å‡ºå½¢çŠ¶å°†ä¸º $(n_h/s_h) \times (n_w/s_w)$ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬<strong>å°†é«˜åº¦å’Œå®½åº¦çš„æ­¥å¹…è®¾ç½®ä¸º2</strong>ï¼Œä»è€Œå°†è¾“å…¥çš„é«˜åº¦å’Œå®½åº¦å‡åŠã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conv2d = nn.Conv2d(<span class="number">1</span>, <span class="number">1</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, stride=<span class="number">2</span>)</span><br><span class="line">comp_conv2d(conv2d, X).shape</span><br></pre></td></tr></table></figure><pre><code>torch.Size([4, 4])</code></pre><p>ä¸ºäº†ç®€æ´èµ·è§ï¼Œå½“è¾“å…¥é«˜åº¦å’Œå®½åº¦ä¸¤ä¾§çš„å¡«å……æ•°é‡åˆ†åˆ«ä¸º $p_h$ å’Œ $p_w$ æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¡«å…… $(p_h, p_w)$ã€‚å½“ $p_h = p_w = p$ æ—¶ï¼Œå¡«å……æ˜¯ $p$ã€‚åŒç†ï¼Œå½“é«˜åº¦å’Œå®½åº¦ä¸Šçš„æ­¥å¹…åˆ†åˆ«ä¸º $s_h$ å’Œ $s_w$ æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ­¥å¹… $(s_h, s_w)$ã€‚å½“æ—¶çš„æ­¥å¹…ä¸º $s_h = s_w = s$ æ—¶ï¼Œæ­¥å¹…ä¸º $s$ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¡«å……ä¸º 0ï¼Œæ­¥å¹…ä¸º 1ã€‚<strong>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨ä¸ä¸€è‡´çš„æ­¥å¹…æˆ–å¡«å……ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ $p_h = p_w$ å’Œ $s_h = s_w$ã€‚</strong></p><h1 id="é€šé“"><a href="#é€šé“" class="headerlink" title="é€šé“"></a>é€šé“</h1><p>å½“æˆ‘ä»¬æ·»åŠ é€šé“æ—¶ï¼Œæˆ‘ä»¬çš„è¾“å…¥å’Œéšè—çš„è¡¨ç¤ºä»äºŒç»´å¼ é‡å˜æˆäº†ä¸‰ç»´å¼ é‡ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªRGBè¾“å…¥å›¾åƒå…·æœ‰ 3Ã—hÃ—w çš„å½¢çŠ¶ã€‚æˆ‘ä»¬å°†è¿™ä¸ªå¤§å°ä¸º 3 çš„è½´ç§°ä¸ºé€šé“ï¼ˆchannelï¼‰ç»´åº¦ã€‚</p><p>é€šé“åˆ†ä¸ºè¾“å…¥é€šé“å’Œè¾“å‡ºé€šé“ã€‚ç°åº¦å›¾çš„è¾“å…¥é€šé“ä¸º1ï¼ŒRGBå›¾çš„è¾“å…¥é€šé“ä¸º3ã€‚è€Œè¾“å‡ºé€šé“æ˜¯è‡ªå®šä¹‰çš„ã€‚ç°åº¦å›¾çš„è¾“å‡ºé€šé“ä¹Ÿå¯ä»¥å¤§äº1ï¼ŒRGBå›¾çš„è¾“å‡ºé€šé“ä¹Ÿå¯ä»¥ä¸º1ï¼Œè¿™å–å†³äºå¦‚ä½•å®šä¹‰å·ç§¯æ ¸å’Œè¾“å‡ºã€‚</p><h2 id="å¤šè¾“å…¥é€šé“"><a href="#å¤šè¾“å…¥é€šé“" class="headerlink" title="å¤šè¾“å…¥é€šé“"></a>å¤šè¾“å…¥é€šé“</h2><p>å½“è¾“å…¥åŒ…å«å¤šä¸ªé€šé“æ—¶ï¼Œéœ€è¦æ„é€ ä¸€ä¸ªä¸è¾“å…¥æ•°æ®å…·æœ‰ç›¸åŒè¾“å…¥é€šé“æ•°ç›®çš„å·ç§¯æ ¸ï¼Œä»¥ä¾¿ä¸è¾“å…¥æ•°æ®è¿›è¡Œäº’ç›¸å…³è¿ç®—ã€‚å‡è®¾è¾“å…¥çš„é€šé“æ•°ä¸º $c_i$ï¼Œé‚£ä¹ˆå·ç§¯æ ¸çš„è¾“å…¥é€šé“æ•°ä¹Ÿéœ€è¦ä¸º $c_i$ ã€‚å¦‚æœå·ç§¯æ ¸çš„çª—å£å½¢çŠ¶æ˜¯ $k_h\times k_w$ï¼Œé‚£ä¹ˆå½“ $c_i=1$ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå·ç§¯æ ¸çœ‹ä½œå½¢çŠ¶ä¸º $k_h\times k_w$ çš„äºŒç»´å¼ é‡ã€‚</p><p>ç„¶è€Œï¼Œå½“ $c_i&gt;1$ æ—¶ï¼Œæˆ‘ä»¬å·ç§¯æ ¸çš„æ¯ä¸ªè¾“å…¥é€šé“å°†åŒ…å«å½¢çŠ¶ä¸º $k_h\times k_w$ çš„å¼ é‡ã€‚å°†è¿™äº›å¼ é‡ $c_i$ è¿ç»“åœ¨ä¸€èµ·å¯ä»¥å¾—åˆ°å½¢çŠ¶ä¸º $c_i\times k_h\times k_w$ çš„å·ç§¯æ ¸ã€‚ç”±äºè¾“å…¥å’Œå·ç§¯æ ¸éƒ½æœ‰ $c_i$ ä¸ªé€šé“ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªé€šé“è¾“å…¥çš„äºŒç»´å¼ é‡å’Œå·ç§¯æ ¸çš„äºŒç»´å¼ é‡è¿›è¡Œäº’ç›¸å…³è¿ç®—ï¼Œå†å¯¹é€šé“æ±‚å’Œï¼ˆå°† $c_i$ çš„ç»“æœç›¸åŠ ï¼‰å¾—åˆ°äºŒç»´å¼ é‡ã€‚è¿™æ˜¯å¤šé€šé“è¾“å…¥å’Œå¤šè¾“å…¥é€šé“å·ç§¯æ ¸ä¹‹é—´è¿›è¡ŒäºŒç»´äº’ç›¸å…³è¿ç®—çš„ç»“æœã€‚</p><p>ä¸‹å›¾æˆ‘ä»¬æ¼”ç¤ºäº†ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªè¾“å…¥é€šé“çš„äºŒç»´äº’ç›¸å…³è¿ç®—çš„ç¤ºä¾‹ã€‚</p><p><img src="conv-multi-in.svg" alt="ä¸¤ä¸ªè¾“å…¥é€šé“çš„äº’ç›¸å…³è®¡ç®—ã€‚"></p><p>å¤šè¾“å…¥é€šé“äº’ç›¸å…³è¿ç®—çš„å®ç°å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">corr2d_multi_in</span>(<span class="params">X, K</span>):</span><br><span class="line">    <span class="comment"># å…ˆéå†â€œXâ€å’Œâ€œKâ€çš„ç¬¬0ä¸ªç»´åº¦ï¼ˆé€šé“ç»´åº¦ï¼‰ï¼Œå†æŠŠå®ƒä»¬åŠ åœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="comment"># for x, k in zip(X, K) æ‹¿å‡ºX, Kå¯¹åº”ç»´åº¦é‡Œçš„çŸ©é˜µ</span></span><br><span class="line">    <span class="comment"># d2l.corr2d()å‡½æ•°ï¼šå®Œæˆäº’ç›¸å…³è¿ç®—</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(d2l.corr2d(x, k) <span class="keyword">for</span> x, k <span class="keyword">in</span> <span class="built_in">zip</span>(X, K))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = torch.tensor([[[<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>], [<span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>]],</span><br><span class="line">               [[<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>], [<span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>], [<span class="number">7.0</span>, <span class="number">8.0</span>, <span class="number">9.0</span>]]])</span><br><span class="line">K = torch.tensor([[[<span class="number">0.0</span>, <span class="number">1.0</span>], [<span class="number">2.0</span>, <span class="number">3.0</span>]], [[<span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">3.0</span>, <span class="number">4.0</span>]]])</span><br><span class="line"></span><br><span class="line">corr2d_multi_in(X, K)</span><br></pre></td></tr></table></figure><pre><code>tensor([[ 56.,  72.],        [104., 120.]])</code></pre><h2 id="å¤šè¾“å‡ºé€šé“"><a href="#å¤šè¾“å‡ºé€šé“" class="headerlink" title="å¤šè¾“å‡ºé€šé“"></a>å¤šè¾“å‡ºé€šé“</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸è®ºæœ‰å¤šå°‘è¾“å…¥é€šé“ï¼Œæˆ‘ä»¬è¿˜åªæœ‰ä¸€ä¸ªè¾“å‡ºé€šé“ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸å¤Ÿçš„ã€‚åœ¨æœ€æµè¡Œçš„ç¥ç»ç½‘ç»œæ¶æ„ä¸­ï¼Œéšç€ç¥ç»ç½‘ç»œå±‚æ•°çš„åŠ æ·±ï¼Œæˆ‘ä»¬å¸¸ä¼š<strong>å¢åŠ è¾“å‡ºé€šé“çš„ç»´æ•°ï¼Œé€šè¿‡å‡å°‘ç©ºé—´åˆ†è¾¨ç‡ä»¥è·å¾—æ›´å¤§çš„é€šé“æ·±åº¦</strong>ã€‚ç›´è§‚åœ°è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªé€šé“çœ‹ä½œæ˜¯å¯¹ä¸åŒç‰¹å¾çš„å“åº”ã€‚è€Œç°å®å¯èƒ½æ›´ä¸ºå¤æ‚ä¸€äº›ï¼Œå› ä¸ºæ¯ä¸ªé€šé“ä¸æ˜¯ç‹¬ç«‹å­¦ä¹ çš„ï¼Œè€Œæ˜¯ä¸ºäº†å…±åŒä½¿ç”¨è€Œä¼˜åŒ–çš„ã€‚å› æ­¤ï¼Œå¤šè¾“å‡ºé€šé“å¹¶ä¸ä»…æ˜¯å­¦ä¹ å¤šä¸ªå•é€šé“çš„æ£€æµ‹å™¨ã€‚</p><p>ç”¨ $c_i$ å’Œ $c_o$ åˆ†åˆ«è¡¨ç¤ºè¾“å…¥å’Œè¾“å‡ºé€šé“çš„æ•°ç›®ï¼Œå¹¶è®© $k_h$ å’Œ $k_w$ ä¸ºå·ç§¯æ ¸çš„é«˜åº¦å’Œå®½åº¦ã€‚ä¸ºäº†è·å¾—å¤šä¸ªé€šé“çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªè¾“å‡ºé€šé“åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º $c_i\times k_h\times k_w$ çš„å·ç§¯æ ¸å¼ é‡ï¼Œè¿™æ ·å·ç§¯æ ¸çš„å½¢çŠ¶æ˜¯ $c_o\times c_i\times k_h\times k_w$ã€‚åœ¨äº’ç›¸å…³è¿ç®—ä¸­ï¼Œæ¯ä¸ªè¾“å‡ºé€šé“å…ˆè·å–æ‰€æœ‰è¾“å…¥é€šé“ï¼Œå†ä»¥å¯¹åº”è¯¥è¾“å‡ºé€šé“çš„å·ç§¯æ ¸è®¡ç®—å‡ºç»“æœã€‚</p><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ª<strong>è®¡ç®—å¤šä¸ªé€šé“çš„è¾“å‡ºçš„äº’ç›¸å…³å‡½æ•°</strong>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">corr2d_multi_in_out</span>(<span class="params">X, K</span>):</span><br><span class="line">    <span class="comment"># è¿­ä»£â€œKâ€çš„ç¬¬0ä¸ªç»´åº¦ï¼Œæ¯æ¬¡éƒ½å¯¹è¾“å…¥â€œXâ€æ‰§è¡Œäº’ç›¸å…³è¿ç®—ã€‚</span></span><br><span class="line">    <span class="comment"># æœ€åå°†æ‰€æœ‰ç»“æœéƒ½å åŠ åœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="comment"># `corr2d_multi_in(X, k) for k in K`æ„æ€æ˜¯åœ¨æ‹¿å‡ºæ¯ä¸€ä¸ªäºŒç»´å·ç§¯æ ¸kï¼Œéƒ½å¯¹å®Œæ•´çš„è¾“å…¥Xåšäº’ç›¸å…³è¿ç®—</span></span><br><span class="line">    <span class="comment"># torch.stack(â€¦, 0)æ„æ€æ˜¯å°†ç»“æœåœ¨0çš„ç»´åº¦ä¸Šâ€œå †â€èµ·æ¥</span></span><br><span class="line">    <span class="keyword">return</span> torch.stack([corr2d_multi_in(X, k) <span class="keyword">for</span> k <span class="keyword">in</span> K], <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>torch.stack(â€¦, 0)</code>æ˜¯å°†ç»“æœåœ¨0çš„ç»´åº¦ä¸Šâ€œå †â€èµ·æ¥ã€‚ä¸‹é¢é€šè¿‡å°†æ ¸å¼ é‡Kä¸K+1ï¼ˆKä¸­æ¯ä¸ªå…ƒç´ åŠ  1 ï¼‰å’ŒK+2è¿æ¥èµ·æ¥ï¼Œæ„é€ äº†ä¸€ä¸ªå…·æœ‰ 3 ä¸ªè¾“å‡ºé€šé“çš„å·ç§¯æ ¸ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">K = torch.stack((K, K + <span class="number">1</span>, K + <span class="number">2</span>), <span class="number">0</span>)</span><br><span class="line">K.shape  <span class="comment"># åŸå§‹Kçš„ç»´åº¦æ˜¯(2,2,2)</span></span><br></pre></td></tr></table></figure><pre><code>torch.Size([3, 2, 2, 2])</code></pre><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¯¹è¾“å…¥å¼ é‡Xä¸å·ç§¯æ ¸å¼ é‡Kæ‰§è¡Œäº’ç›¸å…³è¿ç®—ã€‚ç°åœ¨çš„è¾“å‡ºåŒ…å« 3 ä¸ªé€šé“ï¼Œ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">corr2d_multi_in_out(X, K)</span><br></pre></td></tr></table></figure><pre><code>tensor([[[ 56.,  72.],         [104., 120.]],        [[ 76., 100.],         [148., 172.]],        [[ 96., 128.],         [192., 224.]]])</code></pre><h2 id="1-times-1-å·ç§¯å±‚"><a href="#1-times-1-å·ç§¯å±‚" class="headerlink" title="$1\times 1$ å·ç§¯å±‚"></a>$1\times 1$ å·ç§¯å±‚</h2><p>$1\times 1$ å·ç§¯ï¼Œå³ $k_h = k_w = 1$ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚<br>æ¯•ç«Ÿï¼Œå·ç§¯çš„æœ¬è´¨æ˜¯æœ‰æ•ˆæå–ç›¸é‚»åƒç´ é—´çš„ç›¸å…³ç‰¹å¾ï¼Œè€Œ $1 \times 1$ å·ç§¯æ˜¾ç„¶æ²¡æœ‰æ­¤ä½œç”¨ã€‚<br>å°½ç®¡å¦‚æ­¤ï¼Œ$1 \times 1$ ä»ç„¶ååˆ†æµè¡Œï¼Œæ—¶å¸¸åŒ…å«åœ¨å¤æ‚æ·±å±‚ç½‘ç»œçš„è®¾è®¡ä¸­ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬è¯¦ç»†åœ°è§£è¯»ä¸€ä¸‹å®ƒçš„å®é™…ä½œç”¨ã€‚</p><p>å› ä¸ºä½¿ç”¨äº†æœ€å°çª—å£ï¼Œ$1\times 1$ å·ç§¯å¤±å»äº†å·ç§¯å±‚çš„ç‰¹æœ‰èƒ½åŠ›â€”â€”åœ¨é«˜åº¦å’Œå®½åº¦ç»´åº¦ä¸Šï¼Œè¯†åˆ«ç›¸é‚»å…ƒç´ é—´ç›¸äº’ä½œç”¨çš„èƒ½åŠ›ã€‚<br>å…¶å® $1\times 1$ å·ç§¯çš„å”¯ä¸€è®¡ç®—å‘ç”Ÿåœ¨é€šé“ä¸Šã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ä½¿ç”¨ $1\times 1$ å·ç§¯æ ¸ä¸ $3$ ä¸ªè¾“å…¥é€šé“å’Œ $2$ ä¸ªè¾“å‡ºé€šé“çš„äº’ç›¸å…³è®¡ç®—ã€‚è¿™é‡Œè¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜åº¦å’Œå®½åº¦ï¼Œè¾“å‡ºä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä»è¾“å…¥å›¾åƒä¸­åŒä¸€ä½ç½®çš„å…ƒç´ çš„çº¿æ€§ç»„åˆã€‚æˆ‘ä»¬å¯ä»¥å°† $1\times 1$ å·ç§¯å±‚çœ‹ä½œæ˜¯åœ¨æ¯ä¸ªåƒç´ ä½ç½®åº”ç”¨çš„å…¨è¿æ¥å±‚ï¼Œä»¥ $c_i$ ä¸ªè¾“å…¥å€¼è½¬æ¢ä¸º $c_o$ ä¸ªè¾“å‡ºå€¼ã€‚å› ä¸ºè¿™ä»ç„¶æ˜¯ä¸€ä¸ªå·ç§¯å±‚ï¼Œæ‰€ä»¥è·¨åƒç´ çš„æƒé‡æ˜¯ä¸€è‡´çš„ã€‚åŒæ—¶ï¼Œ$1\times 1$ å·ç§¯å±‚éœ€è¦çš„æƒé‡ç»´åº¦ä¸º $c_o\times c_i$ ï¼Œå†é¢å¤–åŠ ä¸Šä¸€ä¸ªåç½®ã€‚</p><p><img src="conv-1x1.svg" alt="äº’ç›¸å…³è®¡ç®—ä½¿ç”¨äº†å…·æœ‰3ä¸ªè¾“å…¥é€šé“å’Œ2ä¸ªè¾“å‡ºé€šé“çš„ $1\times 1$ å·ç§¯æ ¸ã€‚å…¶ä¸­ï¼Œè¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜åº¦å’Œå®½åº¦ã€‚"></p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä½¿ç”¨å…¨è¿æ¥å±‚å®ç° $1 \times 1$ å·ç§¯ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®å½¢çŠ¶è¿›è¡Œå¾®è°ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">corr2d_multi_in_out_1x1</span>(<span class="params">X, K</span>):</span><br><span class="line">    c_i, h, w = X.shape</span><br><span class="line">    c_o = K.shape[<span class="number">0</span>]</span><br><span class="line">    X = X.reshape((c_i, h * w))</span><br><span class="line">    K = K.reshape((c_o, c_i))</span><br><span class="line">    <span class="comment"># å…¨è¿æ¥å±‚ä¸­çš„çŸ©é˜µä¹˜æ³•</span></span><br><span class="line">    Y = torch.matmul(K, X)</span><br><span class="line">    <span class="keyword">return</span> Y.reshape((c_o, h, w))</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ $1\times 1$ å·ç§¯è¿ç®—æ—¶ï¼Œä¸Šè¿°å‡½æ•°ç›¸å½“äºå…ˆå‰å®ç°çš„äº’ç›¸å…³å‡½æ•°<code>corr2d_multi_in_out</code>ã€‚è®©æˆ‘ä»¬ç”¨ä¸€äº›æ ·æœ¬æ•°æ®æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = torch.normal(<span class="number">0</span>, <span class="number">1</span>, (<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line">K = torch.normal(<span class="number">0</span>, <span class="number">1</span>, (<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Y1 = corr2d_multi_in_out_1x1(X, K)</span><br><span class="line">Y2 = corr2d_multi_in_out(X, K)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">float</span>(torch.<span class="built_in">abs</span>(Y1 - Y2).<span class="built_in">sum</span>()) &lt; <span class="number">1e-6</span></span><br></pre></td></tr></table></figure><h1 id="pooling"><a href="#pooling" class="headerlink" title="pooling"></a>pooling</h1><p>é€šå¸¸å½“æˆ‘ä»¬å¤„ç†å›¾åƒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€æ¸é™ä½éšè—è¡¨ç¤ºçš„ç©ºé—´åˆ†è¾¨ç‡ï¼Œèšé›†ä¿¡æ¯ï¼Œè¿™æ ·éšç€æˆ‘ä»¬åœ¨ç¥ç»ç½‘ç»œä¸­å±‚å çš„ä¸Šå‡ï¼Œæ¯ä¸ªç¥ç»å…ƒå¯¹å…¶æ•æ„Ÿçš„æ„Ÿå—é‡ï¼ˆè¾“å…¥ï¼‰å°±è¶Šå¤§ã€‚</p><p>è€Œæˆ‘ä»¬çš„æœºå™¨å­¦ä¹ ä»»åŠ¡é€šå¸¸ä¼šè·Ÿå…¨å±€å›¾åƒçš„é—®é¢˜æœ‰å…³ï¼ˆä¾‹å¦‚ï¼Œâ€œå›¾åƒæ˜¯å¦åŒ…å«ä¸€åªçŒ«å‘¢ï¼Ÿâ€ï¼‰ï¼Œ æ‰€ä»¥æˆ‘ä»¬æœ€åä¸€å±‚çš„ç¥ç»å…ƒåº”è¯¥å¯¹æ•´ä¸ªè¾“å…¥çš„å…¨å±€æ•æ„Ÿã€‚é€šè¿‡é€æ¸èšåˆä¿¡æ¯ï¼Œç”Ÿæˆè¶Šæ¥è¶Šç²—ç³™çš„æ˜ å°„ï¼Œæœ€ç»ˆå®ç°å­¦ä¹ å…¨å±€è¡¨ç¤ºçš„ç›®æ ‡ï¼ŒåŒæ—¶å°†å·ç§¯å›¾å±‚çš„æ‰€æœ‰ä¼˜åŠ¿ä¿ç•™åœ¨ä¸­é—´å±‚ã€‚</p><p>æ­¤å¤–ï¼Œå½“æ£€æµ‹è¾ƒåº•å±‚çš„ç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›è¿™äº›ç‰¹å¾ä¿æŒæŸç§ç¨‹åº¦ä¸Šçš„å¹³ç§»ä¸å˜æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ‹æ‘„é»‘ç™½ä¹‹é—´è½®å»“æ¸…æ™°çš„å›¾åƒ $X$ï¼Œå¹¶å°†æ•´ä¸ªå›¾åƒå‘å³ç§»åŠ¨ä¸€ä¸ªåƒç´ ï¼Œå³ $Z[i, j] = X[i, j + 1]$ï¼Œåˆ™æ–°å›¾åƒ $Z$ çš„è¾“å‡ºå¯èƒ½å¤§ä¸ç›¸åŒã€‚è€Œåœ¨ç°å®ä¸­ï¼Œéšç€æ‹æ‘„è§’åº¦çš„ç§»åŠ¨ï¼Œä»»ä½•ç‰©ä½“å‡ ä¹ä¸å¯èƒ½å‘ç”Ÿåœ¨åŒä¸€åƒç´ ä¸Šã€‚å³ä½¿ç”¨ä¸‰è„šæ¶æ‹æ‘„ä¸€ä¸ªé™æ­¢çš„ç‰©ä½“ï¼Œç”±äºå¿«é—¨çš„ç§»åŠ¨è€Œå¼•èµ·çš„ç›¸æœºæŒ¯åŠ¨ï¼Œå¯èƒ½ä¼šä½¿æ‰€æœ‰ç‰©ä½“å·¦å³ç§»åŠ¨ä¸€ä¸ªåƒç´ ã€‚</p><p>æœ¬èŠ‚å°†ä»‹ç» <em>æ± åŒ–</em>ï¼ˆpoolingï¼‰å±‚ï¼Œå®ƒå…·æœ‰åŒé‡ç›®çš„ï¼šé™ä½å·ç§¯å±‚å¯¹ä½ç½®çš„æ•æ„Ÿæ€§ï¼ŒåŒæ—¶é™ä½å¯¹ç©ºé—´é™é‡‡æ ·è¡¨ç¤ºçš„æ•æ„Ÿæ€§ã€‚</p><h2 id="æœ€å¤§æ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚"><a href="#æœ€å¤§æ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚" class="headerlink" title="æœ€å¤§æ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚"></a>æœ€å¤§æ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚</h2><p>ä¸å·ç§¯å±‚ç±»ä¼¼ï¼Œæ±‡èšå±‚è¿ç®—ç¬¦ç”±ä¸€ä¸ªå›ºå®šå½¢çŠ¶çš„çª—å£ç»„æˆï¼Œè¯¥çª—å£æ ¹æ®å…¶æ­¥å¹…å¤§å°åœ¨è¾“å…¥çš„æ‰€æœ‰åŒºåŸŸä¸Šæ»‘åŠ¨ï¼Œä¸ºå›ºå®šå½¢çŠ¶çª—å£ï¼ˆæœ‰æ—¶ç§°ä¸º <em>æ± åŒ–çª—å£</em>ï¼‰éå†çš„æ¯ä¸ªä½ç½®è®¡ç®—ä¸€ä¸ªè¾“å‡ºã€‚</p><p>ç„¶è€Œï¼Œä¸åŒäºå·ç§¯å±‚ä¸­çš„è¾“å…¥ä¸å·ç§¯æ ¸ä¹‹é—´çš„äº’ç›¸å…³è®¡ç®—ï¼Œæ±‡èšå±‚ä¸åŒ…å«å‚æ•°ã€‚<br>ç›¸åï¼Œæ± è¿ç®—ç¬¦æ˜¯ç¡®å®šæ€§çš„ï¼Œæˆ‘ä»¬é€šå¸¸è®¡ç®—æ± åŒ–çª—å£ä¸­æ‰€æœ‰å…ƒç´ çš„æœ€å¤§å€¼æˆ–å¹³å‡å€¼ã€‚è¿™äº›æ“ä½œåˆ†åˆ«ç§°ä¸º <em>æœ€å¤§æ±‡èšå±‚</em> ï¼ˆmaximum poolingï¼‰å’Œ <em>å¹³å‡æ±‡èšå±‚</em> ï¼ˆaverage poolingï¼‰ã€‚</p><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¸äº’ç›¸å…³è¿ç®—ç¬¦ä¸€æ ·ï¼Œæ± åŒ–çª—å£ä»è¾“å…¥å¼ é‡çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹çš„åœ¨è¾“å…¥å¼ é‡å†…æ»‘åŠ¨ã€‚åœ¨æ± åŒ–çª—å£åˆ°è¾¾çš„æ¯ä¸ªä½ç½®ï¼Œå®ƒè®¡ç®—è¯¥çª—å£ä¸­è¾“å…¥å­å¼ é‡çš„æœ€å¤§å€¼æˆ–å¹³å‡å€¼ï¼Œå…·ä½“å–å†³äºæ˜¯ä½¿ç”¨äº†æœ€å¤§æ±‡èšå±‚è¿˜æ˜¯å¹³å‡æ±‡èšå±‚ã€‚</p><p><img src="pooling.svg" alt="æ± åŒ–çª—å£å½¢çŠ¶ä¸º $2\times 2$ çš„æœ€å¤§æ±‡èšå±‚ã€‚ç€è‰²éƒ¨åˆ†æ˜¯ç¬¬ä¸€ä¸ªè¾“å‡ºå…ƒç´ ï¼Œä»¥åŠç”¨äºè®¡ç®—è¿™ä¸ªè¾“å‡ºçš„è¾“å…¥å…ƒç´ : $\max(../img/pooling.svg)=4$."></p><p>ä¸Šå›¾ä¸­è¾“å‡ºå¼ é‡çš„é«˜åº¦ä¸º $2$ï¼Œå®½åº¦ä¸º $2$ã€‚è¿™å››ä¸ªå…ƒç´ ä¸ºæ¯ä¸ªæ± åŒ–çª—å£ä¸­çš„æœ€å¤§å€¼ï¼š</p><script type="math/tex; mode=display">\max(0, 1, 3, 4)=4,\\\max(1, 2, 4, 5)=5,\\\max(3, 4, 6, 7)=7,\\\max(4, 5, 7, 8)=8.\\</script><p>æ± åŒ–çª—å£å½¢çŠ¶ä¸º $p \times q$ çš„æ±‡èšå±‚ç§°ä¸º $p \times q$ æ±‡èšå±‚ï¼Œæ± åŒ–æ“ä½œç§°ä¸º $p \times q$ æ± åŒ–ã€‚</p><p>å›åˆ°æœ¬èŠ‚å¼€å¤´æåˆ°çš„å¯¹è±¡è¾¹ç¼˜æ£€æµ‹ç¤ºä¾‹ï¼Œç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨å·ç§¯å±‚çš„è¾“å‡ºä½œä¸º $2\times 2$ æœ€å¤§æ± åŒ–çš„è¾“å…¥ã€‚è®¾ç½®å·ç§¯å±‚è¾“å…¥ä¸º $X$ï¼Œæ±‡èšå±‚è¾“å‡ºä¸º $Y$ã€‚æ— è®º $X[i, j]$ å’Œ $X[i, j + 1]$ çš„å€¼æ˜¯å¦ä¸åŒï¼Œæˆ– $X[i, j + 1]$ å’Œ $X[i, j + 2]$ çš„å€¼æ˜¯å¦ä¸åŒï¼Œæ±‡èšå±‚å§‹ç»ˆè¾“å‡º $Y[i, j] = 1$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ $2\times 2$ æœ€å¤§æ±‡èšå±‚ï¼Œå³ä½¿åœ¨é«˜åº¦æˆ–å®½åº¦ä¸Šç§»åŠ¨ä¸€ä¸ªå…ƒç´ ï¼Œå·ç§¯å±‚ä»ç„¶å¯ä»¥è¯†åˆ«åˆ°æ¨¡å¼ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­çš„ <code>pool2d</code> å‡½æ•°ï¼Œæˆ‘ä»¬<strong>å®ç°æ±‡èšå±‚çš„æ­£å‘ä¼ æ’­</strong>ã€‚ç„¶è€Œï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰å·ç§¯æ ¸ï¼Œè¾“å‡ºä¸ºè¾“å…¥ä¸­æ¯ä¸ªåŒºåŸŸçš„æœ€å¤§å€¼æˆ–å¹³å‡å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">pool2d</span>(<span class="params">X, pool_size, mode=<span class="string">&#x27;max&#x27;</span></span>):</span><br><span class="line">    p_h, p_w = pool_size</span><br><span class="line">    Y = torch.zeros((X.shape[<span class="number">0</span>] - p_h + <span class="number">1</span>, X.shape[<span class="number">1</span>] - p_w + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Y.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Y.shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> mode == <span class="string">&#x27;max&#x27;</span>:</span><br><span class="line">                Y[i, j] = X[i: i + p_h, j: j + p_w].<span class="built_in">max</span>()</span><br><span class="line">            <span class="keyword">elif</span> mode == <span class="string">&#x27;avg&#x27;</span>:</span><br><span class="line">                Y[i, j] = X[i: i + p_h, j: j + p_w].mean()</span><br><span class="line">    <span class="keyword">return</span> Y</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºè¾“å…¥Xï¼ŒéªŒè¯æœ€å¤§æ± åŒ–çš„è¾“å‡º</span></span><br><span class="line">X = torch.tensor([[<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>], [<span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>]])</span><br><span class="line">pool2d(X, (<span class="number">2</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure><pre><code>tensor([[4., 5.],        [7., 8.]])</code></pre><h2 id="å¡«å……ä¸æ­¥å¹…"><a href="#å¡«å……ä¸æ­¥å¹…" class="headerlink" title="å¡«å……ä¸æ­¥å¹…"></a>å¡«å……ä¸æ­¥å¹…</h2><p>ä¸å·ç§¯å±‚ä¸€æ ·ï¼Œæ±‡èšå±‚ä¹Ÿå¯ä»¥æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¡«å……å’Œæ­¥å¹…ä»¥è·å¾—æ‰€éœ€çš„è¾“å‡ºå½¢çŠ¶ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬ç”¨æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­å†…ç½®çš„äºŒç»´æœ€å¤§æ±‡èšå±‚ï¼Œæ¥æ¼”ç¤ºæ±‡èšå±‚ä¸­å¡«å……å’Œæ­¥å¹…çš„ä½¿ç”¨ã€‚ æˆ‘ä»¬é¦–å…ˆæ„é€ äº†ä¸€ä¸ªè¾“å…¥å¼ é‡Xï¼Œå®ƒæœ‰å››ä¸ªç»´åº¦ï¼Œå…¶ä¸­æ ·æœ¬æ•°å’Œé€šé“æ•°éƒ½æ˜¯1ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = torch.arange(<span class="number">16</span>, dtype=torch.float32).reshape((<span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>))</span><br><span class="line">X</span><br></pre></td></tr></table></figure><pre><code>tensor([[[[ 0.,  1.,  2.,  3.],          [ 4.,  5.,  6.,  7.],          [ 8.,  9., 10., 11.],          [12., 13., 14., 15.]]]])</code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­çš„æ­¥å¹…ä¸æ±‡èšçª—å£çš„å¤§å°ç›¸åŒã€‚ å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å½¢çŠ¶ä¸º(3, 3)çš„æ±‡èšçª—å£ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ­¥å¹…å½¢çŠ¶ä¸º(3, 3)</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pool2d = nn.MaxPool2d(<span class="number">3</span>)</span><br><span class="line">pool2d(X)</span><br></pre></td></tr></table></figure><pre><code>tensor([[[[10.]]]])</code></pre><p>å¡«å……å’Œæ­¥å¹…å¯ä»¥æ‰‹åŠ¨è®¾å®šï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pool2d = nn.MaxPool2d(<span class="number">3</span>, padding=<span class="number">1</span>, stride=<span class="number">2</span>)</span><br><span class="line">pool2d(X)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ªä»»æ„å¤§å°çš„çŸ©å½¢æ±‡èšçª—å£ï¼Œå¹¶åˆ†åˆ«è®¾å®šå¡«å……å’Œæ­¥å¹…çš„é«˜åº¦å’Œå®½åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pool2d = nn.MaxPool2d((<span class="number">2</span>, <span class="number">3</span>), stride=(<span class="number">2</span>, <span class="number">3</span>), padding=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">pool2d(X)</span><br></pre></td></tr></table></figure><pre><code>tensor([[[[ 5.,  7.],          [13., 15.]]]])</code></pre><h2 id="å¤šä¸ªé€šé“"><a href="#å¤šä¸ªé€šé“" class="headerlink" title="å¤šä¸ªé€šé“"></a>å¤šä¸ªé€šé“</h2><p>åœ¨å¤„ç†å¤šé€šé“è¾“å…¥æ•°æ®æ—¶ï¼Œæ±‡èšå±‚åœ¨æ¯ä¸ªè¾“å…¥é€šé“ä¸Šå•ç‹¬è¿ç®—ï¼Œè€Œä¸æ˜¯åƒå·ç§¯å±‚ä¸€æ ·åœ¨é€šé“ä¸Šå¯¹è¾“å…¥è¿›è¡Œæ±‡æ€»ã€‚ è¿™æ„å‘³ç€æ±‡èšå±‚çš„è¾“å‡ºé€šé“æ•°ä¸è¾“å…¥é€šé“æ•°ç›¸åŒã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬å°†åœ¨é€šé“ç»´åº¦ä¸Šè¿ç»“å¼ é‡Xå’ŒX + 1ï¼Œä»¥æ„å»ºå…·æœ‰2ä¸ªé€šé“çš„è¾“å…¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = torch.cat((X, X + <span class="number">1</span>), <span class="number">1</span>)</span><br><span class="line">X</span><br></pre></td></tr></table></figure><pre><code>tensor([[[[ 0.,  1.,  2.,  3.],          [ 4.,  5.,  6.,  7.],          [ 8.,  9., 10., 11.],          [12., 13., 14., 15.]],         [[ 1.,  2.,  3.,  4.],          [ 5.,  6.,  7.,  8.],          [ 9., 10., 11., 12.],          [13., 14., 15., 16.]]]])</code></pre><p>poolingåè¾“å‡ºé€šé“çš„æ•°é‡ä»ç„¶æ˜¯2ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pool2d = nn.MaxPool2d(<span class="number">3</span>, padding=<span class="number">1</span>, stride=<span class="number">2</span>)</span><br><span class="line">pool2d(X)</span><br></pre></td></tr></table></figure><pre><code>tensor([[[[ 5.,  7.],          [13., 15.]],         [[ 6.,  8.],          [14., 16.]]]])</code></pre><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹6.3ã€6.4ã€6.5èŠ‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java å¤šçº¿ç¨‹åŸºç¡€</title>
      <link href="/2022/01/24/Java-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/01/24/Java-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬ç¯‡åšå®¢å™è¿°Javaå¤šçº¿ç¨‹çš„åŸºæœ¬çŸ¥è¯†å’ŒåŸºæœ¬æ“ä½œã€‚</p><blockquote><p>å¾…è¡¥å……çš„éƒ¨åˆ†ï¼š</p><ul><li>[ ] çº¿ç¨‹è°ƒåº¦</li><li>[ ] AtomicInteger</li><li>[ ] Semaphore</li><li>[ ] é˜»å¡é˜Ÿåˆ—çš„å®ç°ç±»è¯¦è§£</li><li>[ ] å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„æ–¹æ³•</li><li>[ ] ConcurrentHashMap</li><li>[ ] Javaå¹¶å‘å…³é”®å­—</li><li>[ ] è¿›ç¨‹è°ƒåº¦ç®—æ³•</li><li>[ ] CAS/ABA/AQS</li></ul></blockquote><h1 id="çº¿ç¨‹æ¦‚è¿°"><a href="#çº¿ç¨‹æ¦‚è¿°" class="headerlink" title="çº¿ç¨‹æ¦‚è¿°"></a>çº¿ç¨‹æ¦‚è¿°</h1><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>å½“ä¸€ä¸ªç¨‹åºè¿›å…¥å†…å­˜è¿è¡Œæ—¶ï¼Œå³å˜æˆä¸€ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹æ˜¯å¤„äºè¿è¡Œè¿‡ç¨‹ä¸­çš„ç¨‹åºï¼Œå¹¶ä¸”å…·æœ‰ä¸€å®šç‹¬ç«‹çš„åŠŸèƒ½ï¼Œè¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œè¿›ç¨‹åŒ…å«ä¸‰ä¸ªç‰¹å¾ï¼šç‹¬ç«‹æ€§ï¼›åŠ¨æ€æ€§ï¼›å¹¶å‘æ€§ã€‚ã€</p><p>å¹¶å‘å’Œå¹¶è¡Œæ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œå¹¶è¡Œæ˜¯æŒ‡åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šæ¡æŒ‡ä»¤åœ¨å¤šä¸ªå¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œï¼›å¹¶å‘æŒ‡åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œä½†å¤šä¸ªè¿›ç¨‹æŒ‡ä»¤è¢«å¿«é€Ÿè½®æ¢æ‰§è¡Œï¼Œä½¿å¾—å®è§‚ä¸Šå…·æœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæœã€‚</p><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p>å¤šçº¿ç¨‹æ‰©å±•äº†å¤šè¿›ç¨‹çš„æ¦‚å¿µï¼Œä½¿å¾—åŒä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶å¹¶å‘å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚</p><p>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„æ‰§è¡Œå•å…ƒï¼Œæ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ†ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¿…é¡»æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ã€‚çº¿ç¨‹å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å †æ ˆã€è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œè‡ªå·±çš„å±€éƒ¨å˜é‡ã€‚</p><p>å¤šä¸ªçº¿ç¨‹å…±äº«çˆ¶è¿›ç¨‹é‡Œçš„å…¨éƒ¨èµ„æºï¼Œå¯ä»¥ä¸å…¶ä»–çº¿ç¨‹å…±äº«çˆ¶è¿›ç¨‹ä¸­çš„å…±äº«å˜é‡å’Œéƒ¨åˆ†ç¯å¢ƒã€‚</p><p>çº¿ç¨‹æ˜¯ç‹¬ç«‹äºè¿è¡Œçš„ï¼Œä»–å¹¶ä¸çŸ¥é“è¿›ç¨‹ä¸­æ˜¯å¦è¿˜æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ã€‚ç°æˆçš„æ‰§è¡Œæ˜¯æŠ¢å å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰è¿è¡Œçš„çº¿ç¨‹åœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«æŒ‚èµ·ï¼Œä»¥ä¾¿å¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œã€‚</p><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</p><p>ä»é€»è¾‘çš„è§’åº¦ï¼Œå¤šçº¿ç¨‹å­˜åœ¨äºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œè®©ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­å¯ä»¥æœ‰å¤šä¸ªæ‰§è¡Œéƒ¨åˆ†åŒæ—¶æ‰§è¡Œï¼Œä½†æ“ä½œç³»ç»Ÿæ— é¡»å°†å¤šä¸ªçº¿ç¨‹çœ‹ä½œå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œå¯¹å¤šçº¿ç¨‹å®ç°è°ƒåº¦å’Œç®¡ç†ä»¥åŠèµ„æºåˆ†é…ã€‚çº¿ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ç”±è¿›ç¨‹æœ¬èº«è´Ÿè´£å®Œæˆã€‚</p><h2 id="çº¿ç¨‹ä¼˜åŠ¿"><a href="#çº¿ç¨‹ä¼˜åŠ¿" class="headerlink" title="çº¿ç¨‹ä¼˜åŠ¿"></a>çº¿ç¨‹ä¼˜åŠ¿</h2><p>è¿›ç¨‹ä¸­çº¿ç¨‹çš„ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦æ›´å°ã€‚</p><p>å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªè¿›ç¨‹è™šæ‹Ÿç©ºé—´ã€‚çº¿ç¨‹å…±äº«çš„ç¯å¢ƒåŒ…æ‹¬ï¼šè¿›ç¨‹ä»£ç æ®µã€è¿›ç¨‹çš„å…±æœ‰æ•°æ®ç­‰ã€‚<br>æ€»ç»“èµ·æ¥ï¼Œä½¿ç”¨å¤šçº¿ç¨‹ç¼–ç¨‹å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>è¿›ç¨‹ä¹‹é—´ä¸èƒ½å…±äº«å†…å­˜ï¼Œä½†çº¿ç¨‹ä¹‹é—´å…±äº«å†…å­˜å¾ˆå®¹æ˜“</li><li>ç³»ç»Ÿåˆ›å»ºè¿›ç¨‹æ—¶ï¼Œéœ€è¦ä½è¯¥è¿›ç¨‹é‡æ–°åˆ†é…ç³»ç»Ÿèµ„æºï¼Œä½†åˆ›å»ºçº¿ç¨‹åˆ™ä»£ä»·å°å¾ˆå¤šï¼Œå› æ­¤ä½¿ç”¨å¤šçº¿ç¨‹å®ç°å¤šä»»åŠ¡å¹¶å‘æ¯”å¤šè¿›ç¨‹çš„æ•ˆç‡é«˜ã€‚</li><li>Javaè¯­è¨€å†…ç½®äº†å¤šçº¿ç¨‹åŠŸèƒ½æ”¯æŒï¼Œè€Œä¸æ˜¯å•çº¯çš„ä½œä¸ºåº•å±‚æ“ä½œç³»ç»Ÿçš„è°ƒåº¦æ–¹å¼ï¼Œä»è€Œç®€åŒ–äº†Javaçš„å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</li></ul><h1 id="çº¿ç¨‹åˆ›å»ºå’Œå¯åŠ¨"><a href="#çº¿ç¨‹åˆ›å»ºå’Œå¯åŠ¨" class="headerlink" title="çº¿ç¨‹åˆ›å»ºå’Œå¯åŠ¨"></a>çº¿ç¨‹åˆ›å»ºå’Œå¯åŠ¨</h1><p>æœ‰ä¸‰ç§æ–¹å¼åˆ›å»ºçº¿ç¨‹ç±»</p><h2 id="ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»"><a href="#ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»" class="headerlink" title="ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»"></a>ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»</h2><ol><li>å®šä¹‰Threadçš„å­ç±»ï¼Œå¹¶é‡å†™runæ–¹æ³•ï¼Œè¯¥runæ–¹æ³•çš„æ–¹æ³•é¢˜å°±ä»£è¡¨äº†çº¿ç¨‹éœ€è¦å®Œæˆçš„ä»»åŠ¡ã€‚ï¼ˆçº¿ç¨‹æ‰§è¡Œä½“ï¼‰</li><li>åˆ›å»ºThreadå­ç±»çš„å®ä¾‹ï¼Œå³åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ã€‚</li><li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„startæ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li></ol><h2 id="å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»"><a href="#å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»" class="headerlink" title="å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»"></a>å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»</h2><ol><li>å®šä¹‰Runnableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™è¯¥æ¥å£çš„runæ–¹æ³•ã€‚è¯¥runæ–¹æ³•çš„æ–¹æ³•ä½“åŒæ ·æ˜¯è¯¥çº¿ç¨‹çš„çº¿ç¨‹æ‰§è¡Œä½“ã€‚</li><li>åˆ›å»ºRunnableå®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶ä»¥æ­¤å®ä¾‹ä½œä¸ºThreadçš„targetæ¥åˆ›å»ºThreadå¯¹è±¡ï¼Œè¯¥Threadå¯¹è±¡æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ã€‚</li></ol><blockquote><p>ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTester</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">firstThread</span>().start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">firstThread</span>().start();</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">tt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">secondThread</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(tt, <span class="string">&quot;æ–°çº¿ç¨‹1&quot;</span>).start(); <span class="comment">//å¯ä»¥ç»™çº¿ç¨‹å‘½å</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(tt, <span class="string">&quot;æ–°çº¿ç¨‹2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">firstThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(getName() + <span class="string">&quot;ï¼š&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">secondThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span> + i); <span class="comment">//åªèƒ½ä½¿ç”¨Thread.currentThread().getName()æ¥è·å¾—çº¿ç¨‹å</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨</p><ul><li>ä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ç±»æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´æ— æ³•å…±äº«çº¿ç¨‹ç±»çš„å®ä¾‹å˜é‡ã€‚</li><li>Runnableå¯¹è±¡ä»…ä½œä¸ºThreadå¯¹è±¡çš„targetï¼ŒRunnableå®ç°ç±»é‡ŒåŒ…å«çš„runæ–¹æ³•ä»…ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ã€‚è€Œå®é™…çš„çº¿ç¨‹å¯¹è±¡ä¾ç„¶æ˜¯Threadå®ä¾‹ï¼Œåªæ˜¯è¯¥Threadçº¿ç¨‹è´Ÿè´£æ‰§è¡Œå…¶targetçš„runæ–¹æ³•ã€‚</li><li>é€šè¿‡å®ç°Runnableæ¥å£æ¥è·å¾—å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œåˆ™å¿…é¡»ä½¿ç”¨Thread.currentThread()æ–¹æ³•ã€‚</li><li>ä»Java8å¼€å§‹ï¼ŒRunnableæ¥å£ä½¿ç”¨äº†@FunctionalInterfaceï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼åˆ›å»ºRunnableå¯¹è±¡ã€‚ä¸‹é¢ä»‹ç»çš„Callableæ¥å£ä¹Ÿæ˜¯å‡½æ•°å¼æ¥å£ã€‚</li></ul><h2 id="ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹"><a href="#ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹" class="headerlink" title="ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹"></a>ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹</h2><p>Callableæ¥å£æä¾›äº†ä¸€ä¸ªcallæ–¹æ³•å¯ä»¥ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œä½†callæ–¹æ³•æ¯”runæ–¹æ³•åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p><ul><li>callæ–¹æ³•æœ‰è¿”å›å€¼ã€‚</li><li>callå¯ä»¥å£°æ˜æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><p>å®Œå…¨å¯ä»¥æä¾›ä¸€ä¸ªCallableå¯¹è±¡ä½œä¸ºThreadçš„targetï¼Œè€Œè¯¥çº¿ç¨‹çš„çº¿ç¨‹æ‰§è¡Œä½“å°±æ˜¯è¯¥Callableå¯¹è±¡çš„callæ–¹æ³•ã€‚ä½†Callableæ¥å£ä¸æ˜¯Runnableæ¥å£çš„å­æ¥å£ï¼Œæ‰€ä»¥Callableå¯¹è±¡ä¸èƒ½ç›´æ¥ä½œä¸ºThreadçš„targetã€‚</p><p>Java5æä¾›äº†Futureæ¥å£æ¥ä»£è¡¨Callableæ¥å£é‡Œcallæ–¹æ³•çš„è¿”å›å€¼ï¼Œå¹¶ä¸ºFutureæ¥å£æä¾›äº†ä¸€ä¸ªFutureTaskå®ç°ç±»ï¼Œè¯¥å®ç°ç±»å®ç°äº†Futureæ¥å£å¹¶å®ç°äº†Runnableæ¥å£ï¼Œå¯ä»¥ä½œä¸ºThreadç±»çš„targetã€‚</p><p><img src="20160713174739239.png" alt="FutureTask"></p><p>Futureæ¥å£ä¸­å®šä¹‰äº†å¦‚ä¸‹å…¬å…±æ–¹æ³•æ¥æ§åˆ¶å®ƒå…³è”çš„Callableä»»åŠ¡ã€‚</p><ul><li><code>boolean cancel(boolean mayInterroutIfRunning)</code>ï¼šè¯•å›¾å–æ¶ˆè¯¥Futureé‡Œå…³è”çš„Callableä»»åŠ¡ã€‚</li><li><code>V get()</code>ï¼šè¿”å›Callableä»»åŠ¡é‡Œçš„callæ–¹æ³•çš„è¿”å›å€¼ã€‚è°ƒç”¨è¯¥æ–¹æ³•å°†å¯¼è‡´ç¨‹åºé˜»å¡ï¼Œå¿…é¡»ç­‰å¾…å­çº¿ç¨‹æ¥å£åæ‰ä¼šå¾—åˆ°è¿”å›å€¼ã€‚</li><li><code>V get(long timeout, TimeUnit unit)</code>ï¼šè¿”å›Callableä»»åŠ¡é‡Œçš„callæ–¹æ³•çš„è¿”å›å€¼ã€‚è¯¥æ–¹æ³•è®©ç¨‹åºæœ€å¤šé˜»å¡timeoutå’ŒunitæŒ‡å®šçš„æ—¶é—´ï¼Œå¦‚æœç»è¿‡æŒ‡å®šæ—¶é—´åCallableä»»åŠ¡ä¾ç„¶æ²¡æœ‰è¿”å›å€¼ï¼Œå°†ä¼šæŠ›å‡ºTimeoutExceptionå¼‚å¸¸ã€‚</li><li><code>boolean isCancelled()</code>å¦‚æœCallableä»»åŠ¡æ­£å¸¸å®Œæˆå‰è¢«å–æ¶ˆï¼Œåˆ™è¿”å›trueã€‚</li><li><code>boolean isDone()</code>å¦‚æœCallableä»»åŠ¡å·²å®Œæˆï¼Œåˆ™è¿”å›trueã€‚</li></ul><p>åˆ›å»ºå¹¶å¯åŠ¨æœ‰è¿”å›å€¼çš„çº¿ç¨‹æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°callæ–¹æ³•ï¼ˆæ³¨æ„æ³›å‹ï¼‰ï¼Œè¯¥callæ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œä¸”è¯¥callæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œå†åˆ›å»ºCallableå®ç°ç±»çš„å®ä¾‹ã€‚</li><li>ä½¿ç”¨FutureTaskç±»æ¥åŒ…è£…Callableå¯¹è±¡ï¼Œè¯¥FutureTaskå¯¹è±¡å°è£…äº†è¯¥Callableå¯¹è±¡çš„callæ–¹æ³•çš„è¿”å›å€¼ã€‚</li><li>ä½¿ç”¨FutureTaskå¯¹è±¡ä½œä¸ºThreadå¯¹è±¡çš„targetåˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚</li><li>è°ƒç”¨FutureTaskå¯¹è±¡çš„getæ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ã€‚</li></ol><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableTester</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        FutureTask&lt;Integer&gt; task = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">thirdThread</span>()); <span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼ç”ŸæˆCallableå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(task, <span class="string">&quot;æœ‰è¿”å›å€¼çš„çº¿ç¨‹1&quot;</span>).start();</span><br><span class="line"><span class="comment">//        new Thread(task, &quot;æœ‰è¿”å›å€¼çš„çº¿ç¨‹2&quot;).start(); // ä¸ç”Ÿæ•ˆï¼Œtaskå¯¹è±¡åªèƒ½ç”¨ä¸€æ¬¡ï¼Ÿ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹è¿”å›å€¼ï¼š&quot;</span>+task.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">thirdThread</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span>(; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šCallableæ¥å£æœ‰æ³›å‹é™åˆ¶ï¼ŒCallableæ¥å£é‡Œçš„æ³›å‹å½¢å‚ç±»å‹ä¸callæ–¹æ³•è¿”å›å€¼ç±»å‹ç›¸åŒã€‚</p><h2 id="ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼å¯¹æ¯”"><a href="#ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼å¯¹æ¯”" class="headerlink" title="ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼å¯¹æ¯”"></a>ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼å¯¹æ¯”</h2><ul><li>å®ç°Runnableæ¥å£å’Œå®ç°Callableæ¥å£çš„æ–¹å¼åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯Callableæ¥å£é‡Œå®šä¹‰çš„æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œå¯ä»¥å£°æ˜æŠ›å‡ºå¼‚å¸¸è€Œå·²ã€‚</li><li>é‡‡ç”¨å®ç°Runnableã€Callableæ¥å£çš„æ–¹å¼çš„ä¼˜ç‚¹æ˜¯<ul><li>çº¿ç¨‹ç±»è¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»</li><li>å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªtargetå¯¹è±¡ï¼Œéå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹æ¥å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å†µã€‚</li></ul></li><li>é‡‡ç”¨ç»§æ‰¿Threadç±»æ–¹å¼åˆ›å»ºå¤šçº¿ç¨‹çš„ä¼˜ç‚¹æ˜¯ï¼š<ul><li>ç¼–å†™ç®€å•</li></ul></li></ul><h1 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>ä¸€ä¸ªçº¿ç¨‹è¦ç»è¿‡æ–°å»ºï¼ˆNewï¼‰ã€å°±ç»ªï¼ˆReadyï¼‰ã€è¿è¡Œï¼ˆRunningï¼‰ã€é˜»å¡ï¼ˆBlockedï¼‰ã€æ­»äº¡ï¼ˆDeadï¼‰5ç§çŠ¶æ€ã€‚</p><p>çº¿ç¨‹çŠ¶æ€ä»¥åŠè½¬æ¢å›¾å¦‚ä¸‹ï¼š</p><p><img src="image-20210709151939392.png" alt="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ"></p><h2 id="æ–°å»ºå’Œå°±ç»ªçŠ¶æ€"><a href="#æ–°å»ºå’Œå°±ç»ªçŠ¶æ€" class="headerlink" title="æ–°å»ºå’Œå°±ç»ªçŠ¶æ€"></a>æ–°å»ºå’Œå°±ç»ªçŠ¶æ€</h2><p>å½“ç¨‹åºä½¿ç”¨äº†newå…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ä¹‹åï¼Œè¯¥çº¿ç¨‹å°±å¤„äºæ–°å»ºçŠ¶æ€ã€‚</p><p>å½“çº¿ç¨‹è°ƒç”¨äº†startæ–¹æ³•åï¼Œè¯¥çº¿ç¨‹å°±å¤„äºå°±ç»ªçŠ¶æ€ã€‚å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹å¹¶æ²¡æœ‰å¼€å§‹è¿è¡Œï¼Œåªæ˜¯è¡¨ç¤ºè¯¥çº¿ç¨‹å¯ä»¥è¿è¡Œäº†ã€‚</p><h2 id="è¿è¡Œå’Œé˜»å¡çŠ¶æ€"><a href="#è¿è¡Œå’Œé˜»å¡çŠ¶æ€" class="headerlink" title="è¿è¡Œå’Œé˜»å¡çŠ¶æ€"></a>è¿è¡Œå’Œé˜»å¡çŠ¶æ€</h2><p>å¦‚æœå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº†CPUï¼Œå¼€å§‹æ‰§è¡Œrunæ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œä½“ï¼Œåˆ™è¯¥çº¿ç¨‹å°±å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p><p>çº¿ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ç§éœ€è¦è¢«ä¸­æ–­ï¼Œç›®çš„æ˜¯ä½¿å…¶ä»–çº¿ç¨‹è·å¾—æ‰§è¡Œçš„æœºä¼šã€‚å½“å‰æ‰§è¡Œçš„çº¿ç¨‹è¢«é˜»å¡åï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥è·å¾—æ‰§è¡Œçš„æœºä¼šã€‚è¢«é˜»å¡çš„çº¿ç¨‹ä¼šåœ¨åˆé€‚çš„æ—¶å€™å°†é‡æ–°è¿›å…¥<strong>å°±ç»ªçŠ¶æ€</strong>ã€‚</p><p>æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µï¼Œè°ƒç”¨yieldæ–¹æ³•å¯ä»¥è®©è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚ã€</p><h2 id="çº¿ç¨‹æ­»äº¡"><a href="#çº¿ç¨‹æ­»äº¡" class="headerlink" title="çº¿ç¨‹æ­»äº¡"></a>çº¿ç¨‹æ­»äº¡</h2><p>çº¿ç¨‹å¯ä»¥ä»¥å¦‚ä¸Šå›¾ä¸‰ç§æ–¹å¼æ­»äº¡ã€‚</p><p>ä¸ºäº†æµ‹è¯•æŸä¸ªçº¿ç¨‹æ˜¯å¦æ­»äº¡ï¼Œå¯ä»¥è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„isAliveæ–¹æ³•ï¼Œå½“çº¿ç¨‹å¤„äºå°±ç»ªã€è¿è¡Œã€é˜»å¡ä¸‰ç§çŠ¶æ€æ—¶ï¼Œè¯¥æ–¹æ³•å°†è¿”å›trueï¼›å½“çº¿ç¨‹å¤„äºæ–°å»ºã€æ­»äº¡ä¸¤ç§çŠ¶æ€æ—¶ï¼Œè¯¥æ–¹æ³•å°†è¿”å›falseã€‚</p><p>æ³¨æ„ï¼š</p><ul><li>å½“ä¸»çº¿ç¨‹ç»“æŸæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸å—å½±å“ï¼Œå¹¶ä¸ä¼šéšä¹‹ç»“æŸã€‚ä¸€æ—¦å­çº¿ç¨‹å¯åŠ¨èµ·æ¥åï¼Œä»–å°±æ‹¥æœ‰å’Œä¸»çº¿ç¨‹ç›¸åŒçš„åœ°ä½ï¼Œä»–ä¸ä¼šå—ä¸»çº¿ç¨‹çš„å½±å“ã€‚</li><li>ä¸è¦è¯•å›¾å¯¹ä¸€ä¸ªå·²ç»æ­»äº¡çš„çº¿ç¨‹è°ƒç”¨startæ–¹æ³•ä½¿ä»–é‡æ–°å¯åŠ¨ã€‚</li><li>å¯¹äºæ–°å»ºçŠ¶æ€çš„çº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨startæ–¹æ³•ä¹Ÿæ˜¯é”™è¯¯çš„ã€‚</li></ul><h1 id="æ§åˆ¶çº¿ç¨‹"><a href="#æ§åˆ¶çº¿ç¨‹" class="headerlink" title="æ§åˆ¶çº¿ç¨‹"></a>æ§åˆ¶çº¿ç¨‹</h1><h2 id="joinçº¿ç¨‹"><a href="#joinçº¿ç¨‹" class="headerlink" title="joinçº¿ç¨‹"></a>joinçº¿ç¨‹</h2><p>Threadæä¾›äº†ä¸€ä¸ªè®©çº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„æ–¹æ³•â€”â€”joinæ–¹æ³•ã€‚å½“åœ¨æŸä¸ªè½¦å…‰ç»ªæ‰§è¡Œæµä¸­è°ƒç”¨å…¶ä»–çº¿ç¨‹çš„joinæ–¹æ³•æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°è¢«joinæ–¹æ³•åŠ å…¥çš„joinçº¿ç¨‹æ‰§è¡Œå®Œä¸ºæ­¢ã€‚</p><p>joinæ–¹æ³•é€šå¸¸ç”±ä½¿ç”¨çº¿ç¨‹çš„ç¨‹åºè°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinTester</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">jt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">joinThread</span>();</span><br><span class="line">        jt.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + i);</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">20</span>) &#123;</span><br><span class="line">                jt.join();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">joinThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(getName() + <span class="string">&quot;:&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="image-20210709163027111.png" alt="join è¿è¡Œç»“æœ"></p><p>ç”±äºåœ¨ä¸»çº¿ç¨‹è°ƒç”¨äº†å­çº¿ç¨‹çš„joinæ–¹æ³•ï¼Œåˆ™ä¸»çº¿ç¨‹å¿…é¡»ç­‰åˆ°å­çº¿ç¨‹ï¼ˆè¢«Joinçš„çº¿ç¨‹ï¼‰æ‰§è¡Œå®Œæ¯•æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><h2 id="åå°çº¿ç¨‹"><a href="#åå°çº¿ç¨‹" class="headerlink" title="åå°çº¿ç¨‹"></a>åå°çº¿ç¨‹</h2><p>æœ‰ä¸€ç§çº¿ç¨‹ï¼Œä»–æ˜¯åœ¨åå°è¿è¡Œçš„ï¼Œä»–çš„ä»»åŠ¡æ˜¯ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ï¼Œè¿™ç§çº¿ç¨‹è¢«ç§°ä¸ºâ€œåå°çº¿ç¨‹ï¼ˆDaemon Threadï¼‰â€ï¼Œåˆç§°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç²¾çµçº¿ç¨‹ã€‚</p><p>åå°çº¿ç¨‹æœ‰ä¸ªç‰¹å¾ï¼š<strong>å¦‚æœå‰å°çº¿ç¨‹éƒ½æ­»äº¡ï¼Œåå°çº¿ç¨‹ä¼šè‡ªåŠ¨æ­»äº¡ã€‚</strong></p><p>è°ƒç”¨Threadçš„setDaemon(true)æ–¹æ³•å¯å°†æŒ‡å®šçº¿ç¨‹è®¾ç½®ä¸ºåå°çº¿ç¨‹ã€‚</p><p>Threadç±»è¿˜æä¾›ä¸€ä¸ªisDaemonæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æŒ‡å®šçº¿ç¨‹æ˜¯å¦ä¸ºåå°çº¿ç¨‹ã€‚</p><p>å‰å°çº¿ç¨‹åˆ›å»ºçš„å­çº¿ç¨‹é»˜è®¤å°±æ˜¯å‰å°çº¿ç¨‹ï¼Œåå°çº¿ç¨‹åˆ›å»ºçš„å­ç¨‹åºé»˜è®¤æ˜¯åå°çº¿ç¨‹ã€‚</p><p>æ³¨æ„ï¼šè¦å°†æŸä¸ªçº¿ç¨‹è®¾ç½®ä¸ºåå°çº¿ç¨‹ï¼Œå¿…é¡»åœ¨è¯¥çº¿ç¨‹å¯åŠ¨ä¹‹å‰è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´setDaemon(true)æ¯”å¦‚åœ¨startæ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚å¦åˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚</p><h2 id="çº¿ç¨‹ç¡çœ sleep"><a href="#çº¿ç¨‹ç¡çœ sleep" class="headerlink" title="çº¿ç¨‹ç¡çœ sleep"></a>çº¿ç¨‹ç¡çœ sleep</h2><p><code>Thread.sleep(long milis)</code></p><p>Threadæä¾›äº†ä¸€ä¸ªä¸sleepæ–¹æ³•æœ‰ç‚¹ç›¸ä¼¼çš„yieldæ–¹æ³•ï¼Œåè€…ä¹Ÿå¯ä»¥è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œä½†ä»–ä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹ï¼Œä»–åªæ˜¯å°†è¯¥çº¿ç¨‹è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚yieldåªæ˜¯è®©å½“å‰çº¿ç¨‹æš‚åœä¸€ä¸‹ã€‚è®©ç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦å™¨é‡æ–°è°ƒåº¦ä¸€æ¬¡ã€‚</p><p>å…³äºsleepæ–¹æ³•å’Œyieldæ–¹æ³•çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>sleepæ–¹æ³•æš‚åœå½“å‰çº¿ç¨‹åï¼Œä¼šç»™å…¶ä»–çº¿ç¨‹æ‰§è¡Œæœºä¼šï¼Œä¸ä¼šç†ä¼šå…¶ä»–çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼›ä½†yieldæ–¹æ³•åªä¼šç»™åŒä¼˜å…ˆçº§ç›¸åŒï¼Œæˆ–ä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹æ‰§è¡Œæœºä¼šã€‚</li><li>sleepæ–¹æ³•ä¼šå°†çº¿ç¨‹è½¬å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°ç»è¿‡é˜»å¡æ—¶é—´æ‰ä¼šè½¬å…¥å°±ç»ªçŠ¶æ€ï¼›è€Œyieldä¸ä¼šè®²çº¿ç¨‹è½¬å…¥é˜»å¡çŠ¶æ€ï¼Œä»–åªæ˜¯å¼ºåˆ¶å½“å‰çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚å› æ­¤å®Œå…¨æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹è¢«yieldæ–¹æ³•æš‚åœä¹‹åï¼Œç«‹å³å†æ¬¡è·å¾—å¤„ç†å™¨èµ„æºè¢«æ‰§è¡Œã€‚</li><li>sleepæ–¹æ³•å£°æ˜æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥è°ƒç”¨sleepæ–¹æ³•å¿…é¡»æ•æ‰æˆ–è€…æ˜¾å¼å£°æ˜æŠ›å‡ºè¯¥å¼‚å¸¸ï¼›è€Œyieldæ²¡æœ‰å£°æ˜æŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚</li><li>sleepæ–¹æ³•æ¯”yieldæ–¹æ³•å…·æœ‰æ›´å¥½çš„ç§»æ¤æ€§ï¼Œæ›´æ¨èç”¨äºæ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ‰§è¡Œã€‚</li></ul><h2 id="çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹ä¼˜å…ˆçº§"></a>çº¿ç¨‹ä¼˜å…ˆçº§</h2><p>æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œéƒ½å…·æœ‰ä¸€å®šçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è·å¾—è¾ƒå¤šçš„æ‰§è¡Œæœºä¼šï¼Œè€Œä¼˜å…ˆçº§ä½çš„çº¿ç¨‹åˆ™è·å¾—è¾ƒå°‘çš„æ‰§è¡Œæœºä¼šã€‚</p><p>æ¯ä¸ªçº¿ç¨‹é»˜è®¤çš„ä¼˜å…ˆçº§éƒ½ä¸åˆ›å»ºå®ƒçš„çˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmainçº¿ç¨‹å…·æœ‰æ™®é€šä¼˜å…ˆçº§ï¼Œç”±mainçº¿ç¨‹åˆ›å»ºçš„å­çº¿ç¨‹ä¹Ÿå…·æœ‰æ™®é€šä¼˜å…ˆçº§ã€‚</p><p>Threadç±»æä¾›äº†setPriority(int newPriority)ã€getPriorityæ–¹æ³•æ¥æŒ‡å®šæˆ–è¿”å›æŒ‡å®šçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚å…¶ä¸­setPriorityçš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒèŒƒå›´æ˜¯1~10ä¹‹é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Threadç±»çš„å¦‚ä¸‹ä¸‰ä¸ªé™æ€å¸¸é‡ã€‚</p><ul><li>MAX_PRIORITYï¼šå…¶å€¼ä¸º10</li><li>MIN_PRIORITYï¼šå…¶å€¼ä¸º1</li><li>NORM_PRIORITYï¼šå…¶å€¼ä¸º5</li></ul><p>è¿™äº›ä¼˜å…ˆçº§éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œå› æ­¤åº”è¯¥å°½é‡é¿å…ç›´æ¥ä¸ºçº¿ç¨‹æŒ‡å®šä¼˜å…ˆçº§ï¼Œè€Œåº”è¯¥ä½¿ç”¨ä¸Šè¿°ä¸‰ä¸ªé™æ€å¸¸é‡ã€‚</p><h1 id="çº¿ç¨‹è°ƒåº¦"><a href="#çº¿ç¨‹è°ƒåº¦" class="headerlink" title="çº¿ç¨‹è°ƒåº¦"></a>çº¿ç¨‹è°ƒåº¦</h1><h2 id="æŠ¢å å¼è°ƒåº¦"><a href="#æŠ¢å å¼è°ƒåº¦" class="headerlink" title="æŠ¢å å¼è°ƒåº¦"></a>æŠ¢å å¼è°ƒåº¦</h2><h2 id="ååŒå¼è°ƒåº¦"><a href="#ååŒå¼è°ƒåº¦" class="headerlink" title="ååŒå¼è°ƒåº¦"></a>ååŒå¼è°ƒåº¦</h2><h2 id="Javaçš„çº¿ç¨‹è°ƒåº¦æ–¹å¼ï¼šæŠ¢å å¼"><a href="#Javaçš„çº¿ç¨‹è°ƒåº¦æ–¹å¼ï¼šæŠ¢å å¼" class="headerlink" title="Javaçš„çº¿ç¨‹è°ƒåº¦æ–¹å¼ï¼šæŠ¢å å¼"></a>Javaçš„çº¿ç¨‹è°ƒåº¦æ–¹å¼ï¼šæŠ¢å å¼</h2><h1 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹åŒæ­¥</h1><p>çº¿ç¨‹å®‰å…¨çš„ç»å…¸é—®é¢˜ï¼šé“¶è¡Œå–é’±é—®é¢˜ã€‚ä¸‹é¢ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ¨¡æ‹Ÿä¸¤ä¸ªäººä»ä¸€ä¸ªé“¶è¡Œè´¦æˆ·ä¸­å–é’±ã€‚æ¥ä¸‹æ¥å®šä¹‰ä¸€ä¸ªè´¦æˆ·ç±»</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accountNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Account</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String accountNo, <span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//çœç•¥getterã€setter</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBalance</span><span class="params">(<span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> (Account) o;</span><br><span class="line">        <span class="keyword">return</span> account.accountNo.equals(accountNo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNo.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯å–é’±çº¿ç¨‹ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="comment">//è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="comment">//å–å¾—é’±æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> drawAmount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DrawThread</span><span class="params">(String name, Account account, <span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.account = account;</span><br><span class="line">        <span class="built_in">this</span>.drawAmount = drawAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(account.getBalance() &gt;= drawAmount) &#123;</span><br><span class="line">            System.out.println(getName() + <span class="string">&quot;å–é’±æˆåŠŸï¼Œåå‡ºé’ç¥¨ï¼š&quot;</span> + drawAmount);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            account.setBalance(account.getBalance() - drawAmount);</span><br><span class="line">            System.out.println(<span class="string">&quot;ä½™é¢ä¸ºï¼š&quot;</span>+ account.getBalance());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(getName() + <span class="string">&quot;å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯ä¸»ç¨‹åº</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè´¦æˆ·</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="string">&quot;0001&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿä¸¤ä¸ªçº¿ç¨‹å–é’±</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawThread</span>(<span class="string">&quot;ç”²&quot;</span>, account, <span class="number">800</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawThread</span>(<span class="string">&quot;ä¹™&quot;</span>, account, <span class="number">800</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ<strong>å¯èƒ½</strong>ä¸ºå¦‚ä¸‹ï¼š</p><p><img src="image-20210710000053047.png" alt="çº¿ç¨‹åŒæ­¥ è¿è¡Œç»“æœ"></p><p>è¿™å°±æ¶‰åŠäº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</p><h2 id="åŒæ­¥ä»£ç å—"><a href="#åŒæ­¥ä»£ç å—" class="headerlink" title="åŒæ­¥ä»£ç å—"></a>åŒæ­¥ä»£ç å—</h2><p>ä¹‹æ‰€ä»¥å‡ºç°ä¸Šè¿°ç»“æœï¼Œæ˜¯å› ä¸ºrunæ–¹æ³•çš„æ–¹æ³•ä½“ä¸å…·æœ‰çº¿ç¨‹å®‰å…¨æ€§ï¼Œç¨‹åºæœ‰ä¸¤ä¸ªå¹¶å‘çº¿ç¨‹åœ¨ä¿®æ”¹Accountå¯¹è±¡ã€‚</p><p>ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼ŒJavaçš„å¤šçº¿ç¨‹æ”¯æŒå¼•å…¥äº†åŒæ­¥ç›‘è§†å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨è®©åŒæ­¥ç›‘è§†å™¨çš„é€šç”¨æ–¹æ³•å°±æ˜¯åŒæ­¥ä»£ç å—ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(obj) &#123;</span><br><span class="line">    <span class="comment">//æ­¤å¤„çš„ä»£ç å°±æ˜¯åŒæ­¥ä»£ç å—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š</p><ol><li>ä¸Šè¿°objå°±æ˜¯åŒæ­¥ç›‘è§†å™¨ï¼Œä¸Šé¢ä»£ç çš„å«ä¹‰æ˜¯çº¿ç¨‹å¼€å§‹æ‰§è¡ŒåŒæ­¥ä»£ç å—ä¹‹å‰å¿…é¡»å…ˆè·å¾—å¯¹åŒæ­¥ç›‘è§†å™¨çš„é”å®šã€‚</li><li>ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—å¯¹åŒæ­¥ç›‘è§†å™¨çš„é”å®šï¼Œå½“åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæˆåï¼Œè¯¥çº¿ç¨‹ä¼šé‡Šæ”¾å¯¹åŒæ­¥ç›‘è§†å™¨çš„é”å®šã€‚</li><li>é€šå¸¸æ¨èä½¿ç”¨å¯èƒ½è¢«å¹¶å‘è®¿é—®çš„å…±äº«èµ„æºå……å½“åŒæ­¥ç›‘è§†å™¨ã€‚</li></ol><blockquote><p>synchronizedå±äºç‹¬å å¼çš„æ‚²è§‚é”ï¼ŒåŒæ—¶å±äºå¯é‡å…¥é”ã€‚</p><p>Synchronizedçš„å®ç°åŸç†ï¼šè¯¦è§ã€ŠOfferæ¥äº† åŸç†ç¯‡ã€‹P87</p></blockquote><p>æ ¹æ®ä¸Šè¿°ä¿®æ”¹ä»£ç è€ƒè™‘ä½¿ç”¨Accountä½œä¸ºåŒæ­¥ç›‘è§†å™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="comment">//è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="comment">//å–å¾—é’±æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> drawAmount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DrawThread</span><span class="params">(String name, Account account, <span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.account = account;</span><br><span class="line">        <span class="built_in">this</span>.drawAmount = drawAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŒæ­¥ä»£ç å—ï¼šä½¿ç”¨accountä½œä¸ºåŒæ­¥ç›‘è§†å™¨ï¼Œä»»ä½•çº¿ç¨‹è¿›å…¥ä¸‹é¢åŒæ­¥ä»£ç å—ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—å¯¹accountè´¦æˆ·çš„é”å®šï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”ä¹Ÿå°±æ— æ³•ä¿®æ”¹å®ƒï¼Œè¿™ç§åšæ³•ç¬¦åˆâ€œåŠ é”ï¼Œä¿®æ”¹ï¼Œé‡Šæ”¾é”â€çš„é€»è¾‘</span></span><br><span class="line">        <span class="keyword">synchronized</span> (account) &#123;</span><br><span class="line">            <span class="keyword">if</span>(account.getBalance() &gt;= drawAmount) &#123;</span><br><span class="line">                System.out.println(getName() + <span class="string">&quot;å–é’±æˆåŠŸï¼Œåå‡ºé’ç¥¨ï¼š&quot;</span> + drawAmount);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                account.setBalance(account.getBalance() - drawAmount);</span><br><span class="line">                System.out.println(<span class="string">&quot;ä½™é¢ä¸ºï¼š&quot;</span>+ account.getBalance());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(getName() + <span class="string">&quot;å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥ä¿è¯å¹¶å‘çº¿ç¨‹åœ¨ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥ä¿®æ”¹å…±äº«èµ„æºçš„ä»£ç åŒºï¼ˆä¹Ÿè¢«ç§°ä¸ºä¸´ç•ŒåŒºï¼‰ï¼Œæ‰€ä»¥åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºä¸´ç•ŒåŒºå†…ï¼Œä»è€Œä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><h2 id="åŒæ­¥æ–¹æ³•"><a href="#åŒæ­¥æ–¹æ³•" class="headerlink" title="åŒæ­¥æ–¹æ³•"></a>åŒæ­¥æ–¹æ³•</h2><p>åŒæ­¥æ–¹æ³•å°±æ˜¯ä½¿ç”¨synchronizedå…³é”®å­—æ¥ä¿®é¥°æŸä¸ªæ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•ç§°ä¸ºåŒæ­¥æ–¹æ³•ï¼Œå¯¹äºsynchronizedä¿®é¥°çš„å®ä¾‹æ–¹æ³•ï¼ˆè€Œéé™æ€æ–¹æ³•ï¼‰ï¼Œæ— éœ€æ˜¾å¼æŒ‡å®šåŒæ­¥ç›‘è§†å™¨ï¼ŒåŒæ­¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨æ˜¯thisï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ã€‚</p><p>ä¸‹é¢å°†Accountçš„balanceçš„è®¿é—®è®¾ç½®æˆçº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆåªè¦æŠŠä¿®æ”¹balanceçš„æ–¹æ³•ç¼–ç¨‹åŒæ­¥æ–¹æ³•å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accountNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Account</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String accountNo, <span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getterã€setter</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccountNo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public void setBalance(double balance) &#123;</span></span><br><span class="line"><span class="comment">//        this.balance = balance;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è´¦æˆ·ä½™é¢ä¸å…è®¸ä¿®æ”¹ï¼Œæ‰€ä»¥åªä¸ºbalanceæä¾›getteræ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">//æä¾›ä¸€çº¿ç¨‹å®‰å…¨çš„drawæ–¹æ³•æ¥å®Œæˆå–é’±æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(balance &gt;= drawAmount) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å–é’±æˆåŠŸï¼åå‡ºé’ç¥¨ï¼š&quot;</span>+drawAmount);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            balance -= drawAmount;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä½™é¢ä¸ºï¼š&quot;</span>+ balance);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çœç•¥equalså’ŒhashCodeæ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºAccountæä¾›äº†drawæ–¹æ³•ï¼Œè€Œä¸”å–æ¶ˆäº†setBalanceæ–¹æ³•ï¼ŒDrawThreadçš„runæ–¹æ³•éœ€è¦æ”¹å†™ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    account.draw(drawAmount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š</p><ol><li>synchronizedå…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»£ç å—ä½†æ˜¯å¸ƒæ©é‚£ä¸ªä¿®é¥°æ„é€ å™¨ã€æˆå‘˜å˜é‡ç­‰ã€‚</li><li>ç»è¿‡ä¸Šè¿°ä¿®æ”¹ï¼ŒDrawThreadç±»æ— éœ€è‡ªå·±å®ç°å–é’±æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨accountçš„drawæ–¹æ³•ã€‚ç”±äºdrawæ–¹æ³•ä½¿ç”¨äº†synchronizedä¿®é¥°ï¼ŒåŒæ­¥æ–¹æ³•çš„ç›‘è§†å™¨æ˜¯thisã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ç§ï¼Œthisæ˜¯accountï¼Œå› æ­¤å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®åŒä¸€ä»½accountä¹‹å‰å¿…é¡»å…ˆå¯¹accountåŠ é”ã€‚è¿™å°±ä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚</li><li>åœ¨Accounté‡Œå®šä¹‰drawæ–¹æ³•ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨runæ–¹æ³•ç§å®ç°å–é’±é€»è¾‘ï¼Œè¿™ç§åšæ³•æ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„è§„åˆ™ã€‚åœ¨é¢å‘å¯¹è±¡é‡Œæœ‰ä¸€ç§æµè¡Œçš„è®¾è®¡ï¼šDomain Driven Designï¼ˆ<strong>é¢†åŸŸé©±åŠ¨è®¾è®¡</strong>ï¼ŒDDDï¼‰ï¼Œè¿™ç§æ–¹å¼è®¤ä¸ºæ¯ä¸ªç±»éƒ½åº”è¯¥æ˜¯å®Œå¤‡çš„é¢†åŸŸå¯¹è±¡ï¼Œä¾‹å¦‚è´¦æˆ·ç±»åº”è¯¥æä¾›è´¦æˆ·çš„ç›¸å…³æ–¹æ³•ã€‚</li><li>ä¸ºäº†å‡å°‘çº¿ç¨‹å®‰å…¨å¸¦æ¥çš„é™ä½ç¨‹åºè¿è¡Œæ•ˆç‡çš„å½±å“åº”è¯¥ï¼šä¸è¦å¯¹çº¿ç¨‹å®‰å…¨ç±»çš„æ‰€æœ‰æ–¹æ³•è¿›è¡ŒåŒæ­¥ï¼Œåªå¯¹é‚£äº›æ”¹å˜äº¬åŸèµ„æºçš„æ–¹æ³•è¿›è¡ŒåŒï¼›å¦‚æœå¯å˜ç±»æœ‰ä¸¤ç§è¿è¡Œç¯å¢ƒï¼šå•çº¿ç¨‹è¿è¡Œç¯å¢ƒå’Œå¤šçº¿ç¨‹è¿è¡Œç¯å¢ƒï¼Œåˆ™åº”è¯¥ä¸ºå¯å˜ç±»æä¾›ä¸¤ç§ç‰ˆæœ¬ã€‚</li></ol><h2 id="é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨çš„é”å®š"><a href="#é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨çš„é”å®š" class="headerlink" title="é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨çš„é”å®š"></a>é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨çš„é”å®š</h2><p>ç¨‹åºæ— æ³•æ˜¾å¼é‡Šæ”¾å¯¹åŒæ­¥ç›‘è§†å™¨çš„é”å®šï¼Œçº¿ç¨‹ä¼šåœ¨å¦‚ä¸‹å‡ ç§æƒ…å†µä¸‹é‡Šæ”¾å¯¹åŒæ­¥ç›‘è§†å™¨çš„é”å®šã€‚</p><ul><li>å½“å‰çº¿ç¨‹çš„åŒæ­¥æ–¹æ³•ã€åŒæ­¥ä»£ç å—æ‰§è¡Œç»“æŸã€‚</li><li>å½“å‰çº¿ç¨‹åœ¨åŒæ­¥ä»£ç å—ï¼ŒåŒæ­¥æ–¹æ³•ä¸­é‡åˆ°äº†breakã€returnç»ˆæ­¢äº†è¯¥ä»£ç å—ã€è¯¥æ–¹æ³•çš„ç»§ç»­æ‰§è¡Œã€‚</li><li>å½“å‰çº¿ç¨‹åœ¨åŒæ­¥ä»£ç å—ï¼ŒåŒæ­¥æ–¹æ³•ä¸­é‡åˆ°äº†æœªå¤„ç†çš„Erroræˆ–Exception</li><li>ç¨‹åºæ‰§è¡Œäº†åŒæ­¥ç›‘è§†å™¨å¯¹è±¡çš„waitæ–¹æ³•ï¼Œåˆ™å½“å‰çº¿ç¨‹æš‚åœï¼Œå¹¶é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚</li></ul><p>åœ¨å¦‚ä¸‹æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚</p><ul><li>ç¨‹åºè°ƒç”¨äº†Thread.sleepã€Thread.yieldæ–¹æ³•æ¥æš‚åœå½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œ</li><li>å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥çº¿ç¨‹çš„suspendæ–¹æ³•å°†çº¿ç¨‹æŒ‚èµ·ã€‚</li></ul><h2 id="åŒæ­¥é”"><a href="#åŒæ­¥é”" class="headerlink" title="åŒæ­¥é”"></a>åŒæ­¥é”</h2><p>Lockæä¾›äº†æ¯”synchronizedæ–¹æ³•å’Œsynchronizedä»£ç å—æ›´å¹¿æ³›æ›´çµæ´»çš„æ“ä½œã€‚</p><p>Lockæ˜¯æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„å·¥å…·ï¼Œé€šå¸¸ï¼Œé”æä¾›äº†å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹Lockå¯¹è±¡åŠ é”ï¼Œçº¿ç¨‹å¼€å§‹è®¿é—®å…±äº«èµ„æºä¹‹å‰åº”å…ˆè·å¾—Lockå¯¹è±¡ã€‚</p><p>Lockæ¥å£çš„ä¸»è¦æ–¹æ³•ï¼š</p><ul><li><code>void lock();</code> åŠ é”</li><li><code>void lockInterruptibly()</code> å½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­åˆ™è·å–è¯¥é”ã€‚</li><li><code>boolean tryLock();</code>è¯•å›¾åŠ é”ï¼Œä½†ä¸ä¼šé˜»å¡</li><li><code>boolean tryLock(long time, TimeUnit unit)</code> åˆ›å»ºå®šæ—¶é”</li><li><code>void unlock();</code> é‡Šæ”¾é”</li><li><code>Condition newCondition();</code> åˆ›å»ºæ¡ä»¶å¯¹è±¡ï¼Œè·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶ã€‚</li></ul><p>Lockã€ReadWriteLockæ˜¯J5æä¾›çš„ä¸¤ä¸ªæ ¹æ¥å£ï¼Œå¹¶ä¸ºLockæä¾›äº†ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰ã€å¸¸ç”¨ã€‘å®ç°ç±»ï¼Œä¸ºReadWriteLockæä¾›äº†ReentrantReadWriteLockå®ç°ç±»ã€‚</p><p>J8æ–°å¢äº†StampedLockç±»ï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„ReentrantReadWriteLockã€‚ReentrantReadWriteLockä¸ºè¯»å†™æ“ä½œæä¾›äº†ä¸‰ç§é”æ¨¡å¼ï¼šWritingã€ReadingOptimisticã€Reading</p><p>é€šå¸¸ä½¿ç”¨ReentrantLockçš„ä»£ç æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">X</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">//å®šä¹‰éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„ä»£ç </span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ReentrantLockæ˜¯ä¸€ä¸ªå¯é‡å…¥çš„ç‹¬å é”ã€‚é€šè¿‡AQSæ¥å®ç°é”çš„è·å–å’Œé‡Šæ”¾ã€‚</p><p>ReentrantLockä¸ä½†æä¾›äº†Synchronizedå¯¹é”çš„æ“ä½œåŠŸèƒ½ã€‚è¿˜æä¾›äº†è¯¸å¦‚å¯å“åº”ä¸­æ–­é”ã€å¯è½®è¯¢é”è¯·æ±‚ï¼Œå®šæ—¶é”ç­‰é¿å…å¤šçº¿ç¨‹æ­»é”çš„æ–¹æ³•ã€‚</p></blockquote><p>æ ¹æ®Lockçš„ä½¿ç”¨ä¿®æ”¹Accountçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accountNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Account</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String accountNo, <span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getterã€setter</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccountNo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public void setBalance(double balance) &#123;</span></span><br><span class="line"><span class="comment">//        this.balance = balance;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è´¦æˆ·ä½™é¢ä¸å…è®¸ä¿®æ”¹ï¼Œæ‰€ä»¥åªä¸ºbalanceæä¾›getteræ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">//æä¾›ä¸€çº¿ç¨‹å®‰å…¨çš„drawæ–¹æ³•æ¥å®Œæˆå–é’±æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        lock.lock(); <span class="comment">//åŠ é”</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(balance &gt;= drawAmount) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å–é’±æˆåŠŸï¼åå‡ºé’ç¥¨ï¼š&quot;</span>+drawAmount);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                balance -= drawAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;ä½™é¢ä¸ºï¼š&quot;</span>+ balance);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock(); <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çœç•¥hashCodeã€equals</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Lockä¸ä½¿ç”¨åŒæ­¥æ–¹æ³•æœ‰ç‚¹ç›¸ä¼¼ï¼Œåªæ˜¯ä½¿ç”¨Lockæ—¶æ˜¾å¼ä½¿ç”¨Lockå¯¹è±¡ä½œä¸ºåŒæ­¥é”ï¼Œè€Œä½¿ç”¨åŒæ­¥æ–¹æ³•æ—¶ç³»ç»Ÿéšå¼ä½¿ç”¨å½“å‰å¯¹è±¡ä½œä¸ºåŒæ­¥ç›‘è§†å™¨ã€‚</p><p>åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä½¿ç”¨ç«äº‰èµ„æºç›¸å…³çš„ã€éšå¼çš„åŒæ­¥ç›‘è§†å™¨ï¼Œå¹¶ä¸”å¼ºåˆ¶è¦æ±‚åŠ é”å’Œé‡Šæ”¾é”è¦å‡ºç°åœ¨ä¸€ä¸ªå—ç»“æ„ä¸­ã€‚å¹¶ä¸”è·å–äº†å¤šä¸ªé”æ—¶ï¼Œä»–ä»¬å¿…é¡»ä»¥ç›¸åçš„é¡ºåºé‡Šæ”¾ã€‚æ‰€ä»¥åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—çš„èŒƒå›´æœºåˆ¶ä½¿å¾—å¤šçº¿ç¨‹å®‰å…¨ç¼–ç¨‹éå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥é¿å…å¾ˆå¤šé”çš„å¸¸è§ç¼–ç¨‹é”™è¯¯ã€‚</p><p>Lockæä¾›äº†åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—æ‰€æ²¡æœ‰çš„å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬tryLockæ–¹æ³•ï¼Œä»¥åŠè¯•å›¾è·å–å¯ä¸­æ–­é”çš„lockInterruptiblyæ–¹æ³•ï¼Œè¿˜å¯ä»¥è·å–è¶…æ—¶å¤±æ•ˆé”çš„tryLock(long, TimeUnit)æ–¹æ³•</p><p>ReentrantLocké”å…·æœ‰å¯é‡å…¥æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹å·²åŠ é”çš„ReentrantLocké”å†æ¬¡åŠ é”ï¼ŒReentrantLockå¯¹è±¡ä¼šç»´æŒä¸€ä¸ªè®¡æ•°å™¨æ¥è¿½è¸ªlockæ–¹æ³•çš„åµŒå¥—è°ƒç”¨ï¼Œçº¿ç¨‹åœ¨æ¯æ¬¡è°ƒç”¨lockåŠ é”åï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨unlockæ¥é‡Šæ”¾é”ï¼Œæ‰€ä»¥ä¸€æ®µè¢«æ‰€ä¿æŠ¤çš„ä»£ç å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªè¢«ç›¸åŒé”ä¿æŠ¤çš„æ–¹æ³•ã€‚</p><h2 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h2><p>ç¼–å†™ç¨‹åºæ—¶åº”å°½é‡é¿å…æ­»é”ã€‚</p><ul><li>é¿å…å¤šæ¬¡é”å®šï¼šå°½é‡é¿å…åŒä¸€ä¸ªçº¿ç¨‹å¯¹å¤šä¸ªåŒæ­¥ç›‘è§†å™¨è¿›è¡Œé”å®š</li><li>å…·æœ‰ç›¸åŒçš„åŠ é”é¡ºåºï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦å¯¹å¤šä¸ªåŒæ­¥ç›‘è§†å™¨è¿›è¡Œé”å®šï¼Œåˆ™åº”è¯¥ä¿è¯ä»–ä»¬ä»¥ç›¸åŒçš„é¡ºåºè¯·æ±‚åŠ é”ã€‚</li><li>ä½¿ç”¨å®šæ—¶é”ï¼šè®¾ç½®é”çš„è¶…æ—¶æ—¶é—´ã€‚</li><li>ä¾é ç®—æ³•è¿›è¡Œæ­»é”æ£€æµ‹ã€‚</li></ul><h1 id="Javaé”è¯¦è§£"><a href="#Javaé”è¯¦è§£" class="headerlink" title="Javaé”è¯¦è§£"></a>Javaé”è¯¦è§£</h1><p>Javaä¸­çš„é”ä¸»è¦ä¿éšœå¤šå¹¶å‘çº¿ç¨‹æƒ…å†µä¸‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>é”ä»ä¹è§‚å’Œæ‚²è§‚çš„è§’åº¦å¯åˆ†ä¸ºä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œä»è·å–èµ„æºçš„å…¬å¹³æ€§è§’åº¦å¯åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä»æ˜¯å¦å…±äº«èµ„æºçš„è§’åº¦å¯åˆ†ä¸ºå…±äº«é”å’Œç‹¬å é”ï¼Œä»é”çš„çŠ¶æ€å¯åˆ†ä¸ºåå‘é”ï¼Œè½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚æ­¤å¤–JVMè¿˜è®¾è®¡äº†è‡ªæ—‹é”æ¥æ›´å¿«çš„ä½¿ç”¨CPUã€‚</p><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p>ä¹è§‚é”ï¼Œåœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†åœ¨æ›´æ–°æ—¶ä¼šåˆ¤æ–­åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰æ›´æ–°è¯¥æ•°æ®ï¼Œé€šå¸¸åœ¨å†™æ—¶å…ˆè¯»å‡ºå½“å‰ç‰ˆæœ¬å·ç„¶ååŠ é”çš„æ–¹æ³•ã€‚å…·ä½“è¿‡ç¨‹æ˜¯ï¼Œæ¯”è¾ƒå½“å‰ç‰ˆæœ¬å·å’Œä¸Šä¸€ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸€è‡´ï¼Œåˆ™æ›´æ–°ï¼Œå¦åˆ™é‡å¤è¿›è¡Œè¯»ã€æ¯”è¾ƒã€å†™æ“ä½œã€‚</p><p>Javaä¸­çš„ä¹è§‚é”å¤§éƒ¨åˆ†æ˜¯é€šè¿‡CASç®—æ³•å®ç°çš„ã€‚</p><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>æ‚²è§‚é”ï¼Œåœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è¯»å†™æ•°æ®éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººåƒè¯»å†™è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ã€ç­‰å¾…ç›´åˆ°æ‹¿åˆ°é”ã€‚</p><p>Javaä¸­çš„æ‚²è§‚é”å¤§éƒ¨åˆ†æ˜¯é€šè¿‡AQSæ¶æ„å®ç°çš„ã€‚è®¸å¤šåŒæ­¥ç±»çš„å®ç°éƒ½ä¾èµ–äºå®ƒï¼Œä¾‹å¦‚Synchronizedã€ReentrantLockã€Semaphoreã€CountDownLatchã€‚è¯¥æ¡†æ¶ä¸‹çš„é”å…ˆå°è¯•ä»¥ä¹è§‚é”å»è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™ä¼šè½¬ä¸ºæ‚²è§‚é”ã€‚</p><h2 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h2><p>è‡ªæ—‹é”è®¤ä¸ºï¼Œå¦‚æœæŒæœ‰é”çš„çº¿ç¨‹èƒ½å¤Ÿåœ¨å¾ˆçŸ­æ—¶é—´å†…é‡Šæ”¾é”ï¼Œé‚£ä¹ˆç­‰å¾…ç«äº‰çš„é”çº¿ç¨‹ä¸éœ€è¦é˜»å¡ã€æŒ‚èµ·çŠ¶æ€åˆ‡æ¢ï¼Œåªéœ€è¦ç­‰ä¸€ç­‰ï¼ˆå†…æ—‹ï¼‰ï¼Œåœ¨æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åå³å¯ç«‹å³è·å¾—é”ï¼Œè¿™æ ·å‡å°‘äº†æ—¶é—´æŸè€—ã€‚</p><p>çº¿ç¨‹è‡ªé€‰æ—¶ä¼šå ç”¨CPUï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ªè‡ªé€‰ç­‰å¾…çš„æœ€å¤§æ—¶é—´ã€‚</p><p>è‡ªæ—‹é”çš„ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šå‡å°‘äº†CPUä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œå¯¹äºå ç”¨é”çš„æ—¶é—´éå¸¸çŸ­æˆ–é”ç«äº‰ä¸æ¿€çƒˆçš„ä»£ç å—æ¥è¯´ï¼Œæ€§èƒ½å¤§å¹…æå‡ã€‚</li><li>ç¼ºç‚¹ï¼šçº¿ç¨‹å¦‚æœåœ¨è‡ªæ—‹è¿‡ç¨‹ä¸­é•¿æ—¶é—´è·å–ä¸åˆ°é”èµ„æºï¼Œå°†ä¼šå¼•èµ·CPUçš„æµªè´¹ã€‚</li></ul><h2 id="å¯é‡å…¥é”"><a href="#å¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”"></a>å¯é‡å…¥é”</h2><p>å¯é‡å…¥é”æ˜¯æŒ‡è¯¥é”æ”¯æŒä¸€ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªèµ„æºå¤šæ¬¡åŠ é”ã€‚Synchronizedã€ReentrantLockéƒ½æ˜¯å¯é‡å…¥é”ã€‚</p><h2 id="å…±äº«é”"><a href="#å…±äº«é”" class="headerlink" title="å…±äº«é”"></a>å…±äº«é”</h2><p>å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–è¯¥é”ï¼Œå¹¶å‘è®¿é—®å…±äº«èµ„æºã€‚ReentrantReadWriteLockä¸­çš„è¯»é”ä¸ºå…±äº«é”çš„å®ç°ã€‚</p><p>å…±äº«é”é‡‡ç”¨äº†ä¹è§‚çš„åŠ é”ç­–ç•¥ï¼Œå…è®¸å¤šä¸ªæ‰§è¡Œè¯»æ“ä½œçš„çº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºã€‚</p><h2 id="ç‹¬å é”"><a href="#ç‹¬å é”" class="headerlink" title="ç‹¬å é”"></a>ç‹¬å é”</h2><p>ä¹Ÿå«äº’æ–¥é”ã€‚æ¯æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯¥é”ã€‚ReentrantLockä¸ºç‹¬å é”çš„å®ç°ã€‚</p><p>ç‹¬å é”æ˜¯ä¸€ç§æ‚²è§‚çš„åŠ é”ç­–ç•¥ã€‚åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªè¯»çº¿ç¨‹è¯»å–é”èµ„æºï¼Œé™åˆ¶äº†è¯»æ“ä½œçš„å¹¶å‘æ€§ã€‚</p><h2 id="é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”"><a href="#é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”" class="headerlink" title="é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”"></a>é‡é‡çº§é”ã€è½»é‡çº§é”å’Œåå‘é”</h2><p>ä»¥åå†è¯´ã€‚</p><h2 id="å…¬å¹³é”å’Œéå…¬å¹³é”"><a href="#å…¬å¹³é”å’Œéå…¬å¹³é”" class="headerlink" title="å…¬å¹³é”å’Œéå…¬å¹³é”"></a>å…¬å¹³é”å’Œéå…¬å¹³é”</h2><ul><li>å…¬å¹³é”æŒ‡å†åˆ†é…é”ä¹‹å‰æ£€æŸ¥æ˜¯å¦æœ‰çº¿ç¨‹åœ¨æ’é˜Ÿç­‰å¾…è·å–é”ï¼Œä¼˜å…ˆå°†é”åˆ†é…ç»™æ’é˜Ÿæ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚</li><li>éå…¬å¹³é”æŒ‡åœ¨åˆ†é…é”æ—¶ä¸è€ƒè™‘çº¿ç¨‹æ’é˜Ÿçš„æƒ…å†µï¼Œç›´æ¥å°è¯•è·å–é”ï¼Œåœ¨è·å–ä¸åˆ°é”æ—¶åœ¨æ’åˆ°é˜Ÿå°¾ç­‰å¾…ã€‚</li></ul><p>å…¬å¹³é”éœ€è¦åœ¨å¤šæ ¸çš„æƒ…å†µä¸‹ç»´æŠ¤ä¸€ä¸ªé”çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ŒåŸºäºè¯¥é˜Ÿåˆ—è¿›è¡Œé”çš„åˆ†é…ï¼Œå› æ­¤æ•ˆç‡æ¯”éå…¬å¹³é”ä½å¾ˆå¤šã€‚</p><p>Javaä¸­çš„Synchronizedã€ReentrantLocké»˜è®¤lockæ–¹æ³•éƒ½æ˜¯éå…¬å¹³é”ã€‚</p><h2 id="è¯»å†™é”ï¼šReadWriteLock"><a href="#è¯»å†™é”ï¼šReadWriteLock" class="headerlink" title="è¯»å†™é”ï¼šReadWriteLock"></a>è¯»å†™é”ï¼šReadWriteLock</h2><p>Lockæ¥å£åŠå¯¹è±¡åŠ çš„é”æ˜¯æ™®é€šé”ï¼Œè¿™ç§é”ä¸åŒºåˆ†è¯»å†™ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒJavaæä¾›äº†è¯»å†™é”ã€‚</p><p>è¯»å†™é”åˆ†ä¸ºè¯»é”å’Œå†™é”ã€‚å¤šä¸ªè¯»é”ä¸äº’æ–¥ï¼Œè¯»é”å’Œå†™é”äº’æ–¥ã€‚åœ¨æ²¡æœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œè¯»æ˜¯æ— é˜»å¡çš„ã€‚</p><p>ä¸€èˆ¬åšæ³•æ˜¯åˆ†åˆ«å®šä¹‰ä¸€ä¸ªè¯»é”å’Œå†™é”ã€‚åœ¨Javaä¸­ä½¿ç”¨ReentrantReadWriteLockæ¥å®Œæˆå¯¹è¯»å†™é”çš„å®šä¹‰å’Œä½¿ç”¨ã€‚</p><h2 id="åˆ†æ®µé”"><a href="#åˆ†æ®µé”" class="headerlink" title="åˆ†æ®µé”"></a>åˆ†æ®µé”</h2><p>åˆ†æ®µé”æ˜¯ä¸€ç§æ€æƒ³ã€‚ç”¨äºå°†æ•°æ®åˆ†æ®µå¹¶åœ¨æ¯ä¸ªåˆ†æ®µä¸Šéƒ½å•ç‹¬åŠ é”ï¼ŒæŠŠé”è¿›ä¸€æ­¥ç»†ç²’åº¦åŒ–ï¼Œä»¥æé«˜å¹¶å‘æ•ˆç‡ã€‚ä¾‹å¦‚ï¼šConcurrentHashMap</p><h2 id="é”ä¼˜åŒ–"><a href="#é”ä¼˜åŒ–" class="headerlink" title="é”ä¼˜åŒ–"></a>é”ä¼˜åŒ–</h2><ul><li>å‡å°‘é”çš„æŒæœ‰æ—¶é—´</li><li>å‡å°‘é”ç²’åº¦</li><li>é”åˆ†ç¦»</li><li>é”ç²—åŒ–</li><li>é”æ¶ˆé™¤</li></ul><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><p>ä¸å†èµ˜è¿°ã€‚</p><h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><p>ä¸å†èµ˜è¿°ã€‚</p><h2 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h2><p>ä»¥åå†è¯´</p><h2 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h2><p>ä»¥åå†è¯´</p><h1 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h1><p>é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¥å­¦ä¹ çº¿ç¨‹é€šä¿¡éƒ¨åˆ†çš„çŸ¥è¯†ã€‚</p><p>å‡è®¾ç³»ç»Ÿæœ‰ä¸€ä¸ªç‰¹æ®Šçš„éœ€æ±‚ï¼šç³»ç»Ÿè¦æ±‚å­˜æ¬¾è€…å’Œå–æ¬¾è€…ä¸æ–­é‡å¤åœ°å­˜æ¬¾å–æ¬¾ï¼Œè€Œä¸”è¦æ±‚æ¯å½“å­˜æ¬¾è€…å°†é’±å­˜å…¥è´¦æˆ·ï¼Œå–æ¬¾è€…å°±ç«‹åˆ»å»é™¤è¿™ç¬”é’±ï¼Œä¸å…è®¸è¿ç»­ä¸¤æ¬¡å­˜é’±ï¼Œä¹Ÿä¸å…è®¸è¿ç»­ä¸¤æ¬¡å–é’±ã€‚</p><h2 id="ä¼ ç»Ÿçš„çº¿ç¨‹é€šä¿¡"><a href="#ä¼ ç»Ÿçš„çº¿ç¨‹é€šä¿¡" class="headerlink" title="ä¼ ç»Ÿçš„çº¿ç¨‹é€šä¿¡"></a>ä¼ ç»Ÿçš„çº¿ç¨‹é€šä¿¡</h2><p>ä¸ºäº†å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œå¯ä»¥å€ŸåŠ©Objectç±»æä¾›çš„waitã€notifyã€notifyAllæ–¹æ³•ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•ä¸å±äºThreadï¼Œä½†æ˜¯è¿™ä¸‰ä¸ªæ–¹æ³•å¿…é¡»ç”±åŒæ­¥ç›‘è§†å™¨å¯¹è±¡æ¥è°ƒç”¨ã€‚</p><ul><li>å¯¹äºsynchronizedä¿®é¥°çš„åŒæ­¥æ–¹æ³•ï¼Œthiså°±æ˜¯åŒæ­¥ç›‘è§†å™¨å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨åŒæ­¥æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</li><li>å¯¹äºsynchronizedä¿®é¥°çš„åŒæ­¥ä»£ç å—ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯synchronizedåæ‹¬å·é‡Œçš„å¯¹è±¡ï¼Œå¿…é¡»ä½¿ç”¨è¯¥å¯¹è±¡è°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</li></ul><p>ä¸‹é¢ä»‹ç»è¿™ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li>waitï¼šå¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨è¯¥åŒæ­¥ç›‘è§†å™¨çš„notifyæˆ–notifyAllæ¥å”¤é†’è¯¥çº¿ç¨‹ã€‚æ— å‚æ•°çš„waitæ–¹æ³•ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¸¦æ—¶é—´å‚æ•°çš„waitæ–¹æ³•çº¿ç¨‹ä¼šåœ¨æŒ‡å®šæ—¶é—´åè‡ªåŠ¨è‹é†’ã€‚</li><li>notifyï¼šå”¤é†’åœ¨æ­¤åŒæ­¥ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚å”¤é†’æ˜¯ä»»æ„çš„ã€‚åªæœ‰å½“å‰çº¿ç¨‹æ”¾å¼ƒå¯¹è¯¥åŒæ­¥ç›‘è§†å™¨çš„é”å®šåï¼Œæ‰å¯ä»¥æ‰§è¡Œè¢«å”¤é†’çš„çº¿ç¨‹ã€‚</li><li>notifyAllï¼šå”¤é†’åœ¨æ­¤åŒæ­¥ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</li></ul><p>æœ¬ç¨‹åºä¸ºAccountç±»æä¾›äº†drawæ–¹æ³•å’Œdepositæ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”è´¦æˆ·çš„å–é’±å’Œå­˜é’±æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accountNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance; <span class="comment">//è´¦æˆ·ä½™é¢</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">//æ˜¯å¦å·²æœ‰å­˜æ¬¾</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Account</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String accountNo, <span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getterã€setter</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccountNo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public void setBalance(double balance) &#123;</span></span><br><span class="line"><span class="comment">//        this.balance = balance;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è´¦æˆ·ä½™é¢ä¸å…è®¸ä¿®æ”¹ï¼Œæ‰€ä»¥åªä¸ºbalanceæä¾›getteræ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">//æä¾›ä¸€çº¿ç¨‹å®‰å…¨çš„drawæ–¹æ³•æ¥å®Œæˆå–é’±æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!flag) &#123; <span class="comment">//æ— å­˜æ¬¾ï¼Œåˆ™å–é’±çº¿ç¨‹é˜»å¡</span></span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å–é’±ï¼š&quot;</span> + drawAmount);</span><br><span class="line">                balance -= drawAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;è´¦æˆ·ä½™é¢ï¼š&quot;</span>+ balance);</span><br><span class="line">                flag = <span class="literal">false</span>; <span class="comment">//å­˜æ¬¾æ ‡å¿—è®¾ç½®ä¸ºfalse</span></span><br><span class="line">                notifyAll(); <span class="comment">//å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">deposit</span><span class="params">(<span class="type">double</span> depositAmount)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(flag) &#123; <span class="comment">//æœ‰å­˜æ¬¾ï¼Œåˆ™å­˜æ¬¾çº¿ç¨‹é˜»å¡</span></span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å­˜æ¬¾ï¼š&quot;</span> + depositAmount);</span><br><span class="line">                balance += depositAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;è´¦æˆ·ä½™é¢ï¼š&quot;</span>+ balance);</span><br><span class="line">                flag = <span class="literal">true</span>; <span class="comment">//å­˜æ¬¾æ ‡å¿—è®¾ç½®ä¸ºfalse</span></span><br><span class="line">                notifyAll(); <span class="comment">//å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çœç•¥hashCodeã€equals</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯å–æ¬¾è€…å’Œå­˜æ¬¾è€…çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å–æ¬¾çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="comment">//è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="comment">//å–å¾—é’±æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> drawAmount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DrawThread</span><span class="params">(String name, Account account, <span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.account = account;</span><br><span class="line">        <span class="built_in">this</span>.drawAmount = drawAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            account.draw(drawAmount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å­˜æ¬¾çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepositThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="comment">//è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="comment">//å–å¾—é’±æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> depositAmount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DepositThread</span><span class="params">(String name, Account account, <span class="type">double</span> depositAmount)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.account = account;</span><br><span class="line">        <span class="built_in">this</span>.depositAmount = depositAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            account.deposit(depositAmount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯ä¸»ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªè´¦æˆ·</span></span><br><span class="line">    <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="string">&quot;0001&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªå–æ¬¾çº¿ç¨‹ï¼Œä¸¤ä¸ªå­˜æ¬¾çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">DrawThread</span>(<span class="string">&quot;å–æ¬¾è€…&quot;</span>, account, <span class="number">800</span>).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">DepositThread</span>(<span class="string">&quot;å­˜æ¬¾è€…1&quot;</span>, account, <span class="number">800</span>).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">DepositThread</span>(<span class="string">&quot;å­˜æ¬¾è€…2&quot;</span>, account, <span class="number">800</span>).start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»ç¨‹åºè®¾ç½®äº†ä¸€ä¸ªå–æ¬¾è€…å’Œä¸¤ä¸ªå­˜æ¬¾è€…ï¼Œæœ€åçº¿ç¨‹ä¼šé˜»å¡è¿™æ˜¯å› ä¸ºä¸¤ä¸ªå­˜æ¬¾è€…ä¼šæœ‰200æ¬¡å­˜æ¬¾æ“ä½œï¼Œè€Œä¸€ä¸ªå–æ¬¾è€…åªæœ‰100æ¬¡å–æ¬¾æ“ä½œã€‚è¿è¡Œç¨‹åºå¯ä»¥å‘ç°ï¼Œå­˜å–æ¬¾çº¿ç¨‹äº¤æ›¿æ‰§è¡Œã€‚</p><h2 id="ä½¿ç”¨Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡"><a href="#ä½¿ç”¨Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡" class="headerlink" title="ä½¿ç”¨Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡"></a>ä½¿ç”¨Conditionæ§åˆ¶çº¿ç¨‹é€šä¿¡</h2><p>å¦‚æœç¨‹åºä¸ä½¿ç”¨synchronizedå…³é”®å­—æ¥ä¿è¯åŒæ­¥ï¼Œè€Œæ˜¯ä½¿ç”¨Lockå¯¹è±¡æ¥ä¿è¯åŒæ­¥ï¼Œåˆ™ç³»ç»Ÿä¸­ä¸å­˜åœ¨éšå¼çš„åŒæ­¥ç›‘è§†å™¨ï¼Œä¹Ÿå°±ä¸èƒ½ä½¿ç”¨waitã€notifyã€notifyAllæ–¹æ³•è¿›è¡Œé€šä¿¡äº†ã€‚</p><p>å½“ä½¿ç”¨Lockå¯¹è±¡æ¥ä¿è¯åŒæ­¥æ—¶ï¼ŒJavaæä¾›äº†ä¸€ä¸ªConditionç±»æ¥ä¿æŒåè°ƒï¼Œä½¿ç”¨Conditionå¯ä»¥è®©é‚£äº›å·²ç»å¾—åˆ°Lockå¯¹è±¡å´æ— æ³•ç»§ç»­æ‰§è¡Œçš„çº¿ç¨‹é‡Šæ”¾Lockå¯¹è±¡ï¼ŒConditionå¯¹è±¡ä¹Ÿå¯ä»¥å”¤é†’å…¶ä»–å¤„äºç­‰å¾…çš„çº¿ç¨‹ã€‚</p><p>Conditionå®ä¾‹è¢«ç»‘å®šåœ¨ä¸€ä¸ªLockå¯¹è±¡ä¸Šã€‚è¦è·å¾—Lockå®ä¾‹çš„Conditionå®ä¾‹ï¼Œéœ€è¦è°ƒç”¨Lockéƒ½è¥¿æ˜‚çš„newConditionæ–¹æ³•ã€‚Conditionæä¾›äº†å¦‚ä¸‹ä¸‰ä¸ªæ–¹æ³•</p><ul><li>awaitï¼šç±»ä¼¼äºwaitæ–¹æ³•ï¼Œå¯¼è‡´çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨è¯¥Conditionçš„signalã€signalAllæ–¹æ³•æ¥å”¤é†’è¯¥çº¿ç¨‹ã€‚</li><li>signalï¼šå”¤é†’æ­¤Lockå¯¹è±¡ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚åªæœ‰å½“å‰çº¿ç¨‹æ”¾å¼ƒå¯¹è¯¥Lockå¯¹è±¡çš„é”å®šåï¼Œæ‰å¯ä»¥æ‰§è¡Œè¢«å”¤é†’çš„è¿›ç¨‹ã€‚</li><li>signalAllï¼šå”¤é†’æ­¤Lockå¯¹è±¡ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</li></ul><p>æ ¹æ®ä¸Šé¢æ”¹å†™Accountç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(); <span class="comment">//å®šä¹‰Lockå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();<span class="comment">//è·å¾—æŒ‡å®šçš„Condition</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accountNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance; <span class="comment">//è´¦æˆ·ä½™é¢</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">//æ˜¯å¦å·²æœ‰å­˜æ¬¾</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Account</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String accountNo, <span class="type">double</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountNo = accountNo;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getterã€setter</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccountNo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public void setBalance(double balance) &#123;</span></span><br><span class="line"><span class="comment">//        this.balance = balance;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è´¦æˆ·ä½™é¢ä¸å…è®¸ä¿®æ”¹ï¼Œæ‰€ä»¥åªä¸ºbalanceæä¾›getteræ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">//æä¾›ä¸€çº¿ç¨‹å®‰å…¨çš„drawæ–¹æ³•æ¥å®Œæˆå–é’±æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">double</span> drawAmount)</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!flag) &#123; <span class="comment">//æ— å­˜æ¬¾ï¼Œåˆ™å–é’±çº¿ç¨‹é˜»å¡</span></span><br><span class="line">                condition.await();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å–é’±ï¼š&quot;</span> + drawAmount);</span><br><span class="line">                balance -= drawAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;è´¦æˆ·ä½™é¢ï¼š&quot;</span>+ balance);</span><br><span class="line">                flag = <span class="literal">false</span>; <span class="comment">//å­˜æ¬¾æ ‡å¿—è®¾ç½®ä¸ºfalse</span></span><br><span class="line">                condition.signalAll(); <span class="comment">//å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">deposit</span><span class="params">(<span class="type">double</span> depositAmount)</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(flag) &#123; <span class="comment">//æœ‰å­˜æ¬¾ï¼Œåˆ™å­˜æ¬¾çº¿ç¨‹é˜»å¡</span></span><br><span class="line">                condition.await();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å­˜æ¬¾ï¼š&quot;</span> + depositAmount);</span><br><span class="line">                balance += depositAmount;</span><br><span class="line">                System.out.println(<span class="string">&quot;è´¦æˆ·ä½™é¢ï¼š&quot;</span>+ balance);</span><br><span class="line">                flag = <span class="literal">true</span>; <span class="comment">//å­˜æ¬¾æ ‡å¿—è®¾ç½®ä¸ºfalse</span></span><br><span class="line">                condition.signalAll(); <span class="comment">//å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿½ç•¥hashCodeã€equals</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ§åˆ¶çº¿ç¨‹é€šä¿¡"><a href="#ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ§åˆ¶çº¿ç¨‹é€šä¿¡" class="headerlink" title="ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ§åˆ¶çº¿ç¨‹é€šä¿¡"></a>ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ§åˆ¶çº¿ç¨‹é€šä¿¡</h2><p>Java5æä¾›äº†ä¸€ä¸ªBlockingQueueæ¥å£ï¼Œå®ƒä¸»è¦ç”¨ä½œçº¿ç¨‹åŒæ­¥å·¥å…·ï¼Œè€Œéå®¹å™¨ã€‚</p><p>BlockingQueueæœ‰ä¸€ä¸ªç‰¹å¾ï¼šå½“ç”Ÿäº§è€…çº¿ç¨‹è¯•å›¾å‘BlockingQueueä¸­æ”¾å…¥å…ƒç´ æ—¶ï¼Œå¦‚æœè¯¥é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¯¥çº¿ç¨‹è¢«é˜»å¡ã€‚å½“æ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»BlockingQueueå–å‡ºå…ƒç´ æ—¶ï¼Œå¦‚æœè¯¥é˜Ÿåˆ—å·²ç©ºï¼Œåˆ™è¯¥çº¿ç¨‹è¢«é˜»å¡ã€‚</p><p>ç¨‹åºçš„ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡äº¤æ›¿å‘BlockingQueueæ”¾å…¥å–å‡ºå…ƒç´ ï¼Œå³å¯å¾ˆå¥½çš„æ§åˆ¶çº¿ç¨‹çš„é€šä¿¡ã€‚</p><p>BlockingQueueåŒ…å«çš„æ–¹æ³•å¯¹åº”å…³ç³»å¦‚å›¾ï¼š</p><div class="table-container"><table><thead><tr><th></th><th>æŠ›å‡ºå¼‚å¸¸</th><th>è¿”å›boolean</th><th>é˜»å¡çº¿ç¨‹</th><th>æŒ‡å®šè¶…æ—¶å¸‚åœº</th></tr></thead><tbody><tr><td>é˜Ÿå°¾æ’å…¥å…ƒç´ </td><td>add(e)</td><td>offer(e)</td><td>put(e)</td><td>offer(e, time, unit)</td></tr><tr><td>é˜Ÿå¤´åˆ é™¤å…ƒç´ </td><td>remove()</td><td>poll()</td><td>take()</td><td>poll(time, unit)</td></tr><tr><td>è·å–ã€ä¸åˆ é™¤å…ƒç´ </td><td>element()</td><td>peek()</td><td>æ— </td><td>æ— </td></tr></tbody></table></div><p>BlockingQueueä¸å®ç°ç±»ä¹‹é—´ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="image-20210710181645057.png" alt="BlockingQueue ç±»å›¾"></p><p>å¯ä»¥çœ‹åˆ°BlockingQueueçš„äº”ä¸ªå®ç°ç±»</p><p>ä¸‹é¢ä½¿ç”¨BlockingQueueæ¥å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…çš„çº¿ç¨‹é€šä¿¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockingQueueTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        BlockingQueue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Producer</span>(<span class="string">&quot;äº§å“A&quot;</span>, queue).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Producer</span>(<span class="string">&quot;äº§å“B&quot;</span>, queue).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Consumer</span>(queue).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;String&gt; queue;</span><br><span class="line">    <span class="keyword">private</span> String productName ;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(String productName, BlockingQueue&lt;String&gt; queue)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.productName = productName;</span><br><span class="line">        <span class="built_in">this</span>.queue = queue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                queue.put(productName + i); <span class="comment">//å°è¯•æ”¾å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™é˜»å¡</span></span><br><span class="line">                System.out.println(getName() + <span class="string">&quot;ç”Ÿäº§å®Œæˆï¼š&quot;</span> + queue);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;String&gt; queue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(BlockingQueue&lt;String&gt; queue)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.queue = queue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(getName() + <span class="string">&quot;æ¶ˆè´¹å…ƒç´ ï¼š&quot;</span> + queue.take());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯¥ç¨‹åºä¸ç¬¦åˆé¢„æœŸï¼ŒåŸå› ä¸æ˜ã€‚</strong></p><p><img src="image-20210710190620858.png" alt="é˜»å¡é˜Ÿåˆ— è¿è¡Œç»“æœ"></p><h1 id="å¤šçº¿ç¨‹å…±äº«æ•°æ®"><a href="#å¤šçº¿ç¨‹å…±äº«æ•°æ®" class="headerlink" title="å¤šçº¿ç¨‹å…±äº«æ•°æ®"></a>å¤šçº¿ç¨‹å…±äº«æ•°æ®</h1><h2 id="å°†æ•°æ®æŠ½è±¡æˆä¸€ä¸ªç±»ï¼Œå¹¶å°†è¿™ä¸ªæ•°æ®çš„æ“ä½œå°è£…åˆ°è¿™ä¸ªç±»ä¸­"><a href="#å°†æ•°æ®æŠ½è±¡æˆä¸€ä¸ªç±»ï¼Œå¹¶å°†è¿™ä¸ªæ•°æ®çš„æ“ä½œå°è£…åˆ°è¿™ä¸ªç±»ä¸­" class="headerlink" title="å°†æ•°æ®æŠ½è±¡æˆä¸€ä¸ªç±»ï¼Œå¹¶å°†è¿™ä¸ªæ•°æ®çš„æ“ä½œå°è£…åˆ°è¿™ä¸ªç±»ä¸­"></a>å°†æ•°æ®æŠ½è±¡æˆä¸€ä¸ªç±»ï¼Œå¹¶å°†è¿™ä¸ªæ•°æ®çš„æ“ä½œå°è£…åˆ°è¿™ä¸ªç±»ä¸­</h2><h2 id="å°†Runnableå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼Œå°†å…±äº«æ•°æ®ä½œä¸ºè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡"><a href="#å°†Runnableå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼Œå°†å…±äº«æ•°æ®ä½œä¸ºè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡" class="headerlink" title="å°†Runnableå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼Œå°†å…±äº«æ•°æ®ä½œä¸ºè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡"></a>å°†Runnableå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼Œå°†å…±äº«æ•°æ®ä½œä¸ºè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡</h2><h1 id="çº¿ç¨‹ç»„å’Œæœªå¤„ç†çš„å¼‚å¸¸"><a href="#çº¿ç¨‹ç»„å’Œæœªå¤„ç†çš„å¼‚å¸¸" class="headerlink" title="çº¿ç¨‹ç»„å’Œæœªå¤„ç†çš„å¼‚å¸¸"></a>çº¿ç¨‹ç»„å’Œæœªå¤„ç†çš„å¼‚å¸¸</h1><h2 id="çº¿ç¨‹ç»„"><a href="#çº¿ç¨‹ç»„" class="headerlink" title="çº¿ç¨‹ç»„"></a>çº¿ç¨‹ç»„</h2><p>Javaä½¿ç”¨ThreadGroupæ¥è¡¨ç¤ºçº¿ç¨‹ç»„ï¼ŒJavaå…è®¸ç¨‹åºå¯¹çº¿ç¨‹ç»„è¿›è¡Œæ§åˆ¶ã€‚ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹éƒ½å±äºæŒ‡å®šçº¿ç¨‹ç»„ã€‚å¦‚æœç¨‹åºæ²¡æœ‰æ˜¾å¼æŒ‡å®šçº¿ç¨‹å±äºå“ªä¸ªçº¿ç¨‹ç»„ï¼Œåˆ™è¯¥çº¿ç¨‹å±äºé»˜è®¤çº¿ç¨‹ç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ å­çº¿ç¨‹å’Œåˆ›å»ºå®ƒçš„çˆ¶çº¿ç¨‹å¤„äºåŒä¸€ä¸ªçº¿ç¨‹ç»„ã€‚</p><p>çº¿ç¨‹è¿è¡Œä¸­é€”ä¸èƒ½æ”¹å˜å®ƒæ‰€å±çš„çº¿ç¨‹ç»„ã€‚</p><p>ä¸‹é¢æ˜¯Threadç±»æä¾›çš„æ„é€ å™¨æ¥è®¾ç½®çº¿ç¨‹å±äºå“ªä¸ªçº¿ç¨‹ç»„ï¼š</p><ul><li>Thread(ThreadGroup group, Runnable target)ï¼šä»¥targetçš„runæ–¹æ³•ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå±äºgroupçº¿ç¨‹ç»„ã€‚</li><li>Thread(ThreadGroup group, Runnable target, String name)</li><li>Thread(ThreadGroup group, String name)</li></ul><p>Threadæä¾›äº†ä¸€ä¸ªgetThreadGroupæ–¹æ³•æ¥è¿”å›çº¿ç¨‹æ‰€å±çš„çº¿ç¨‹ç»„ã€‚</p><p>ThreadGroupæä¾›äº†ä¸¤ä¸ªæ„é€ å™¨æ¥åˆ›å»ºå®ä¾‹ã€‚</p><ul><li>ThreadGroup(String name)</li><li>ThreadGroup(ThreadGroup parent, String name)ï¼šä»¥æŒ‡å®šåå­—ã€æŒ‡å®šçˆ¶çº¿ç¨‹ç»„åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ç»„ã€‚</li></ul><p>å…¶ä¸­nameå‚æ•°æ˜¯æŒ‡å®šçº¿ç¨‹ç»„çš„åå­—ï¼Œçº¿ç¨‹ç»„çš„åå­—å¯ä»¥é€šè¿‡getNameæ–¹æ³•å¾—åˆ°ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹ã€‚</p><p>ThreadGroupçš„å¸¸ç”¨æ–¹æ³•ï¼š</p><ul><li>int activeCount()</li><li>void isDaemon()</li><li>void interrupt()</li><li>void setDaemon(boolean daemon)</li><li>void setMaxPriority(int pri)</li></ul><p>ThreadGroupå†…å®šä¹‰äº†ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æ–¹æ³•ï¼š<code>void uncaughtException(Thread t, Throwable e)</code>ï¼Œè¯¥æ–¹æ³•å¯ä»¥å¤„ç†è¯¥çº¿ç¨‹ç»„å†…çš„ä»»æ„çº¿ç¨‹æ‰€æŠ›å‡ºçš„æœªå¤„ç†å¼‚å¸¸ã€‚</p><h2 id="çº¿ç¨‹å¼‚å¸¸"><a href="#çº¿ç¨‹å¼‚å¸¸" class="headerlink" title="çº¿ç¨‹å¼‚å¸¸"></a>çº¿ç¨‹å¼‚å¸¸</h2><p>Java5ä¹‹åï¼Œå¦‚æœçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºäº†ä¸€ä¸ªæœªå¤„ç†çš„å¼‚å¸¸ï¼ŒJVMåœ¨ç»“æŸä¹‹å‰ä¼šè‡ªåŠ¨æŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„Thread.UncaughtExceptionHandlerå¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„<code>uncaughtException(Thread t, Throwable e)</code>æ¥å¤„ç†å¼‚å¸¸ã€‚</p><p>Threadç±»æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥è®¾ç½®å¼‚å¸¸å¤„ç†å™¨ï¼š</p><ul><li>setUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh)ï¼šä¸ºæŒ‡å®šçº¿ç¨‹å®ä¾‹è®¾ç½®é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨</li><li>static setDefaultUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh)ï¼šä¸ºè¯¥çº¿ç¨‹ç±»çš„æ‰€æœ‰å®ä¾‹è®¾ç½®é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨ã€‚</li></ul><p>ThreadGroupç±»å®ç°äº†Thread.UncaughtExceptionHandleræ¥å£ã€‚</p><p>æ‰€ä»¥çº¿ç¨‹å¤„ç†å¼‚å¸¸çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœçº¿ç¨‹è®¾ç½®äº†å¼‚å¸¸å¤„ç†å™¨ï¼Œåˆ™è°ƒç”¨è¯¥å¼‚å¸¸å¤„ç†å™¨å¤„ç†å¼‚å¸¸</li><li>æŸ¥æ‰¾çº¿ç¨‹æ˜¯å¦å±äºçº¿ç¨‹ç»„ï¼š<ol><li>å¦‚æœæ‰€å±çº¿ç¨‹ç»„æœ‰çˆ¶çº¿ç¨‹ç»„ï¼Œåˆ™è°ƒç”¨çˆ¶çº¿ç¨‹ç»„çš„uncaughtExceptionæ–¹æ³•</li><li>å¦‚æœè¯¥çº¿ç¨‹ç»„æœ‰å¼‚å¸¸å¤„ç†å™¨ï¼Œåˆ™ä½¿ç”¨è¯¥å¼‚å¸¸å¤„ç†å™¨å¤„ç†å¼‚å¸¸ã€‚</li></ol></li></ol><p>æ³¨æ„ï¼šå½“ä½¿ç”¨catchæ•è·å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸ä¸ä¼šå‘ä¸Šä¼ æ’­ç»™ä¸Šä¸€çº§è°ƒç”¨è€…ï¼›ä½†ä½¿ç”¨å¼‚å¸¸å¤„ç†å™¨å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†åï¼Œå¼‚å¸¸ä¾ç„¶ä¼šä¼ æ’­ç»™ä¸Šä¸€çº§è°ƒç”¨è€…ã€‚</p><h1 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h1><p>å½“ç¨‹åºéœ€è¦åˆ›å»ºå¤§é‡ç”Ÿå­˜æœŸå¾ˆçŸ­æš‚çš„çº¿ç¨‹æ—¶ï¼Œæ›´åº”è¯¥è€ƒè™‘ä½¿ç”¨çº¿ç¨‹æ± ã€‚</p><p>çº¿ç¨‹æ± åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å³åˆ›å»ºå¤§é‡ç©ºé—²çº¿ç¨‹ï¼Œç¨‹åºå°†ä¸€ä¸ªRunnable/Callableå¯¹è±¡ä¼ ç»™çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å°±ä¼šå¯åŠ¨ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ¥æ‰§è¡Œrun/callæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œçº¿ç¨‹ä¸ä¼šæ­»äº¡è€Œæ˜¯è¿”å›çº¿ç¨‹æ± æˆä¸ºç©ºé—²çŠ¶æ€ã€‚</p><p>çº¿ç¨‹æ± çš„ä¸»è¦ä½œç”¨æ˜¯çº¿ç¨‹å¤ç”¨ï¼Œçº¿ç¨‹èµ„æºç®¡ç†ï¼Œæ§åˆ¶æ“ä½œç³»ç»Ÿçš„æœ€å¤§å¹¶å‘æ•°ï¼Œä»¥ä¿è¯ç³»ç»Ÿé«˜æ•ˆï¼ˆé€šè¿‡çº¿ç¨‹èµ„æºå¤ç”¨å®ç°ï¼‰ä¸”å®‰å…¨ï¼ˆé€šè¿‡æ§åˆ¶æœ€å¤§çº¿ç¨‹å¹¶å‘æ•°å®ç°ï¼‰çš„è¿è¡Œã€‚</p><h2 id="çº¿ç¨‹æ± çš„æ ¸å¿ƒç»„ä»¶å’Œæ ¸å¿ƒç±»"><a href="#çº¿ç¨‹æ± çš„æ ¸å¿ƒç»„ä»¶å’Œæ ¸å¿ƒç±»" class="headerlink" title="çº¿ç¨‹æ± çš„æ ¸å¿ƒç»„ä»¶å’Œæ ¸å¿ƒç±»"></a>çº¿ç¨‹æ± çš„æ ¸å¿ƒç»„ä»¶å’Œæ ¸å¿ƒç±»</h2><p>Javaçº¿ç¨‹æ± ä¸»è¦ç”±4ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆã€‚</p><ul><li>çº¿ç¨‹æ± ç®¡ç†å™¨ï¼šç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹</li><li>å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­æ‰§è¡Œå…·ä½“ä»»åŠ¡çš„çº¿ç¨‹ã€‚</li><li>ä»»åŠ¡æ¥å£ï¼šç”¨äºå®šä¹‰å·¥ä½œçº¿ç¨‹çš„è°ƒåº¦å’Œæ‰§è¡Œç­–ç•¥ï¼Œåªæœ‰çº¿ç¨‹å®ç°äº†è¯¥æ¥å£ï¼Œçº¿ç¨‹ä¸­çš„ä»»åŠ¡æ‰èƒ½å¤Ÿè¢«çº¿ç¨‹æ± è°ƒåº¦ã€‚</li><li>ä»»åŠ¡é˜Ÿåˆ—ï¼šå­˜æ”¾å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæ–°çš„ä»»åŠ¡å°†ä¼šä¸æ–­è¢«åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡å°†è¢«ä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚</li></ul><p>Javaçº¿ç¨‹æ± ç”¨åˆ°äº†Executorã€Executorsã€ExecutorServiceã€ThreadPoolExecutorã€Callableã€Futureã€FutureTaskè¿™å‡ ä¸ªæ ¸å¿ƒç±»ï¼Œå…·ä½“ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="image-20210803000256474.png" alt="çº¿ç¨‹æ± æ ¸å¿ƒç±» ç±»å›¾"></p><p>ThreadPoolExecutoræ˜¯æ„å»ºçº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ã€‚</p><h2 id="ä½¿ç”¨Executorsç®¡ç†çº¿ç¨‹"><a href="#ä½¿ç”¨Executorsç®¡ç†çº¿ç¨‹" class="headerlink" title="ä½¿ç”¨Executorsç®¡ç†çº¿ç¨‹"></a>ä½¿ç”¨Executorsç®¡ç†çº¿ç¨‹</h2><p>Java5ä»¥å‰ï¼Œå¼€å‘è€…å¿…é¡»å®ç°è‡ªå·±çš„çº¿ç¨‹æ± ï¼Œä»Java5å¼€å§‹ï¼Œæ–°å¢äº†ä¸€ä¸ªExecutorså·¥å‚ç±»æ¥äº§ç”Ÿçº¿ç¨‹æ± ã€‚å®ƒåŒ…å«å¦‚ä¸‹é™æ€å·¥å‚æ–¹æ³•ï¼š</p><ul><li>ExecutorService newCachedThreadPool()ï¼šåˆ›å»ºä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„çº¿ç¨‹æ± </li><li>ExecutorService newFixedThreadPool(int nThreads)ï¼šåˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„ã€å…·æœ‰å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </li><li>ExecutorService newSingleThreadExecutor()ï¼šåˆ›å»ºä¸€ä¸ªåªæœ‰å•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œç›¸å½“äºnewFixedThreadPool(1)</li><li>ScheduledExecutorService newScheduledThreadPool(int corePoolSize)ï¼šåˆ›å»ºå…·æœ‰æŒ‡å®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚å‚æ•°æŒ‡å‡ºæ± ä¸­æ‰€ä¿å­˜çš„çº¿ç¨‹æ•°ã€‚</li><li>ScheduledExecutorService newSingleThreadScheduledExecutor()ï¼šåˆ›å»ºåªæœ‰ä¸€ä¸ªç°æˆçš„çº¿ç¨‹æ± </li><li>ExecutorService newWorkStealingPool(int parallelism)ï¼šåˆ›å»ºæŒæœ‰è¶³å¤Ÿçš„çº¿ç¨‹çš„çº¿ç¨‹æ± æ¥æ”¯æŒç»™å®šçš„å¹¶è¡Œçº§åˆ«</li><li>ExecutorService newWorkStealingPool()ï¼šç›¸å½“äºå‰ä¸€ä¸ªæ–¹æ³•çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå‡è®¾å½“å‰æœºå™¨æœ‰4ä¸ªCPUï¼Œåˆ™ç›¸å½“äºå‰ä¸€ä¸ªæ–¹æ³•ä¼ å…¥4</li></ul><p>å‰é¢ä»‹ç»çš„æ–¹æ³•ä¸­è¿”å›å€¼ç±»å‹ä¸­ExecutorServiceä»£è¡¨çº¿ç¨‹æ± ï¼Œå®ƒå¯ä»¥æ‰§è¡ŒRunnable/Callableæ‰€ä»£è¡¨çš„çº¿ç¨‹ï¼›ScheduledExecutorService æ˜¯ExecutorServiceçš„å­ç±»ï¼Œå®ƒå¯ä»¥åœ¨æŒ‡å®šå»¶è¿Ÿåæ‰§è¡Œçº¿ç¨‹ä»»åŠ¡ã€‚</p><p>æœ€åä¸¤ä¸ªæ–¹æ³•æ˜¯J8æ–°å¢ï¼Œä»–ä»¬æˆåˆ†åˆ©ç”¨äº†å¤šCPUçš„å¹¶è¡Œèƒ½åŠ›ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ›å»ºçš„ç›¸å½“äºåå°çº¿ç¨‹æ± ã€‚</p><p>ExecutorServiceä»£è¡¨å°½å¿«æ‰§è¡Œçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼š</p><ul><li><code>Future&lt;?&gt; submit(Runnable task)</code>ï¼šå°†ä¸€ä¸ªRunnableå¯¹è±¡æäº¤ç»™çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å°†åœ¨æœ‰ç©ºé—²çº¿ç¨‹æ—¶æ‰§è¡ŒRunnableå¯¹è±¡ä»£è¡¨çš„ä»»åŠ¡ã€‚å…¶ä¸­Futureå¯¹è±¡ä»£è¡¨Runnableçš„è¿”å›å€¼ï¼Œä½†æ˜¯runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥Futureå¯¹è±¡å°†åœ¨runæ–¹æ³•æ‰§è¡Œç»“æŸåè¿”å›null</li><li><code>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result)</code>ï¼šåŒä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œä½†æœ¬æ–¹æ³•å°†åœ¨runæ–¹æ³•ç»“æŸåè¿”å›result</li><li><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code></li></ul><p>ScheduledExecutorService ä»£è¡¨åœ¨æŒ‡å®šå»¶è¿Ÿåæˆ–å‘¨æœŸæ€§çš„æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡ï¼Œå®ƒæä¾›äº†å››ä¸ªä¸»è¦æ–¹æ³•ï¼š</p><ul><li><code>&lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable, long delay, TimeUnit unit)</code>ï¼š</li><li><code>ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit)</code></li><li><code>ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit)</code>ï¼šå¯è®¾å®šé¢‘ç‡é‡å¤æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡</li><li><code>ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit)</code>ï¼šæ¯ä¸€æ¬¡æ‰§è¡Œç»ˆæ­¢å’Œä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹ä¹‹é—´éƒ½å­˜åœ¨ä¸€ä¸ªç»™å®šçš„å»¶è¿Ÿã€‚</li></ul><p>å½“ç”¨å®Œä¸€ä¸ªçº¿ç¨‹æ± åï¼Œåº”è¯¥è°ƒç”¨è¯¥çº¿ç¨‹æ± çš„shutdownæ–¹æ³•ï¼Œè°ƒç”¨shutdownæ–¹æ³•åï¼Œçº¿ç¨‹æ± ä¸å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä½†ä¼šå°†ä»¥å‰æ‰€æœ‰å·²æäº¤ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚</p><p>ä½¿ç”¨çº¿ç¨‹æ± æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è°ƒç”¨Executorsç±»çš„é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </li><li>åˆ›å»ºRunnable/Callableå®ä¾‹</li><li>è°ƒç”¨submitæ–¹æ³•æäº¤Runnable/Callableå®ä¾‹</li><li>è°ƒç”¨çº¿ç¨‹æ± çš„shutdownæ–¹æ³•å…³é—­çº¿ç¨‹æ± ã€‚</li></ol><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå›ºå®šçº¿ç¨‹å¤„çš„çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">6</span>);</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çš„iå€¼ä¸ºï¼š&quot;</span> + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//å‘çº¿ç¨‹æ± æäº¤ä¸¤ä¸ªçº¿ç¨‹</span></span><br><span class="line">        pool.submit(target);</span><br><span class="line">        pool.submit(target);</span><br><span class="line"></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ForkJoinPoolåˆ©ç”¨å¤šCPU"><a href="#ä½¿ç”¨ForkJoinPoolåˆ©ç”¨å¤šCPU" class="headerlink" title="ä½¿ç”¨ForkJoinPoolåˆ©ç”¨å¤šCPU"></a>ä½¿ç”¨ForkJoinPoolåˆ©ç”¨å¤šCPU</h2><p>Java7æä¾›äº†ForkJoinPoolæ¥æ”¯æŒå¤šCPUè®¡ç®—ã€‚ForkJoinPoolæ˜¯ExecutorServiceçš„å®ç°ç±»ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„çº¿ç¨‹æ± ã€‚</p><p>ForkJoinPoolæœ‰ä¸¤ä¸ªæ„é€ å™¨ï¼š</p><ul><li>ForkJoinPool(int parallelism)ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«parallelismä¸ªå¹¶è¡Œçº¿ç¨‹çš„ForkJoinPool</li><li>ForkJoinPool()ï¼šä»¥Runtime.availableProcessorsæ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºparallelismå‚æ•°åˆ›å»ºForkJoinPool</li></ul><p>J8è¿›ä¸€æ­¥æ‰©å±•äº†ForkJoinPoolçš„åŠŸèƒ½ã€‚J8é€šè¿‡æä¾›å¦‚ä¸‹ä¸¤ä¸ªé™æ€æ–¹æ³•ä¸ºForkJoinPoolå¢åŠ äº†é€šç”¨æ± åŠŸèƒ½ã€‚</p><ul><li>ForkJoinPool commonPool()ï¼šè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªé€šç”¨æ± ï¼Œé€šç”¨æ± ä¸ä¼šå—åˆ°shutdownæˆ–shutdownNowæ–¹æ³•çš„å½±å“ã€‚</li><li>int getCommonPoolParallelismï¼šè¯¥æ–¹æ³•è¿”å›é€šç”¨æ± çš„å¹¶è¡Œçº§åˆ«ã€‚</li></ul><p>åœ¨åˆ›å»ºForkJoinPoolå®ä¾‹ä¹‹åå°±å¯ä»¥è°ƒç”¨å®ƒçš„submit(ForkJoinTask<T> task)æ–¹æ³•æ¥æ‰§è¡ŒæŒ‡å®šä»»åŠ¡ã€‚ForkJoinTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä»–ä»£è¡¨ä¸€ä¸ªå¯å¹¶è¡Œã€åˆå¹¶çš„ä»»åŠ¡ã€‚ä»–æœ‰ä¸¤ä¸ªæŠ½è±¡å­ç±»ã€‚RecursiveActionå’ŒRecursiveTaskã€‚RecursiveActionä»£è¡¨æ— è¿”å›å€¼çš„ä»»åŠ¡ï¼ŒRecursiveTaskä»£è¡¨æœ‰è¿”å›å€¼çš„ä»»åŠ¡ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForkJoinPoolTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> rand.nextInt(<span class="number">20</span>);</span><br><span class="line">            total += (arr[i] = tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å•çº¿ç¨‹ç´¯åŠ çš„ç»“æœä¸ºï¼š&quot;</span> + total);</span><br><span class="line"></span><br><span class="line">        Future&lt;Integer&gt; future = pool.submit(<span class="keyword">new</span> <span class="title class_">CalTask</span>(arr, <span class="number">0</span>, arr.length));</span><br><span class="line">        System.out.println(<span class="string">&quot;å¹¶è¡ŒCPUç´¯åŠ çš„ç»“æœä¸ºï¼š&quot;</span> + future.get());</span><br><span class="line"></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CalTask</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Integer&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">20</span>; <span class="comment">//æ¯ä¸ªå°äººç‰©æœ€å¤šç´¯åŠ 20ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] arr;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CalTask</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.arr = arr;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Integer <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(end - start &lt; THRESHOLD) &#123; <span class="comment">//å½“æ•°ç»„æ•°é‡å°äºTHRESHOLDæ—¶å¼€å§‹ç´¯åŠ </span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) &#123;</span><br><span class="line">                sum += arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (start + end) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">//åˆ†è§£æˆå­ä»»åŠ¡</span></span><br><span class="line">            <span class="type">CalTask</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CalTask</span>(arr, start, mid);</span><br><span class="line">            <span class="type">CalTask</span> <span class="variable">right</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CalTask</span>(arr, mid, end);</span><br><span class="line">            left.fork();<span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">            right.fork();</span><br><span class="line">            <span class="keyword">return</span> left.join() + right.join(); <span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="*ThreadPoolExecutor"></a>*ThreadPoolExecutor</h2><p>Javaæä¾›äº†Excutorså·¥å…·ç±»ï¼Œé€‚ç”¨äºå°é¡¹ç›®ï¼Œå¯¹äºä¸€äº›å¤§å‹ç¨‹åºè¿˜æ˜¯éœ€è¦è‡ªå·±åˆ›å»ºThreadPoolExecutorç±»ã€‚è¿™æ ·åšçš„å¥½å¤„æœ‰ï¼š</p><ul><li>ä½¿ç”¨ThreadPoolExecutoræ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚</li><li>Excutorsçš„newFixedThreadPoolå’ŒnewSingleThreadExecutorçš„ä¸»è¦é—®é¢˜æ˜¯å †ç§¯çš„è¯·æ±‚å¤„ç†é˜Ÿåˆ—å¯èƒ½ä¼šè€—è´¹éå¸¸å¤§çš„å†…å­˜ï¼Œç”šè‡³OOMï¼›Excutorsçš„newCachedThreadPoolå’ŒnewScheduledThreadPoolä¸»è¦é—®é¢˜æ˜¯çº¿ç¨‹æœ€å¤§æ•°ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºæ•°é‡éå¸¸å¤šçš„çº¿ç¨‹ï¼Œç”šè‡³OOMã€‚</li></ul><p>ThreadPoolExecutoræ˜¯æ„å»ºçº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ï¼Œå®šä¹‰å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                              TimeUnit unit,</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">                              ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler)</span> &#123;</span><br><span class="line">    <span class="comment">//code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“å‚æ•°å¦‚è¡¨æ ¼ï¼š</p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>corePoolSize</td><td>çº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡</td></tr><tr><td>maximumPoolSize</td><td>çº¿ç¨‹æ± ä¸­æœ€å¤§çº¿ç¨‹æ•°é‡</td></tr><tr><td>keepAliveTime</td><td>å½“å‰çº¿ç¨‹æ•°é‡è¶…è¿‡corePoolSizeæ—¶ï¼Œç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´</td></tr><tr><td>unit</td><td>keepAliveTimeçš„æ—¶é—´å•ä½</td></tr><tr><td>workQueue</td><td>ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡å­˜æ”¾çš„åœ°æ–¹</td></tr><tr><td>threadFactory</td><td>çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œå¯ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹å·¥å‚æˆ–è‡ªå®šä¹‰</td></tr><tr><td>handler</td><td>ç”±äºä»»åŠ¡è¿‡å¤šæˆ–å…¶ä»–åŸå› å¯¼è‡´çº¿ç¨‹æ± æ— æ³•å¤„ç†æ—¶çš„ä»»åŠ¡æ‹’ç»ç­–ç•¥</td></tr></tbody></table></div><h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><p>é€šè¿‡è°ƒç”¨ThreadPoolExecutorçš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± åˆšè¢«åˆ›å»ºæ—¶ï¼Œåªæ˜¯å‘ç³»ç»Ÿç”³è¯·ä¸€ä¸ªç”¨äºæ‰§è¡Œçº¿ç¨‹é˜Ÿåˆ—å’Œç®¡ç†çº¿ç¨‹æ± çš„çº¿ç¨‹èµ„æºã€‚åœ¨æ·»åŠ ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå½“å‰ç°æœ‰çº¿ç¨‹æ•°ï¼ˆè®¾ä¸ºnï¼‰ï¼š</p><ol><li>n&lt;corePoolSizeï¼Œçº¿ç¨‹æ± å°±ä¼šç«‹åˆ»åˆ›å»ºçº¿ç¨‹å¹¶æ‰§è¡Œè¯¥çº¿ç¨‹ä»»åŠ¡ã€‚</li><li>n&gt;=corePoolSizeï¼Œè¯¥ä»»åŠ¡å°±ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ã€‚</li><li>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä¸”n&lt;maximumPoolSizeæ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»æ‰§è¡Œè¯¥çº¿ç¨‹ä»»åŠ¡ã€‚</li><li>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä¸”n&gt;=maximumPoolSizeæ—¶ï¼Œçº¿ç¨‹æ± å°†æ‹’ç»æ‰§è¡Œè¯¥çº¿ç¨‹ä»»åŠ¡å¹¶æŠ›å‡ºRejectExecutionExceptionå¼‚å¸¸ã€‚</li><li>çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¯¥ä»»åŠ¡å°†ä»çº¿ç¨‹æ± é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œçº¿ç¨‹æ± å°†ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸‹ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚</li><li>åœ¨çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€çš„å®è·µè¶…è¿‡keepAliveTimeæ—¶ï¼Œæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¶…è¿‡corePoolSizeï¼Œè¯¥çº¿ç¨‹å°†è¢«è®¤å®šä¸ºç©ºé—²çº¿ç¨‹å¹¶åœæ­¢ã€‚å› æ­¤ï¼Œåœ¨çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹æ± ä¼šæ”¶ç¼©åˆ°corePoolSizeå¤§å°ã€‚</li></ol><h3 id="å…¥é˜Ÿç­–ç•¥"><a href="#å…¥é˜Ÿç­–ç•¥" class="headerlink" title="å…¥é˜Ÿç­–ç•¥"></a>å…¥é˜Ÿç­–ç•¥</h3><ol><li>ç›´æ¥ä¼ é€’ï¼šSynchronousQueueï¼ˆå¾…è¡¥å……ï¼‰</li><li>æ— ç•Œé˜Ÿåˆ—ï¼šä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ˆLinkedBlockingQueueï¼‰ä½œä¸ºç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¤„ç†ä»»åŠ¡æ—¶ï¼Œæ–°æäº¤çš„ä»»åŠ¡éƒ½ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚æ­¤æ—¶maximumPoolSizeå°†å¤±å»ä½œç”¨ã€‚</li><li>æœ‰ç•Œé˜Ÿåˆ—ï¼šæœ‰ç•Œé˜Ÿåˆ—ï¼ˆArrayBlockingQueueï¼‰å¯ä»¥é˜²æ­¢èµ„æºè€—å°½ï¼Œä½†æ˜¯éš¾ä»¥è°ƒæ•´å’Œæ§åˆ¶ã€‚é˜Ÿåˆ—å¤§å°å’Œçº¿ç¨‹æ± å¤§å°å¯ä»¥ç›¸äº’ä½œç”¨ï¼Œä½¿ç”¨å¤§é˜Ÿåˆ—å’Œå°çº¿ç¨‹æ•°å¯ä»¥å‡å°‘CPUä½¿ç”¨ç‡ã€ç³»ç»Ÿèµ„æºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ååé‡å˜ä½ï¼Œå¦‚æœä»»åŠ¡é¢‘ç¹é˜»å¡ï¼Œç³»ç»Ÿå°±èƒ½ä¸ºæ›´å¤šçš„çº¿ç¨‹è°ƒåº¦æ‰§è¡Œæ—¶é—´ã€‚ä½¿ç”¨å°é˜Ÿåˆ—é€šå¸¸éœ€è¦æ›´å¤šçš„çº¿ç¨‹æ•°ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§åŒ–CPUä½¿ç”¨ç‡ã€‚ä½†å¯èƒ½ä¼šéœ€è¦æ›´å¤§çš„è°ƒåº¦å¼€é”€ï¼Œä»è€Œé™ä½ååé‡ã€‚</li></ol><h3 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h3><p>JDKå†…ç½®çš„æ‹’ç»ç­–ç•¥æœ‰AbortPolicyã€CallerRunsPolicyã€DiscardOldestPolicyã€DiscardPolicyè¿™å››ç§ã€‚</p><ul><li>AbortPolicyï¼šé»˜è®¤ç­–ç•¥ï¼ŒæŠ›å‡ºRejectExecutionExceptionå¼‚å¸¸</li><li>CallerRunsPolicyï¼šåœ¨executeæ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹å·²å…³é—­ï¼Œä»»åŠ¡å°†è¢«ä¸¢å¼ƒã€‚</li><li>DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„ä»»åŠ¡å¹¶æ‰§è¡Œå½“å‰æäº¤çš„ä»»åŠ¡ã€‚</li><li>DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ã€‚</li><li>è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥éœ€è¦å®ç°RejectedExecutionHandleræ¥å£ï¼Œå®ç°<code>rejectedExecution(Runnable r, ThreadPoolExecutor executor)</code>æ–¹æ³•ã€‚</li></ul><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">corePoolSize</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">maximumPoolSize</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">keepAliveTime</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="type">TimeUnit</span> <span class="variable">unit</span> <span class="operator">=</span> TimeUnit.SECONDS;</span><br><span class="line">    BlockingQueue&lt;Runnable&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">    <span class="type">ThreadPoolExecutor</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    pool = <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, queue);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> i+<span class="number">1</span>;</span><br><span class="line">        pool.submit(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + index);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//æ¯ä¸ªä»»åŠ¡æäº¤åä¼‘çœ 500msåœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œç”¨äºä¿è¯æäº¤é¡ºåºã€‚</span></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    pool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯è¿è¡Œç»“æœã€‚</p><p><img src="image-20210730173914926.png" alt="æ‹’ç»ç­–ç•¥ è¿è¡Œæˆªå›¾"></p><p>å¯¹è¯¥è¿è¡Œç»“æœè¿›è¡Œåˆ†æï¼š</p><ol><li>ç”±äºcorePoolSizeè®¾ç½®çš„ä¸º3ï¼Œæ‰€ä»¥ä»»åŠ¡1ã€2ã€3æ­£å¸¸æäº¤ä¸”å¼€å§‹æ‰§è¡Œã€‚</li><li>æäº¤ä»»åŠ¡4ï¼Œ5æ—¶ï¼Œä»»åŠ¡123è¿˜åœ¨è¿è¡Œï¼Œæ‰€ä»¥ä»»åŠ¡4ï¼Œ5è¿›å…¥åˆ°é˜»å¡é˜Ÿåˆ—ã€‚</li><li>æäº¤ä»»åŠ¡6ï¼Œ7ï¼Œ8æ—¶ï¼Œæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ç­‰äºcorePoolSizeä¸”å°äºmaximumPoolSizeï¼Œé˜»å¡é˜Ÿåˆ—æ»¡ï¼Œæ‰€ä»¥ä¼šç«‹å³åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡678</li><li>å½“ä»»åŠ¡1æ‰§è¡Œå®Œæ¯•åï¼Œå–å‡ºé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡4å¼€å§‹æ‰§è¡Œã€‚</li><li>å½“ä»»åŠ¡2æ‰§è¡Œå®Œæ¯•åï¼Œå–å‡ºé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡5å¼€å§‹æ‰§è¡Œã€‚</li></ol><p>ä¸ºäº†æ¼”ç¤ºé»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼Œå°†ä¸Šè¿°æ¡ˆä¾‹å¢åŠ ä¸€ä¸ªçº¿ç¨‹ã€‚ç»“æœå¦‚å›¾</p><p><img src="image-20210730174640219.png" alt="æ‹’ç»ç­–ç•¥ æˆªå›¾"></p><h1 id="çº¿ç¨‹ç›¸å…³ç±»"><a href="#çº¿ç¨‹ç›¸å…³ç±»" class="headerlink" title="çº¿ç¨‹ç›¸å…³ç±»"></a>çº¿ç¨‹ç›¸å…³ç±»</h1><h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><p>ThreadLocalæ˜¯Theradçš„å±€éƒ¨å˜é‡çš„ç»´æŠ¤ç±»ï¼Œåœ¨Javaä¸­æ˜¯ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„å˜é‡å­˜å‚¨åœ¨ã€‚å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚</p><p>å› ä¸ºæ¯ä¸ªThreadå†…æœ‰è‡ªå·±çš„å®ä¾‹å‰¯æœ¬ï¼Œä¸”è¯¥å‰¯æœ¬åªèƒ½ç”±å½“å‰Threadä½¿ç”¨ï¼Œä¹Ÿå°±ä¸å­˜åœ¨å¤šçº¿ç¨‹é—´å…±äº«çš„é—®é¢˜ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒThreadLocalé€‚ç”¨äºæ¯ä¸ªçº¿ç¨‹éœ€è¦è‡ªå·±ç‹¬ç«‹çš„å®ä¾‹ä¸”è¯¥å®ä¾‹éœ€è¦åœ¨å¤šä¸ªæ–¹æ³•ä¸­è¢«ä½¿ç”¨ï¼Œä¹Ÿå³å˜é‡åœ¨çº¿ç¨‹é—´éš”ç¦»è€Œåœ¨æ–¹æ³•æˆ–ç±»é—´å…±äº«çš„åœºæ™¯ã€‚</p><p>æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªå˜é‡countï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘æ—¶æ“ä½œcount++ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯é€šè¿‡ThreadLocalå°±å¯ä»¥ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºåªå±äºå½“å‰çº¿ç¨‹çš„countå‰¯æœ¬ï¼Œå„è‡ªæ“ä½œå„è‡ªçš„å‰¯æœ¬ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; HOLDER = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadLocalTest</span>().execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        HOLDER.set(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼š&quot;</span> + HOLDER.get());</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼š&quot;</span> + HOLDER.get());</span><br><span class="line">            HOLDER.set(<span class="string">&quot;thread&quot;</span>); <span class="comment">//è®¾ç½®å½“å‰çº¿ç¨‹çš„å€¼</span></span><br><span class="line">            System.out.println(<span class="string">&quot;é‡æ–°è®¾ç½®åï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼š&quot;</span> + HOLDER.get());</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼š&quot;</span> + HOLDER.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¨‹åºï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mainçº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼šç¨‹åºæ–°è§†ç•Œ</span><br><span class="line">Thread-0çº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼šnull</span><br><span class="line">é‡æ–°è®¾ç½®ä¹‹åï¼ŒThread-0çº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼šã€Šç¨‹åºæ–°è§†ç•Œã€‹</span><br><span class="line">Thread-0çº¿ç¨‹æ‰§è¡Œç»“æŸ</span><br><span class="line">mainçº¿ç¨‹ThreadLocalä¸­çš„å€¼ï¼šç¨‹åºæ–°è§†ç•Œ</span><br></pre></td></tr></table></figure><p>å¯¹ç…§ç¨‹åºå’Œè¾“å‡ºç»“æœï¼Œä½ ä¼šå‘ç°ï¼Œä¸»çº¿ç¨‹å’ŒThread-0å„è‡ªç‹¬äº«è‡ªå·±çš„å˜é‡å­˜å‚¨ã€‚ä¸»çº¿ç¨‹å¹¶æ²¡æœ‰å› ä¸ºThread-0è°ƒç”¨äº†HOLDERçš„setæ–¹æ³•è€Œè¢«æ”¹å˜ã€‚</p><p>ä¹‹æ‰€ä»¥èƒ½è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œæ­£æ˜¯å› ä¸ºåœ¨ThreadLocalä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹Threadæ‹¥æœ‰ä¸€ä»½è‡ªå·±çš„å‰¯æœ¬å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹äº’ä¸å¹²æ‰°ã€‚</p><p>ThreadLocalå’Œå…¶ä»–åŒæ­¥æœºåˆ¶ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸ºäº†è§£å†³å¤šçº¿ç¨‹å¯¹åŒä¸€å˜é‡çš„è®¿é—®å†²çªã€‚åœ¨æ™®é€šçš„åŒæ­¥æœºåˆ¶ä¸­ï¼Œè¯•å›¾ç”¨è¿‡å¯¹å¯¹è±¡æ·é”æ¥å®ç°å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å˜é‡çš„å®‰å…¨è®¿é—®çš„ã€‚ThreadLocalä»å¦ä¸€ä¸ªè§’åº¦æ¥è§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ï¼ŒThreadLocalå°†éœ€è¦å¹¶å‘è®¿é—®çš„èµ„æºå¤åˆ¶å¤šåˆ†ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ä¸€ä»½èµ„æºï¼Œä»è€Œå°±æ²¡æœ‰å¿…è¦å†å¯¹è¯¥å˜é‡è¿›è¡ŒåŒæ­¥äº†ã€‚åœ¨ç¼–å†™å¤šçº¿ç¨‹ä»£ç æ—¶ï¼Œå¯ä»¥æŠŠä¸å®‰å…¨çš„æ•´ä¸ªå˜é‡å°è£…è¿›ThreadLocalï¼Œæˆ–è€…æŠŠè¯¥å¯¹è±¡ä¸çº¿ç¨‹ç›¸å…³çš„çŠ¶æ€ä½¿ç”¨ThreadLocalä¿å­˜ã€‚</p><p>ThreadLocalä¸èƒ½ä»£æ›¿åŒæ­¥æœºåˆ¶ï¼Œä¸¤è€…é¢å‘çš„é¢†åŸŸä¸åŒã€‚åŒæ­¥æœºåˆ¶æ˜¯ä¸ºäº†åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹ç›¸åŒèµ„æºçš„å¹¶å‘è®¿é—®ï¼Œæ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æœ‰æ•ˆæ–¹å¼ï¼›è€ŒThreadLocalæ˜¯ä¸ºäº†éš”ç¦»å¤šä¸ªçº¿ç¨‹çš„æ•°æ®å…±äº«ï¼Œä»æ ¹æœ¬ä¸Šé¿å…äº†å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„ç«äº‰ã€‚</p><p><em>å‚è€ƒèµ„æ–™ï¼š<a href="https://zhuanlan.zhihu.com/p/368293603">https://zhuanlan.zhihu.com/p/368293603</a></em></p><h2 id="åŒ…è£…çº¿ç¨‹ä¸å®‰å…¨é›†åˆ"><a href="#åŒ…è£…çº¿ç¨‹ä¸å®‰å…¨é›†åˆ" class="headerlink" title="åŒ…è£…çº¿ç¨‹ä¸å®‰å…¨é›†åˆ"></a>åŒ…è£…çº¿ç¨‹ä¸å®‰å…¨é›†åˆ</h2><p>åœ¨Javaé›†åˆä¸­æ‰€è®²çš„ArrayListã€LinkedListã€HashSetã€TreeSetã€HashMapã€TreeMapéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚Collectionsæä¾›çš„ç±»æ–¹æ³•å¯ä»¥æŠŠè¿™äº›é›†åˆåŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚</p><ul><li>static <T> Collection<T> synchronizedCollection(Collection<T> c)</li><li>static <T> List<T> synchronizedList(List<T> list)</li><li>static <K,V> Map<K,V> synchronizedMap(Map<K,V> m)</li><li>static <T> Set<T> synchronizedSet(Set<T> s)</li><li>static <K,V> SortedMap<K,V> synchronizedSortedMap(SortedMap<K,V> m)</li><li>static <T> SortedSet<T> synchronizedSortedSet(SortedSet<T> s)</li></ul><p>ä¾‹å¦‚éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„HashMapå¯¹è±¡ï¼Œåˆ™é‡‡ç”¨ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = Collections.synchronizedMap(<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;()); <span class="comment">//åœ¨åˆ›å»ºåç«‹å³åŒ…è£…</span></span><br></pre></td></tr></table></figure><h2 id="çº¿ç¨‹å®‰å…¨é›†åˆç±»"><a href="#çº¿ç¨‹å®‰å…¨é›†åˆç±»" class="headerlink" title="çº¿ç¨‹å®‰å…¨é›†åˆç±»"></a>çº¿ç¨‹å®‰å…¨é›†åˆç±»</h2><p><img src="image-20210711190905713.png" alt="çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»"></p><p>çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>ä»¥Concurrentå¼€å¤´çš„é›†åˆç±»ï¼šä»£è¡¨äº†æ”¯æŒå¹¶å‘è®¿é—®çš„é›†åˆï¼Œå¯¹è¿™ç§é›†åˆçš„å†™å…¥æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†è¯»å–æ“ä½œä¸å¿…é”å®šã€‚</li><li>ä»¥CopyOnWriteå¼€å¤´çš„é›†åˆç±»ï¼šé‡‡ç”¨äº†æ›´å¤æ‚çš„ç®—æ³•ï¼ˆå¤åˆ¶åº•å±‚æ•°ç»„çš„æ–¹å¼å®ç°å†™æ“ä½œï¼‰æ¥ä¿è¯æ°¸è¿œä¸ä¼šé”ä½é›†åˆï¼Œå› æ­¤å¹¶å‘å†™å…¥æ—¶æœ‰è¾ƒå¥½çš„æ€§èƒ½ã€‚</li></ul><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><ul><li>é»˜è®¤æ”¯æŒ16ä¸ªçº¿ç¨‹å¹¶å‘å†™å…¥ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ„é€ å‚æ•°æ¥æ”¯æŒæ›´å¤šçš„å¹¶å‘ã€‚</li><li>J8æ‰©å±•äº†ConcurrentHashMapçš„åŠŸèƒ½ï¼Œæ–°å¢çš„æ–¹æ³•åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç±»<ul><li>forEach</li><li>search</li><li>reduce</li></ul></li></ul><h2 id="J9æ–°å¢çš„å‘å¸ƒ-è®¢é˜…æ¡†æ¶"><a href="#J9æ–°å¢çš„å‘å¸ƒ-è®¢é˜…æ¡†æ¶" class="headerlink" title="J9æ–°å¢çš„å‘å¸ƒ-è®¢é˜…æ¡†æ¶"></a>J9æ–°å¢çš„å‘å¸ƒ-è®¢é˜…æ¡†æ¶</h2><p>ç•¥</p><h1 id="Javaå¹¶å‘å…³é”®å­—"><a href="#Javaå¹¶å‘å…³é”®å­—" class="headerlink" title="Javaå¹¶å‘å…³é”®å­—"></a>Javaå¹¶å‘å…³é”®å­—</h1><h2 id="CountDownLacth"><a href="#CountDownLacth" class="headerlink" title="CountDownLacth"></a>CountDownLacth</h2><h2 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h2><h2 id="Semaphore-1"><a href="#Semaphore-1" class="headerlink" title="Semaphore"></a>Semaphore</h2><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><h1 id="è¡¥å……ï¼šè¿›ç¨‹è°ƒåº¦ç®—æ³•"><a href="#è¡¥å……ï¼šè¿›ç¨‹è°ƒåº¦ç®—æ³•" class="headerlink" title="è¡¥å……ï¼šè¿›ç¨‹è°ƒåº¦ç®—æ³•"></a>è¡¥å……ï¼šè¿›ç¨‹è°ƒåº¦ç®—æ³•</h1><h2 id="ä¼˜å…ˆè°ƒåº¦ç®—æ³•"><a href="#ä¼˜å…ˆè°ƒåº¦ç®—æ³•" class="headerlink" title="ä¼˜å…ˆè°ƒåº¦ç®—æ³•"></a>ä¼˜å…ˆè°ƒåº¦ç®—æ³•</h2><h2 id="é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•"><a href="#é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•" class="headerlink" title="é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•"></a>é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•</h2><h2 id="æ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•"><a href="#æ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•" class="headerlink" title="æ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•"></a>æ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•</h2><h1 id="è¡¥å……ï¼šCASã€ABAã€AQS"><a href="#è¡¥å……ï¼šCASã€ABAã€AQS" class="headerlink" title="è¡¥å……ï¼šCASã€ABAã€AQS"></a>è¡¥å……ï¼šCASã€ABAã€AQS</h1><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€Šç–¯ç‹‚Javaè®²ä¹‰ã€‹ å¤šçº¿ç¨‹ç¯‡</li><li><a href="https://mp.weixin.qq.com/s/F8PbZ5PnwGNI4jRiylCRpQ">ä¸ºä»€ä¹ˆé˜¿é‡Œä¸å…è®¸ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutorçš„æ–¹å¼ï¼Ÿ</a></li><li>ã€ŠOffer æ¥äº† Javaé¢è¯•æ ¸å¿ƒçŸ¥è¯†ç‚¹è®²è§£ åŸç†ç¯‡ã€‹ å¤šçº¿ç¨‹</li><li><a href="https://zhuanlan.zhihu.com/p/368293603">ThreadLocalå…¨æ”»ç•¥ï¼šä½¿ç”¨å®æˆ˜ï¼Œæºç åˆ†æï¼Œå†…å­˜æ³„éœ²åˆ†æ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> å¤šçº¿ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>_Pythonå®ç°ä¸€ä¸ªç®€å•çš„å¤šçº¿ç¨‹ç¨‹åº</title>
      <link href="/2022/01/20/Python%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%A8%8B%E5%BA%8F/"/>
      <url>/2022/01/20/Python%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ˜¯ä¸€ä¸ªçŸ¥è¯†ç¢ç‰‡ï¼Œä»¥åå†åšè¯¦ç»†æ•´ç†ã€‚</p></blockquote><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><p>æˆ‘å°è¯•ä½¿ç”¨å¤šçº¿ç¨‹æ‰¹é‡ä¸‹è½½å›¾ç‰‡ã€‚ä»£ç æ¡†æ¶å¦‚ä¸‹ï¼Œ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing.pool <span class="keyword">import</span> ThreadPool</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä¸‹è½½è¾“å…¥çš„urlä¿å­˜ä¸ºå›¾ç‰‡</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_urls</span>(<span class="params">url</span>):</span><br><span class="line">    r = requests.request(<span class="string">&#x27;GET&#x27;</span>, url, headers=&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;save_path&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(r.content)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># urls</span></span><br><span class="line">url_list = [<span class="string">&#x27;...&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å•çº¿ç¨‹</span></span><br><span class="line"><span class="comment">#  for url in url_list:</span></span><br><span class="line"><span class="comment">#      download_urls(url)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># è®¾ç½®çº¿ç¨‹æ± çº¿ç¨‹æ•°</span></span><br><span class="line">pool = ThreadPool(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># ä¼ å…¥ä¸‹è½½å‡½æ•°å’Œä¸‹è½½list</span></span><br><span class="line">pool.imap_unordered(download_urls, url_list)</span><br><span class="line"></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›®å‰æˆ‘ä¸æ˜ç™½çš„æ˜¯ï¼Œ</p><ul><li><strong>ä¸èƒ½ä½¿ç”¨mainå‡½æ•°å°†ä»£ç åŒ…å«è¿›å»ï¼Œå¦åˆ™èµ·ä¸æ¥å¤šçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</strong></li><li>Pythonå¤šçº¿ç¨‹çš„åŸºæœ¬çŸ¥è¯†ï¼›</li><li>Python GILç­‰ã€‚</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/weixin_36896856/article/details/108016558">Pythonä¸‹è½½æ–‡ä»¶çš„11ç§æ–¹å¼</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> å¤šçº¿ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹è¯»ä¹¦ç¬”è®°ï¼ˆäºŒï¼‰ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯å±‚</title>
      <link href="/2022/01/20/%E3%80%8A%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BB%8E%E5%85%A8%E8%BF%9E%E6%8E%A5%E5%B1%82%E5%88%B0%E5%8D%B7%E7%A7%AF%E5%B1%82/"/>
      <url>/2022/01/20/%E3%80%8A%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BB%8E%E5%85%A8%E8%BF%9E%E6%8E%A5%E5%B1%82%E5%88%B0%E5%8D%B7%E7%A7%AF%E5%B1%82/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡FROMã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ç¬¬å…­ç«  å·ç§¯ç¥ç»ç½‘ç»œ 6.1å’Œ6.2å°èŠ‚</p></blockquote><h1 id="ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯"><a href="#ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯" class="headerlink" title="ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯"></a>ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯</h1><p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰çš„å…¨è¿æ¥å±‚æ¥è®­ç»ƒå›¾ç‰‡æ•°æ®é›†ã€‚ä¸€å¼ æ™®é€šå›¾åƒéƒ½æ˜¯ç™¾ä¸‡åƒç´ ï¼Œå¦‚æœæŠŠå›¾åƒçš„æ¯ä¸€ä¸ªåƒç´ ä½œä¸ºä¸€ä¸ªç‰¹å¾ä¼ å…¥MLPï¼Œé‚£ä¹ˆç½‘ç»œçš„æ¯æ¬¡è¾“å…¥éƒ½æ˜¯ç™¾ä¸‡ç»´åº¦ï¼Œè¿™æ˜¯ä¸å¯æ¥å—çš„ï¼›å…¶æ¬¡ï¼Œä¹‹å‰æˆ‘ä»¬å¤„ç†äºŒç»´å›¾åƒæ—¶ï¼ŒæŠŠäºŒç»´å›¾åƒçš„æ‰€æœ‰åƒç´ ä½œä¸ºä¸€ä¸ªä¸€ç»´å‘é‡è¾“å…¥MLPï¼Œä¸¢å¤±äº†å›¾åƒçš„ç»“æ„ç‰¹å¾ã€‚</p><p><strong>å·ç§¯ç¥ç»ç½‘ç»œ</strong>ï¼ˆconvolutional neural networksï¼ŒCNNï¼‰åº”è¿è€Œç”Ÿï¼Œå®ƒæ˜¯æœºå™¨å­¦ä¹ åˆ©ç”¨è‡ªç„¶å›¾åƒä¸­ä¸€äº›å·²çŸ¥ç»“æ„çš„åˆ›é€ æ€§æ–¹æ³•ã€‚</p><h2 id="è‡ªç„¶å›¾åƒçš„ä¸¤ä¸ªæ€§è´¨"><a href="#è‡ªç„¶å›¾åƒçš„ä¸¤ä¸ªæ€§è´¨" class="headerlink" title="è‡ªç„¶å›¾åƒçš„ä¸¤ä¸ªæ€§è´¨"></a>è‡ªç„¶å›¾åƒçš„ä¸¤ä¸ªæ€§è´¨</h2><p>æˆ‘ä»¬æ ¹æ®è‡ªç„¶å›¾åƒçš„ä¸¤ä¸ªæ€§è´¨ï¼Œæ¥è®¾è®¡é€‚åˆäºè®¡ç®—æœºè§†è§‰çš„ç¥ç»ç½‘ç»œæ¶æ„ï¼š</p><ol><li><em>å¹³ç§»ä¸å˜æ€§</em>ï¼ˆtranslation invarianceï¼‰ï¼šä¸ç®¡æ£€æµ‹å¯¹è±¡å‡ºç°åœ¨å›¾åƒä¸­çš„å“ªä¸ªä½ç½®ï¼Œç¥ç»ç½‘ç»œçš„å‰é¢å‡ å±‚åº”è¯¥å¯¹ç›¸åŒçš„å›¾åƒåŒºåŸŸå…·æœ‰ç›¸ä¼¼çš„ååº”ï¼Œå³ä¸ºâ€œå¹³ç§»ä¸å˜æ€§â€ã€‚</li><li><em>å±€éƒ¨æ€§</em>ï¼ˆlocalityï¼‰ï¼šç¥ç»ç½‘ç»œçš„å‰é¢å‡ å±‚åº”è¯¥åªæ¢ç´¢è¾“å…¥å›¾åƒä¸­çš„å±€éƒ¨åŒºåŸŸï¼Œè€Œä¸è¿‡åº¦åœ¨æ„å›¾åƒä¸­ç›¸éš”è¾ƒè¿œåŒºåŸŸçš„å…³ç³»ï¼Œè¿™å°±æ˜¯â€œå±€éƒ¨æ€§â€åŸåˆ™ã€‚æœ€ç»ˆï¼Œå¯ä»¥èšåˆè¿™äº›å±€éƒ¨ç‰¹å¾ï¼Œä»¥åœ¨æ•´ä¸ªå›¾åƒçº§åˆ«è¿›è¡Œé¢„æµ‹ã€‚</li></ol><h2 id="MLPçš„é™åˆ¶"><a href="#MLPçš„é™åˆ¶" class="headerlink" title="MLPçš„é™åˆ¶"></a>MLPçš„é™åˆ¶</h2><p>é¦–å…ˆï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„è¾“å…¥æ˜¯äºŒç»´å›¾åƒ$\mathbf{X}$ï¼Œå…¶éšè—è¡¨ç¤º $\mathbf{H}$ åœ¨æ•°å­¦ä¸Šæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œåœ¨ä»£ç ä¸­è¡¨ç¤ºä¸ºäºŒç»´å¼ é‡ã€‚å…¶ä¸­ $\mathbf{X}$ å’Œ $\mathbf{H}$ å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œæ— è®ºæ˜¯è¾“å…¥è¿˜æ˜¯éšè—è¡¨ç¤ºéƒ½æ‹¥æœ‰ç©ºé—´ç»“æ„ã€‚</p><blockquote><p>æ‰€è°“éšè—è¡¨ç¤ºæ˜¯æŒ‡è¾“å…¥ç»è¿‡MLPçš„ä¸€å±‚åå¾—åˆ°çš„è¾“å‡ºã€‚</p></blockquote><p>ä½¿ç”¨  $[\mathbf{X}]<em>{i, j}$ å’Œ $[\mathbf{H}]</em>{i, j}$ åˆ†åˆ«è¡¨ç¤ºè¾“å…¥å›¾åƒå’Œéšè—è¡¨ç¤ºä¸­ä½ç½®($i$, $j$)å¤„çš„åƒç´ ã€‚</p><p>ä¸ºäº†ä½¿æ¯ä¸ªéšè—ç¥ç»å…ƒéƒ½èƒ½æ¥æ”¶åˆ°æ¯ä¸ªè¾“å…¥åƒç´ çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†å‚æ•°ä»æƒé‡çŸ©é˜µï¼ˆå¦‚åŒæˆ‘ä»¬å…ˆå‰åœ¨å¤šå±‚æ„ŸçŸ¥æœºä¸­æ‰€åšçš„é‚£æ ·ï¼‰æ›¿æ¢ä¸ºå››é˜¶æƒé‡å¼ é‡ $\mathsf{W}$ã€‚å‡è®¾ $\mathbf{U}$ åŒ…å«åç½®å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¨è¿æ¥å±‚å½¢å¼åŒ–åœ°è¡¨ç¤ºä¸º</p><blockquote><p>åœ¨ä¹‹å‰è¾“å…¥è¾“å‡ºéƒ½æ˜¯ä¸€ç»´å¼ é‡æ—¶ï¼Œæƒé‡ä¸ºäºŒç»´å¼ é‡ã€‚ç°åœ¨è¾“å…¥è¾“å‡ºéƒ½æ˜¯äºŒç»´å¼ é‡ï¼Œåˆ™æƒé‡ä¸ºå››ç»´å¼ é‡ã€‚</p></blockquote><script type="math/tex; mode=display">\begin{aligned} \left[\mathbf{H}\right]_{i, j} &= [\mathbf{U}]_{i, j} + \sum_k \sum_l[\mathsf{W}]_{i, j, k, l}  [\mathbf{X}]_{k, l}\\ &=  [\mathbf{U}]_{i, j} +\sum_a \sum_b [\mathsf{V}]_{i, j, a, b}  [\mathbf{X}]_{i+a, j+b}.\end{aligned}</script><blockquote><p>è¿™é‡Œ $\mathsf{W}$ å’Œ $\mathsf{V}$ çš„è½¬æ¢ä»…ä»…æ˜¯é‡æ–°è¿›è¡Œäº†ç´¢å¼•ã€‚æˆ‘ä»¬åªéœ€é‡æ–°ç´¢å¼•ä¸‹æ ‡ $(k, l)$ï¼Œä½¿ $k = i+a$ã€$l = j+b$ï¼Œ ç”±æ­¤å¯å¾— $[\mathsf{V}]<em>{i, j, a, b} = [\mathsf{W}]</em>{i, j, i+a, j+b}$ã€‚</p><p>ç´¢å¼• $a$ å’Œ $b$ é€šè¿‡åœ¨æ­£åç§»å’Œè´Ÿåç§»ä¹‹é—´ç§»åŠ¨è¦†ç›–äº†æ•´ä¸ªå›¾åƒã€‚å¯¹äºéšè—è¡¨ç¤ºä¸­ä»»æ„ç»™å®šä½ç½®ï¼ˆ$i$, $j$ï¼‰å¤„çš„åƒç´ å€¼$[\mathbf{H}]<em>{i, j}$ï¼Œå¯ä»¥é€šè¿‡åœ¨ $x$ ä¸­ä»¥ $(i, j)$ ä¸ºä¸­å¿ƒå¯¹åƒç´ è¿›è¡ŒåŠ æƒæ±‚å’Œå¾—åˆ°ï¼ŒåŠ æƒä½¿ç”¨çš„æƒé‡ä¸º $[\mathsf{V}]</em>{i, j, a, b}$ ã€‚</p></blockquote><h3 id="å¹³ç§»ä¸å˜æ€§"><a href="#å¹³ç§»ä¸å˜æ€§" class="headerlink" title="å¹³ç§»ä¸å˜æ€§"></a>å¹³ç§»ä¸å˜æ€§</h3><p>ç°åœ¨å¼•ç”¨ä¸Šè¿°çš„ç¬¬ä¸€ä¸ªåŸåˆ™ï¼šå¹³ç§»ä¸å˜æ€§ã€‚è¿™æ„å‘³ç€æ£€æµ‹å¯¹è±¡åœ¨è¾“å…¥ $\mathbf{X}$ ä¸­çš„å¹³ç§»ï¼Œåº”è¯¥ä»…ä»…å¯¼è‡´éšè—è¡¨ç¤º $\mathbf{H}$ ä¸­çš„å¹³ç§»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ $\mathsf{V}$ å’Œ $\mathbf{U}$ å®é™…ä¸Šä¸ä¾èµ–äº $(i, j)$ çš„å€¼ï¼Œå³ $[\mathsf{V}]<em>{i, j, a, b} = [\mathbf{V}]</em>{a, b}$ã€‚å¹¶ä¸”  $\mathbf{U}$ æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ¯”å¦‚ $u$ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ– $\mathbf{H}$ å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">[\mathbf{H}]_{i, j} = u + \sum_a\sum_b [\mathbf{V}]_{a, b} [\mathbf{X}]_{i+a, j+b}.</script><p>è¿™å°±æ˜¯ <em>å·ç§¯</em> ï¼ˆconvolutionï¼‰ã€‚æˆ‘ä»¬æ˜¯åœ¨ä½¿ç”¨ç³»æ•° $[\mathbf{V}]<em>{a, b}$ å¯¹ä½ç½® $(i, j)$ é™„è¿‘çš„åƒç´  $(i+a, j+b)$ è¿›è¡ŒåŠ æƒå¾—åˆ°$[\mathbf{H}]</em>{i, j}$ã€‚</p><p>æ³¨æ„ï¼Œ$[\mathbf{V}]<em>{a, b}$ çš„ç³»æ•°æ¯” $[\mathsf{V}]</em>{i, j, a, b}$ å°‘å¾ˆå¤šï¼Œå› ä¸ºå‰è€…ä¸å†ä¾èµ–äºå›¾åƒä¸­çš„ä½ç½®ã€‚è¿™å°±æ˜¯æ˜¾è‘—çš„è¿›æ­¥ï¼</p><h3 id="å±€éƒ¨æ€§"><a href="#å±€éƒ¨æ€§" class="headerlink" title="å±€éƒ¨æ€§"></a>å±€éƒ¨æ€§</h3><p>ç°åœ¨å¼•ç”¨ä¸Šè¿°çš„ç¬¬äºŒä¸ªåŸåˆ™ï¼šå±€éƒ¨æ€§ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œä¸ºäº†æ”¶é›†ç”¨æ¥è®­ç»ƒå‚æ•° $[\mathbf{H}]<em>{i, j}$ çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸åº”åç¦»åˆ°è· $(i, j)$ å¾ˆè¿œçš„åœ°æ–¹ã€‚è¿™æ„å‘³ç€åœ¨ $|a|&gt; \Delta$ æˆ– $|b| &gt; \Delta$ çš„èŒƒå›´ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® $[\mathbf{V}]</em>{a, b} = 0$ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† $[\mathbf{H}]_{i, j}$ é‡å†™ä¸º</p><script type="math/tex; mode=display">[\mathbf{H}]_{i, j} = u + \sum_{a = -\Delta}^{\Delta} \sum_{b = -\Delta}^{\Delta} [\mathbf{V}]_{a, b}  [\mathbf{X}]_{i+a, j+b}. \tag{$1$}</script><p>ç®€è€Œè¨€ä¹‹ï¼Œ å…¬å¼ï¼ˆ1ï¼‰ä»£è¡¨çš„æ˜¯ä¸€ä¸ª <em>å·ç§¯å±‚</em> ï¼ˆconvolutional layerï¼‰ï¼Œè€Œå·ç§¯ç¥ç»ç½‘ç»œæ˜¯åŒ…å«å·ç§¯å±‚çš„ä¸€ç±»ç‰¹æ®Šçš„ç¥ç»ç½‘ç»œã€‚</p><p>åœ¨æ·±åº¦å­¦ä¹ ç ”ç©¶ç¤¾åŒºä¸­ï¼Œ $\mathbf{V}$ è¢«ç§°ä¸º <em>å·ç§¯æ ¸</em> ï¼ˆconvolution kernelï¼‰ æˆ–è€…  <em>æ»¤æ³¢å™¨</em> ï¼ˆfilterï¼‰ï¼Œå®ƒä»…ä»…æ˜¯å¯å­¦ä¹ çš„ä¸€ä¸ªå±‚çš„æƒé‡ã€‚</p><p>å½“å›¾åƒå¤„ç†çš„å±€éƒ¨åŒºåŸŸå¾ˆå°æ—¶ï¼Œå·ç§¯ç¥ç»ç½‘ç»œä¸å¤šå±‚æ„ŸçŸ¥æœºçš„è®­ç»ƒå·®å¼‚å¯èƒ½æ˜¯å·¨å¤§çš„ï¼šä»¥å‰ï¼Œå¤šå±‚æ„ŸçŸ¥æœºå¯èƒ½éœ€è¦æ•°åäº¿ä¸ªå‚æ•°æ¥è¡¨ç¤ºç½‘ç»œä¸­çš„ä¸€å±‚ï¼Œè€Œç°åœ¨å·ç§¯ç¥ç»ç½‘ç»œé€šå¸¸åªéœ€è¦å‡ ç™¾ä¸ªå‚æ•°ï¼Œè€Œä¸”ä¸éœ€è¦æ”¹å˜è¾“å…¥æˆ–éšè—è¡¨ç¤ºçš„ç»´æ•°ã€‚</p><p>å‚æ•°å¤§å¹…å‡å°‘çš„ä»£ä»·æ˜¯ï¼Œæˆ‘ä»¬çš„ç‰¹å¾ç°åœ¨æ˜¯å¹³ç§»ä¸å˜çš„ï¼Œå¹¶ä¸”å½“ç¡®å®šæ¯ä¸ªéšè—æ¿€æ´»çš„å€¼æ—¶ï¼Œæ¯ä¸€å±‚åªèƒ½åŒ…å«å±€éƒ¨çš„ä¿¡æ¯ã€‚</p><p>ä»¥ä¸Šæ‰€æœ‰çš„æƒé‡å­¦ä¹ éƒ½å°†ä¾èµ–äºå½’çº³åç½®ã€‚å½“è¿™ç§åç½®ä¸ç°å®ç›¸ç¬¦æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°æ ·æœ¬æœ‰æ•ˆçš„æ¨¡å‹ï¼Œå¹¶ä¸”è¿™äº›æ¨¡å‹èƒ½å¾ˆå¥½åœ°æ³›åŒ–åˆ°æœªçŸ¥æ•°æ®ä¸­ã€‚</p><p>ä½†å¦‚æœè¿™åç½®ä¸ç°å®ä¸ç¬¦æ—¶ï¼Œæ¯”å¦‚å½“å›¾åƒä¸æ»¡è¶³å¹³ç§»ä¸å˜æ—¶ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å¯èƒ½éš¾ä»¥æ‹Ÿåˆæˆ‘ä»¬çš„è®­ç»ƒæ•°æ®ã€‚</p><h2 id="å·ç§¯"><a href="#å·ç§¯" class="headerlink" title="å·ç§¯"></a>å·ç§¯</h2><p>åœ¨è¿›ä¸€æ­¥è®¨è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€è¦å›é¡¾ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸Šé¢çš„æ“ä½œè¢«ç§°ä¸ºå·ç§¯ã€‚åœ¨æ•°å­¦ä¸­ï¼Œä¸¤ä¸ªå‡½æ•°ï¼ˆæ¯”å¦‚ $f, g: \mathbb{R}^d \to \mathbb{R}$ï¼‰ä¹‹é—´çš„â€œå·ç§¯â€è¢«å®šä¹‰ä¸º</p><script type="math/tex; mode=display">(f * g)(\mathbf{x}) = \int f(\mathbf{z}) g(\mathbf{x}-\mathbf{z}) d\mathbf{z}.</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå·ç§¯æ˜¯æµ‹é‡ $f$ å’Œ $g$ ä¹‹é—´ï¼ˆæŠŠå…¶ä¸­ä¸€ä¸ªå‡½æ•°â€œç¿»è½¬â€å¹¶ç§»ä½ $\mathbf{x}$ æ—¶ï¼‰çš„é‡å ã€‚</p><p>å½“æˆ‘ä»¬æœ‰ç¦»æ•£å¯¹è±¡æ—¶ï¼Œç§¯åˆ†å°±å˜æˆæ±‚å’Œã€‚ä¾‹å¦‚ï¼šå¯¹äºç”±ç´¢å¼•ä¸º$\mathbb{Z}$çš„ã€å¹³æ–¹å¯å’Œçš„ã€æ— é™ç»´å‘é‡é›†åˆä¸­æŠ½å–çš„å‘é‡ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å®šä¹‰ï¼š</p><script type="math/tex; mode=display">(f * g)(i) = \sum_a f(a) g(i-a).</script><p>å¯¹äºäºŒç»´å¼ é‡ï¼Œåˆ™ä¸º $f$ çš„ç´¢å¼• $(a, b)$ å’Œ $g$ çš„ç´¢å¼• $(i-a, j-b)$ ä¸Šçš„å¯¹åº”å’Œï¼š</p><script type="math/tex; mode=display">(f * g)(i, j) = \sum_a\sum_b f(a, b) g(i-a, j-b).  \tag{$2$}</script><p>è¿™çœ‹èµ·æ¥ç±»ä¼¼äºå…¬å¼ï¼ˆ1ï¼‰ï¼Œä½†æœ‰ä¸€ä¸ªä¸»è¦åŒºåˆ«ï¼šè¿™é‡Œä¸æ˜¯ä½¿ç”¨ $(i+a, j+b)$ ï¼Œè€Œæ˜¯ä½¿ç”¨å·®å€¼ã€‚ç„¶è€Œï¼Œè¿™ç§åŒºåˆ«ä¸»è¦æ˜¯è£…é¥°æ€§çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯å¯ä»¥åŒ¹é…å…¬å¼ï¼ˆ1ï¼‰å’Œå…¬å¼ï¼ˆ2ï¼‰ä¹‹é—´çš„ç¬¦å·ã€‚æˆ‘ä»¬åœ¨å…¬å¼ï¼ˆ1ï¼‰ä¸­çš„åŸå§‹å®šä¹‰æ›´æ­£ç¡®åœ°æè¿°äº†<em>äº’ç›¸å…³</em>ï¼ˆcross-correlationï¼‰ã€‚</p><h2 id="é€šé“"><a href="#é€šé“" class="headerlink" title="é€šé“"></a>é€šé“</h2><p>ç„¶è€Œï¼ˆä¸Šè¿°ï¼‰è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¿½ç•¥äº†å›¾åƒä¸€èˆ¬åŒ…å«ä¸‰ä¸ªé€šé“/ä¸‰ç§åŸè‰²ï¼ˆçº¢è‰²ã€ç»¿è‰²å’Œè“è‰²ï¼‰ã€‚å®é™…ä¸Šï¼Œå›¾åƒä¸æ˜¯äºŒç»´å¼ é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªç”±é«˜åº¦ã€å®½åº¦å’Œé¢œè‰²ç»„æˆçš„ä¸‰ç»´å¼ é‡ï¼Œæ¯”å¦‚åŒ…å« $1024 \times 1024 \times 3$ ä¸ªåƒç´ ã€‚å‰ä¸¤ä¸ªè½´ä¸åƒç´ çš„ç©ºé—´ä½ç½®æœ‰å…³ï¼Œè€Œç¬¬ä¸‰ä¸ªè½´å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸ªåƒç´ çš„å¤šç»´è¡¨ç¤ºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°† $\mathsf{X}$ ç´¢å¼•ä¸º $[\mathsf{X}]<em>{i, j, k}$ ã€‚ç”±æ­¤å·ç§¯ç›¸åº”åœ°è°ƒæ•´ä¸º $[\mathsf{V}]</em>{a,b,c}$ ï¼Œè€Œä¸æ˜¯ $[\mathbf{V}]_{a,b}$ ã€‚</p><p>æ­¤å¤–ï¼Œç”±äºè¾“å…¥å›¾åƒæ˜¯ä¸‰ç»´çš„ï¼Œæˆ‘ä»¬çš„éšè—è¡¨ç¤º $\mathsf{H}$ ä¹Ÿæœ€å¥½é‡‡ç”¨ä¸‰ç»´å¼ é‡ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæ¯ä¸€ä¸ªç©ºé—´ä½ç½®ï¼Œæˆ‘ä»¬æƒ³è¦é‡‡ç”¨ä¸€ç»„è€Œä¸æ˜¯ä¸€ä¸ªéšè—è¡¨ç¤ºã€‚è¿™æ ·ä¸€ç»„éšè—è¡¨ç¤ºå¯ä»¥æƒ³è±¡æˆä¸€äº›äº’ç›¸å †å çš„äºŒç»´ç½‘æ ¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠéšè—è¡¨ç¤ºæƒ³è±¡ä¸ºä¸€ç³»åˆ—å…·æœ‰äºŒç»´å¼ é‡çš„ <em>é€šé“</em> ï¼ˆchannelï¼‰ã€‚è¿™äº›é€šé“æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º <em>ç‰¹å¾æ˜ å°„</em> ï¼ˆfeature mapsï¼‰ï¼Œå› ä¸ºæ¯ä¸ªé€šé“éƒ½å‘åç»­å±‚æä¾›ä¸€ç»„ç©ºé—´åŒ–çš„å­¦ä¹ ç‰¹å¾ã€‚ç›´è§‚ä¸Šä½ å¯ä»¥æƒ³è±¡åœ¨é è¿‘è¾“å…¥çš„åº•å±‚ï¼Œä¸€äº›é€šé“ä¸“é—¨è¯†åˆ«è¾¹ï¼Œè€Œå…¶ä»–é€šé“ä¸“é—¨è¯†åˆ«çº¹ç†ã€‚</p><p>ä¸ºäº†æ”¯æŒè¾“å…¥ $\mathsf{X}$ å’Œéšè—è¡¨ç¤º $\mathsf{H}$ ä¸­çš„å¤šä¸ªé€šé“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ $\mathsf{V}$ ä¸­æ·»åŠ ç¬¬å››ä¸ªåæ ‡ï¼Œå³ $[\mathsf{V}]_{a, b, c, d}$ ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œ</p><script type="math/tex; mode=display">[\mathsf{H}]_{i,j,d} = \sum_{a = -\Delta}^{\Delta} \sum_{b = -\Delta}^{\Delta} \sum_c [\mathsf{V}]_{a, b, c, d} [\mathsf{X}]_{i+a, j+b, c}, \tag{$3$}</script><p>å…¶ä¸­éšè—è¡¨ç¤º $\mathsf{H}$ ä¸­çš„ $d$ ç´¢å¼•è¡¨ç¤ºè¾“å‡ºé€šé“ï¼Œè€Œéšåçš„è¾“å‡ºå°†ç»§ç»­ä»¥ä¸‰ç»´å¼ é‡ $\mathsf{H}$ ä½œä¸ºè¾“å…¥è¿›å…¥ä¸‹ä¸€ä¸ªå·ç§¯å±‚ã€‚æ‰€ä»¥ï¼Œå…¬å¼ï¼ˆ3ï¼‰å¯ä»¥å®šä¹‰å…·æœ‰å¤šä¸ªé€šé“çš„å·ç§¯å±‚ï¼Œè€Œå…¶ä¸­ $\mathsf{V}$ æ˜¯è¯¥å·ç§¯å±‚çš„æƒé‡ã€‚</p><h1 id="å›¾åƒå·ç§¯"><a href="#å›¾åƒå·ç§¯" class="headerlink" title="å›¾åƒå·ç§¯"></a>å›¾åƒå·ç§¯</h1><h2 id="äº’ç›¸å…³è¿ç®—"><a href="#äº’ç›¸å…³è¿ç®—" class="headerlink" title="äº’ç›¸å…³è¿ç®—"></a>äº’ç›¸å…³è¿ç®—</h2><p>ä¸¥æ ¼æ¥è¯´ï¼Œå·ç§¯å±‚æ˜¯ä¸ªé”™è¯¯çš„å«æ³•ï¼Œå› ä¸ºå®ƒæ‰€è¡¨è¾¾çš„è¿ç®—å…¶å®æ˜¯ <em>äº’ç›¸å…³è¿ç®—</em> (cross-correlation)ï¼Œè€Œä¸æ˜¯å·ç§¯è¿ç®—ã€‚ä¸ºäº†ä¸æ·±åº¦å­¦ä¹ æ–‡çŒ®ä¸­çš„æ ‡å‡†æœ¯è¯­ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬å°†ç»§ç»­æŠŠâ€œäº’ç›¸å…³è¿ç®—â€ç§°ä¸ºå·ç§¯è¿ç®—ï¼Œå°½ç®¡ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬ç•¥æœ‰ä¸åŒ.æ­¤å¤–ï¼Œå¯¹äºå·ç§¯æ ¸å¼ é‡ä¸Šçš„æƒé‡ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º<em>å…ƒç´ </em>ã€‚</p><p>æ ¹æ®ä¸Šä¸€èŠ‚çš„æè¿°ï¼Œåœ¨å·ç§¯å±‚ä¸­ï¼Œè¾“å…¥å¼ é‡å’Œæ ¸å¼ é‡é€šè¿‡(<strong>äº’ç›¸å…³è¿ç®—</strong>)äº§ç”Ÿè¾“å‡ºå¼ é‡ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æš‚æ—¶å¿½ç•¥é€šé“ï¼ˆç¬¬ä¸‰ç»´ï¼‰è¿™ä¸€æƒ…å†µï¼Œçœ‹çœ‹å¦‚ä½•å¤„ç†äºŒç»´å›¾åƒæ•°æ®å’Œéšè—è¡¨ç¤ºã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œè¾“å…¥æ˜¯é«˜åº¦ä¸º $3$ã€å®½åº¦ä¸º $3$ çš„äºŒç»´å¼ é‡ï¼ˆå³å½¢çŠ¶ä¸º $3 \times 3$ ï¼‰ã€‚å·ç§¯æ ¸çš„é«˜åº¦å’Œå®½åº¦éƒ½æ˜¯ $2$ã€‚</p><p><img src="correlation.svg" alt="å›¾1: äºŒç»´äº’ç›¸å…³è¿ç®—ã€‚é˜´å½±éƒ¨åˆ†æ˜¯ç¬¬ä¸€ä¸ªè¾“å‡ºå…ƒç´ ï¼Œä»¥åŠç”¨äºè®¡ç®—è¿™ä¸ªè¾“å‡ºçš„è¾“å…¥å’Œæ ¸å¼ é‡å…ƒç´ ï¼š$0\times0+1\times1+3\times2+4\times3=19$."></p><p>åœ¨äºŒç»´äº’ç›¸å…³è¿ç®—ä¸­ï¼Œå·ç§¯çª—å£ä»è¾“å…¥å¼ é‡çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹æ»‘åŠ¨ã€‚å½“å·ç§¯çª—å£æ»‘åŠ¨åˆ°æ–°ä¸€ä¸ªä½ç½®æ—¶ï¼ŒåŒ…å«åœ¨è¯¥çª—å£ä¸­çš„éƒ¨åˆ†å¼ é‡ä¸å·ç§¯æ ¸å¼ é‡è¿›è¡ŒæŒ‰å…ƒç´ ç›¸ä¹˜ï¼Œå¾—åˆ°çš„å¼ é‡å†æ±‚å’Œå¾—åˆ°ä¸€ä¸ªå•ä¸€çš„æ ‡é‡å€¼ï¼Œç”±æ­¤æˆ‘ä»¬å¾—å‡ºäº†è¿™ä¸€ä½ç½®çš„è¾“å‡ºå¼ é‡å€¼ã€‚</p><p>åœ¨å¦‚ä¸Šä¾‹å­ä¸­ï¼Œè¾“å‡ºå¼ é‡çš„å››ä¸ªå…ƒç´ ç”±äºŒç»´äº’ç›¸å…³è¿ç®—å¾—åˆ°ï¼Œè¿™ä¸ªè¾“å‡ºé«˜åº¦ä¸º $2$ ã€å®½åº¦ä¸º $2$ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><script type="math/tex; mode=display">0\times0+1\times1+3\times2+4\times3=19,\\1\times0+2\times1+4\times2+5\times3=25,\\3\times0+4\times1+6\times2+7\times3=37,\\4\times0+5\times1+7\times2+8\times3=43.</script><p>æ³¨æ„ï¼Œè¾“å‡ºå¤§å°ç•¥å°äºè¾“å…¥å¤§å°ã€‚è¿™æ˜¯å› ä¸ºå·ç§¯æ ¸çš„å®½åº¦å’Œé«˜åº¦å¤§äº1ï¼Œè€Œå·ç§¯æ ¸åªä¸å›¾åƒä¸­æ¯ä¸ªå¤§å°å®Œå…¨é€‚åˆçš„ä½ç½®è¿›è¡Œäº’ç›¸å…³è¿ç®—ã€‚æ‰€ä»¥ï¼Œè¾“å‡ºå¤§å°ç­‰äºè¾“å…¥å¤§å° $n_h \times n_w$ å‡å»å·ç§¯æ ¸å¤§å° $k_h \times k_w$ï¼Œå³ï¼š</p><script type="math/tex; mode=display">(n_h-k_h+1) \times (n_w-k_w+1).</script><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦è¶³å¤Ÿçš„ç©ºé—´åœ¨å›¾åƒä¸Šâ€œç§»åŠ¨â€å·ç§¯æ ¸ã€‚ç¨åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•é€šè¿‡åœ¨å›¾åƒè¾¹ç•Œå‘¨å›´å¡«å……é›¶æ¥ä¿è¯æœ‰è¶³å¤Ÿçš„ç©ºé—´ç§»åŠ¨å†…æ ¸ï¼Œä»è€Œä¿æŒè¾“å‡ºå¤§å°ä¸å˜ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ <code>corr2d</code> å‡½æ•°ä¸­å®ç°å¦‚ä¸Šè¿‡ç¨‹ï¼Œè¯¥å‡½æ•°æ¥å—è¾“å…¥å¼ é‡ <code>X</code> å’Œå·ç§¯æ ¸å¼ é‡  <code>K</code> ï¼Œå¹¶è¿”å›è¾“å‡ºå¼ é‡ <code>Y</code> ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"><span class="comment"># è¾“å…¥å¼ é‡Xå’Œå·ç§¯æ ¸å¼ é‡K</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">corr2d</span>(<span class="params">X, K</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—äºŒç»´äº’ç›¸å…³è¿ç®—&quot;&quot;&quot;</span></span><br><span class="line">    h, w = K.shape</span><br><span class="line">    <span class="comment"># æ ¹æ®Xå’ŒKå¾—åˆ°è¾“å‡ºYçš„å½¢çŠ¶</span></span><br><span class="line">    Y = torch.zeros((X.shape[<span class="number">0</span>] - h + <span class="number">1</span>, X.shape[<span class="number">1</span>] - w + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Y.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Y.shape[<span class="number">1</span>]):</span><br><span class="line">            Y[i, j] = (X[i:i + h, j:j + w] * K).<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">return</span> Y</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¹ä¸Šè¿°å‡½æ•°è¿›è¡ŒéªŒè¯</span></span><br><span class="line">X = torch.tensor([[<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>], [<span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>]])</span><br><span class="line">K = torch.tensor([[<span class="number">0.0</span>, <span class="number">1.0</span>], [<span class="number">2.0</span>, <span class="number">3.0</span>]])</span><br><span class="line">corr2d(X, K)</span><br></pre></td></tr></table></figure><pre><code>tensor([[19., 25.],        [37., 43.]])</code></pre><h2 id="å·ç§¯å±‚"><a href="#å·ç§¯å±‚" class="headerlink" title="å·ç§¯å±‚"></a>å·ç§¯å±‚</h2><p>å·ç§¯å±‚å¯¹è¾“å…¥å’Œå·ç§¯æ ¸æƒé‡è¿›è¡Œäº’ç›¸å…³è¿ç®—ï¼Œå¹¶åœ¨æ·»åŠ æ ‡é‡åç½®ä¹‹åäº§ç”Ÿè¾“å‡ºã€‚æ‰€ä»¥ï¼Œå·ç§¯å±‚ä¸­çš„ä¸¤ä¸ªè¢«è®­ç»ƒçš„å‚æ•°æ˜¯<strong>å·ç§¯æ ¸æƒé‡</strong>å’Œ<strong>æ ‡é‡åç½®</strong>ã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰éšæœºåˆå§‹åŒ–å…¨è¿æ¥å±‚ä¸€æ ·ï¼Œåœ¨è®­ç»ƒåŸºäºå·ç§¯å±‚çš„æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéšæœºåˆå§‹åŒ–å·ç§¯æ ¸æƒé‡ã€‚</p><p>åŸºäºä¸Šé¢å®šä¹‰çš„ <code>corr2d</code> å‡½æ•°[<strong>å®ç°äºŒç»´å·ç§¯å±‚</strong>]ã€‚åœ¨ <code>__init__</code> æ„é€ å‡½æ•°ä¸­ï¼Œå°† <code>weight</code> å’Œ <code>bias</code> å£°æ˜ä¸ºä¸¤ä¸ªæ¨¡å‹å‚æ•°ã€‚å‰å‘ä¼ æ’­å‡½æ•°è°ƒç”¨ <code>corr2d</code> å‡½æ•°å¹¶æ·»åŠ åç½®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Conv2D</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, kernel_size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.weight = nn.Parameter(torch.rand(kernel_size))</span><br><span class="line">        self.bias = nn.Parameter(torch.zeros(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> corr2d(x, self.weight) + self.bias</span><br></pre></td></tr></table></figure><p>é«˜åº¦å’Œå®½åº¦åˆ†åˆ«ä¸º $h$ å’Œ $w$çš„å·ç§¯æ ¸å¯ä»¥è¢«ç§°ä¸º $h \times w$ å·ç§¯æˆ– $h \times w$ å·ç§¯æ ¸ã€‚æˆ‘ä»¬ä¹Ÿå°†å¸¦æœ‰ $h \times w$ å·ç§¯æ ¸çš„å·ç§¯å±‚ç§°ä¸º $h \times w$ å·ç§¯å±‚ã€‚</p><h2 id="å›¾åƒä¸­ç›®æ ‡çš„è¾¹ç¼˜æ£€æµ‹"><a href="#å›¾åƒä¸­ç›®æ ‡çš„è¾¹ç¼˜æ£€æµ‹" class="headerlink" title="å›¾åƒä¸­ç›®æ ‡çš„è¾¹ç¼˜æ£€æµ‹"></a>å›¾åƒä¸­ç›®æ ‡çš„è¾¹ç¼˜æ£€æµ‹</h2><p>å¦‚ä¸‹æ˜¯<strong>å·ç§¯å±‚çš„ä¸€ä¸ªç®€å•åº”ç”¨ï¼š</strong>é€šè¿‡æ‰¾åˆ°åƒç´ å˜åŒ–çš„ä½ç½®ï¼Œæ¥<strong>æ£€æµ‹å›¾åƒä¸­ä¸åŒé¢œè‰²çš„è¾¹ç¼˜</strong>ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ª $6\times 8$ åƒç´ çš„é»‘ç™½å›¾åƒã€‚ä¸­é—´å››åˆ—ä¸ºé»‘è‰²ï¼ˆ$0$ï¼‰ï¼Œå…¶ä½™åƒç´ ä¸ºç™½è‰²ï¼ˆ$1$ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = torch.ones((<span class="number">6</span>, <span class="number">8</span>))</span><br><span class="line">X[:, <span class="number">2</span>:<span class="number">6</span>] = <span class="number">0</span></span><br><span class="line">X</span><br></pre></td></tr></table></figure><pre><code>tensor([[1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.],        [1., 1., 0., 0., 0., 0., 1., 1.]])</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªé«˜åº¦ä¸º $1$ ã€å®½åº¦ä¸º $2$ çš„å·ç§¯æ ¸ <code>K</code> ã€‚å½“è¿›è¡Œäº’ç›¸å…³è¿ç®—æ—¶ï¼Œå¦‚æœæ°´å¹³ç›¸é‚»çš„ä¸¤å…ƒç´ ç›¸åŒï¼Œåˆ™è¾“å‡ºä¸ºé›¶ï¼Œå¦åˆ™è¾“å‡ºä¸ºéé›¶ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">K = torch.tensor([[<span class="number">1.0</span>, -<span class="number">1.0</span>]])</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹å‚æ•° <code>X</code> ï¼ˆè¾“å…¥ï¼‰å’Œ <code>K</code> ï¼ˆå·ç§¯æ ¸ï¼‰æ‰§è¡Œäº’ç›¸å…³è¿ç®—ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ<strong>è¾“å‡º<code>Y</code>ä¸­çš„1ä»£è¡¨ä»ç™½è‰²åˆ°é»‘è‰²çš„è¾¹ç¼˜ï¼Œ-1ä»£è¡¨ä»é»‘è‰²åˆ°ç™½è‰²çš„è¾¹ç¼˜</strong>ï¼Œå…¶ä»–æƒ…å†µçš„è¾“å‡ºä¸º $0$ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Y = corr2d(X, K)</span><br><span class="line">Y</span><br></pre></td></tr></table></figure><pre><code>tensor([[ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.],        [ 0.,  1.,  0.,  0.,  0., -1.,  0.]])</code></pre><p>ç°åœ¨æˆ‘ä»¬å°†è¾“å…¥çš„äºŒç»´å›¾åƒè½¬ç½®ï¼Œå†è¿›è¡Œå¦‚ä¸Šçš„äº’ç›¸å…³è¿ç®—ã€‚å…¶è¾“å‡ºå¦‚ä¸‹ï¼Œä¹‹å‰æ£€æµ‹åˆ°çš„å‚ç›´è¾¹ç¼˜æ¶ˆå¤±äº†ã€‚ä¸å‡ºæ‰€æ–™ï¼Œè¿™ä¸ª<strong>å·ç§¯æ ¸<code>K</code>åªå¯ä»¥æ£€æµ‹å‚ç›´è¾¹ç¼˜</strong>ï¼Œæ— æ³•æ£€æµ‹æ°´å¹³è¾¹ç¼˜ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">corr2d(X.t(), K)</span><br></pre></td></tr></table></figure><pre><code>tensor([[0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.],        [0., 0., 0., 0., 0.]])</code></pre><h2 id="å­¦ä¹ å·ç§¯æ ¸"><a href="#å­¦ä¹ å·ç§¯æ ¸" class="headerlink" title="å­¦ä¹ å·ç§¯æ ¸"></a>å­¦ä¹ å·ç§¯æ ¸</h2><p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼Œå·ç§¯æ ¸æ˜¯éœ€è¦å­¦ä¹ çš„å‚æ•°ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥é€šè¿‡ä»…æŸ¥çœ‹â€œè¾“å…¥-è¾“å‡ºâ€å¯¹æ¥å­¦ä¹ ç”± <code>X</code> ç”Ÿæˆ <code>Y</code> çš„å·ç§¯æ ¸ã€‚æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªå·ç§¯å±‚ï¼Œå¹¶å°†å…¶å·ç§¯æ ¸åˆå§‹åŒ–ä¸ºéšæœºå¼ é‡ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒ  <code>Y</code> ä¸å·ç§¯å±‚è¾“å‡ºçš„å¹³æ–¹è¯¯å·®ï¼Œç„¶åè®¡ç®—æ¢¯åº¦æ¥æ›´æ–°å·ç§¯æ ¸ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åœ¨æ­¤ä½¿ç”¨å†…ç½®çš„äºŒç»´å·ç§¯å±‚ï¼Œå¹¶å¿½ç•¥åç½®ã€‚</p><blockquote><p><strong>è¿™ä¸€æ®µæœ‰å‡ ä¸ªé—®é¢˜</strong>ï¼š</p><ol><li>conv2dæ˜¯ä»€ä¹ˆï¼Œæ˜¯nn.Conv2då‡½æ•°æœ¬èº«ï¼Œè¿˜æ˜¯nn.Conv2dçš„è¿”å›å€¼</li><li>ä¸ºä»€ä¹ˆè¦å°†XYè½¬æ¢ä¸ºå››ç»´ã€‚</li><li>lï¼ˆlossï¼‰å’Œconv2dä¹‹é—´æ˜¯æ€ä¹ˆå»ºç«‹èµ·è”ç³»çš„ï¼Ÿ</li></ol></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ„é€ ä¸€ä¸ªäºŒç»´å·ç§¯å±‚ï¼Œå®ƒå…·æœ‰1ä¸ªè¾“å‡ºé€šé“å’Œå½¢çŠ¶ä¸ºï¼ˆ1ï¼Œ2ï¼‰çš„å·ç§¯æ ¸</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€äºŒä¸ªå‚æ•°æŒ‡æ˜äº†è¾“å…¥ã€è¾“å‡ºçš„é€šé“æ•°</span></span><br><span class="line">conv2d = nn.Conv2d(<span class="number">1</span>,<span class="number">1</span>, kernel_size=(<span class="number">1</span>, <span class="number">2</span>), bias=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªäºŒç»´å·ç§¯å±‚ä½¿ç”¨å››ç»´è¾“å…¥å’Œè¾“å‡ºæ ¼å¼ï¼ˆæ‰¹é‡å¤§å°ã€é€šé“ã€é«˜åº¦ã€å®½åº¦ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"># å…¶ä¸­æ‰¹é‡å¤§å°å’Œé€šé“æ•°éƒ½ä¸º1</span></span><br><span class="line">X = X.reshape((<span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">8</span>))</span><br><span class="line">Y = Y.reshape((<span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>))</span><br><span class="line">lr = <span class="number">3e-2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    Y_hat = conv2d(X)</span><br><span class="line">    l = (Y_hat - Y) ** <span class="number">2</span></span><br><span class="line">    conv2d.zero_grad()</span><br><span class="line">    l.<span class="built_in">sum</span>().backward()</span><br><span class="line">    <span class="comment"># æ ¹æ®æ¢¯åº¦è¿­ä»£å·ç§¯æ ¸</span></span><br><span class="line">    conv2d.weight.data[:] -= lr * conv2d.weight.grad</span><br><span class="line">    <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;epoch <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>, loss <span class="subst">&#123;l.<span class="built_in">sum</span>():<span class="number">.3</span>f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>epoch 2, loss 7.561epoch 4, loss 2.024epoch 6, loss 0.649epoch 8, loss 0.236epoch 10, loss 0.091epoch 12, loss 0.037epoch 14, loss 0.015epoch 16, loss 0.006epoch 18, loss 0.002epoch 20, loss 0.001</code></pre><p>æŸ¥çœ‹æˆ‘ä»¬æ‰€å­¦åˆ°çš„å·ç§¯æ ¸æƒé‡å¼ é‡ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬å­¦ä¹ åˆ°çš„å·ç§¯æ ¸æƒé‡éå¸¸æ¥è¿‘æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„å·ç§¯æ ¸Kã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conv2d.weight.data.reshape((<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure><pre><code>tensor([[ 0.9966, -1.0032]])</code></pre><h2 id="ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡"><a href="#ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡" class="headerlink" title="ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡"></a>ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡</h2><p>è¾“å‡ºçš„å·ç§¯å±‚æœ‰æ—¶è¢«ç§°ä¸º <em>ç‰¹å¾æ˜ å°„</em> ï¼ˆFeature Mapï¼‰ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªè¾“å…¥æ˜ å°„åˆ°ä¸‹ä¸€å±‚çš„ç©ºé—´ç»´åº¦çš„è½¬æ¢å™¨ã€‚åœ¨CNNä¸­ï¼Œå¯¹äºæŸä¸€å±‚çš„ä»»æ„å…ƒç´  $x$ ï¼Œå…¶ <em>æ„Ÿå—é‡</em> ï¼ˆReceptive Fieldï¼‰æ˜¯æŒ‡åœ¨å‰å‘ä¼ æ’­æœŸé—´å¯èƒ½å½±å“ $x$ è®¡ç®—çš„æ‰€æœ‰å…ƒç´ ï¼ˆæ¥è‡ªæ‰€æœ‰å…ˆå‰å±‚ï¼‰ã€‚</p><p>æ³¨æ„ï¼Œæ„Ÿå—é‡çš„è¦†ç›–ç‡å¯èƒ½å¤§äºæŸå±‚è¾“å…¥çš„å®é™…åŒºåŸŸå¤§å°ã€‚è®©æˆ‘ä»¬ç”¨<em>å›¾1</em>ä¸ºä¾‹æ¥è§£é‡Šæ„Ÿå—é‡ï¼šç»™å®š $2 \times 2$ å·ç§¯æ ¸ï¼Œé˜´å½±è¾“å‡ºå…ƒç´ å€¼ $19$ çš„æ¥æ”¶åŸŸæ˜¯è¾“å…¥é˜´å½±éƒ¨åˆ†çš„å››ä¸ªå…ƒç´ ã€‚å‡è®¾ä¹‹å‰è¾“å‡ºä¸º $\mathbf{Y}$ ï¼Œå…¶å¤§å°ä¸º $2 \times 2$ ï¼Œç°åœ¨æˆ‘ä»¬åœ¨å…¶åé™„åŠ ä¸€ä¸ªå·ç§¯å±‚ï¼Œè¯¥å·ç§¯å±‚ä»¥ $\mathbf{Y}$ ä¸ºè¾“å…¥ï¼Œè¾“å‡ºå•ä¸ªå…ƒç´  $z$ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ $\mathbf{Y}$ ä¸Šçš„ $z$ çš„æ¥æ”¶å­—æ®µåŒ…æ‹¬ $\mathbf{Y}$ çš„æ‰€æœ‰å››ä¸ªå…ƒç´ ï¼Œè€Œè¾“å…¥çš„æ„Ÿå—é‡åŒ…æ‹¬æœ€åˆæ‰€æœ‰ä¹ä¸ªè¾“å…¥å…ƒç´ ã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªç‰¹å¾å›¾ä¸­çš„ä»»æ„å…ƒç´ éœ€è¦æ£€æµ‹æ›´å¹¿åŒºåŸŸçš„è¾“å…¥ç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªæ›´æ·±çš„ç½‘ç»œã€‚</p><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p><a href="https://github.com/guoyujian/blog-resource/blob/main/d2l-notebooks/conv-layer.ipynb">https://github.com/guoyujian/blog-resource/blob/main/d2l-notebooks/conv-layer.ipynb</a></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="http://zh-v2.d2l.ai/chapter_convolutional-neural-networks/why-conv.html">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹6.1. ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯</a></li><li><a href="http://zh-v2.d2l.ai/chapter_convolutional-neural-networks/conv-layer.html">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹6.2. å›¾åƒå·ç§¯</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Win10ç³»ç»Ÿä¸‹é…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒ</title>
      <link href="/2022/01/16/Win10%E7%B3%BB%E7%BB%9F%E4%B8%8B%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83/"/>
      <url>/2022/01/16/Win10%E7%B3%BB%E7%BB%9F%E4%B8%8B%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¹‹å‰åœ¨æœ¬æœºé…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒæ—¶å€™è¸©äº†å¾ˆå¤šå‘ï¼Œè¿™é‡Œç¨ä½œè®°å½•å¤‡å¿˜ã€‚</p></blockquote><h1 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h1><h2 id="å®‰è£…Anaconda"><a href="#å®‰è£…Anaconda" class="headerlink" title="å®‰è£…Anaconda"></a>å®‰è£…Anaconda</h2><p>åœ¨anacondaå®˜ç½‘ä¸‹è½½å®‰è£…ã€‚</p><p>å®‰è£…å®Œæˆåï¼Œ1. é…ç½®ç¯å¢ƒå˜é‡ï¼›2. ä¿®æ”¹anacondaçš„å®‰è£…æº</p><p>éªŒè¯condaï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">conda -V</span><br><span class="line">conda env list</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºcondaç¯å¢ƒ"><a href="#åˆ›å»ºcondaç¯å¢ƒ" class="headerlink" title="åˆ›å»ºcondaç¯å¢ƒ"></a>åˆ›å»ºcondaç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªåç§°ä¸ºcommonçš„è™šæ‹Ÿç¯å¢ƒå¹¶æŒ‡å®špythonç‰ˆæœ¬ä¸º3.6.8</span><br><span class="line">conda create -n common python=3.6.8</span><br><span class="line"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">activate common</span><br><span class="line"># åˆ—å‡ºæ‰€æœ‰çš„è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">conda env list</span><br><span class="line"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">conda deactivate</span><br><span class="line"># åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">conda remove -n common --all</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨"><a href="#å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨" class="headerlink" title="å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨"></a>å®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨</h1><p>å®˜ç½‘é€‰æ‹©ç”µè„‘ç›¸åº”çš„æ˜¾å¡ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼š<a href="https://www.nvidia.cn/geforce/drivers/">https://www.nvidia.cn/geforce/drivers/</a></p><h1 id="å®‰è£…CUDA"><a href="#å®‰è£…CUDA" class="headerlink" title="å®‰è£…CUDA"></a>å®‰è£…CUDA</h1><p>nvidiaå®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ï¼š</p><p><a href="https://developer.nvidia.cn/cuda-toolkit-archive">https://developer.nvidia.cn/cuda-toolkit-archive</a></p><p>å®‰è£…å®Œæ¯•åï¼Œ1. æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœå®‰è£…æ—¶è‡ªåŠ¨æ·»åŠ åˆ™è·³è¿‡è¿™ä¸€æ­¥ï¼‰2. æ£€æŸ¥CUDAæ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nvcc -V</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…CUDNN"><a href="#å®‰è£…CUDNN" class="headerlink" title="å®‰è£…CUDNN"></a>å®‰è£…CUDNN</h1><p>NVIDIA cuDNNæ˜¯ç”¨äºæ·±åº¦ç¥ç»ç½‘ç»œçš„GPUåŠ é€Ÿåº“ã€‚</p><p>å®˜ç½‘åœ°å€ï¼š<a href="https://developer.nvidia.com/rdp/cudnn-archive">https://developer.nvidia.com/rdp/cudnn-archive</a></p><p>é€‰æ‹©å’ŒCUDAç‰ˆæœ¬ç›¸å¯¹åº”çš„è¿›è¡Œä¸‹è½½ã€‚</p><p>ä¸‹è½½ä¸‡æ’åï¼ŒæŠŠè§£å‹å¾—åˆ°çš„æ–‡ä»¶å¤¹å†…çš„binã€includeã€libç›®å½•ä¸‹çš„dllæ–‡ä»¶ä¸hæ–‡ä»¶åˆ†åˆ«å¤åˆ¶åˆ°ç›¸åº”çš„CUDAçš„å®‰è£…ç›®å½•ä¸‹ã€‚</p><p>é€šè¿‡NVIDIAæä¾›çš„ <code>deviceQuery.exe</code> å’Œ <code>bandwidthTest.exe</code> æ¥æŸ¥çœ‹GPUçš„çŠ¶æ€ï¼Œä¸¤è€…å‡åœ¨å®‰è£…ç›®å½•çš„ <code>extras\demo_suite</code>æ–‡ä»¶å¤¹ä¸­</p><h1 id="å®‰è£…Pytorch"><a href="#å®‰è£…Pytorch" class="headerlink" title="å®‰è£…Pytorch"></a>å®‰è£…Pytorch</h1><p>åœ¨<a href="https://pytorch.org/get-started/previous-versions/">https://pytorch.org/get-started/previous-versions/</a> ä¸­é€‰æ‹©ä¸CUDAç‰ˆæœ¬å¯¹åº”çš„Pytorchç‰ˆæœ¬ï¼Œæ‰§è¡Œç»™å‡ºçš„å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</p><blockquote><p>è¿™é‡Œæ¨èpipå®‰è£…ï¼Œåœ¨å°è¯•çš„æ—¶å€™å‘ç°ä½¿ç”¨condaå‘½ä»¤å›ºç„¶å¯ä»¥å®‰è£…ï¼Œä½†æ˜¯å®‰è£…ä¹‹å<code>torch.cuda.is_available()</code>ä¸ºFalse</p><p>åæ¥é€‰æ‹©pipå®‰è£…ï¼ŒæŠ¥é”™ï¼Œåé€‰æ‹©Pytorchä½ä¸€ç‚¹çš„ç‰ˆæœ¬ï¼ŒæˆåŠŸ<code>torch.cuda.is_available()==True</code>ã€‚</p></blockquote><p>å®‰è£…å®Œæˆåï¼Œè¿›å…¥Pythonå‘½ä»¤è¡Œï¼Œæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import torch</span><br><span class="line">print(torch.cuda.is_available())</span><br></pre></td></tr></table></figure><p>ç»“æœä¸ºTrueåˆ™torch-GPUå¯ç”¨ã€‚</p><h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ol><li><strong>ä»æ˜¾å¡å‹å·åˆ°æ˜¾å¡é©±åŠ¨ï¼Œåˆ°CUDAï¼Œåˆ°CUDNNï¼Œåˆ°Pytorchï¼Œåˆ°torchvisionï¼Œåˆ°cudatoolkitè¿™äº›ç‰ˆæœ¬ä¸€å®šè¦å¯¹åº”å¥½ã€‚</strong></li><li>å®‰è£…pytorché€‰æ‹©å‘½ä»¤æ—¶ï¼Œé€‰æ‹©pipæ‰‹åŠ¨ä¸‹è½½whlæ–‡ä»¶å®‰è£…è¾ƒä¿é™©ã€‚</li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://mp.weixin.qq.com/s/-oNZfkYdOb_UiWPPZCk1Nw">ç»™win11è£…ä¸ªæ·±åº¦å­¦ä¹ ç¯å¢ƒ</a></li><li><a href="https://www.zhihu.com/question/370243934">ä¸ºä½•torch.version.cudaè¿”å›Noneï¼Ÿ</a></li><li><a href="https://blog.csdn.net/yinxian9019/article/details/106763892">pytorch gpuä¸å¯ç”¨ åŸå› æ ¸æŸ¥</a></li><li><a href="https://www.zhihu.com/question/59184480">æ˜¾å¡ã€æ˜¾å¡é©±åŠ¨ã€cuda ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> ç¯å¢ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“ä¹‹åˆ†æå‡½æ•°</title>
      <link href="/2022/01/15/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8B%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0/"/>
      <url>/2022/01/15/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8B%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦è¿˜æ˜¯å‚è€ƒäº†Oracleç›¸å…³èµ„æ–™ï¼Œæ‰€ä»¥æ–‡ä¸­çš„è¯­æ³•ç»†èŠ‚å’ŒæŸäº›å‡½æ•°åœ¨å…¶ä»–DBä¸ä¼šç”Ÿæ•ˆã€‚</p><p>æˆ‘å¹¶ä¸å¸Œæœ›è¿‡å¤šå…³æ³¨è¯­æ³•ç»†èŠ‚å’Œå…·ä½“å‡½æ•°ï¼ˆè¿™äº›éƒ½å¯ä»¥è‡ªè¡Œç™¾åº¦ï¼‰ï¼Œè€Œæ›´å¸Œæœ›å¯¹åˆ†æå‡½æ•°è¿™å—çš„çŸ¥è¯†è¿›è¡ŒæŠ½è±¡ã€‚</p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åˆ†æå‡½æ•°ï¼Œä¹Ÿç§°ä¸ºçª—å£å‡½æ•°ã€‚</p><p>ä½¿ç”¨åˆ†æå‡½æ•°çš„æŸ¥è¯¢ï¼ŒåŸºäºæ•°æ®è¡Œçš„åˆ†ç»„æ¥è®¡ç®—æ€»é‡å€¼ã€‚å°½ç®¡ä¸ä¸€èˆ¬çš„èšåˆå‡½æ•°æä¾›çš„åˆ†ç»„ç»Ÿè®¡ç±»ä¼¼ï¼Œä½†å…¶ä¸»è¦ä¸åŒç‚¹æ˜¯ï¼Œåˆ†æå‡½æ•°ä¸ºæ¯ä¸ªåˆ†ç»„è¿”å›å¤šè¡Œæ•°æ®ã€‚ä¸åŒäºæ¯ä¸ªåˆ†ç»„åªå¾—åˆ°ä¸€è¡Œæ•°æ®ï¼Œåˆ†æå‡½æ•°å¯ä»¥åŒæ—¶å¾—åˆ°æ‰€æœ‰è¡Œçš„è¯¦ç»†æ•°æ®ã€‚åŒºåˆ†åˆ†æå‡½æ•°å’Œèšåˆå‡½æ•°çš„ä¸€ç§æ–¹æ³•å°±æ˜¯ï¼Œåœ¨ä½“ç§¯åˆ†æå‡½æ•°ä¸­ä½¿ç”¨çš„ä¸€ç»„æ•°æ®æ—¶ï¼Œä½¿ç”¨æ•°æ®ï¼š<strong>çª—å£</strong>ã€‚</p><p>â€œçª—å£â€ï¼ˆwindowsï¼‰æ˜¯é€šè¿‡åˆ†æå­å¥å®šä¹‰çš„ã€‚æ¯ä¸€è¡Œé™å®šåœ¨ä¸€ä¸ªæ»‘åŠ¨çª—å£ä¸­ï¼Œè¿™äº›æ»‘åŠ¨çª—å£ç¡®å®šäº†ç”¨æ¥è®¡ç®—å½“å‰è¡Œçš„æ•°æ®è¡ŒèŒƒå›´ã€‚</p><p>å¯ä»¥æŠŠçª—å£ç†è§£ä¸ºä¸€ä¸ªé›†åˆï¼Œä¸€ä¸ªçª—å£å°±æ˜¯ä¸€ä¸ªé›†åˆï¼Œåœ¨ç»Ÿè®¡åˆ†æä¸­æœ‰éœ€è¦ä¸åŒçš„ã€Œçª—å£ã€ï¼Œæ¯”å¦‚ä¸€ä¸ªéƒ¨é—¨åˆ†æˆä¸åŒç»„ï¼Œåœ¨ç»Ÿè®¡æ—¶ä¼šæŒ‰ç»„è¿›è¡Œå¹³å‡ã€æ’åç­‰æ“ä½œã€‚å†æ¯”å¦‚ï¼Œåœ¨ä¸€äº›åƒæ—¶é—´è¿™ç§æœ‰é¡ºåºçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯èƒ½5å¤©åˆ†ä¸€ç»„ã€ä¸€æœˆåˆ†ä¸€ç»„å†è¿›è¡Œæ’åºã€æ±‚ä¸­ä½æ•°ç­‰è®¡ç®—ã€‚</p><p><strong>åˆ†æå‡½æ•°åœ¨SQLæ‰§è¡Œçš„é¡ºåº</strong>ï¼šé™¤äº†ORDER BYå­å¥ï¼Œåˆ†æå‡½æ•°åœ¨æŸ¥è¯¢ä¸­æ˜¯æœ€åæ‰§è¡Œçš„è¿ç®—ã€‚</p><h2 id="ç¤ºä¾‹æ•°æ®"><a href="#ç¤ºä¾‹æ•°æ®" class="headerlink" title="ç¤ºä¾‹æ•°æ®"></a>ç¤ºä¾‹æ•°æ®</h2><p>ä¸ºäº†æ–¹ä¾¿è®²è§£å’Œæ›´åŠ ç›´è§‚ï¼Œæˆ‘å»ºç«‹äº†ä¸€å¼ æ•°æ®è¡¨ï¼Œè¯¥è¡¨åä¸ºscoresï¼Œå­˜æ”¾äº†å„ç­çº§å„å­¦ç”Ÿçš„æ•°å­¦æˆç»©ã€‚å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table math_scores(</span><br><span class="line">student_id string,</span><br><span class="line">class_num int,</span><br><span class="line">score float);</span><br><span class="line">insert into math_scores(student_id, class_num, score) values(</span><br><span class="line">(&#x27;1&#x27;,1,84),</span><br><span class="line">(&#x27;2&#x27;,1,76),</span><br><span class="line">(&#x27;3&#x27;,1,85),</span><br><span class="line">(&#x27;4&#x27;,1,92),</span><br><span class="line">(&#x27;5&#x27;,2,89),</span><br><span class="line">(&#x27;6&#x27;,2,91),</span><br><span class="line">(&#x27;7&#x27;,2,63),</span><br><span class="line">(&#x27;8&#x27;,3,83),</span><br><span class="line">(&#x27;9&#x27;,3,63),</span><br><span class="line">(&#x27;10&#x27;,3,84)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="å‰–æ"><a href="#å‰–æ" class="headerlink" title="å‰–æ"></a>å‰–æ</h1><h2 id="ä¸èšåˆçš„ä¸åŒ"><a href="#ä¸èšåˆçš„ä¸åŒ" class="headerlink" title="ä¸èšåˆçš„ä¸åŒ"></a>ä¸èšåˆçš„ä¸åŒ</h2><p>çª—å£å‡½æ•°ä¼šæŒ‰å½“å‰æ‰€åœ¨çš„åˆ†ç»„è¿›è¡Œèšåˆè®¡ç®—ï¼Œå¹¶å°†èšåˆè®¡ç®—ç»“æœè¿½åŠ åœ¨å½“å‰è¡Œå¯¹åº”çš„æ–°åˆ—ï¼Œå®ƒè¡¨è¾¾çš„æ˜¯å½“å‰è¡Œä¸è¿™æ‰€åœ¨åˆ†ç»„çš„å…³ç³»ã€‚</p><p><img src="sql-windows-functions-01.png" alt="èšåˆå‡½æ•°ä¸çª—å£å‡½æ•°"></p><p>çª—å£å‡½æ•°å’Œ Group By èšåˆå‡½æ•°åŒºåˆ«åœ¨äºï¼šçª—å£å‡½æ•°ä»…ä»…åªä¼šå°†ç»“æœé™„åŠ åˆ°å½“å‰çš„ç»“æœä¸Šï¼Œå®ƒä¸ä¼šå¯¹å·²æœ‰çš„è¡Œæˆ–åˆ—åšä»»ä½•ä¿®æ”¹ã€‚è€Œ Group By çš„åšæ³•å®Œå…¨ä¸åŒï¼šå¯¹äºå„ä¸ª Group å®ƒä»…ä»…ä¼šä¿ç•™ä¸€è¡Œèšåˆç»“æœã€‚</p><p><img src="window-functions-partitioning.jpg" alt="çª—å£å‡½æ•°è®¡ç®—è¿‡ç¨‹"></p><h2 id="ä¸-group-by-çš„åŒºåˆ«"><a href="#ä¸-group-by-çš„åŒºåˆ«" class="headerlink" title="ä¸ group by çš„åŒºåˆ«"></a>ä¸ group by çš„åŒºåˆ«</h2><ul><li>ç»“æœæ•°æ®å½¢å¼<ul><li>çª—å£å‡½æ•°å¯ä»¥åœ¨ä¿ç•™åŸè¡¨ä¸­çš„å…¨éƒ¨æ•°æ®</li><li>group by åªèƒ½ä¿ç•™ä¸åˆ†ç»„å­—æ®µèšåˆçš„ç»“æœ</li></ul></li><li>æ’åºèŒƒå›´ä¸åŒ<ul><li>çª—å£å‡½æ•°ä¸­çš„ order by åªæ˜¯å†³å®šç€çª—å£é‡Œçš„æ•°æ®çš„æ’åºæ–¹å¼</li><li>æ™®é€šçš„ order by å†³å®šæŸ¥è¯¢å‡ºçš„æ•°æ®ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ•´ä½“æ’åº</li></ul></li><li>SQL é¡ºåº<ul><li>group by å…ˆè¿›è¡Œè®¡ç®—</li><li>çª—å£å‡½æ•°åœ¨ group by åè¿›è¡Œè®¡ç®—</li></ul></li></ul><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p>åˆ†æå‡½æ•°æœ‰ä¸‰ä¸ªåŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼šåˆ†åŒºå­å¥ã€æ’åºå­å¥ä»¥åŠå¼€çª—å­å¥ã€‚åˆ†æå‡½æ•°çš„åŸºæœ¬è¯­æ³•æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">function1(argument1, argument2,...argumentN) <span class="keyword">over</span>([<span class="keyword">partition</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause] [<span class="keyword">order</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause] [windowing<span class="operator">-</span>clause])</span><br></pre></td></tr></table></figure><h3 id="function1"><a href="#function1" class="headerlink" title="function1"></a>function1</h3><p>function1æ˜¯æ‰€è°ƒç”¨çš„æ¥æ”¶0ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„åˆ†æå‡½æ•°ã€‚ä¸‹è¡¨åˆ—ä¸¾äº†å¸¸ç”¨çš„åˆ†æå‡½æ•°ã€‚ï¼ˆä¸éœ€è¦çº ç»“æ¯ä¸ªå‡½æ•°å…·ä½“æ€ä¹ˆç”¨ï¼Œå¤§è‡´äº†è§£åŠŸèƒ½ï¼Œç”¨çš„æ—¶å€™å†ç»†çœ‹ã€‚ï¼‰</p><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>lag</td><td>è®¿é—®ä¸€ä¸ªåˆ†åŒºæˆ–ç»“æœé›†ä¸­ä¹‹å‰çš„ä¸€è¡Œ</td></tr><tr><td>lead</td><td>è®¿é—®ä¸€ä¸ªåˆ†åŒºæˆ–ç»“æœé›†ä¸­ä¹‹åçš„ä¸€è¡Œ</td></tr><tr><td>first_value</td><td>è®¿é—®ä¸€ä¸ªåˆ†åŒºæˆ–ç»“æœé›†ä¸­ç¬¬ä¸€è¡Œ</td></tr><tr><td>last_value</td><td>è®¿é—®ä¸€ä¸ªåˆ†åŒºæˆ–ç»“æœé›†ä¸­æœ€åä¸€è¡Œ</td></tr><tr><td>nth_value</td><td>è®¿é—®ä¸€ä¸ªåˆ†åŒºæˆ–ç»“æœé›†ä¸­ä»»æ„ä¸€è¡Œ</td></tr><tr><td>rank</td><td>å°†æ•°æ®è¡Œå€¼æŒ‰ç…§æ’åºåçš„é¡ºåºè¿›è¡Œæ’åï¼Œåœ¨æœ‰å¹¶åˆ—çš„æƒ…å†µä¸‹æ’åå€¼å°†è¢«è·³è¿‡</td></tr><tr><td>dense_rank</td><td>å°†æ•°æ®è¡Œå€¼æŒ‰ç…§æ’åºåçš„é¡ºåºè¿›è¡Œæ’åï¼Œåœ¨æœ‰å¹¶åˆ—çš„æƒ…å†µä¸‹ä¹Ÿä¸è·³è¿‡æ’åå€¼</td></tr><tr><td>row_number</td><td>å¯¹è¡Œè¿›è¡Œæ’åºå¹¶ä¸ºæ¯ä¸€è¡Œå¢åŠ å”¯ä¸€ç¼–å·ã€‚è¿™æ˜¯ä¸€ä¸ªéç¡®å®šå‡½æ•°</td></tr><tr><td>ratio_to_report</td><td>è®¡ç®—æŠ¥å‘Šä¸­å€¼å¾—æ¯”ä¾‹</td></tr><tr><td>percent_rank</td><td>å°†è®¡ç®—å¾—åˆ°çš„æ’åå€¼æ ‡å‡†åŒ–ä¸º0-1ä¹‹é—´çš„å€¼</td></tr><tr><td>percentile_cont</td><td>å–å‡ºä¸æŒ‡å®šçš„æ’åç™¾åˆ†æ¯”ç›¸åŒ¹é…çš„å€¼ã€‚æ˜¯percent_rankçš„åå‡½æ•°</td></tr><tr><td>percentile_dist</td><td>å–å‡ºä¸æŒ‡å®šçš„æ’åç™¾åˆ†æ¯”ç›¸åŒ¹é…çš„å€¼ã€‚é‡‡ç”¨è°¨æ…åˆ†å¸ƒæ¨¡å‹</td></tr><tr><td>ntile</td><td>å°†æ•°æ®è¡Œåˆ†ç»„ä¸ºå•å…ƒ</td></tr><tr><td>listagg</td><td>å°†æ¥è‡ªä¸åŒè¡Œçš„åˆ—å€¼è½¬åŒ–ä¸ºåˆ—è¡¨æ ¼å¼</td></tr></tbody></table></div><p><strong>é™¤äº†ä¸Šè¿°åˆ†æå‡½æ•°ï¼Œfunction1è¿˜å¯ä»¥æ˜¯min/max/avg/countç­‰èšåˆå‡½æ•°</strong>ã€‚</p><h3 id="åˆ†åŒºå­å¥"><a href="#åˆ†åŒºå­å¥" class="headerlink" title="åˆ†åŒºå­å¥"></a>åˆ†åŒºå­å¥</h3><p>åˆ†åŒºå­å¥æŒ‰ç…§åˆ†åŒºåˆ—çš„å€¼å¯¹æ•°æ®è¡Œè¿›è¡Œåˆ†ç»„ã€‚æ‰€æœ‰åˆ†åŒºåˆ—çš„å€¼ç›¸åŒçš„æ•°æ®è¡Œè¢«ç»„åˆä¸ºä¸€ä¸ªæ•°æ®åˆ†åŒºã€‚ä¾‹å¦‚<code>partition by class_num</code>å°±æ˜¯æŒ‰ç­çº§è¿›è¡Œåˆ†åŒºã€‚</p><h3 id="æ’åºå­å¥"><a href="#æ’åºå­å¥" class="headerlink" title="æ’åºå­å¥"></a>æ’åºå­å¥</h3><p>æ’åºå­å¥å¯¹æ•°æ®åˆ†åŒºä¸­çš„è¡Œè¿›è¡Œæ’åºã€‚æ’åºå¯ä»¥æŒ‰ç…§å‡åºæˆ–è€…é™åºï¼Œä½¿ç”¨<code>NULLS FIRST</code>æˆ–<code>NULLS LAST</code>å­å¥å¯ä»¥å°†ç©ºå€¼æ”¾åˆ°æ•°æ®åˆ†åŒºçš„æœ€ä¸Šé¢æˆ–æœ€ä¸‹é¢ã€‚</p><h3 id="å¼€çª—å­å¥"><a href="#å¼€çª—å­å¥" class="headerlink" title="å¼€çª—å­å¥"></a>å¼€çª—å­å¥</h3><p>ä¹‹å‰çš„çª—å£æ˜¯å›ºå®šçš„æ•°æ®åˆ†ç»„çª—å£ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ ¹æ®æ•°æ®çš„å‰åå†åˆ†é…çª—å£ï¼Œæ¯”å¦‚åœ¨è‚¡ç¥¨ã€æ°”æ¸©ç­‰æ•°æ®åœºæ™¯ä¸‹ï¼Œæ•°æ®çš„å‰åä¼šæœ‰å½±å“ï¼Œå°±é€‚ç”¨äºç§»åŠ¨çª—å£è®¡ç®—ã€‚</p><p>å¼€çª—å­å¥æŒ‡å®šäº†åˆ†æå‡½æ•°è¿›è¡Œè¿ç®—çš„æ•°æ®å­é›†ã€‚è¿™ä¸ªçª—å£å¯ä»¥æ˜¯åŠ¨æ€çš„ï¼Œä»–æœ‰ä¸€ä¸ªå¾ˆæ°å½“çš„åå­—â€”â€”<strong>æ»‘åŠ¨çª—å£</strong>ã€‚ä½¿ç”¨çª—å£è¯´æ˜å­å¥æ¥æŒ‡å®šæ»‘åŠ¨çª—å£çš„ä¸Šä¸‹è¾¹ç•Œæ¡ä»¶ã€‚çª—å£å­å¥çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">ROWS</span> <span class="operator">|</span> <span class="keyword">RANGE</span>] <span class="keyword">BETWEEN</span> <span class="operator">&lt;</span><span class="keyword">start</span> expr<span class="operator">&gt;</span> <span class="keyword">AND</span> <span class="operator">&lt;</span><span class="keyword">end</span> expr<span class="operator">&gt;</span></span><br><span class="line">Whereas</span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">start</span> expr<span class="operator">&gt;</span> <span class="keyword">is</span> [UNBOUNDED PRECEDING <span class="operator">|</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span> <span class="operator">|</span> n PRECEDING <span class="operator">|</span> n FOLLOWING]</span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">end</span> expr<span class="operator">&gt;</span> <span class="keyword">is</span> [UNBOUNDED PRECEDING <span class="operator">|</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span> <span class="operator">|</span> n PRECEDING <span class="operator">|</span> n FOLLOWING]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li>ç§»åŠ¨èŒƒå›´è®¾å®š<ul><li>rows: ç‰©ç†çª—å£ï¼Œrows åçš„ n æ˜¯æŒ‡ç›¸å¯¹å½“å‰è¡Œåç§»nä½ï¼ˆå½“å‰è¡Œä¹Ÿå‚ä¸è®¡ç®—ï¼‰ï¼Œå¯ä»¥ä¸ between æ­é…ä½¿ç”¨è¡¨è¾¾èŒƒå›´</li><li>range: é€»è¾‘çª—å£ï¼Œæ˜¯æŒ‡å®šå½“å‰è¡Œå¯¹åº”å€¼çš„èŒƒå›´å–å€¼ã€‚</li><li>rowså’Œrangeçš„åŒºåˆ«è§<em>å‚è€ƒèµ„æ–™3</em></li></ul></li><li>åç§»æ–¹å‘<ul><li>precending: å‘å½“å‰è¡Œä¹‹å‰</li><li>following: å‘å½“å‰è¡Œä¹‹å</li></ul></li></ul><p>åŒæ—¶ï¼Œpreceding ä¸ following å¯ä»¥ç›¸ç»“åˆï¼Œä¾‹1ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">1</span> precending <span class="keyword">and</span> <span class="number">2</span> following</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå½“å‰è¡Œçš„å‰ä¸€è¡Œå’Œåä¸¤è¡Œï¼Œå…± 4 è¡Œï¼ˆåŒ…æ‹¬å½“å‰è¡Œï¼‰ä½œä¸ºæ±‡æ€»çš„ä¾æ®ã€‚</p><p>ä¾‹2ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> unbounded preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span></span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºçª—å£æœ€ä¸Šä¸€è¡Œæ˜¯å½“å‰åˆ†åŒºä¸­çš„ç¬¬ä¸€è¡Œè€Œçª—å£æœ€ä¸‹ä¸€è¡Œæ˜¯å½“å‰çš„æ•°æ®è¡Œã€‚</p><blockquote><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„åˆ†æå‡½æ•°éƒ½æ”¯æŒå¼€çª—å­å¥ï¼›</p><p>åˆ†æå‡½æ•°ä¸èƒ½åµŒå¥—ã€‚</p><p>çª—å£å­å¥ä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œå¿…é¡»æœ‰order byå­å¥æ—¶æ‰èƒ½å‡ºç°ã€‚</p><p><strong>é»˜è®¤çª—å£</strong>åˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æœ‰order byæ—¶ï¼Œæ— çª—å£å­å¥ï¼Œåˆ™é»˜è®¤çš„çª—å£æ˜¯<code>unbounded preceding and current row</code>ï¼Œå³å½“å‰ç»„çš„ç¬¬ä¸€è¡Œåˆ°å½“å‰è¡Œ</li><li>æ— order byæ—¶ï¼Œæ— çª—å£å­å¥ï¼Œåˆ™é»˜è®¤çš„çª—å£æ˜¯<code>unbounded preceding and unbounded following</code>ï¼Œå³æ•´ä¸ªç»„</li></ul></blockquote><h3 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h3><ul><li>ä¸‹é¢sqlæŒ‡å‡ºäº†æ¯ä½å­¦ç”Ÿæ‰€åœ¨ç­çº§çš„å¹³å‡æ•°å­¦æˆç»©</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, class_num, <span class="built_in">AVG</span>(score) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> class_num) <span class="keyword">AS</span> math_avg</span><br><span class="line"><span class="keyword">FROM</span> math_scores</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">student_idclass_numscorealg_avg</span><br><span class="line">118484.25</span><br><span class="line">217684.25</span><br><span class="line">318584.25</span><br><span class="line">419284.25</span><br><span class="line">528981</span><br><span class="line">629181</span><br><span class="line">726381</span><br><span class="line">838376.67</span><br><span class="line">936376.67</span><br><span class="line">1038476.67</span><br></pre></td></tr></table></figure><ul><li>è®¡ç®—æ¯ä½åŒå­¦æ•°å­¦æˆç»©çš„ç­çº§æ’å</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, class_num, score, <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> class_num <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>) <span class="keyword">AS</span> rankk</span><br><span class="line"><span class="keyword">FROM</span> math_scores</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">student_idclass_numscorerankk</span><br><span class="line">41921</span><br><span class="line">31852</span><br><span class="line">11843</span><br><span class="line">21764</span><br><span class="line">62911</span><br><span class="line">52892</span><br><span class="line">72633</span><br><span class="line">103841</span><br><span class="line">83832</span><br><span class="line">93633</span><br></pre></td></tr></table></figure><h1 id="leadå’Œlag"><a href="#leadå’Œlag" class="headerlink" title="leadå’Œlag"></a>leadå’Œlag</h1><p>leadå‡½æ•°æ”¯æŒè®¿é—®ç»“æœé›†ä¸­åé¢çš„è¡Œï¼Œlagèƒ½å¤Ÿè®¿é—®ç»“æœé›†ä¸­å‰é¢çš„è¡Œã€‚</p><p>leadå’Œlagçš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">lag</span>(expr [, <span class="keyword">offset</span>] [, <span class="keyword">default</span>]) <span class="keyword">OVER</span> ([partition_by_clause] order_by_clause)</span><br><span class="line"><span class="built_in">lead</span>(expr [, <span class="keyword">offset</span>] [, <span class="keyword">default</span>]) <span class="keyword">OVER</span>([partition_by_clause] order_by_clause)</span><br></pre></td></tr></table></figure><p>leadå’Œlag<strong>ä¸æ”¯æŒå¼€çª—å­å¥</strong>ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ä»…æ”¯æŒpartition_byå­å¥å’Œorder_byå­å¥ã€‚</p><p>ä¸‹é¢çš„sqlç»™å‡ºå½“å‰æ•°æ®è¡Œå‰ä¸€è¡Œçš„æ•°å­¦æˆç»©ï¼ˆæˆç»©ä»å¤§åˆ°å°æ’åºï¼‰</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student_id, class_num, score, <span class="built_in">lag</span>(score, <span class="number">1</span>) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>) <span class="keyword">AS</span> last_score</span><br><span class="line"><span class="keyword">FROM</span> math_scores</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">student_idclass_numscorelast_score</span><br><span class="line">4192NULL</span><br><span class="line">629192</span><br><span class="line">528991</span><br><span class="line">318589</span><br><span class="line">1038485</span><br><span class="line">118484</span><br><span class="line">838384</span><br><span class="line">217683</span><br><span class="line">936376</span><br><span class="line">726363</span><br></pre></td></tr></table></figure><p>ç”±äºç¬¬ä¸€è¡Œæ²¡æœ‰å‰ä¸€è¡Œï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œlast_scoreä¸ºNULLï¼Œå¦‚æœä¸æƒ³è®©å®ƒä¸ºNULL ï¼Œå¯ä»¥ä½¿ç”¨lag/leadçš„ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šé»˜è®¤å€¼ã€‚</p><blockquote><p>ç†è§£offsetæ˜¯è¡Œåç§»ï¼Œè€Œä¸æ˜¯æ•°æ®å€¼åç§»</p></blockquote><h1 id="first-valueå’Œlast-value"><a href="#first-valueå’Œlast-value" class="headerlink" title="first_valueå’Œlast_value"></a>first_valueå’Œlast_value</h1><p>first_valueå’Œlast_valueåˆ†åˆ«ä»æ•°æ®è¡Œçª—å£è¿”å›ç¬¬ä¸€è¡Œçš„åˆ—å€¼å’Œæœ€åä¸€è¡Œçš„åˆ—å€¼ã€‚å…¶è¯­æ³•å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">first_value</span>(expr) <span class="keyword">over</span>([<span class="keyword">partition</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause] [<span class="keyword">order</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause] [windowing<span class="operator">-</span>clause])</span><br><span class="line"><span class="built_in">last_value</span>(expr) <span class="keyword">over</span>([<span class="keyword">partition</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause] [<span class="keyword">order</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause] [windowing<span class="operator">-</span>clause])</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œä½¿ç”¨first_valueå¯ä»¥å®ç°è®¡ç®—<em>æ¯ä¸ªç­çº§çš„æ•°å­¦æˆç»©æœ€é«˜åˆ†</em>ã€‚ï¼ˆè‡ªè¡Œæ€è€ƒï¼‰</p><p>ä½¿ç”¨å¼€çª—è¯­å¥ï¼Œå¯ä»¥ä¸ºè¿™äº›å‡½æ•°è¿ç®—å®šä¹‰åŠ¨æ€æ»‘åŠ¨çª—å£ï¼Œä¾‹å¦‚è®¡ç®—åˆ°<em>ç›®å‰ä¸ºæ­¢çš„æœ€å¤§é”€å”®é¢</em></p><h2 id="å¤„ç†ç©ºå€¼"><a href="#å¤„ç†ç©ºå€¼" class="headerlink" title="å¤„ç†ç©ºå€¼"></a>å¤„ç†ç©ºå€¼</h2><p>ç©ºå€¼é€šè¿‡[RESPECT NULLS | IGNORE NULLS]å¤„ç†ã€‚RESPECT NULLSå­å¥æ˜¯é»˜è®¤å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç¬¬ä¸€è¡Œçš„åˆ—å€¼ä¸ºç©ºï¼Œfirst_valueå‡½æ•°å°±ä¼šè¿”å›ç©ºå€¼ã€‚å¦‚æœæŒ‡å®šäº†IGNORE NULLSå­å¥ï¼Œåˆ™first_valueå‡½æ•°å°†ä¼šè¿”å›åœ¨çª—å£ä¸­ç¬¬ä¸€ä¸ªåˆ—å€¼ä¸ä¸ºç©ºçš„è¡Œçš„å€¼ã€‚</p><h1 id="rank-dense-rank-row-number"><a href="#rank-dense-rank-row-number" class="headerlink" title="rank/dense_rank/row_number"></a>rank/dense_rank/row_number</h1><p>è¿™ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯è¿”å›æ’åï¼Œä¸åŒä¹‹å¤„åœ¨äºä»–ä»¬å¯¹æ’åç›¸åŒè¡Œçš„å¤„ç†ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rank</span>() <span class="keyword">OVER</span>([partition_by_clause] order_by_clause); <span class="comment">-- é—´æ–­ï¼Œç›¸åŒå€¼åŒåºå·ï¼Œå¦‚ 1ã€1ã€3ã€4ã€5</span></span><br><span class="line"><span class="built_in">row_number</span>() <span class="keyword">OVER</span>([partition_by_clause] order_by_clause); <span class="comment">-- ä¸é—´æ–­ï¼Œåºå·ä¸é‡å¤ï¼Œå¦‚ 1ã€2ã€3ã€4ã€5</span></span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">OVER</span>([partition_by_clause] order_by_clause) <span class="comment">-- ä¸é—´æ–­ï¼Œç›¸åŒå€¼åŒåºå·ï¼Œå¦‚ 1ã€1ã€2ã€3ã€3</span></span><br></pre></td></tr></table></figure><p>row_numberæ˜¯ä¸€ä¸ªéç¡®å®šå‡½æ•°ï¼Œå¦‚æœæ•°æ®åˆ†åŒºä¸­çš„ä¸¤è¡Œå…·æœ‰åŒæ ·çš„å€¼ï¼Œrow_numberçš„å€¼æ˜¯ä¸ç¡®å®šçš„ã€‚</p><p>è¿™ä¸‰ä¸ªå‡½æ•°éƒ½ä¸èƒ½ä½¿ç”¨å¼€çª—å­å¥</p><h1 id="å…¶ä»–åˆ†æå‡½æ•°"><a href="#å…¶ä»–åˆ†æå‡½æ•°" class="headerlink" title="å…¶ä»–åˆ†æå‡½æ•°"></a>å…¶ä»–åˆ†æå‡½æ•°</h1><h2 id="nth-value"><a href="#nth-value" class="headerlink" title="nth_value"></a>nth_value</h2><p>first_valueå’Œlast_valueå‡½æ•°èƒ½å¤Ÿè·å–æ’åºè¿‡çš„ç»“æœé›†ä¸­ç¬¬ä¸€è¡Œæˆ–æœ€åä¸€è¡Œçš„æ•°æ®ã€‚ä½¿ç”¨nth_valueå‡½æ•°ï¼Œå¯ä»¥è·å–æ’è¿‡åºçš„ç»“æœé›†ä¸­çš„ä»»æ„ä¸€è¡Œã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">nth_value</span>(measure, n) [<span class="keyword">FROM</span> <span class="keyword">FIRST</span> <span class="operator">|</span> <span class="keyword">FROM</span> <span class="keyword">LAST</span> ] [RESPECT NULLS <span class="operator">|</span> IGNORE NULLS] <span class="keyword">OVER</span>(...)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆ—åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçª—å£ä½ç§»é‡ã€‚</p><h2 id="ratio-to-report"><a href="#ratio-to-report" class="headerlink" title="ratio_to_report"></a>ratio_to_report</h2><p>ratio_to_reportè®¡ç®—æ•°æ®åˆ†åŒºä¸­æŸä¸ªå€¼ä¸å’Œå€¼çš„æ¯”ç‡ã€‚</p><h2 id="listagg-Oracle"><a href="#listagg-Oracle" class="headerlink" title="listagg(Oracle)"></a>listagg(Oracle)</h2><p>è¿™æ˜¯Oracle 11gR2ä¸­å¼•å…¥çš„åˆ†æå‡½æ•°ã€‚è¿™ä¸ªåˆ†æå‡½æ•°èƒ½å¤Ÿå°†æ¥è‡ªå¤šä¸ªè¡Œçš„åˆ—å€¼è½¬åŒ–ä¸ºåˆ—è¡¨æ ¼å¼ã€‚</p><p>listaggè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">listagg</span>(string, separator) <span class="keyword">within</span> <span class="keyword">group</span> (<span class="keyword">order</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause) <span class="keyword">over</span>(<span class="keyword">partition</span><span class="operator">-</span><span class="keyword">by</span><span class="operator">-</span>clause)</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨HIVEä¸­å¯ä»¥ä½¿ç”¨<code>collect_list</code>æˆ–<code>collect_set</code>ä»¥åŠæ•°ç»„è½¬å­—ç¬¦ä¸²å‡½æ•°<code>concat_ws(&#39;,&#39;, COLLECT_LIST(&lt;cloumn&gt;))</code>æ¥å®ç°ç›¸åŒçš„æ•ˆæœã€‚</p><p>listaggå‡½æ•°çš„ä¸€ä¸ª<strong>å±€é™</strong>å°±æ˜¯ï¼Œä»–çš„ç»“æœå¼ºåˆ¶ä¸ºVARCHAR2æ•°æ®ç±»å‹çš„æœ€å¤§é•¿åº¦ã€‚</p></blockquote><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>ã€Šç²¾é€šOracle SQLã€‹ ç¬¬å…«ç« </li><li><a href="https://www.gairuo.com/p/hive-sql-tutorial">HIVE SQLæ•™ç¨‹</a> çª—å£è®¡ç®— </li><li><a href="http://blog.itpub.net/21251711/viewspace-1068855/">åˆ†æå‡½æ•°ç”¨æ³•åŠçª—å£å­å¥ range/rowså·®åˆ«</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> åˆ†æå‡½æ•° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> åˆ†æå‡½æ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPåè®®çš„å¹‚ç­‰æ€§</title>
      <link href="/2022/01/15/HTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7/"/>
      <url>/2022/01/15/HTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åŸºäºHTTPåè®®çš„Web APIæ˜¯æ—¶ä¸‹æœ€ä¸ºæµè¡Œçš„ä¸€ç§åˆ†å¸ƒå¼æœåŠ¡æä¾›æ–¹å¼ã€‚æ— è®ºæ˜¯åœ¨å¤§å‹äº’è”ç½‘åº”ç”¨è¿˜æ˜¯ä¼ä¸šçº§æ¶æ„ä¸­ï¼Œæˆ‘ä»¬éƒ½è§åˆ°äº†è¶Šæ¥è¶Šå¤šçš„SOAæˆ–RESTfulçš„Web APIã€‚ä¸ºä»€ä¹ˆWeb APIå¦‚æ­¤æµè¡Œå‘¢ï¼Ÿæˆ‘è®¤ä¸ºå¾ˆå¤§ç¨‹åº¦ä¸Šåº”å½’åŠŸäºç®€å•æœ‰æ•ˆçš„HTTPåè®®ã€‚</p><p>HTTPåè®®æ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„é¢å‘èµ„æºçš„ç½‘ç»œ<strong>åº”ç”¨å±‚åè®®</strong>ï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨ç«¯æä¾›WebæœåŠ¡ï¼Œè¿˜æ˜¯å®¢æˆ·ç«¯æ¶ˆè´¹WebæœåŠ¡éƒ½éå¸¸ç®€å•ã€‚å†åŠ ä¸Šæµè§ˆå™¨ã€Javascriptã€AJAXã€JSONä»¥åŠHTML5ç­‰æŠ€æœ¯å’Œå·¥å…·çš„å‘å±•ï¼Œäº’è”ç½‘åº”ç”¨æ¶æ„è®¾è®¡è¡¨ç°å‡ºäº†ä»ä¼ ç»Ÿçš„PHPã€JSPã€ASP.NETç­‰æœåŠ¡å™¨ç«¯åŠ¨æ€ç½‘é¡µå‘Web API + RIAï¼ˆå¯Œäº’è”ç½‘åº”ç”¨ï¼‰è¿‡æ¸¡çš„è¶‹åŠ¿ã€‚Web APIä¸“æ³¨äºæä¾›ä¸šåŠ¡æœåŠ¡ï¼ŒRIAä¸“æ³¨äºç”¨æˆ·ç•Œé¢å’Œäº¤äº’è®¾è®¡ï¼Œä»æ­¤ä¸¤ä¸ªé¢†åŸŸçš„åˆ†å·¥æ›´åŠ æ˜æ™°ã€‚åœ¨è¿™ç§è¶‹åŠ¿ä¸‹ï¼ŒWeb APIè®¾è®¡å°†æˆä¸ºæœåŠ¡å™¨ç«¯ç¨‹åºå‘˜çš„å¿…ä¿®è¯¾ã€‚ç„¶è€Œï¼Œæ­£å¦‚ç®€å•çš„Javaè¯­è¨€å¹¶ä¸æ„å‘³ç€é«˜è´¨é‡çš„Javaç¨‹åºï¼Œç®€å•çš„HTTPåè®®ä¹Ÿä¸æ„å‘³ç€é«˜è´¨é‡çš„Web APIã€‚è¦æƒ³è®¾è®¡å‡ºé«˜è´¨é‡çš„Web APIï¼Œè¿˜éœ€è¦æ·±å…¥ç†è§£åˆ†å¸ƒå¼ç³»ç»ŸåŠHTTPåè®®çš„ç‰¹æ€§ã€‚</p><h1 id="å¹‚ç­‰æ€§å®šä¹‰"><a href="#å¹‚ç­‰æ€§å®šä¹‰" class="headerlink" title="å¹‚ç­‰æ€§å®šä¹‰"></a>å¹‚ç­‰æ€§å®šä¹‰</h1><p>æœ¬æ–‡æ‰€è¦æ¢è®¨çš„æ­£æ˜¯HTTPåè®®æ¶‰åŠåˆ°çš„ä¸€ç§é‡è¦æ€§è´¨ï¼šå¹‚ç­‰æ€§(Idempotence)ã€‚åœ¨HTTP/1.1è§„èŒƒä¸­å¹‚ç­‰æ€§çš„å®šä¹‰æ˜¯ï¼š</p><blockquote><p>Methods can also have the property of â€œidempotenceâ€ in that (aside from error or expiration issues) the side-effects of N &gt; 0 identical requests is the same as for a single request.</p></blockquote><p>ä»å®šä¹‰ä¸Šçœ‹ï¼Œ<strong>HTTPæ–¹æ³•çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨ã€‚</strong>å¹‚ç­‰æ€§å±äºè¯­ä¹‰èŒƒç•´ï¼Œæ­£å¦‚ç¼–è¯‘å™¨åªèƒ½å¸®åŠ©æ£€æŸ¥è¯­æ³•é”™è¯¯ä¸€æ ·ï¼ŒHTTPè§„èŒƒä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡æ¶ˆæ¯æ ¼å¼ç­‰è¯­æ³•æ‰‹æ®µæ¥å®šä¹‰å®ƒï¼Œè¿™å¯èƒ½æ˜¯å®ƒä¸å¤ªå—åˆ°é‡è§†çš„åŸå› ä¹‹ä¸€ã€‚ä½†å®é™…ä¸Šï¼Œå¹‚ç­‰æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ååˆ†é‡è¦çš„æ¦‚å¿µï¼Œè€ŒHTTPçš„åˆ†å¸ƒå¼æœ¬è´¨ä¹Ÿå†³å®šäº†å®ƒåœ¨HTTPä¸­å…·æœ‰é‡è¦åœ°ä½ã€‚</p><h1 id="åˆ†å¸ƒå¼äº‹åŠ¡-vs-å¹‚ç­‰è®¾è®¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡-vs-å¹‚ç­‰è®¾è®¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡ vs å¹‚ç­‰è®¾è®¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡ vs å¹‚ç­‰è®¾è®¡</h1><p>ä¸ºä»€ä¹ˆéœ€è¦å¹‚ç­‰æ€§å‘¢ï¼Ÿæˆ‘ä»¬å…ˆä»ä¸€ä¸ªä¾‹å­è¯´èµ·ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä»è´¦æˆ·å–é’±çš„è¿œç¨‹APIï¼ˆå¯ä»¥æ˜¯HTTPçš„ï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯ï¼‰ï¼Œæˆ‘ä»¬æš‚æ—¶ç”¨ç±»å‡½æ•°çš„æ–¹å¼è®°ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bool withdraw(account_id, amount)</span><br></pre></td></tr></table></figure><p>withdrawçš„è¯­ä¹‰æ˜¯ä»account_idå¯¹åº”çš„è´¦æˆ·ä¸­æ‰£é™¤amountæ•°é¢çš„é’±ï¼›å¦‚æœæ‰£é™¤æˆåŠŸåˆ™è¿”å›trueï¼Œè´¦æˆ·ä½™é¢å‡å°‘amountï¼›å¦‚æœæ‰£é™¤å¤±è´¥åˆ™è¿”å›falseï¼Œè´¦æˆ·ä½™é¢ä¸å˜ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå’Œæœ¬åœ°ç¯å¢ƒç›¸æ¯”ï¼Œæˆ‘ä»¬ä¸èƒ½è½»æ˜“å‡è®¾åˆ†å¸ƒå¼ç¯å¢ƒçš„å¯é æ€§ã€‚ä¸€ç§å…¸å‹çš„æƒ…å†µæ˜¯withdrawè¯·æ±‚å·²ç»è¢«æœåŠ¡å™¨ç«¯æ­£ç¡®å¤„ç†ï¼Œä½†æœåŠ¡å™¨ç«¯çš„è¿”å›ç»“æœç”±äºç½‘ç»œç­‰åŸå› è¢«æ‰ä¸¢äº†ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•å¾—çŸ¥å¤„ç†ç»“æœã€‚å¦‚æœæ˜¯åœ¨ç½‘é¡µä¸Šï¼Œä¸€äº›ä¸æ°å½“çš„è®¾è®¡å¯èƒ½ä¼šä½¿ç”¨æˆ·è®¤ä¸ºä¸Šä¸€æ¬¡æ“ä½œå¤±è´¥äº†ï¼Œç„¶ååˆ·æ–°é¡µé¢ï¼Œè¿™å°±å¯¼è‡´äº†withdrawè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œè´¦æˆ·ä¹Ÿè¢«å¤šæ‰£äº†ä¸€æ¬¡é’±ã€‚å¦‚å›¾1æ‰€ç¤ºï¼š</p><p><img src="20110810171503575.png" alt="å›¾1"></p><p>è¿™ä¸ªé—®é¢˜çš„<strong>è§£å†³æ–¹æ¡ˆä¸€</strong>æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé€šè¿‡å¼•å…¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸­é—´ä»¶æ¥ä¿è¯withdrawåŠŸèƒ½çš„äº‹åŠ¡æ€§ã€‚åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¼˜ç‚¹æ˜¯å¯¹äºè°ƒç”¨è€…å¾ˆç®€å•ï¼Œå¤æ‚æ€§éƒ½äº¤ç»™äº†ä¸­é—´ä»¶æ¥ç®¡ç†ã€‚ç¼ºç‚¹åˆ™æ˜¯ä¸€æ–¹é¢æ¶æ„å¤ªé‡é‡çº§ï¼Œå®¹æ˜“è¢«ç»‘åœ¨ç‰¹å®šçš„ä¸­é—´ä»¶ä¸Šï¼Œä¸åˆ©äºå¼‚æ„ç³»ç»Ÿçš„é›†æˆï¼›å¦ä¸€æ–¹é¢åˆ†å¸ƒå¼äº‹åŠ¡è™½ç„¶èƒ½ä¿è¯äº‹åŠ¡çš„ACIDæ€§è´¨ï¼Œè€Œä½†å´æ— æ³•æä¾›æ€§èƒ½å’Œå¯ç”¨æ€§çš„ä¿è¯ã€‚</p><p>å¦ä¸€ç§æ›´<strong>è½»é‡çº§çš„è§£å†³æ–¹æ¡ˆ</strong>æ˜¯å¹‚ç­‰è®¾è®¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§æŠŠwithdrawå˜æˆå¹‚ç­‰çš„ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int create_ticket() </span><br><span class="line">bool idempotent_withdraw(ticket_id, account_id, amount)</span><br></pre></td></tr></table></figure><p>create_ticketçš„è¯­ä¹‰æ˜¯è·å–ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„å¤„ç†å·ticket_idï¼Œå®ƒå°†ç”¨äºæ ‡è¯†åç»­çš„æ“ä½œã€‚idempotent_withdrawå’Œwithdrawçš„åŒºåˆ«åœ¨äºå…³è”äº†ä¸€ä¸ªticket_idï¼Œ<strong>ä¸€ä¸ªticket_idè¡¨ç¤ºçš„æ“ä½œè‡³å¤šåªä¼šè¢«å¤„ç†ä¸€æ¬¡</strong>ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å°†è¿”å›ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶çš„å¤„ç†ç»“æœã€‚è¿™æ ·ï¼Œidempotent_withdrawå°±ç¬¦åˆå¹‚ç­‰æ€§äº†ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æ”¾å¿ƒåœ°å¤šæ¬¡è°ƒç”¨ã€‚</p><p>åŸºäºå¹‚ç­‰æ€§çš„è§£å†³æ–¹æ¡ˆä¸­ä¸€ä¸ªå®Œæ•´çš„å–é’±æµç¨‹è¢«åˆ†è§£æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼š1.è°ƒç”¨create_ticket()è·å–ticket_idï¼›2.è°ƒç”¨idempotent_withdraw(ticket_id, account_id, amount)ã€‚è™½ç„¶create_ticketä¸æ˜¯å¹‚ç­‰çš„ï¼Œä½†åœ¨è¿™ç§è®¾è®¡ä¸‹ï¼Œå®ƒå¯¹ç³»ç»ŸçŠ¶æ€çš„å½±å“å¯ä»¥å¿½ç•¥ï¼ŒåŠ ä¸Šidempotent_withdrawæ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥ä»»ä½•ä¸€æ­¥ç”±äºç½‘ç»œç­‰åŸå› å¤±è´¥æˆ–è¶…æ—¶ï¼Œå®¢æˆ·ç«¯éƒ½å¯ä»¥é‡è¯•ï¼Œç›´åˆ°è·å¾—ç»“æœã€‚å¦‚å›¾2æ‰€ç¤ºï¼š</p><p><img src="201106042051069339.png" alt="å›¾2"></p><p>å’Œåˆ†å¸ƒå¼äº‹åŠ¡ç›¸æ¯”ï¼Œå¹‚ç­‰è®¾è®¡çš„ä¼˜åŠ¿åœ¨äºå®ƒçš„è½»é‡çº§ï¼Œå®¹æ˜“é€‚åº”å¼‚æ„ç¯å¢ƒï¼Œä»¥åŠæ€§èƒ½å’Œå¯ç”¨æ€§æ–¹é¢ã€‚åœ¨æŸäº›æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨ï¼Œå¹‚ç­‰è®¾è®¡å¾€å¾€æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚</p><h1 id="HTTPçš„å¹‚ç­‰æ€§"><a href="#HTTPçš„å¹‚ç­‰æ€§" class="headerlink" title="HTTPçš„å¹‚ç­‰æ€§"></a>HTTPçš„å¹‚ç­‰æ€§</h1><p>HTTPåè®®æœ¬èº«æ˜¯ä¸€ç§é¢å‘èµ„æºçš„åº”ç”¨å±‚åè®®ï¼Œä½†å¯¹HTTPåè®®çš„ä½¿ç”¨å®é™…ä¸Šå­˜åœ¨ç€ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼š<strong>ä¸€ç§æ˜¯RESTfulçš„ï¼Œå®ƒæŠŠHTTPå½“æˆåº”ç”¨å±‚åè®®ï¼Œæ¯”è¾ƒå¿ å®åœ°éµå®ˆäº†HTTPåè®®çš„å„ç§è§„å®šï¼›å¦ä¸€ç§æ˜¯SOAçš„ï¼Œå®ƒå¹¶æ²¡æœ‰å®Œå…¨æŠŠHTTPå½“æˆåº”ç”¨å±‚åè®®ï¼Œè€Œæ˜¯æŠŠHTTPåè®®ä½œä¸ºäº†ä¼ è¾“å±‚åè®®ï¼Œ</strong>ç„¶ååœ¨HTTPä¹‹ä¸Šå»ºç«‹äº†è‡ªå·±çš„åº”ç”¨å±‚åè®®ã€‚æœ¬æ–‡æ‰€è®¨è®ºçš„HTTPå¹‚ç­‰æ€§ä¸»è¦é’ˆå¯¹RESTfulé£æ ¼çš„ï¼Œä¸è¿‡æ­£å¦‚ä¸Šä¸€èŠ‚æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œå¹‚ç­‰æ€§å¹¶ä¸å±äºç‰¹å®šçš„åè®®ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§ç‰¹æ€§ï¼›æ‰€ä»¥ï¼Œä¸è®ºæ˜¯SOAè¿˜æ˜¯RESTfulçš„Web APIè®¾è®¡éƒ½åº”è¯¥è€ƒè™‘å¹‚ç­‰æ€§ã€‚ä¸‹é¢å°†ä»‹ç»HTTP GETã€DELETEã€PUTã€POSTå››ç§ä¸»è¦æ–¹æ³•çš„è¯­ä¹‰å’Œå¹‚ç­‰æ€§ã€‚</p><p><strong>HTTP GETæ–¹æ³•ç”¨äºè·å–èµ„æºï¼Œä¸åº”æœ‰å‰¯ä½œç”¨ï¼Œæ‰€ä»¥æ˜¯å¹‚ç­‰çš„ã€‚</strong>æ¯”å¦‚ï¼šGET <code>http://www.bank.com/account/123456</code>ï¼Œä¸ä¼šæ”¹å˜èµ„æºçš„çŠ¶æ€ï¼Œä¸è®ºè°ƒç”¨ä¸€æ¬¡è¿˜æ˜¯Næ¬¡éƒ½æ²¡æœ‰å‰¯ä½œç”¨ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œå¼ºè°ƒçš„æ˜¯ä¸€æ¬¡å’ŒNæ¬¡å…·æœ‰ç›¸åŒçš„å‰¯ä½œç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡GETçš„ç»“æœç›¸åŒã€‚GET <code>http://www.news.com/latest-news</code>è¿™ä¸ªHTTPè¯·æ±‚å¯èƒ½ä¼šæ¯æ¬¡å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå› è€Œæ˜¯æ»¡è¶³å¹‚ç­‰æ€§çš„ã€‚</p><p><strong>HTTP DELETEæ–¹æ³•ç”¨äºåˆ é™¤èµ„æºï¼Œæœ‰å‰¯ä½œç”¨ï¼Œä½†å®ƒåº”è¯¥æ»¡è¶³å¹‚ç­‰æ€§ã€‚</strong>æ¯”å¦‚ï¼šDELETE <code>http://www.forum.com/article/4231</code>ï¼Œè°ƒç”¨ä¸€æ¬¡å’ŒNæ¬¡å¯¹ç³»ç»Ÿäº§ç”Ÿçš„å‰¯ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œå³åˆ æ‰idä¸º4231çš„å¸–å­ï¼›å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥å¤šæ¬¡è°ƒç”¨æˆ–åˆ·æ–°é¡µé¢è€Œä¸å¿…æ‹…å¿ƒå¼•èµ·é”™è¯¯ã€‚</p><p>æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ˜¯HTTP POSTå’ŒPUTã€‚POSTå’ŒPUTçš„åŒºåˆ«å®¹æ˜“è¢«ç®€å•åœ°è¯¯è®¤ä¸ºâ€œPOSTè¡¨ç¤ºåˆ›å»ºèµ„æºï¼ŒPUTè¡¨ç¤ºæ›´æ–°èµ„æºâ€ï¼›è€Œå®é™…ä¸Šï¼ŒäºŒè€…å‡å¯ç”¨äºåˆ›å»ºèµ„æºï¼Œæ›´ä¸ºæœ¬è´¨çš„å·®åˆ«æ˜¯åœ¨å¹‚ç­‰æ€§æ–¹é¢ã€‚åœ¨HTTPè§„èŒƒä¸­å¯¹POSTå’ŒPUTæ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p><blockquote><p>The POST method is used to request that the origin server accept the entity enclosed in the request as a new subordinate of the resource identified by the Request-URI in the Request-Line â€¦â€¦ If a resource has been created on the origin server, the response SHOULD be 201 (Created) and contain an entity which describes the status of the request and refers to the new resource, and a Location header.</p><p>The PUT method requests that the enclosed entity be stored under the supplied Request-URI. If the Request-URI refers to an already existing resource, the enclosed entity SHOULD be considered as a modified version of the one residing on the origin server. If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI.</p></blockquote><p><strong>POSTæ‰€å¯¹åº”çš„URIå¹¶éåˆ›å»ºçš„èµ„æºæœ¬èº«ï¼Œè€Œæ˜¯èµ„æºçš„æ¥æ”¶è€…ã€‚</strong>æ¯”å¦‚ï¼šPOST <code>http://www.forum.com/articles</code>çš„è¯­ä¹‰æ˜¯åœ¨<code>http://www.forum.com/articles</code>ä¸‹åˆ›å»ºä¸€ç¯‡å¸–å­ï¼ŒHTTPå“åº”ä¸­åº”åŒ…å«å¸–å­çš„åˆ›å»ºçŠ¶æ€ä»¥åŠå¸–å­çš„URIã€‚ä¸¤æ¬¡ç›¸åŒçš„POSTè¯·æ±‚ä¼šåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸¤ä»½èµ„æºï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„URIï¼›æ‰€ä»¥ï¼Œ<strong>POSTæ–¹æ³•ä¸å…·å¤‡å¹‚ç­‰æ€§</strong>ã€‚è€ŒPUTæ‰€å¯¹åº”çš„URIæ˜¯è¦åˆ›å»ºæˆ–æ›´æ–°çš„èµ„æºæœ¬èº«ã€‚æ¯”å¦‚ï¼šPUT<code>http://www.forum/articles/4231</code>çš„è¯­ä¹‰æ˜¯åˆ›å»ºæˆ–æ›´æ–°IDä¸º4231çš„å¸–å­ã€‚å¯¹åŒä¸€URIè¿›è¡Œå¤šæ¬¡PUTçš„å‰¯ä½œç”¨å’Œä¸€æ¬¡PUTæ˜¯ç›¸åŒçš„ï¼›å› æ­¤ï¼Œ<strong>PUTæ–¹æ³•å…·æœ‰å¹‚ç­‰æ€§ã€‚</strong></p><p><strong>åœ¨ä»‹ç»äº†å‡ ç§æ“ä½œçš„è¯­ä¹‰å’Œå¹‚ç­‰æ€§ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡Web APIçš„å½¢å¼å®ç°å‰é¢æ‰€æåˆ°çš„å–æ¬¾åŠŸèƒ½ã€‚å¾ˆç®€å•ï¼Œç”¨POST /ticketsæ¥å®ç°create_ticketï¼›ç”¨PUT /accounts/account_id/ticket_id?amount=xxxæ¥å®ç°idempotent_withdrawã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ä¸¥æ ¼æ¥è®²amountå‚æ•°ä¸åº”è¯¥ä½œä¸ºURIçš„ä¸€éƒ¨åˆ†ï¼ŒçœŸæ­£çš„URIåº”è¯¥æ˜¯/accounts/account_id/ticket_idï¼Œè€Œamountåº”è¯¥æ”¾åœ¨è¯·æ±‚çš„bodyä¸­ã€‚è¿™ç§æ¨¡å¼å¯ä»¥åº”ç”¨äºå¾ˆå¤šåœºåˆï¼Œæ¯”å¦‚ï¼šè®ºå›ç½‘ç«™ä¸­é˜²æ­¢æ„å¤–çš„é‡å¤å‘å¸–ã€‚</strong></p><h2 id="å¦‚ä½•é˜²èŒƒ-POST-é‡å¤æäº¤"><a href="#å¦‚ä½•é˜²èŒƒ-POST-é‡å¤æäº¤" class="headerlink" title="å¦‚ä½•é˜²èŒƒ POST é‡å¤æäº¤"></a>å¦‚ä½•é˜²èŒƒ POST é‡å¤æäº¤</h2><p>HTTP POST æ“ä½œæ—¢ä¸æ˜¯å®‰å…¨çš„ï¼Œä¹Ÿä¸æ˜¯å¹‚ç­‰çš„ï¼ˆè‡³å°‘åœ¨ HTTP è§„èŒƒé‡Œæ²¡æœ‰ä¿è¯ï¼‰ã€‚å½“æˆ‘ä»¬å› ä¸ºåå¤åˆ·æ–°æµè§ˆå™¨å¯¼è‡´å¤šæ¬¡æäº¤è¡¨å•ï¼Œå¤šæ¬¡å‘å‡ºåŒæ ·çš„ POST è¯·æ±‚ï¼Œå¯¼è‡´è¿œç«¯æœåŠ¡å™¨é‡å¤åˆ›å»ºå‡ºäº†èµ„æºã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å½¢ï¼Œæœ‰ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ³•ï¼š</p><ol><li>ä¸Šè¿°æ‰€è¯´çš„å¹‚ç­‰æ€§è®¾è®¡ï¼›</li><li>PRG(Post/Redirect/Getæ¨¡å¼)ï¼šæœåŠ¡å™¨ç«¯æ”¶åˆ° POST è¯·æ±‚ï¼Œåœ¨æ“ä½œæˆåŠŸåå¿…é¡» 302 è·³è½¬åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œè¿™æ ·å³ä½¿ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œä¹Ÿä¸ä¼šé‡å¤æäº¤è¡¨å•ã€‚</li><li>ç”¨JavaScriptçš„æ–¹å¼åœ¨å®¢æˆ·ç«¯å¤„ç†ï¼šè¡¨å•æäº¤ä¹‹åï¼Œå°†æäº¤æŒ‰é’®è®¾ç½®ä¸ºä¸å¯ç”¨ï¼›</li><li>åç«¯ WebService ä¸€å®šè¦åšåˆ°å¹‚ç­‰æ€§ï¼š<ol><li>ä½¿ç”¨Sessionè®¾ç½®ä»¤ç‰Œã€‚å®¢æˆ·ç«¯è¯·æ±‚é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¸ºæ¯æ¬¡äº§ç”Ÿçš„Formè¡¨å•åˆ†é…å”¯ä¸€çš„éšæœºæ ‡è¯†å·ï¼Œå¹¶ä¸”åœ¨ormçš„ä¸€ä¸ªéšè—å­—æ®µä¸­è®¾ç½®è¿™ä¸ªæ ‡è¯†å·ï¼ŒåŒæ—¶åœ¨å½“å‰ç”¨æˆ·çš„Sessionä¸­ä¿å­˜è¿™ä¸ªæ ‡è¯†å·ã€‚å½“æäº¤è¡¨å•æ—¶ï¼ŒæœåŠ¡å™¨æ¯”è¾ƒhiddenå’Œsessionä¸­çš„æ ‡è¯†å·æ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™ç»§ç»­ï¼Œå¤„ç†å®Œåæ¸…ç©ºSessionï¼Œå¦åˆ™æœåŠ¡å™¨å¿½ç•¥è¯·æ±‚ã€‚æ³¨æ„ï¼šæ¶æ„ç”¨æˆ·å¯åˆ©ç”¨è¿™ä¸€æ€§è´¨ï¼Œä¸æ–­é‡å¤è®¿é—®é¡µé¢ï¼Œä»¥è‡´Sessionä¸­ä¿å­˜çš„æ ‡è¯†å·ä¸æ–­å¢å¤šï¼Œæœ€ç»ˆä¸¥é‡æ¶ˆè€—æœåŠ¡å™¨å†…å­˜ã€‚å¯ä»¥é‡‡ç”¨åœ¨Sessionä¸­è®°å½•ç”¨æˆ·å‘å¸–çš„æ—¶é—´ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªæ—¶é—´é—´éš”æ¥é™åˆ¶ç”¨æˆ·è¿ç»­å‘å¸–çš„æ•°é‡æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</li><li>åœ¨æ•°æ®åº“æ·»åŠ å”¯ä¸€å­—æ®µã€‚åœ¨æ•°æ®åº“å»ºè¡¨çš„æ—¶å€™åœ¨IDå­—æ®µæ·»åŠ ä¸»é”®çº¦æŸï¼Œè´¦å·ï¼Œåç§°çš„ä¿¡æ¯æ·»åŠ å”¯ä¸€æ€§çº¦æŸã€‚ç¡®ä¿æ•°æ®åº“åªå¯ä»¥æ·»åŠ ä¸€æ¡æ•°æ®ã€‚</li></ol></li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.cnblogs.com/weidagang2046/archive/2011/06/04/idempotence.html">ç†è§£HTTPå¹‚ç­‰æ€§</a></li><li><a href="https://blog.csdn.net/qq_33945246/article/details/104613726">HTTPåè®®çš„è¡¥å……ï¼ˆPOSTã€GETè¯·æ±‚æ–¹æ³•ã€å¹‚ç­‰æ€§ï¼‰</a></li><li><a href="https://juejin.cn/post/6968747879682801672">é˜²æ­¢è¡¨å•é‡å¤æäº¤çš„è§£å†³æ–¹æ¡ˆæ•´ç†</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
          <category> HTTPåè®® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
            <tag> HTTPåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¥ç»ç½‘ç»œè®­ç»ƒåˆä½“éªŒ: æˆ¿ä»·é¢„æµ‹æ¯”èµ›</title>
      <link href="/2022/01/12/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83%E5%88%9D%E4%BD%93%E9%AA%8C-%E6%88%BF%E4%BB%B7%E9%A2%84%E6%B5%8B%E6%AF%94%E8%B5%9B/"/>
      <url>/2022/01/12/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83%E5%88%9D%E4%BD%93%E9%AA%8C-%E6%88%BF%E4%BB%B7%E9%A2%84%E6%B5%8B%E6%AF%94%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡FROMã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ç¬¬å››ç« ç¬¬åèŠ‚ï¼Œé“¾æ¥è¯¦è§<em>å‚è€ƒèµ„æ–™1</em></p></blockquote><h1 id="å·¥ä½œç¯å¢ƒ"><a href="#å·¥ä½œç¯å¢ƒ" class="headerlink" title="å·¥ä½œç¯å¢ƒ"></a>å·¥ä½œç¯å¢ƒ</h1><div class="table-container"><table><thead><tr><th>è½¯ä»¶åç§°</th><th>è¯´æ˜</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>anaconda</td><td>Pythonç¯å¢ƒå’Œå¼€æºæ¨¡å—ç®¡ç†å·¥å…·</td><td>é»˜è®¤</td></tr><tr><td>Python</td><td>å¼€å‘è¯­è¨€</td><td>3.8</td></tr><tr><td>torchã€torchvision</td><td>æ·±åº¦å­¦ä¹ æ¡†æ¶</td><td>é»˜è®¤</td></tr><tr><td>d2l</td><td>åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ å®˜æ–¹æ¨¡å—</td><td>é»˜è®¤</td></tr><tr><td>VS Code</td><td>å¼€å‘IDE</td><td>é»˜è®¤</td></tr></tbody></table></div><h1 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h1><p>åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹<code>kaggle-house-prices</code>ï¼ˆè‡ªå®šä¹‰å‘½åï¼‰ä»¥åŠ<code>code</code>å­æ–‡ä»¶å¤¹ï¼Œ<code>code/</code>ä¸‹åˆ›å»ºJupyter notebookï¼Œæ‰€æœ‰ä»£ç å†™åœ¨è¿™é‡Œé¢ã€‚</p><p>ç”Ÿæˆçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kaggle-house-prices/</span><br><span class="line">code/</span><br><span class="line">kaggle-house-prices.ipynb</span><br></pre></td></tr></table></figure><h1 id="ä¸‹è½½æ•°æ®é›†"><a href="#ä¸‹è½½æ•°æ®é›†" class="headerlink" title="ä¸‹è½½æ•°æ®é›†"></a>ä¸‹è½½æ•°æ®é›†</h1><p>æ•°æ®é›†æ¥è‡ªäºKaggleä¸Šçš„ä¸€ä¸ªç«èµ›ã€‚ç½‘å€ï¼š<a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data">https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data</a></p><p>ä½ å¯ä»¥ç›´æ¥ä»ä¸Šé¢ä¸‹è½½æ•°æ®é›†ï¼›ï¼ˆåŒ…å«è®­ç»ƒé›†ã€æµ‹è¯•é›†ã€æ•°æ®æè¿°å’Œæäº¤æ ·ä¾‹ï¼‰</p><p>æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä¹¦ä¸­çš„æ–¹å¼ä¸‹è½½ä»£ç ï¼Œè¿™é‡Œæˆ‘æŠŠå®Œæ•´çš„ä»£ç è´´ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªäºŒå…ƒç»„åŒ…å«æ•°æ®é›†çš„urlå’ŒéªŒè¯æ–‡ä»¶å®Œæ•´æ€§çš„sha-1å¯†é’¥</span></span><br><span class="line">DATA_HUB = <span class="built_in">dict</span>()</span><br><span class="line">DATA_URL = <span class="string">&#x27;http://d2l-data.s3-accelerate.amazonaws.com/&#x27;</span></span><br><span class="line">DATA_HUB[<span class="string">&#x27;kaggle_house_train&#x27;</span>] = (</span><br><span class="line">    DATA_URL + <span class="string">&#x27;kaggle_house_pred_train.csv&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;585e9cc93e70b39160e7921475f9bcd7d31219ce&#x27;</span>)</span><br><span class="line"></span><br><span class="line">DATA_HUB[<span class="string">&#x27;kaggle_house_test&#x27;</span>] = (</span><br><span class="line">    DATA_URL + <span class="string">&#x27;kaggle_house_pred_test.csv&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;fa19780a7b011d9b009e8bff8e99922a8ee2eb90&#x27;</span>)</span><br><span class="line"></span><br><span class="line">DATA_URL = <span class="string">&#x27;http://d2l-data.s3-accelerate.amazonaws.com/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å®šä¹‰äº†ä¸€å †ä¸‹è½½ã€è§£å‹çš„å‡½æ•°</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">name, cache_dir=os.path.join(<span class="params"><span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;data&#x27;</span></span>)</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸‹è½½ä¸€ä¸ªDATA_HUBä¸­çš„æ–‡ä»¶ï¼Œè¿”å›æœ¬åœ°æ–‡ä»¶å&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> name <span class="keyword">in</span> DATA_HUB, <span class="string">f&quot;<span class="subst">&#123;name&#125;</span> ä¸å­˜åœ¨äº <span class="subst">&#123;DATA_HUB&#125;</span>&quot;</span></span><br><span class="line">    url, sha1_hash = DATA_HUB[name]</span><br><span class="line">    os.makedirs(cache_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    fname = os.path.join(cache_dir, url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(fname):</span><br><span class="line">        sha1 = hashlib.sha1()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(fname, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                data = f.read(<span class="number">1048576</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                sha1.update(data)</span><br><span class="line">        <span class="keyword">if</span> sha1.hexdigest() == sha1_hash:</span><br><span class="line">            <span class="keyword">return</span> fname  <span class="comment"># å‘½ä¸­ç¼“å­˜</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;æ­£åœ¨ä»<span class="subst">&#123;url&#125;</span>ä¸‹è½½<span class="subst">&#123;fname&#125;</span>...&#x27;</span>)</span><br><span class="line">    r = requests.get(url, stream=<span class="literal">True</span>, verify=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fname, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(r.content)</span><br><span class="line">    <span class="keyword">return</span> fname</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_extract</span>(<span class="params">name, folder=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸‹è½½å¹¶è§£å‹zip/taræ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line">    fname = download(name)</span><br><span class="line">    base_dir = os.path.dirname(fname)</span><br><span class="line">    data_dir, ext = os.path.splitext(fname)</span><br><span class="line">    <span class="keyword">if</span> ext == <span class="string">&#x27;.zip&#x27;</span>:</span><br><span class="line">        fp = zipfile.ZipFile(fname, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ext <span class="keyword">in</span> (<span class="string">&#x27;.tar&#x27;</span>, <span class="string">&#x27;.gz&#x27;</span>):</span><br><span class="line">        fp = tarfile.<span class="built_in">open</span>(fname, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">False</span>, <span class="string">&#x27;åªæœ‰zip/taræ–‡ä»¶å¯ä»¥è¢«è§£å‹ç¼©&#x27;</span></span><br><span class="line">    fp.extractall(base_dir)</span><br><span class="line">    <span class="keyword">return</span> os.path.join(base_dir, folder) <span class="keyword">if</span> folder <span class="keyword">else</span> data_dir</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_all</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸‹è½½DATA_HUBä¸­çš„æ‰€æœ‰æ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> DATA_HUB:</span><br><span class="line">        download(name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">download_all()</span><br></pre></td></tr></table></figure><pre><code>æ­£åœ¨ä»http://d2l-data.s3-accelerate.amazonaws.com/kaggle_house_pred_train.csvä¸‹è½½..\data\kaggle_house_pred_train.csv...æ­£åœ¨ä»http://d2l-data.s3-accelerate.amazonaws.com/kaggle_house_pred_test.csvä¸‹è½½..\data\kaggle_house_pred_test.csv...</code></pre><p>ä½¿ç”¨ä¹¦ä¸­çš„ä»£ç ä¸‹è½½çš„æ•°æ®é›†å­˜æ”¾åœ¨<code>../data/</code>ä¸­ã€‚ç»“æ„ç›®å½•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kaggle-house-prices/</span><br><span class="line">code/</span><br><span class="line">kaggle-house-prices.ipynb</span><br><span class="line">    data/</span><br><span class="line">    kaggle_house_pred_train.csv</span><br><span class="line">    kaggle_house_pred_test.csv</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿›è¡Œæ•°æ®è¯»å–å’Œé¢„å¤„ç†ã€‚</p><h1 id="è¯»å–æ•°æ®é›†"><a href="#è¯»å–æ•°æ®é›†" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœpandasæ²¡æœ‰è¢«å®‰è£…ï¼Œè¯·å–æ¶ˆä¸‹ä¸€å¥çš„æ³¨é‡Šã€‚</span></span><br><span class="line"><span class="comment"># !pip install pandas</span></span><br><span class="line"></span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">train_data = pd.read_csv(<span class="string">&quot;../data/kaggle_house_pred_train.csv&quot;</span>)</span><br><span class="line">test_data = pd.read_csv(<span class="string">&quot;../data/kaggle_house_pred_train.csv&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰“å°ä»–ä»¬çš„è¡Œåˆ—æ•°ï¼Œè¿™é‡Œtest_dataçš„åˆ—æ¯”train_dataå°‘1ï¼Œå°‘çš„æ˜¯æ ‡ç­¾ä¸€åˆ—</span></span><br><span class="line"><span class="built_in">print</span>(train_data.shape)</span><br><span class="line"><span class="built_in">print</span>(test_data.shape)</span><br></pre></td></tr></table></figure><pre><code>(1460, 81)(1460, 81)</code></pre><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># print train_data ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æŒ‡å‡ºæ‰“å°çš„è¡Œï¼ˆæ ·æœ¬ï¼‰å’Œåˆ—ï¼ˆç‰¹å¾ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(train_data.iloc[<span class="number">0</span>:<span class="number">4</span>, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">3</span>, -<span class="number">2</span>, -<span class="number">1</span>]])</span><br></pre></td></tr></table></figure><pre><code>   Id  MSSubClass MSZoning  LotFrontage SaleType SaleCondition  SalePrice0   1          60       RL         65.0       WD        Normal     2085001   2          20       RL         80.0       WD        Normal     1815002   3          60       RL         68.0       WD        Normal     2235003   4          70       RL         60.0       WD       Abnorml     140000</code></pre><p>å°†train_dataå’Œtest_dataå»æ‰ç¬¬ä¸€ä¸ªç‰¹å¾ï¼ˆç¬¬ä¸€ä¸ªç‰¹å¾æ˜¯IDï¼Œå¯¹è®­ç»ƒæ— æ„ä¹‰ï¼‰çš„æ‰€æœ‰ç‰¹å¾éƒ½æ”¾åˆ°all_featuresä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">all_features = pd.concat((train_data.iloc[:, <span class="number">1</span>:-<span class="number">1</span>], test_data.iloc[:, <span class="number">1</span>:]))</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h2><p>åœ¨å¼€å§‹å»ºæ¨¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚</p><p>å¯¹äºæ•°å­—ç‰¹å¾ï¼Œé¦–å…ˆï¼Œ<strong>å°†æ‰€æœ‰ç¼ºå¤±çš„å€¼æ›¿æ¢ä¸ºç›¸åº”ç‰¹å¾çš„å¹³å‡å€¼ï¼›</strong></p><p>ç„¶åï¼Œä¸ºäº†å°†æ‰€æœ‰ç‰¹å¾æ”¾åœ¨ä¸€ä¸ªå…±åŒçš„å°ºåº¦ä¸Šï¼Œæˆ‘ä»¬<strong>é€šè¿‡å°†ç‰¹å¾é‡æ–°ç¼©æ”¾åˆ°é›¶å‡å€¼å’Œå•ä½æ–¹å·®æ¥æ ‡å‡†åŒ–æ•°æ®</strong>ï¼š</p><script type="math/tex; mode=display">x \leftarrow \frac{x - \mu}{\sigma}.</script><p>æ­¤æ—¶ï¼Œç‰¹å¾å³å…·æœ‰é›¶å‡å€¼å’Œå•ä½æ–¹å·®ï¼Œå³ $E[\frac{x-\mu}{\sigma}] = \frac{\mu - \mu}{\sigma} = 0$å’Œ$E[(x-\mu)^2] = (\sigma^2 + \mu^2) - 2\mu^2+\mu^2 = \sigma^2$ã€‚</p><p>æ ‡å‡†åŒ–æ•°æ®æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>æ–¹ä¾¿ä¼˜åŒ–ï¼›</li><li>æˆ‘ä»¬ä¸çŸ¥é“å“ªäº›ç‰¹å¾æ˜¯ç›¸å…³çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æƒ³è®©æƒ©ç½šåˆ†é…ç»™ä¸€ä¸ªç‰¹å¾çš„ç³»æ•°æ¯”åˆ†é…ç»™å…¶ä»–ä»»ä½•ç‰¹å¾çš„ç³»æ•°æ›´å¤§ï¼›</li><li>å–æ¶ˆç”±äºé‡çº²ä¸åŒã€è‡ªèº«å˜å¼‚æˆ–è€…æ•°å€¼ç›¸å·®è¾ƒå¤§æ‰€å¼•èµ·çš„è¯¯å·®ã€‚</li></ul><p>æ›´å¤šå…³äºæ ‡å‡†åŒ–çš„çŸ¥è¯†è¯·è§<em>å‚è€ƒèµ„æ–™2</em></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¹¦ä¸­æåˆ°çš„æ˜¯å…ˆå¤„ç†ç¼ºå¤±å€¼ï¼Œå†æ ‡å‡†åŒ–ï¼›è€Œå®é™…ä»£ç æ˜¯å…ˆæ ‡å‡†åŒ–ï¼Œå†å¤„ç†ç¼ºå¤±å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‹¥æ— æ³•è·å¾—æµ‹è¯•æ•°æ®ï¼Œåˆ™å¯æ ¹æ®è®­ç»ƒæ•°æ®è®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®</span></span><br><span class="line"><span class="comment"># å–å‡ºæ•°å­—ç±»å‹çš„ç‰¹å¾ç´¢å¼•</span></span><br><span class="line">numeric_features = all_features.dtypes[all_features.dtypes != <span class="string">&#x27;object&#x27;</span>].index</span><br><span class="line"><span class="comment"># å°†æ•°å­—ç±»å‹çš„ç‰¹å¾æ ‡å‡†åŒ–</span></span><br><span class="line">all_features[numeric_features] = all_features[numeric_features].apply(</span><br><span class="line">    <span class="keyword">lambda</span> x: (x - x.mean()) / (x.std()))</span><br><span class="line"><span class="comment"># åœ¨æ ‡å‡†åŒ–æ•°æ®ä¹‹åï¼Œæ‰€æœ‰å‡å€¼æ¶ˆå¤±ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†ç¼ºå¤±å€¼è®¾ç½®ä¸º0</span></span><br><span class="line">all_features[numeric_features] = all_features[numeric_features].fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>å¯¹äºç¦»æ•£å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨one-hotç¼–ç ï¼Œå°±æ˜¯ç‰¹å¾çš„ç¦»æ•£å€¼è½¬æ¢ä¸ºå‘é‡ã€‚ä¾‹å¦‚ï¼Œç‰¹å¾â€œtypeâ€çš„å€¼åŒ…æ‹¬catï¼Œdogï¼Œratï¼Œé‚£ä¹ˆç»è¿‡one-hotç¼–ç åä¼šç”Ÿæˆä¸‰ä¸ªç‰¹å¾â€œtype_catâ€ï¼Œâ€œtype_dogâ€ï¼Œâ€œtype_ratâ€ã€‚å¦‚æœåŸæ¥â€œtypeâ€=catï¼Œåˆ™â€œtype_catâ€=1ï¼Œâ€œtype_dogâ€=0ï¼Œâ€œtype_ratâ€=0ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># â€œDummy_na=Trueâ€å°†â€œnaâ€ï¼ˆç¼ºå¤±å€¼ï¼‰è§†ä¸ºæœ‰æ•ˆçš„ç‰¹å¾å€¼ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºæŒ‡ç¤ºç¬¦ç‰¹å¾</span></span><br><span class="line">all_features = pd.get_dummies(all_features, dummy_na=<span class="literal">True</span>)</span><br><span class="line">all_features.shape</span><br></pre></td></tr></table></figure><pre><code>(2920, 332)</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤è½¬æ¢ä¼šå°†ç‰¹å¾çš„æ€»æ•°é‡ä»79ä¸ªå¢åŠ åˆ°331ä¸ªã€‚ æœ€åï¼Œé€šè¿‡valueså±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ ä»pandasæ ¼å¼ä¸­æå–NumPyæ ¼å¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¼ é‡è¡¨ç¤ºç”¨äºè®­ç»ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n_train = train_data.shape[<span class="number">0</span>]  <span class="comment"># å–å¾—train_dataçš„è¡Œæ•°</span></span><br><span class="line"><span class="comment"># å–å‡ºall_featuresçš„train_dataè½¬æ¢æˆtensor</span></span><br><span class="line">train_features = torch.tensor(all_features[:n_train].values, dtype=torch.float32)</span><br><span class="line"><span class="comment"># å–å‡ºall_featuresçš„test_dataè½¬æ¢æˆtensor</span></span><br><span class="line">test_features = torch.tensor(all_features[n_train:].values, dtype=torch.float32)</span><br><span class="line"><span class="comment"># train_labels.shape[0] == n_train</span></span><br><span class="line"><span class="comment"># reshape(-1, 1)ç›¸å½“äºæŠŠlabelsä¸€è¡Œè½¬ä¸ºä¸€åˆ—å’Œtrain_featuresä¸€ä¸€å¯¹åº”</span></span><br><span class="line">train_labels = torch.tensor(</span><br><span class="line">    train_data.SalePrice.values.reshape(-<span class="number">1</span>, <span class="number">1</span>), dtype=torch.float32)</span><br></pre></td></tr></table></figure><h1 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬è®­ç»ƒä¸€ä¸ªå¸¦æœ‰æŸå¤±å¹³æ–¹çš„çº¿æ€§æ¨¡å‹ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œçº¿æ€§æ¨¡å‹å°†ä½œä¸ºåŸºçº¿ï¼ˆbaselineï¼‰æ¨¡å‹ï¼Œ è®©æˆ‘ä»¬ç›´è§‚åœ°çŸ¥é“æœ€å¥½çš„æ¨¡å‹æœ‰è¶…å‡ºç®€å•çš„æ¨¡å‹å¤šå°‘ã€‚</p><p>æŸå¤±å‡½æ•°ï¼šMSE Loss</p><p>åŸºçº¿æ¨¡å‹ï¼šï¼ˆä¸ªäººç†è§£ï¼‰æœ€å…ˆæƒ³åˆ°çš„ã€æœ€ç®€å•çš„ã€ç»“æœæ¯”è¾ƒå·®ã€ä¸€èˆ¬åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–çš„æ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">loss = nn.MSELoss()</span><br><span class="line">in_features = train_features.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_net</span>():</span><br><span class="line">    net = nn.Sequential(nn.Linear(in_features,<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> net</span><br></pre></td></tr></table></figure><p>å¯¹äºæˆ¿ä»·ï¼Œå°±åƒè‚¡ç¥¨ä»·æ ¼ä¸€æ ·ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯ç›¸å¯¹æ•°é‡ï¼Œè€Œä¸æ˜¯ç»å¯¹æ•°é‡ã€‚å› æ­¤ï¼Œ[<strong>æˆ‘ä»¬æ›´å…³å¿ƒç›¸å¯¹è¯¯å·®$\frac{y - \hat{y}}{y}$ï¼Œ</strong>]è€Œä¸æ˜¯ç»å¯¹è¯¯å·®$y - \hat{y}$ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¿„äº¥ä¿„å·å†œæ‘åœ°åŒºä¼°è®¡ä¸€æ ‹æˆ¿å­çš„ä»·æ ¼æ—¶ï¼Œæˆ‘ä»¬çš„é¢„æµ‹åå·®äº†10ä¸‡ç¾å…ƒï¼Œåœ¨é‚£é‡Œä¸€æ ‹å…¸å‹çš„æˆ¿å­çš„ä»·å€¼æ˜¯12.5ä¸‡ç¾å…ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½åšå¾—å¾ˆç³Ÿç³•ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åŠ å·è±ªå®…åŒºçš„é¢„æµ‹å‡ºç°äº†è¿™ä¸ªæ•°å­—çš„åå·®ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæƒŠäººçš„å‡†ç¡®é¢„æµ‹ï¼ˆåœ¨é‚£é‡Œï¼Œæˆ¿ä»·å‡å€¼è¶…è¿‡400ä¸‡ç¾å…ƒï¼‰ã€‚</p><p>(<strong>è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ç”¨ä»·æ ¼é¢„æµ‹çš„å¯¹æ•°æ¥è¡¡é‡å·®å¼‚</strong>)ã€‚äº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯æ¯”èµ›ä¸­å®˜æ–¹ç”¨æ¥è¯„ä»·æäº¤è´¨é‡çš„è¯¯å·®æŒ‡æ ‡ã€‚å³å°† $\delta$ for $|\log y - \log \hat{y}| \leq \delta$è½¬æ¢ä¸º$e^{-\delta} \leq \frac{\hat{y}}{y} \leq e^\delta$ã€‚è¿™ä½¿å¾—é¢„æµ‹ä»·æ ¼çš„å¯¹æ•°ä¸çœŸå®æ ‡ç­¾ä»·æ ¼çš„å¯¹æ•°ä¹‹é—´å‡ºç°ä»¥ä¸‹å‡æ–¹æ ¹è¯¯å·®ï¼š</p><script type="math/tex; mode=display">\sqrt{\frac{1}{n}\sum_{i=1}^n\left(\log y_i -\log \hat{y}_i\right)^2}.</script><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">log_rmse</span>(<span class="params">net, features, labels</span>):</span><br><span class="line">    <span class="comment"># ä¸ºäº†åœ¨å–å¯¹æ•°æ—¶è¿›ä¸€æ­¥ç¨³å®šè¯¥å€¼ï¼Œå°†å°äº1çš„å€¼è®¾ç½®ä¸º1</span></span><br><span class="line">    <span class="comment"># clampæ–¹æ³•è¯´æ˜è¯¦è§ å‚è€ƒèµ„æ–™5</span></span><br><span class="line">    clipped_preds = torch.clamp(net(features), <span class="number">1</span>, <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>))</span><br><span class="line">    rmse = torch.sqrt(loss(torch.log(clipped_preds),</span><br><span class="line">                           torch.log(labels)))</span><br><span class="line">    <span class="keyword">return</span> rmse.item()</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä¸€å¼€å§‹å¯¹æŸå¤±å‡½æ•°ï¼ˆlossï¼‰å’Œè¯„ä»·æŒ‡æ ‡ï¼ˆmetricsï¼‰æ²¡æœ‰ç†è§£ï¼Œæ‰€ä»¥æˆ‘å¯¹losså’Œlog_rmseçº ç»“äº†å¾ˆä¹…ã€‚</p><p>è¿™é‡Œæˆ‘çš„ç†è§£æ˜¯ï¼Œ</p><p>lossæ˜¯éœ€è¦ä¸¢åˆ°ç½‘ç»œé‡Œçš„ï¼Œæ˜¯ç½‘ç»œä¼˜åŒ–çš„ç›®æ ‡å‡½æ•°ï¼›å› ä¸ºéœ€è¦é€šè¿‡æ¢¯åº¦ä¸‹é™æ¥åå‘ä¼ æ’­ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å¯å¯¼çš„ï¼›</p><p>metricsæ˜¯è¯„ä»·ç½‘ç»œçš„ä¸€ç§æŒ‡æ ‡ï¼Œä¸å‚ä¸ä¼˜åŒ–ï¼›ä¸éœ€è¦å¯å¯¼ã€‚</p><p>æ›´å¤šå…³äºæŸå¤±å‡½æ•°å’Œè¯„ä»·æŒ‡æ ‡è¯·å‚è§<em>å‚è€ƒèµ„æ–™3</em>ï¼Œ<em>å‚è€ƒèµ„æ–™4</em></p></blockquote><hr><p>æˆ‘ä»¬çš„è®­ç»ƒå‡½æ•°å°†å€ŸåŠ©Adamä¼˜åŒ–å™¨ã€‚</p><p>Adamä¼˜åŒ–å™¨çš„ä¸»è¦å¸å¼•åŠ›åœ¨äºå®ƒå¯¹åˆå§‹å­¦ä¹ ç‡ä¸é‚£ä¹ˆæ•æ„Ÿã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">net, train_features, train_labels, test_features, test_labels,</span></span><br><span class="line"><span class="params">          num_epochs, learning_rate, weight_decay, batch_size</span>):</span><br><span class="line">    train_ls, test_ls = [], []</span><br><span class="line">    train_iter = d2l.load_array((train_features, train_labels), batch_size)</span><br><span class="line">    <span class="comment"># è¿™é‡Œä½¿ç”¨çš„æ˜¯Adamä¼˜åŒ–ç®—æ³•</span></span><br><span class="line">    optimizer = torch.optim.Adam(net.parameters(),</span><br><span class="line">                                 lr = learning_rate,</span><br><span class="line">                                 weight_decay = weight_decay)</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            l = loss(net(X), y)</span><br><span class="line">            l.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">        train_ls.append(log_rmse(net, train_features, train_labels))</span><br><span class="line">        <span class="keyword">if</span> test_labels <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            test_ls.append(log_rmse(net, test_features, test_labels))</span><br><span class="line">    <span class="keyword">return</span> train_ls, test_ls</span><br></pre></td></tr></table></figure><h1 id="K-æŠ˜äº¤å‰éªŒè¯"><a href="#K-æŠ˜äº¤å‰éªŒè¯" class="headerlink" title="K-æŠ˜äº¤å‰éªŒè¯"></a>K-æŠ˜äº¤å‰éªŒè¯</h1><p>æ‰€è°“K-æŠ˜äº¤å‰éªŒè¯å°±æ˜¯æŠŠtrain dataåˆ†ä¸ºKä»½ï¼Œæ¯æ¬¡1/Kä»½ä½œä¸ºéªŒè¯é›†ï¼ŒæŠŠå¦å¤–çš„1 - 1/Kä»½ä½œä¸ºè®­ç»ƒé›†ã€‚äº‹å®ä¸Šï¼Œ<code>get_k_fold_data</code>å°±æ˜¯åœ¨åšè¿™ä»¶äº‹ã€‚</p><p>K-æŠ˜äº¤å‰éªŒè¯æœ‰åŠ©äºæ¨¡å‹é€‰æ‹©å’Œè¶…å‚æ•°è°ƒæ•´ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_k_fold_data</span>(<span class="params">k, i, X, y</span>):</span><br><span class="line">    <span class="keyword">assert</span> k &gt; <span class="number">1</span></span><br><span class="line">    fold_size = X.shape[<span class="number">0</span>] // k</span><br><span class="line">    X_train, y_train = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        <span class="comment"># sliceæ–¹æ³•è¯´æ˜è¯¦è§å‚è€ƒèµ„æ–™6</span></span><br><span class="line">        idx = <span class="built_in">slice</span>(j * fold_size, (j + <span class="number">1</span>) * fold_size)</span><br><span class="line">        X_part, y_part = X[idx, :], y[idx]</span><br><span class="line">        <span class="keyword">if</span> j == i:</span><br><span class="line">            X_valid, y_valid = X_part, y_part</span><br><span class="line">        <span class="keyword">elif</span> X_train <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            X_train, y_train = X_part, y_part</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            X_train = torch.cat([X_train, X_part], <span class="number">0</span>) <span class="comment"># å°†å·²æœ‰çš„X_trainå’ŒX_partè¿æ¥èµ·æ¥</span></span><br><span class="line">            y_train = torch.cat([y_train, y_part], <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> X_train, y_train, X_valid, y_valid</span><br></pre></td></tr></table></figure><p><code>k_fold</code>ä¸­å…ˆæ±‚æ¯ä¸€æŠ˜å¾—åˆ°çš„trian-loss, valid-lossï¼Œæ³¨æ„train_lså’Œvalid_lsæ˜¯ä¸€ä¸ªlistï¼Œå­˜æ”¾äº†æ¯æ¬¡è¿­ä»£ålosså€¼ï¼Œæˆ‘ä»¬å–train_ls[-1]ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆçš„é‚£ä¸ªloss</p><p>æœ€åæŠŠæ‰€æœ‰K-æŠ˜å¾—åˆ°çš„train-lossçš„å¹³å‡å’Œvalid-lossçš„å¹³å‡</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">k_fold</span>(<span class="params">k, X_train, y_train, num_epochs, learning_rate, weight_decay,</span></span><br><span class="line"><span class="params">           batch_size</span>):</span><br><span class="line">    train_l_sum, valid_l_sum = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        <span class="comment"># è¿™é‡Œdataå®é™…æ˜¯ä¸€ä¸ªå…ƒç»„(X_train, y_train, X_valid, y_valid)</span></span><br><span class="line">        data = get_k_fold_data(k, i, X_train, y_train)</span><br><span class="line">        net = get_net()</span><br><span class="line">        <span class="comment"># æŠŠdataè¿™ä¸ªå…ƒç»„ä¼ å…¥ï¼Œå¯¹åº”trainä¸­çš„train_features, train_labels, test_features, test_labelså››ä¸ªå‚æ•°</span></span><br><span class="line">        train_ls, valid_ls = train(net, *data, num_epochs, learning_rate,</span><br><span class="line">                                   weight_decay, batch_size)</span><br><span class="line">        train_l_sum += train_ls[-<span class="number">1</span>]</span><br><span class="line">        valid_l_sum += valid_ls[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            d2l.plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs + <span class="number">1</span>)), [train_ls, valid_ls],</span><br><span class="line">                     xlabel=<span class="string">&#x27;epoch&#x27;</span>, ylabel=<span class="string">&#x27;rmse&#x27;</span>, xlim=[<span class="number">1</span>, num_epochs],</span><br><span class="line">                     legend=[<span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;valid&#x27;</span>], yscale=<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;æŠ˜<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>ï¼Œè®­ç»ƒlog rmse<span class="subst">&#123;<span class="built_in">float</span>(train_ls[-<span class="number">1</span>]):f&#125;</span>, &#x27;</span></span><br><span class="line">              <span class="string">f&#x27;éªŒè¯log rmse<span class="subst">&#123;<span class="built_in">float</span>(valid_ls[-<span class="number">1</span>]):f&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> train_l_sum / k, valid_l_sum / k</span><br></pre></td></tr></table></figure><h1 id="æ¨¡å‹é€‰æ‹©"><a href="#æ¨¡å‹é€‰æ‹©" class="headerlink" title="æ¨¡å‹é€‰æ‹©"></a>æ¨¡å‹é€‰æ‹©</h1><p>ä¸‹é¢æ˜¯ä¸€ç»„è¶…å‚æ•°ï¼Œåé¢æˆ‘ä»¬å¯ä»¥å¯¹æ­¤è¿›è¡Œè°ƒä¼˜ï¼ˆæ”¹æ”¹æ•°ï¼Œ run run codeï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">k, num_epochs, lr, weight_decay, batch_size = <span class="number">5</span>, <span class="number">100</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">64</span></span><br><span class="line">train_l, valid_l = k_fold(k, train_features, train_labels, num_epochs, lr,</span><br><span class="line">                          weight_decay, batch_size)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;k&#125;</span>-æŠ˜éªŒè¯: å¹³å‡è®­ç»ƒlog rmse: <span class="subst">&#123;<span class="built_in">float</span>(train_l):f&#125;</span>, &#x27;</span></span><br><span class="line">      <span class="string">f&#x27;å¹³å‡éªŒè¯log rmse: <span class="subst">&#123;<span class="built_in">float</span>(valid_l):f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>æŠ˜1ï¼Œè®­ç»ƒlog rmse0.168934, éªŒè¯log rmse0.158768æŠ˜2ï¼Œè®­ç»ƒlog rmse0.162051, éªŒè¯log rmse0.186553æŠ˜3ï¼Œè®­ç»ƒlog rmse0.163633, éªŒè¯log rmse0.167966æŠ˜4ï¼Œè®­ç»ƒlog rmse0.167716, éªŒè¯log rmse0.154111æŠ˜5ï¼Œè®­ç»ƒlog rmse0.161381, éªŒè¯log rmse0.1841885-æŠ˜éªŒè¯: å¹³å‡è®­ç»ƒlog rmse: 0.164743, å¹³å‡éªŒè¯log rmse: 0.170317</code></pre><p><img src="kaggle-house-prices_31_1.svg" alt="svg"></p><p>è¯·æ³¨æ„ï¼Œæœ‰æ—¶ä¸€ç»„è¶…å‚æ•°çš„è®­ç»ƒè¯¯å·®å¯èƒ½éå¸¸ä½ï¼Œä½† K æŠ˜äº¤å‰éªŒè¯çš„è¯¯å·®è¦é«˜å¾—å¤šï¼Œ è¿™è¡¨æ˜æ¨¡å‹è¿‡æ‹Ÿåˆäº†ã€‚ åœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä½ å°†å¸Œæœ›ç›‘æ§è®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®è¿™ä¸¤ä¸ªæ•°å­—ã€‚ è¾ƒå°‘çš„è¿‡æ‹Ÿåˆå¯èƒ½è¡¨æ˜ç°æœ‰æ•°æ®å¯ä»¥æ”¯æ’‘ä¸€ä¸ªæ›´å¼ºå¤§çš„æ¨¡å‹ï¼Œ è¾ƒå¤§çš„è¿‡æ‹Ÿåˆå¯èƒ½æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡æ­£åˆ™åŒ–æŠ€æœ¯æ¥è·ç›Šã€‚</p><h1 id="æäº¤Kaggleé¢„æµ‹"><a href="#æäº¤Kaggleé¢„æµ‹" class="headerlink" title="æäº¤Kaggleé¢„æµ‹"></a>æäº¤Kaggleé¢„æµ‹</h1><p>å½“æˆ‘ä»¬ç”¨ä¸Šé¢çš„K-æŠ˜äº¤å‰éªŒè¯ç¡®å®šå‚æ•°åï¼Œæˆ‘ä»¬å°†è¶…å‚æ•°å›ºå®šä½ï¼ŒæŠŠæ‰€æœ‰çš„train dataæ‹¿æ¥trainã€‚</p><p>å¦‚æœæµ‹è¯•é›†ä¸Šçš„é¢„æµ‹ä¸ K å€äº¤å‰éªŒè¯è¿‡ç¨‹ä¸­çš„é¢„æµ‹ç›¸ä¼¼ï¼Œ é‚£å°±æ˜¯æ—¶å€™æŠŠå®ƒä»¬ä¸Šä¼ åˆ°Kaggleäº†ã€‚ ä¸‹é¢çš„ä»£ç å°†ç”Ÿæˆä¸€ä¸ªåä¸ºsubmission.csvçš„æ–‡ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train_and_pred</span>(<span class="params">train_features, test_feature, train_labels, test_data,</span></span><br><span class="line"><span class="params">                   num_epochs, lr, weight_decay, batch_size</span>):</span><br><span class="line">    net = get_net()</span><br><span class="line">    train_ls, _ = train(net, train_features, train_labels, <span class="literal">None</span>, <span class="literal">None</span>,</span><br><span class="line">                        num_epochs, lr, weight_decay, batch_size)</span><br><span class="line">    d2l.plot(np.arange(<span class="number">1</span>, num_epochs + <span class="number">1</span>), [train_ls], xlabel=<span class="string">&#x27;epoch&#x27;</span>,</span><br><span class="line">             ylabel=<span class="string">&#x27;log rmse&#x27;</span>, xlim=[<span class="number">1</span>, num_epochs], yscale=<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;è®­ç»ƒlog rmseï¼š<span class="subst">&#123;<span class="built_in">float</span>(train_ls[-<span class="number">1</span>]):f&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="comment"># å°†ç½‘ç»œåº”ç”¨äºæµ‹è¯•é›†ã€‚</span></span><br><span class="line">    preds = net(test_features).detach().numpy()</span><br><span class="line">    <span class="comment"># å°†å…¶é‡æ–°æ ¼å¼åŒ–ä»¥å¯¼å‡ºåˆ°Kaggle</span></span><br><span class="line">    test_data[<span class="string">&#x27;SalePrice&#x27;</span>] = pd.Series(preds.reshape(<span class="number">1</span>, -<span class="number">1</span>)[<span class="number">0</span>])</span><br><span class="line">    submission = pd.concat([test_data[<span class="string">&#x27;Id&#x27;</span>], test_data[<span class="string">&#x27;SalePrice&#x27;</span>]], axis=<span class="number">1</span>)</span><br><span class="line">    submission.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">train_and_pred(train_features, test_features, train_labels, test_data,</span><br><span class="line">               num_epochs, lr, weight_decay, batch_size)</span><br></pre></td></tr></table></figure><pre><code>è®­ç»ƒlog rmseï¼š0.162150</code></pre><p><img src="kaggle-house-prices_34_1.svg" alt="svg"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ç”Ÿæˆçš„<code>submission.csv</code>æ–‡ä»¶æäº¤åˆ°Kaggleï¼š</p><ul><li>è®¿é—®<a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data">https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data</a></li><li>ç‚¹å‡»â€œSubmit Predictionsâ€</li><li>é€‰æ‹©ä½ è¦ä¸Šä¼ çš„é¢„æµ‹æ–‡ä»¶<code>submission.csv</code></li><li>ç‚¹å‡»é¡µé¢åº•éƒ¨çš„â€œMake Submissionâ€æŒ‰é’®ï¼Œå³å¯æŸ¥çœ‹ç»“æœã€‚</li></ul><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><ul><li>çœŸå®æ•°æ®é€šå¸¸æ··åˆäº†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œéœ€è¦è¿›è¡Œé¢„å¤„ç†ã€‚</li><li>å¸¸ç”¨çš„é¢„å¤„ç†æ–¹æ³•ï¼šå°†å®å€¼æ•°æ®é‡æ–°ç¼©æ”¾ä¸ºé›¶å‡å€¼å’Œå•ä½æ–¹æ³•ï¼›ç”¨å‡å€¼æ›¿æ¢ç¼ºå¤±å€¼ã€‚</li><li>å°†ç±»åˆ«ç‰¹å¾è½¬åŒ–ä¸ºæŒ‡æ ‡ç‰¹å¾ï¼Œå¯ä»¥ä½¿æˆ‘ä»¬æŠŠè¿™ä¸ªç‰¹å¾å½“ä½œä¸€ä¸ªç‹¬çƒ­å‘é‡æ¥å¯¹å¾…ã€‚</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ K æŠ˜äº¤å‰éªŒè¯æ¥é€‰æ‹©æ¨¡å‹å¹¶è°ƒæ•´è¶…å‚æ•°ã€‚</li><li>å¯¹æ•°å¯¹äºç›¸å¯¹è¯¯å·®å¾ˆæœ‰ç”¨ã€‚</li></ul><h1 id="æ›´è¿›ä¸€æ­¥"><a href="#æ›´è¿›ä¸€æ­¥" class="headerlink" title="æ›´è¿›ä¸€æ­¥"></a>æ›´è¿›ä¸€æ­¥</h1><p>è¿™é‡Œæ˜¯ä¹¦ä¸­ç»™å‡ºçš„ä¸€äº›æ€è€ƒé—®é¢˜ï¼Œæˆ‘æ²¡åšï¼Œä½†æ˜¯ä¾ç„¶åˆ—å‡ºæ¥ä¾›å‚è€ƒï¼š</p><ol><li>å°†è¯•å›¾é¢„æµ‹ä»·æ ¼æ”¹ä¸ºè¯•å›¾é¢„æµ‹ä»·æ ¼çš„å¯¹æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li><li>ç”¨å¹³å‡å€¼æ›¿æ¢ç¼ºå¤±å€¼æ€»æ˜¯å¥½ä¸»æ„å—ï¼Ÿæç¤ºï¼šä½ èƒ½æ„é€ ä¸€ä¸ªä¸éšæœºä¸¢å¤±å€¼çš„æƒ…å†µå—ï¼Ÿ</li><li>é€šè¿‡ K æŠ˜äº¤å‰éªŒè¯è°ƒæ•´è¶…å‚æ•°ï¼Œä»è€Œæé«˜Kaggleçš„å¾—åˆ†ã€‚</li><li>é€šè¿‡æ”¹è¿›æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œå±‚ã€æƒé‡è¡°å‡å’Œdropoutï¼‰æ¥æé«˜åˆ†æ•°ã€‚</li><li>å¦‚æœæˆ‘ä»¬æ²¡æœ‰åƒæœ¬èŠ‚æ‰€åšçš„é‚£æ ·æ ‡å‡†åŒ–è¿ç»­çš„æ•°å€¼ç‰¹å¾ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li></ol><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>æˆ‘ä»”ç»†é˜…è¯»åŸæ–‡ï¼Œæ‹äº†ä¸€è¾¹ä»£ç ã€‚</p><p>åŸºç¡€æ¯”è¾ƒå·®ï¼Œæœ‰äº›åœ°æ–¹è®¤è¯†ä¸å¤ªæ¸…æ™°ï¼Œå…¨å‡­è‡ªå·±ç†è§£ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·å¤šåŒ…æ¶µï¼Œæˆ–ç›´æ¥é‚®ç®±è”ç³»æˆ‘ã€‚</p><p>æˆ‘åŸä»¥ä¸ºä¼šæœ‰è®­ç»ƒæ¨¡å‹é”™è¯¯ç‡ä¸æ–­é™ä½çš„æˆå°±æ„Ÿã€‚ã€‚ä½†å®é™…ä¸Šå…¨æ˜¯å¤åˆ¶ç²˜è´´run codeã€‚</p><p>å¥½åƒå­¦åˆ°äº†åˆå¥½åƒæ²¡å­¦åˆ°ã€‚ğŸ¤¦â€</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="http://zh-v2.d2l.ai/chapter_multilayer-perceptrons/kaggle-house-price.html#id6">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ 4.10. å®æˆ˜Kaggleæ¯”èµ›ï¼šé¢„æµ‹æˆ¿ä»·</a></li><li><a href="https://www.cnblogs.com/wangqiang9/p/9285594.html">æ•°æ®é¢„å¤„ç†ä¹‹ä¸­å¿ƒåŒ–ï¼ˆé›¶å‡å€¼åŒ–ï¼‰ä¸æ ‡å‡†åŒ–ï¼ˆå½’ä¸€åŒ–ï¼‰</a></li><li><a href="https://zhuanlan.zhihu.com/p/373032887">æœºå™¨å­¦ä¹ â€”â€”æŸå¤±å‡½æ•°(loss)ä¸è¯„ä»·æŒ‡æ ‡(metric)çš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="https://codeantenna.com/a/7p6uOqnNhx">kerasä¸­compileæ–¹æ³•çš„ loss å’Œ metrics åŒºåˆ«</a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.clamp.html">torch.clampæ–¹æ³•è¯´æ˜</a></li><li><a href="https://www.runoob.com/python/python-func-slice.html">Python sliceæ–¹æ³•è¯´æ˜</a></li><li><a href="https://blog.csdn.net/m0_37871195/article/details/79829488">æ·±åº¦å­¦ä¹ ä¸­iterationã€epochã€batchsizeçš„å®šä¹‰</a></li><li><a href="https://pytorch.org/docs/1.9.1/generated/torch.Tensor.detach.html">torch.detachæ–¹æ³•è¯´æ˜</a></li><li><a href="https://pytorch.org/docs/stable/generated/torch.cat.html#torch.cat">torch.catæ–¹æ³•è¯´æ˜</a></li><li><a href="https://csbwang.github.io/dl_ch2">æœºå™¨å­¦ä¹ åŸºç¡€</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸€ï¼‰ å‰è¨€</title>
      <link href="/2022/01/10/%E3%80%8A%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89-%E5%89%8D%E8%A8%80/"/>
      <url>/2022/01/10/%E3%80%8A%E5%8A%A8%E6%89%8B%E5%AD%A6%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89-%E5%89%8D%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<p><em>æœ¬åšå®¢è®°å½•é˜…è¯»ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹çš„è¯»ä¹¦ç¬”è®°ã€‚</em></p><blockquote><p>åŸæ–‡åœ°å€ï¼š<a href="http://zh-v2.d2l.ai/chapter_introduction/index.html">http://zh-v2.d2l.ai/chapter_introduction/index.html</a></p></blockquote><h1 id="æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æœºå™¨å­¦ä¹ "><a href="#æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æœºå™¨å­¦ä¹ " class="headerlink" title="æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æœºå™¨å­¦ä¹ "></a>æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æœºå™¨å­¦ä¹ </h1><p>æˆ‘ä»¬å¯ä»¥æŠŠ<strong>å‚æ•°</strong>çœ‹ä½œæ—‹é’®ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åŠ¨æ—‹é’®æ¥è°ƒæ•´ç¨‹åºçš„è¡Œä¸ºã€‚</p><p>ä»»ä¸€è°ƒæ•´å‚æ•°åçš„ç¨‹åºï¼Œæˆ‘ä»¬ç§°ä¸º<strong>æ¨¡å‹</strong>ï¼ˆmodelï¼‰ã€‚</p><p>é€šè¿‡æ“ä½œå‚æ•°è€Œç”Ÿæˆçš„æ‰€æœ‰ä¸åŒç¨‹åºï¼ˆè¾“å…¥-è¾“å‡ºæ˜ å°„ï¼‰çš„é›†åˆç§°ä¸ºâ€œ<strong>æ¨¡å‹æ—</strong>â€ã€‚</p><p>ä½¿ç”¨æ•°æ®é›†æ¥é€‰æ‹©å‚æ•°çš„å…ƒç¨‹åºè¢«ç§°ä¸º<strong>å­¦ä¹ ç®—æ³•</strong>ï¼ˆlearning algorithmï¼‰ã€‚</p><p>åœ¨æˆ‘ä»¬å¼€å§‹ç”¨æœºå™¨å­¦ä¹ ç®—æ³•è§£å†³é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç²¾ç¡®åœ°å®šä¹‰é—®é¢˜ï¼Œç¡®å®š<strong>è¾“å…¥ï¼ˆinputï¼‰å’Œè¾“å‡ºï¼ˆoutputï¼‰</strong>çš„æ€§è´¨ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„æ¨¡å‹æ—ã€‚</p><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œ<strong>å­¦ä¹ </strong>ï¼ˆlearningï¼‰æ˜¯ä¸€ä¸ªè®­ç»ƒæ¨¡å‹çš„è¿‡ç¨‹ã€‚ é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ­£ç¡®çš„å‚æ•°é›†ï¼Œä»è€Œä½¿æ¨¡å‹å¼ºåˆ¶æ‰§è¡Œæ‰€éœ€çš„è¡Œä¸ºã€‚ æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ç”¨æ•°æ®<strong>è®­ç»ƒ</strong>ï¼ˆtrainï¼‰æˆ‘ä»¬çš„æ¨¡å‹ã€‚ </p><p>è®­ç»ƒè¿‡ç¨‹é€šå¸¸åŒ…å«å¦‚ä¸‹æ­¥éª¤ï¼š</p><ol><li>ä»ä¸€ä¸ªéšæœºåˆå§‹åŒ–å‚æ•°çš„æ¨¡å‹å¼€å§‹ï¼Œè¿™ä¸ªæ¨¡å‹åŸºæœ¬æ¯«ä¸â€œæ™ºèƒ½â€ã€‚</li><li>è·å–ä¸€äº›æ•°æ®æ ·æœ¬ï¼ˆä¾‹å¦‚ï¼ŒéŸ³é¢‘ç‰‡æ®µä»¥åŠå¯¹åº”çš„{æ˜¯,å¦}æ ‡ç­¾ï¼‰ã€‚</li><li>è°ƒæ•´å‚æ•°ï¼Œä½¿æ¨¡å‹åœ¨è¿™äº›æ ·æœ¬ä¸­è¡¨ç°å¾—æ›´å¥½ã€‚</li><li>é‡å¤ç¬¬2æ­¥å’Œç¬¬3æ­¥ï¼Œç›´åˆ°æ¨¡å‹åœ¨ä»»åŠ¡ä¸­çš„è¡¨ç°ä»¤ä½ æ»¡æ„ã€‚</li></ol><p><img src="ml-loop.png" alt="å…¸å‹çš„è®­ç»ƒè¿‡ç¨‹"></p><h1 id="å…³é”®ç»„ä»¶"><a href="#å…³é”®ç»„ä»¶" class="headerlink" title="å…³é”®ç»„ä»¶"></a>å…³é”®ç»„ä»¶</h1><p>æ— è®ºæˆ‘ä»¬é‡åˆ°ä»€ä¹ˆç±»å‹çš„æœºå™¨å­¦ä¹ é—®é¢˜ï¼Œè¿™äº›ç»„ä»¶éƒ½å°†ä¼´éšæˆ‘ä»¬å·¦å³ï¼š</p><ol><li>æˆ‘ä»¬å¯ä»¥å­¦ä¹ çš„<strong>æ•°æ®</strong>ï¼ˆdataï¼‰ã€‚</li><li>å¦‚ä½•è½¬æ¢æ•°æ®çš„<strong>æ¨¡å‹</strong>ï¼ˆmodelï¼‰ã€‚</li><li>ä¸€ä¸ª<strong>ç›®æ ‡å‡½æ•°</strong>ï¼ˆobjective functionï¼‰ï¼Œç”¨æ¥é‡åŒ–æ¨¡å‹çš„æœ‰æ•ˆæ€§ã€‚</li><li>è°ƒæ•´æ¨¡å‹å‚æ•°ä»¥ä¼˜åŒ–ç›®æ ‡å‡½æ•°çš„<strong>ç®—æ³•</strong>ï¼ˆalgorithmï¼‰ã€‚</li></ol><h2 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h2><p>æ¯ä¸ªæ•°æ®é›†ç”±ä¸€ä¸ªä¸ª<strong>æ ·æœ¬</strong>ï¼ˆexample, sampleï¼‰ç»„æˆï¼Œå¤§å¤šæ—¶å€™ï¼Œå®ƒä»¬éµå¾ªç‹¬ç«‹åŒåˆ†å¸ƒ(independently and identically distributed, i.i.d.)ã€‚ æ ·æœ¬æœ‰æ—¶ä¹Ÿå«åš<strong>æ•°æ®ç‚¹</strong>ï¼ˆdata pointï¼‰æˆ–è€…<strong>æ•°æ®å®ä¾‹</strong>ï¼ˆdata instanceï¼‰ï¼Œé€šå¸¸æ¯ä¸ªæ ·æœ¬ç”±ä¸€ç»„ç§°ä¸º<strong>ç‰¹å¾</strong>ï¼ˆfeaturesï¼Œæˆ–<strong>åå˜é‡</strong>ï¼ˆcovariatesï¼‰ï¼‰çš„å±æ€§ç»„æˆã€‚ æœºå™¨å­¦ä¹ æ¨¡å‹ä¼šæ ¹æ®è¿™äº›å±æ€§è¿›è¡Œé¢„æµ‹ã€‚ </p><p><strong>æ ‡ç­¾</strong>ï¼šé¢„æµ‹çš„ä¸€ä¸ªç‰¹æ®Šå±æ€§ï¼Œä¾‹å¦‚æ˜¯/å¦ï¼ŒçŒ«/ç‹—ç­‰ã€‚</p><p>å½“æ¯ä¸ªæ ·æœ¬çš„ç‰¹å¾ç±»åˆ«æ•°é‡éƒ½æ˜¯ç›¸åŒçš„æ—¶å€™ï¼Œå…¶ç‰¹å¾å‘é‡æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œè¿™ä¸ªé•¿åº¦è¢«ç§°ä¸ºæ•°æ®çš„ç»´æ•°ï¼ˆdimensionalityï¼‰ã€‚ å›ºå®šé•¿åº¦çš„ç‰¹å¾å‘é‡æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„å±æ€§ï¼Œå®ƒæœ‰åŠ©äºæˆ‘ä»¬é‡åŒ–å­¦ä¹ å¤§é‡æ ·æœ¬ã€‚</p><p>ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½å¯ä»¥ç”¨â€œå›ºå®šé•¿åº¦â€çš„å‘é‡è¡¨ç¤ºã€‚ä¾‹å¦‚ä¸åŒçš„å›¾ç‰‡å¤§å°ï¼Œæ–‡æœ¬é•¿åº¦ã€‚ä¸ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ–¹æ³•ç›¸æ¯”ï¼Œæ·±åº¦å­¦ä¹ çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿æ˜¯å¯ä»¥å¤„ç†ä¸åŒé•¿åº¦çš„æ•°æ®ã€‚</p><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><h2 id="ç›®æ ‡å‡½æ•°"><a href="#ç›®æ ‡å‡½æ•°" class="headerlink" title="ç›®æ ‡å‡½æ•°"></a>ç›®æ ‡å‡½æ•°</h2><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ¨¡å‹çš„ä¼˜åŠ£ç¨‹åº¦çš„åº¦é‡ï¼Œè¿™ä¸ªåº¦é‡åœ¨å¤§å¤šæ•°æƒ…å†µæ˜¯â€œå¯ä¼˜åŒ–â€çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>ç›®æ ‡å‡½æ•°</strong>ï¼ˆobjective functionï¼‰ã€‚ æˆ‘ä»¬é€šå¸¸å®šä¹‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼Œå¹¶å¸Œæœ›ä¼˜åŒ–å®ƒåˆ°æœ€ä½ç‚¹ã€‚ å› ä¸ºè¶Šä½è¶Šå¥½ï¼Œæ‰€ä»¥è¿™äº›å‡½æ•°æœ‰æ—¶è¢«ç§°ä¸º<strong>æŸå¤±å‡½æ•°</strong>ï¼ˆloss functionï¼Œæˆ–cost functionï¼‰ã€‚</p><p>å½“ä»»åŠ¡åœ¨è¯•å›¾é¢„æµ‹æ•°å€¼æ—¶ï¼Œæœ€å¸¸è§çš„æŸå¤±å‡½æ•°æ˜¯<strong>å¹³æ–¹è¯¯å·®</strong>ï¼ˆsquared errorï¼‰ï¼Œå³é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹å·®çš„å¹³æ–¹ã€‚ å½“è¯•å›¾è§£å†³åˆ†ç±»é—®é¢˜æ—¶ï¼Œæœ€å¸¸è§çš„ç›®æ ‡å‡½æ•°æ˜¯æœ€å°åŒ–é”™è¯¯ç‡ï¼Œå³é¢„æµ‹ä¸å®é™…æƒ…å†µä¸ç¬¦çš„æ ·æœ¬æ¯”ä¾‹ã€‚ æœ‰äº›ç›®æ ‡å‡½æ•°ï¼ˆå¦‚å¹³æ–¹è¯¯å·®ï¼‰å¾ˆå®¹æ˜“è¢«ä¼˜åŒ–ï¼Œæœ‰äº›ç›®æ ‡ï¼ˆå¦‚é”™è¯¯ç‡ï¼‰ç”±äºä¸å¯å¾®æ€§æˆ–å…¶ä»–å¤æ‚æ€§éš¾ä»¥ç›´æ¥ä¼˜åŒ–ã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šä¼˜åŒ–æ›¿ä»£ç›®æ ‡ã€‚</p><p> åœ¨ä¸€ä¸ªæ•°æ®é›†ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡æœ€å°åŒ–æ€»æŸå¤±æ¥å­¦ä¹ æ¨¡å‹å‚æ•°çš„æœ€ä½³å€¼ã€‚ è¯¥æ•°æ®é›†ç”±ä¸€äº›ä¸ºè®­ç»ƒè€Œæ”¶é›†çš„æ ·æœ¬ç»„æˆï¼Œç§°ä¸º<strong>è®­ç»ƒæ•°æ®é›†</strong>ï¼ˆtraining datasetï¼Œæˆ–ç§°ä¸ºè®­ç»ƒé›†ï¼ˆtraining setï¼‰ï¼‰ã€‚ ç„¶è€Œï¼Œåœ¨è®­ç»ƒæ•°æ®ä¸Šè¡¨ç°è‰¯å¥½çš„æ¨¡å‹ï¼Œå¹¶ä¸ä¸€å®šåœ¨â€œæ–°æ•°æ®é›†â€ä¸Šæœ‰åŒæ ·çš„æ•ˆèƒ½ï¼Œè¿™é‡Œçš„â€œæ–°æ•°æ®é›†â€é€šå¸¸ç§°ä¸ºæµ‹è¯•æ•°æ®é›†ï¼ˆtest datasetï¼Œæˆ–ç§°ä¸º<strong>æµ‹è¯•é›†</strong>ï¼ˆtest setï¼‰ï¼‰ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬é€šå¸¸å°†å¯ç”¨æ•°æ®é›†åˆ†æˆä¸¤éƒ¨åˆ†ï¼š<strong>è®­ç»ƒæ•°æ®é›†ç”¨äºæ‹Ÿåˆæ¨¡å‹å‚æ•°ï¼Œæµ‹è¯•æ•°æ®é›†ç”¨äºè¯„ä¼°æ‹Ÿåˆçš„æ¨¡å‹ã€‚</strong> ç„¶åæˆ‘ä»¬è§‚å¯Ÿæ¨¡å‹åœ¨è¿™ä¸¤éƒ¨åˆ†æ•°æ®é›†çš„æ•ˆèƒ½ã€‚ ä½ å¯ä»¥æŠŠâ€œä¸€ä¸ªæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šçš„æ•ˆèƒ½â€æƒ³è±¡æˆâ€œä¸€ä¸ªå­¦ç”Ÿåœ¨æ¨¡æ‹Ÿè€ƒè¯•ä¸­çš„åˆ†æ•°â€ã€‚ è¿™ä¸ªåˆ†æ•°ç”¨æ¥ä¸ºä¸€äº›çœŸæ­£çš„æœŸæœ«è€ƒè¯•åšå‚è€ƒï¼Œå³ä½¿æˆç»©ä»¤äººé¼“èˆï¼Œä¹Ÿä¸èƒ½ä¿è¯æœŸæœ«è€ƒè¯•æˆåŠŸã€‚ æ¢è¨€ä¹‹ï¼Œæµ‹è¯•æ€§èƒ½å¯èƒ½ä¼šæ˜¾è‘—åç¦»è®­ç»ƒæ€§èƒ½ã€‚ å½“ä¸€ä¸ªæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°è‰¯å¥½ï¼Œä½†ä¸èƒ½æ¨å¹¿åˆ°æµ‹è¯•é›†æ—¶ï¼Œæˆ‘ä»¬è¯´è¿™ä¸ªæ¨¡å‹æ˜¯â€œ<strong>è¿‡æ‹Ÿåˆ</strong>â€ï¼ˆoverfittingï¼‰çš„ã€‚</p><h2 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h2><p>ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†ä¸€äº›æ•°æ®æºåŠå…¶è¡¨ç¤ºã€ä¸€ä¸ªæ¨¡å‹å’Œä¸€ä¸ªåˆé€‚çš„æŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±éœ€è¦ä¸€ç§ç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿæœç´¢å‡ºæœ€ä½³å‚æ•°ï¼Œä»¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚ æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¤§å¤šæµè¡Œçš„ä¼˜åŒ–ç®—æ³•é€šå¸¸åŸºäºä¸€ç§åŸºæœ¬æ–¹æ³•â€“<strong>æ¢¯åº¦ä¸‹é™</strong>ï¼ˆgradient descentï¼‰ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œåœ¨æ¯ä¸ªæ­¥éª¤ä¸­ï¼Œæ¢¯åº¦ä¸‹é™æ³•éƒ½ä¼šæ£€æŸ¥æ¯ä¸ªå‚æ•°ï¼Œçœ‹çœ‹å¦‚æœä½ ä»…å¯¹è¯¥å‚æ•°è¿›è¡Œå°‘é‡å˜åŠ¨ï¼Œè®­ç»ƒé›†æŸå¤±ä¼šæœå“ªä¸ªæ–¹å‘ç§»åŠ¨ã€‚ ç„¶åï¼Œå®ƒåœ¨å¯ä»¥å‡å°‘æŸå¤±çš„æ–¹å‘ä¸Šä¼˜åŒ–å‚æ•°ã€‚</p><h1 id="å„ç§æœºå™¨å­¦ä¹ é—®é¢˜"><a href="#å„ç§æœºå™¨å­¦ä¹ é—®é¢˜" class="headerlink" title="å„ç§æœºå™¨å­¦ä¹ é—®é¢˜"></a>å„ç§æœºå™¨å­¦ä¹ é—®é¢˜</h1><h2 id="ç›‘ç£å­¦ä¹ "><a href="#ç›‘ç£å­¦ä¹ " class="headerlink" title="ç›‘ç£å­¦ä¹ "></a>ç›‘ç£å­¦ä¹ </h2><p>ç›‘ç£å­¦ä¹ ï¼ˆsupervised learningï¼‰æ“…é•¿åœ¨â€œ<strong>ç»™å®šè¾“å…¥ç‰¹å¾</strong>â€çš„æƒ…å†µä¸‹é¢„æµ‹æ ‡ç­¾ã€‚</p><p>ç›‘ç£å­¦ä¹ ä¸¾ä¾‹ï¼šæ ¹æ®è®¡ç®—æœºæ–­å±‚æ‰«æï¼ˆCTï¼‰è‚¿ç˜¤å›¾åƒï¼Œé¢„æµ‹æ˜¯å¦ä¸ºç™Œç—‡ï¼›æ ¹æ®æœ¬æœˆçš„è´¢åŠ¡æŠ¥å‘Šæ•°æ®ï¼Œé¢„æµ‹ä¸‹ä¸ªæœˆè‚¡ç¥¨çš„ä»·æ ¼ã€‚</p><p>åœ¨å·¥ä¸šä¸­ï¼Œå¤§éƒ¨åˆ†æœºå™¨å­¦ä¹ çš„æˆåŠŸåº”ç”¨éƒ½æ˜¯ç›‘ç£å­¦ä¹ ã€‚ è¿™æ˜¯å› ä¸ºåœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œè®¸å¤šé‡è¦çš„ä»»åŠ¡å¯ä»¥æ¸…æ™°åœ°æè¿°ä¸ºï¼šåœ¨ç»™å®šä¸€ç»„ç‰¹å®šçš„å¯ç”¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¼°è®¡æœªçŸ¥äº‹ç‰©çš„æ¦‚ç‡ã€‚</p><p><img src="supervised-learning.png" alt="ç›‘ç£å­¦ä¹ "></p><h3 id="å›å½’"><a href="#å›å½’" class="headerlink" title="å›å½’"></a>å›å½’</h3><p>å›å½’ï¼ˆregressionï¼‰æ˜¯æœ€ç®€å•çš„ç›‘ç£å­¦ä¹ ä»»åŠ¡ä¹‹ä¸€ã€‚</p><p>å½“æ ‡ç­¾å–ä»»æ„æ•°å€¼æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå›å½’é—®é¢˜ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªæ¨¡å‹ï¼Œå®ƒçš„é¢„æµ‹éå¸¸æ¥è¿‘å®é™…æ ‡ç­¾å€¼ã€‚</p><p>å›å½’é—®é¢˜ä¸¾ä¾‹ï¼šé¢„æµ‹æˆ¿ä»·ï¼›é¢„æµ‹ç”¨æˆ·å¯¹ä¸€éƒ¨ç”µå½±çš„è¯„åˆ†ã€‚</p><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p>äºŒåˆ†ç±»ï¼Œå¤šåˆ†ç±»ã€‚</p><p>åˆ†ç±»å¯èƒ½å˜å¾—æ¯”äºŒå…ƒåˆ†ç±»ã€å¤šå…ƒåˆ†ç±»å¤æ‚å¾—å¤šã€‚ ä¾‹å¦‚ï¼Œæœ‰ä¸€äº›åˆ†ç±»ä»»åŠ¡çš„å˜ä½“å¯ä»¥ç”¨äºå¯»æ‰¾å±‚æ¬¡ç»“æ„ï¼Œå±‚æ¬¡ç»“æ„å‡å®šåœ¨è®¸å¤šç±»ä¹‹é—´å­˜åœ¨æŸç§å…³ç³»ã€‚å› æ­¤ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é”™è¯¯éƒ½æ˜¯å‡ç­‰çš„ã€‚ æˆ‘ä»¬å®æ„¿é”™è¯¯åœ°åˆ†å…¥ä¸€ä¸ªç›¸å…³çš„ç±»åˆ«ï¼Œä¹Ÿä¸æ„¿é”™è¯¯åœ°åˆ†å…¥ä¸€ä¸ªé¥è¿œçš„ç±»åˆ«ï¼Œè¿™é€šå¸¸è¢«ç§°ä¸º<strong>å±‚æ¬¡åˆ†ç±»</strong>(hierarchical classification)ã€‚</p><h3 id="æ ‡è®°é—®é¢˜"><a href="#æ ‡è®°é—®é¢˜" class="headerlink" title="æ ‡è®°é—®é¢˜"></a>æ ‡è®°é—®é¢˜</h3><p>å­¦ä¹ é¢„æµ‹ä¸ç›¸äº’æ’æ–¥çš„ç±»åˆ«çš„é—®é¢˜ç§°ä¸º<strong>å¤šæ ‡ç­¾åˆ†ç±»</strong>ï¼ˆmulti-label classificationï¼‰ã€‚</p><p> ä¸¾ä¸ªä¾‹å­ï¼Œäººä»¬åœ¨æŠ€æœ¯åšå®¢ä¸Šè´´çš„æ ‡ç­¾ï¼Œæ¯”å¦‚â€œæœºå™¨å­¦ä¹ â€ã€â€œæŠ€æœ¯â€ã€â€œå°å·¥å…·â€ã€â€œç¼–ç¨‹è¯­è¨€â€ã€â€œLinuxâ€ã€â€œäº‘è®¡ç®—â€ã€‚ ä¸€ç¯‡å…¸å‹çš„æ–‡ç« å¯èƒ½ä¼šç”¨5-10ä¸ªæ ‡ç­¾ï¼Œå› ä¸ºè¿™äº›æ¦‚å¿µæ˜¯ç›¸äº’å…³è”çš„ã€‚</p><h3 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h3><p>åœ¨ä¿¡æ¯æ£€ç´¢é¢†åŸŸï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹ä¸€ç»„é¡¹ç›®è¿›è¡Œæ’åºã€‚ ä»¥ç½‘ç»œæœç´¢ä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡ä¸æ˜¯ç®€å•çš„â€œæŸ¥è¯¢ï¼ˆqueryï¼‰-ç½‘é¡µï¼ˆpageï¼‰â€åˆ†ç±»ï¼Œè€Œæ˜¯åœ¨æµ·é‡æœç´¢ç»“æœä¸­æ‰¾åˆ°ç”¨æˆ·æœ€éœ€è¦çš„é‚£éƒ¨åˆ†ã€‚</p><h3 id="æ¨èç³»ç»Ÿ"><a href="#æ¨èç³»ç»Ÿ" class="headerlink" title="æ¨èç³»ç»Ÿ"></a>æ¨èç³»ç»Ÿ</h3><h3 id="åºåˆ—å­¦ä¹ "><a href="#åºåˆ—å­¦ä¹ " class="headerlink" title="åºåˆ—å­¦ä¹ "></a>åºåˆ—å­¦ä¹ </h3><p>æœ‰äº›æ—¶å€™ï¼Œè¾“å…¥æ˜¯è¿ç»­çš„ã€‚æˆ‘ä»¬çš„æ¨¡å‹å¯èƒ½å°±éœ€è¦æ‹¥æœ‰â€œè®°å¿†â€åŠŸèƒ½ã€‚</p><p>æ¯”å¦‚æ–‡å­—åºåˆ—ï¼Œå›¾åƒåºåˆ—ï¼ˆè§†é¢‘ï¼‰</p><p>ä»¥ä¸‹æ˜¯åºåˆ—å­¦ä¹ çš„ç‰¹æ®Šæƒ…å†µï¼š</p><ul><li><strong>æ ‡è®°å’Œè§£æ</strong></li><li><strong>è¯­éŸ³è¯†åˆ«</strong></li><li><strong>æ–‡æœ¬åˆ°è¯­éŸ³</strong></li><li><strong>æœºå™¨ç¿»è¯‘</strong></li></ul><h2 id="æ— ç›‘ç£å­¦ä¹ "><a href="#æ— ç›‘ç£å­¦ä¹ " class="headerlink" title="æ— ç›‘ç£å­¦ä¹ "></a>æ— ç›‘ç£å­¦ä¹ </h2><p> æ¯”å¦‚ï¼Œä½ çš„è€æ¿å¯èƒ½ä¼šç»™ä½ ä¸€å¤§å †æ•°æ®ï¼Œç„¶åè®©ä½ ç”¨å®ƒåšä¸€äº›æ•°æ®ç§‘å­¦ç ”ç©¶ï¼Œå´æ²¡æœ‰å¯¹ç»“æœæœ‰è¦æ±‚ã€‚ æˆ‘ä»¬ç§°è¿™ç±»æ•°æ®ä¸­ä¸å«æœ‰â€œç›®æ ‡â€çš„æœºå™¨å­¦ä¹ é—®é¢˜ä¸º<strong>æ— ç›‘ç£å­¦ä¹ </strong>ï¼ˆunsupervised learningï¼‰</p><p>ä»¥ä¸‹åˆ—ä¸¾äº†é›†ä¸­æ— ç›‘ç£å­¦ä¹ ï¼š</p><ul><li><strong>èšç±»</strong>ï¼ˆclusteringï¼‰é—®é¢˜ï¼šæ²¡æœ‰æ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½ç»™æ•°æ®åˆ†ç±»</li><li><strong>ä¸»æˆåˆ†åˆ†æ</strong>ï¼ˆprincipal component analysisï¼‰é—®é¢˜ï¼šæˆ‘ä»¬èƒ½å¦æ‰¾åˆ°å°‘é‡çš„å‚æ•°æ¥å‡†ç¡®åœ°æ•æ‰æ•°æ®çš„çº¿æ€§ç›¸å…³å±æ€§ï¼Ÿæ¯”å¦‚ï¼Œä¸€ä¸ªçƒçš„è¿åŠ¨è½¨è¿¹å¯ä»¥ç”¨çƒçš„é€Ÿåº¦ã€ç›´å¾„å’Œè´¨é‡æ¥æè¿°ã€‚</li><li><strong>å› æœå…³ç³»</strong>ï¼ˆcausalityï¼‰å’Œæ¦‚ç‡å›¾æ¨¡å‹ï¼ˆprobabilistic graphical modelsï¼‰é—®é¢˜ï¼šæˆ‘ä»¬èƒ½å¦æè¿°è§‚å¯Ÿåˆ°çš„è®¸å¤šæ•°æ®çš„æ ¹æœ¬åŸå› ï¼Ÿ</li><li><strong>ç”Ÿæˆå¯¹æŠ—æ€§ç½‘ç»œ</strong>ï¼ˆgenerative adversarial networksï¼‰ï¼šä¸ºæˆ‘ä»¬æä¾›ä¸€ç§åˆæˆæ•°æ®çš„æ–¹æ³•ï¼Œç”šè‡³åƒå›¾åƒå’ŒéŸ³é¢‘è¿™æ ·å¤æ‚çš„ç»“æ„åŒ–æ•°æ®ã€‚</li></ul><h3 id="ä¸ç¯å¢ƒäº’åŠ¨"><a href="#ä¸ç¯å¢ƒäº’åŠ¨" class="headerlink" title="ä¸ç¯å¢ƒäº’åŠ¨"></a>ä¸ç¯å¢ƒäº’åŠ¨</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸ç®¡æ˜¯ç›‘ç£å­¦ä¹ è¿˜æ˜¯æ— ç›‘ç£å­¦ä¹ ï¼Œæˆ‘ä»¬éƒ½ä¼šé¢„å…ˆè·å–å¤§é‡æ•°æ®ï¼Œç„¶åå¯åŠ¨æ¨¡å‹ï¼Œä¸å†ä¸ç¯å¢ƒäº¤äº’ã€‚ è¿™é‡Œæ‰€æœ‰å­¦ä¹ éƒ½æ˜¯åœ¨ç®—æ³•ä¸ç¯å¢ƒæ–­å¼€åè¿›è¡Œçš„ï¼Œè¢«ç§°ä¸º<strong>ç¦»çº¿å­¦ä¹ </strong>ï¼ˆoffline learningï¼‰ã€‚</p><p>è¿™ç§ç®€å•çš„ç¦»çº¿å­¦ä¹ æœ‰å®ƒçš„é­…åŠ›ã€‚ å¥½çš„ä¸€é¢æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å­¤ç«‹åœ°è¿›è¡Œæ¨¡å¼è¯†åˆ«ï¼Œè€Œä¸å¿…åˆ†å¿ƒäºå…¶ä»–é—®é¢˜ã€‚ ä½†ç¼ºç‚¹æ˜¯ï¼Œè§£å†³çš„é—®é¢˜ç›¸å½“æœ‰é™ã€‚ ä¸é¢„æµ‹ä¸åŒï¼Œâ€œä¸çœŸå®ç¯å¢ƒäº’åŠ¨â€å®é™…ä¸Šä¼šå½±å“ç¯å¢ƒã€‚ è¿™é‡Œçš„äººå·¥æ™ºèƒ½æ˜¯â€œæ™ºèƒ½ä»£ç†â€ï¼Œè€Œä¸ä»…æ˜¯â€œé¢„æµ‹æ¨¡å‹â€ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘åˆ°å®ƒçš„è¡Œä¸ºå¯èƒ½ä¼šå½±å“æœªæ¥çš„è§‚å¯Ÿç»“æœã€‚</p><p>è€ƒè™‘â€œä¸çœŸå®ç¯å¢ƒäº’åŠ¨â€å°†æ‰“å¼€ä¸€æ•´å¥—æ–°çš„å»ºæ¨¡é—®é¢˜ã€‚ä»¥ä¸‹åªæ˜¯å‡ ä¸ªä¾‹å­ï¼š</p><ul><li>ç¯å¢ƒè¿˜è®°å¾—æˆ‘ä»¬ä»¥å‰åšè¿‡ä»€ä¹ˆå—ï¼Ÿ</li><li>ç¯å¢ƒæ˜¯å¦æœ‰åŠ©äºæˆ‘ä»¬å»ºæ¨¡ï¼Ÿä¾‹å¦‚ï¼Œç”¨æˆ·å°†æ–‡æœ¬è¯»å…¥è¯­éŸ³è¯†åˆ«å™¨ã€‚</li><li>ç¯å¢ƒæ˜¯å¦æƒ³è¦æ‰“è´¥æ¨¡å‹ï¼Ÿä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹æŠ—æ€§çš„è®¾ç½®ï¼Œå¦‚åƒåœ¾é‚®ä»¶è¿‡æ»¤æˆ–ç©æ¸¸æˆï¼Ÿ</li><li>ç¯å¢ƒæ˜¯å¦é‡è¦ï¼Ÿ</li><li>ç¯å¢ƒæ˜¯å¦å˜åŒ–ï¼Ÿä¾‹å¦‚ï¼Œæœªæ¥çš„æ•°æ®æ˜¯å¦æ€»æ˜¯ä¸è¿‡å»ç›¸ä¼¼ï¼Œè¿˜æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿæ˜¯è‡ªç„¶å˜åŒ–è¿˜æ˜¯å“åº”æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–å·¥å…·è€Œå‘ç”Ÿå˜åŒ–ï¼Ÿ</li></ul><p>å½“è®­ç»ƒå’Œæµ‹è¯•æ•°æ®ä¸åŒæ—¶ï¼Œæœ€åä¸€ä¸ªé—®é¢˜æå‡ºäº†<strong>åˆ†å¸ƒåç§»</strong>ï¼ˆdistribution shiftï¼‰çš„é—®é¢˜ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç®€è¦æè¿°å¼ºåŒ–å­¦ä¹ é—®é¢˜ï¼Œè¿™æ˜¯ä¸€ç±»æ˜ç¡®è€ƒè™‘ä¸ç¯å¢ƒäº¤äº’çš„é—®é¢˜ã€‚</p><h3 id="å¼ºåŒ–å­¦ä¹ "><a href="#å¼ºåŒ–å­¦ä¹ " class="headerlink" title="å¼ºåŒ–å­¦ä¹ "></a>å¼ºåŒ–å­¦ä¹ </h3><p><em>ä¸æ˜¯å¤ªæ‡‚</em></p><p>åœ¨å¼ºåŒ–å­¦ä¹ é—®é¢˜ä¸­ï¼Œagentåœ¨ä¸€ç³»åˆ—çš„æ—¶é—´æ­¥éª¤ä¸Šä¸ç¯å¢ƒäº¤äº’ã€‚ åœ¨æ¯ä¸ªç‰¹å®šæ—¶é—´ç‚¹ï¼Œagentä»ç¯å¢ƒæ¥æ”¶ä¸€äº›è§‚å¯Ÿï¼ˆobservationï¼‰ï¼Œå¹¶ä¸”å¿…é¡»é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œï¼ˆactionï¼‰ï¼Œç„¶åé€šè¿‡æŸç§æœºåˆ¶ï¼ˆæœ‰æ—¶ç§°ä¸ºæ‰§è¡Œå™¨ï¼‰å°†å…¶ä¼ è¾“å›ç¯å¢ƒï¼Œæœ€åagentä»ç¯å¢ƒä¸­è·å¾—å¥–åŠ±ï¼ˆrewardï¼‰ã€‚ æ­¤åæ–°ä¸€è½®å¾ªç¯å¼€å§‹ï¼Œagentæ¥æ”¶åç»­è§‚å¯Ÿï¼Œå¹¶é€‰æ‹©åç»­æ“ä½œï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p><img src="rl-environment.png" alt="å¼ºåŒ–å­¦ä¹ "></p><p>å¼ºåŒ–å­¦ä¹ æ¡†æ¶çš„é€šç”¨æ€§ååˆ†å¼ºå¤§ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»ä½•ç›‘ç£å­¦ä¹ é—®é¢˜è½¬åŒ–ä¸ºå¼ºåŒ–å­¦ä¹ é—®é¢˜ã€‚</p><p>å½“ç„¶ï¼Œå¼ºåŒ–å­¦ä¹ è¿˜å¯ä»¥è§£å†³è®¸å¤šç›‘ç£å­¦ä¹ æ— æ³•è§£å†³çš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œåœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯å¸Œæœ›<strong>è¾“å…¥ä¸æ­£ç¡®çš„æ ‡ç­¾ç›¸å…³è”</strong>ã€‚ ä½†åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬<strong>å¹¶ä¸å‡è®¾ç¯å¢ƒå‘Šè¯‰agentæ¯ä¸ªè§‚æµ‹çš„æœ€ä¼˜åŠ¨ä½œ</strong>ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œagentåªæ˜¯å¾—åˆ°ä¸€äº›å¥–åŠ±ã€‚ æ­¤å¤–ï¼Œç¯å¢ƒç”šè‡³å¯èƒ½ä¸ä¼šå‘Šè¯‰æˆ‘ä»¬æ˜¯å“ªäº›è¡Œä¸ºå¯¼è‡´äº†å¥–åŠ±ã€‚</p><p>å¼ºåŒ–å­¦ä¹ å¯èƒ½è¿˜å¿…é¡»å¤„ç†éƒ¨åˆ†å¯è§‚æµ‹æ€§é—®é¢˜ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çš„è§‚å¯Ÿç»“æœå¯èƒ½æ— æ³•é˜è¿°æœ‰å…³å½“å‰çŠ¶æ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæ¸…æ´æœºå™¨äººå‘ç°è‡ªå·±è¢«å›°åœ¨ä¸€ä¸ªè®¸å¤šç›¸åŒçš„å£æ©±çš„æˆ¿å­é‡Œã€‚ æ¨æ–­æœºå™¨äººçš„ç²¾ç¡®ä½ç½®ï¼ˆä»è€Œæ¨æ–­å…¶çŠ¶æ€ï¼‰ï¼Œéœ€è¦åœ¨è¿›å…¥å£æ©±ä¹‹å‰è€ƒè™‘å®ƒä¹‹å‰çš„è§‚å¯Ÿç»“æœã€‚</p><p>æœ€åï¼Œåœ¨ä»»ä½•æ—¶é—´ç‚¹ä¸Šï¼Œå¼ºåŒ–å­¦ä¹ agentå¯èƒ½çŸ¥é“ä¸€ä¸ªå¥½çš„ç­–ç•¥ï¼Œä½†å¯èƒ½æœ‰è®¸å¤šæ›´å¥½çš„ç­–ç•¥ä»æœªå°è¯•è¿‡çš„ã€‚ å¼ºåŒ–å­¦ä¹ agentå¿…é¡»ä¸æ–­åœ°åšå‡ºé€‰æ‹©ï¼šæ˜¯åº”è¯¥åˆ©ç”¨å½“å‰æœ€å¥½çš„ç­–ç•¥ï¼Œè¿˜æ˜¯æ¢ç´¢æ–°çš„ç­–ç•¥ç©ºé—´ï¼ˆæ”¾å¼ƒä¸€äº›çŸ­æœŸå›æŠ¥æ¥æ¢å–çŸ¥è¯†ï¼‰ã€‚</p><p>ä¸€èˆ¬çš„å¼ºåŒ–å­¦ä¹ é—®é¢˜æ˜¯ä¸€ä¸ªéå¸¸æ™®éçš„é—®é¢˜ã€‚ agentçš„åŠ¨ä½œä¼šå½±å“åç»­çš„è§‚å¯Ÿï¼Œè€Œå¥–åŠ±åªä¸æ‰€é€‰çš„åŠ¨ä½œç›¸å¯¹åº”ã€‚ ç¯å¢ƒå¯ä»¥æ˜¯å®Œæ•´è§‚å¯Ÿåˆ°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯éƒ¨åˆ†è§‚å¯Ÿåˆ°çš„ï¼Œè§£é‡Šæ‰€æœ‰è¿™äº›å¤æ‚æ€§å¯èƒ½ä¼šå¯¹ç ”ç©¶äººå‘˜è¦æ±‚å¤ªé«˜ã€‚ æ­¤å¤–ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªå®é™…é—®é¢˜éƒ½è¡¨ç°å‡ºæ‰€æœ‰è¿™äº›å¤æ‚æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
          <category> åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºScrapyçš„ç½‘ç»œçˆ¬è™«æ¡ˆä¾‹</title>
      <link href="/2022/01/09/%E5%9F%BA%E4%BA%8EScrapy%E7%9A%84%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E6%A1%88%E4%BE%8B/"/>
      <url>/2022/01/09/%E5%9F%BA%E4%BA%8EScrapy%E7%9A%84%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E6%A1%88%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™æ˜¯åœ¨å…¬å¸å®ä¹ æ—¶ï¼Œé¢†å¯¼ç»™å‡ºçš„ä¸€ä¸ªæ•°æ®çˆ¬å–éœ€æ±‚ã€‚ï¼ˆæ‰€ä»¥æ¶‰åŠæ³•å¾‹é—®é¢˜è¯·æ‰¾å…¬å¸çš„éº»çƒ¦ï¼Œä¸è¦è”ç³»æˆ‘ğŸ˜‚ï¼‰</p><p>è™½ç„¶æˆ‘ä¹‹å‰ä¹Ÿå¹²è¿‡ç½‘ç»œçˆ¬è™«ï¼Œä½†éƒ½æ˜¯åœ¨æ¯”è¾ƒå®Œæ•´çš„æ¡†æ¶ä¸‹è¿›è¡Œå®ç°ï¼šä»¥å‰åªéœ€è¦å®ç°URLè§£æå’Œç½‘é¡µæºç æŠ½å–æ¥å£ï¼Œå…¶ä»–åƒç½‘ç»œçˆ¬è™«é…ç½®ï¼Œæ•°æ®å­˜å‚¨ï¼Œæ•°æ®æŠ½å–ï¼Œæ•°æ®å¯¼å‡ºï¼Œä»»åŠ¡å¯åŠ¨å’Œåœæ­¢ç­‰æ¨¡å—åªéœ€è¦é¼ æ ‡clickä¸€ä¸‹æˆ–è€…æ ¹æœ¬å°±æ˜¯â€œé»‘ç›’â€çš„ï¼Œä¸éœ€è¦æˆ‘æ“å¿ƒã€‚ã€‚</p><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘åŸºæœ¬æ˜¯ä»â€œ0â€å¼€å§‹ã€‚æ‰€ä»¥åœ¨å®Œæˆä»»åŠ¡çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šã€‚ï¼ˆå½“ç„¶ä¹Ÿè¿˜ä¸å¤Ÿå¤šï¼‰</p><p>ç”±äºçˆ¬å–çš„ç½‘ç«™æ˜¯ä¸€ä¸ªç»å…¸çš„â€œåˆ—è¡¨-è¯¦æƒ…â€ç»“æ„ï¼Œä¸”çˆ¬å–éš¾åº¦ä¸éš¾ï¼ˆç½‘ç«™æ²¡æœ‰è®¾ç½®åçˆ¬ï¼‰ï¼Œä½œä¸ºçˆ¬è™«åˆå­¦è€…å¾ˆåˆé€‚ï¼Œæ‰€ä»¥æˆ‘æŠŠè¯¥ä»»åŠ¡çš„å®ç°è¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿è‡ªå·±å­¦ä¹ ã€‚</p><p>æœ¬ç¯‡åšå®¢å°†è®°å½•æˆ‘åœ¨å®ç°è¯¥ä»»åŠ¡æ—¶ï¼Œå­¦åˆ°çš„çŸ¥è¯†ã€é‡åˆ°çš„å›°éš¾ã€å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é€šè¿‡é˜…è¯»æœ¬ç¯‡åšå®¢ä½ å°†è·å¾—</p><ul><li>ä½¿ç”¨Scrapyè¿›è¡Œç®€å•çš„ç½‘é¡µæ•°æ®çˆ¬å–</li><li>ä½¿ç”¨BeautifulSoupè§£æHTML</li><li>ä½¿ç”¨Pandasåšç®€å•çš„æ•°æ®è¯»å–ã€å»é‡ã€åˆ†ææ“ä½œ</li></ul><p>ä¸èƒ½è·å¾—ï¼š</p><ul><li>Scrapyé«˜çº§ä½¿ç”¨ã€æ¡†æ¶ç»“æ„ã€åº•å±‚åŸç†</li><li>ç ´è§£æ•°æ®é‡‡é›†æ—¶é‡åˆ°çš„åçˆ¬</li></ul><p>åºŸè¯æ¯”è¾ƒå¤šã€‚å…ˆæ¥çœ‹ä¸€ä¸‹é˜…è¯»æœ¬æ–‡éœ€è¦çš„å‰ç½®çŸ¥è¯†ã€‚</p><h1 id="é˜…è¯»æœ¬æ–‡éœ€è¦çš„å‰ç½®çŸ¥è¯†"><a href="#é˜…è¯»æœ¬æ–‡éœ€è¦çš„å‰ç½®çŸ¥è¯†" class="headerlink" title="é˜…è¯»æœ¬æ–‡éœ€è¦çš„å‰ç½®çŸ¥è¯†"></a>é˜…è¯»æœ¬æ–‡éœ€è¦çš„å‰ç½®çŸ¥è¯†</h1><p>é˜…è¯»æœ¬ç¯‡åšå®¢éœ€è¦ä¸€å®šçš„å‰ç½®çŸ¥è¯†ã€‚æˆ‘å°†åˆ—ä¸¾ä¸€äº›ï¼Œå¯èƒ½ä¸å…¨ã€‚</p><ul><li>ç½‘ç»œçˆ¬è™«ï¼šä»€ä¹ˆæ˜¯ç½‘ç»œçˆ¬è™«</li><li>//Condaï¼šä»€ä¹ˆæ˜¯Condaï¼ŒCondaå®‰è£…ã€ç¯å¢ƒåˆ›å»ºç­‰</li><li>Python åŸºç¡€ï¼šåŸºç¡€æ•°æ®ç»“æ„åŠæ“ä½œã€æ–‡ä»¶I/Oæ“ä½œ</li><li>PyCharmä½¿ç”¨ï¼šå¦‚ä½•é…ç½®å¼€å‘ç¯å¢ƒï¼Œè¿æ¥è¿œç¨‹ç¯å¢ƒè¿›è¡Œå¼€å‘ç­‰</li><li>//Linux æœåŠ¡å™¨åŸºæœ¬å‘½ä»¤</li><li>HTMLåŸºç¡€ã€CSSé€‰æ‹©å™¨ç­‰å‰ç«¯åŸºç¡€çŸ¥è¯†ã€‚</li><li>XPathæ•°æ®å®šä½ã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç­‰çŸ¥è¯†ã€‚</li></ul><p>å¦‚æœä½ æœ‰ä»¥ä¸ŠåŸºç¡€ï¼Œé‚£ä¹ˆé˜…è¯»æœ¬ç¯‡åšå®¢åŸºæœ¬æ²¡æœ‰éšœç¢ã€‚</p><p>ä¸‹é¢ä»‹ç»æˆ‘çš„å·¥ä½œç¯å¢ƒã€‚</p><h1 id="å·¥ä½œç¯å¢ƒ"><a href="#å·¥ä½œç¯å¢ƒ" class="headerlink" title="å·¥ä½œç¯å¢ƒ"></a>å·¥ä½œç¯å¢ƒ</h1><div class="table-container"><table><thead><tr><th>è½¯ä»¶åç§°</th><th>å¤‡æ³¨</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>Windows</td><td>æ“ä½œç³»ç»Ÿ</td><td>10</td></tr><tr><td>PyCharm</td><td>å¼€å‘IDE</td><td>2019.3.5</td></tr><tr><td>Ananconda</td><td>Pythonç¯å¢ƒç®¡ç†å’ŒåŒ…ç®¡ç†å·¥å…·</td><td>æ‡’å¾—å†™äº†</td></tr><tr><td>Scrapy</td><td>Pythonå¼€æºæ¨¡å—ï¼Œçˆ¬è™«æ¡†æ¶</td><td>æ‡’å¾—å†™äº†</td></tr><tr><td>BeautifulSoup</td><td>Pythonå¼€æºæ¨¡å—ï¼Œè§£æHTML</td><td>æ‡’å¾—å†™äº†</td></tr><tr><td>Pandas</td><td>Pythonå¼€æºæ¨¡å—ï¼Œè¿™é‡Œç”¨å®ƒåšç®€å•çš„æ•°æ®æå–</td><td>æ‡’å¾—å†™äº†</td></tr></tbody></table></div><p>ä¸‹é¢ä»‹ç»å…·ä½“éœ€æ±‚ã€‚</p><h1 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h1><p>çˆ¬å–ç½‘ç«™ <a href="https://www.yunyubaike.com/">å­•è‚²ç™¾ç§‘</a> å„åˆ†ç±»ä¸‹çš„å­•è‚²é—®ç­”ã€‚ç»“æœä»¥CSVæ ¼å¼ç»™å‡ºã€‚</p><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p>æ‰“å¼€ <a href="https://www.yunyubaike.com/">å­•è‚²ç™¾ç§‘</a> å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šå­•è‚²ç™¾ç§‘çš„åˆ†ç±»ï¼Œé€‰æ‹©ä¸€ä¸ªåˆ†ç±»ï¼Œæ¯”å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ã€å‡†å¤‡æ€€å­•ã€‘ã€‚</p><p><img src="image-20220107161453957.png" alt="åˆ†ç±»"></p><p>æ–°æ‰“å¼€çš„ç½‘é¡µä¸º<a href="https://www.yunyubaike.com/beiyun/">https://www.yunyubaike.com/beiyun/</a></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸€äº›å­åˆ†ç±»ï¼š</p><p><img src="image-20220107162138428.png" alt="åˆ†ç±»å’Œå­åˆ†ç±»"></p><p>è¿™äº›åˆ†ç±»å’Œå­åˆ†ç±»ä¸‹æœ‰å¾ˆå¤šå­•è‚²ç™¾ç§‘é—®ç­”ï¼Œæˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªé—®é¢˜çš„è¶…é“¾æ¥ï¼Œåœ¨å¼¹å‡ºçš„è¯¦æƒ…é¡µä¸­ç»™å‡ºé—®é¢˜çš„ç­”æ¡ˆï¼Œå¦‚å›¾ï¼š</p><p><img src="image-20220107162808046.png" alt="å­•è‚²ç™¾ç§‘-è¯¦æƒ…é¡µ"></p><p>æŠŠè¿™äº›é—®é¢˜å’Œç­”æ¡ˆâ€œæŠ½å–â€åˆ°åˆ°CSVæ–‡ä»¶ä¸­ï¼Œä½œä¸ºæœ€ç»ˆç»“æœã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ†æè¯¥ç½‘ç«™ï¼Œä¾‹å¦‚ç½‘ç«™æ•°æ®é‡å¤§å°ï¼Œç½‘ç«™ç½‘é¡µç»“æ„ï¼Œç½‘ç«™è·³è½¬æ–¹å¼ï¼Œæ•°æ®ä¼ è¾“æ–¹å¼ï¼Œæ•°æ®æ˜¯å¦åŠ å¯†ï¼Œç½‘ç«™åçˆ¬ä¸¥ä¸ä¸¥é‡ç­‰ç­‰ã€‚</p><p>å¯ä»¥æŠ“åŒ…ã€å†™ç½‘é¡µä¸‹è½½ä»£ç æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>æ®æ­¤æŒ‡å®šç½‘ç«™é‡‡é›†ç­–ç•¥ï¼Œæ˜¯ä½¿ç”¨æœ¬åœ°IPå°±å¯ä»¥é‡‡é›†è¿˜æ˜¯éœ€è¦è®¾ç½®ä¸€æ‰¹ä»£ç†IPï¼Œæ•°æ®æ–‡ä»¶æ˜¯å­˜æ”¾åˆ°æœ¬åœ°è¿˜æ˜¯éœ€è¦å­˜æ”¾åˆ°Hadoopï¼Œæ˜¯å¦éœ€è¦å¯è§†åŒ–ï¼ˆSeleniumï¼‰é‡‡é›†ç­‰ç­‰ã€‚</p><h2 id="é‡‡é›†ç­–ç•¥"><a href="#é‡‡é›†ç­–ç•¥" class="headerlink" title="é‡‡é›†ç­–ç•¥"></a>é‡‡é›†ç­–ç•¥</h2><ol><li>å…ˆé‡‡é›†åˆ†ç±»ï¼ˆé¦–é¡µï¼‰URLï¼›</li><li>æ ¹æ®åˆ†ç±»ï¼ˆé¦–é¡µï¼‰URLä¸æ–­å¾ªç¯ç”Ÿæˆåˆ†é¡µï¼ˆåˆ—è¡¨é¡µï¼‰ï¼›</li><li>çˆ¬å–æ¯ä¸ªåˆ—è¡¨é¡µä¸­çš„è¯¦æƒ…URLï¼›</li><li>ä¸‹è½½è¯¦æƒ…URLçš„HTMLæ–‡ä»¶ï¼Œä¿å­˜åˆ°æœ¬åœ°ï¼›</li><li>è§£ææœ¬åœ°HTMLï¼Œç”ŸæˆCSVæ–‡ä»¶ã€‚</li></ol><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="é‡‡é›†åˆ†ç±»"><a href="#é‡‡é›†åˆ†ç±»" class="headerlink" title="é‡‡é›†åˆ†ç±»"></a>é‡‡é›†åˆ†ç±»</h2><p>ä»”ç»†åˆ†æç½‘ç«™å¯ä»¥å‘ç°ï¼Œåœ¨é‡‡é›†åˆ†ç±»å­˜åœ¨ä¸¤ä¸ªå‘ã€‚</p><ul><li>ä¸æ˜¯æ‰€æœ‰åˆ†ç±»éƒ½æ˜¯å­•è‚²ç™¾ç§‘ï¼šå¯¹äºä¸æ˜¯åˆ†ç±»çš„URLå¯ä»¥ç›´æ¥ä¸¢å¼ƒã€‚</li><li>å­åˆ†ç±»ä¸‹å’Œåˆ†ç±»å­˜åœ¨é‡å¤ï¼šå»é‡ã€‚</li></ul><p>ç”±äºå­åˆ†ç±»å’Œåˆ†ç±»ä¸æ˜¯å¾ˆå¤šï¼Œè¿™é‡Œä½¿ç”¨çš„æ‰‹å·¥é‡‡é›†ã€‚</p><p>è™½è¯´æ‰‹å·¥é‡‡é›†ï¼Œä½†è¿˜æ˜¯éœ€è¦ä¸€ç‚¹å°å°çš„æŠ€å·§ã€‚è¿™é‡Œä¸æ˜¯æŒ¨ä¸ªå¤åˆ¶ç½‘é¡µæºç ä¸­çš„åˆ†ç±»è¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡Chromeçš„ä¸€ä¸ªæ’ä»¶<a href="https://chrome.google.com/webstore/detail/xpath-helper/hgimnogjllphhhkhlmebbmlgjoejdpjl?utm_source=chrome-ntp-icon">XPath Helper</a>ã€‚</p><p>è¯¥æ’ä»¶æ”¯æŒé€šè¿‡å†™XPathçš„æ–¹å¼æ‰¹é‡è·å¾—ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬è¦è·å–ä¸Šå›¾ã€åˆ†ç±»å’Œå­åˆ†ç±»ã€‘ä¸­çš„å­åˆ†ç±»ã€‚å…ˆæŸ¥çœ‹è¿™éƒ¨åˆ†çš„ç½‘é¡µæºç </p><p><img src="image-20220107165203546.png" alt="å­åˆ†ç±»ç½‘é¡µæºç "></p><p>æ‰“å¼€XPath Helperï¼Œå†™å…¥XPathè·å¾—ç»“æœã€‚</p><p><img src="image-20220107165324295.png" alt="XPath Helperæˆªå›¾"></p><p>æœ€ç»ˆè·å¾—å¤§å°åˆ†ç±»å…±72ä¸ªã€‚</p><h2 id="åˆ—è¡¨é¡µç¿»é¡µé‡‡é›†è¯¦æƒ…é¡µURL"><a href="#åˆ—è¡¨é¡µç¿»é¡µé‡‡é›†è¯¦æƒ…é¡µURL" class="headerlink" title="åˆ—è¡¨é¡µç¿»é¡µé‡‡é›†è¯¦æƒ…é¡µURL"></a>åˆ—è¡¨é¡µç¿»é¡µé‡‡é›†è¯¦æƒ…é¡µURL</h2><p>æ¯ä¸ªåˆ†ç±»ä¸‹æœ‰å¾ˆå¤šç¿»é¡µï¼Œé€šè¿‡ä¸æ–­çš„ç¿»é¡µé‡‡é›†æ‰€æœ‰çš„è¯¦æƒ…URLã€‚</p><p><img src="image-20220107165646544.png" alt="ç¿»é¡µ"></p><p>è¿™é‡Œæˆ‘ä¸€å¼€å§‹å·æ‡’ï¼Œç”¨çš„â€œå…«çˆªé±¼é‡‡é›†å™¨â€ã€‚åæ¥å‘ç°è¿™è½¯ä»¶è™½ç„¶ä¸éœ€è¦å†™ä»£ç ï¼Œä½†æ˜¯å¯¹äºå¤§äº1Wçš„æ•°æ®éœ€è¦æ”¶è´¹ï¼Œå°±æ”¾å¼ƒäº†ã€‚</p><p>åç»­æˆ‘åŸºäºScrapyçˆ¬è™«æ¡†æ¶å®Œæˆé‡‡é›†ã€‚</p><h3 id="æ–°å»ºScrapyé¡¹ç›®"><a href="#æ–°å»ºScrapyé¡¹ç›®" class="headerlink" title="æ–°å»ºScrapyé¡¹ç›®"></a>æ–°å»ºScrapyé¡¹ç›®</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªScrapyé¡¹ç›®ï¼ˆå‰ææ˜¯å·²ç»å®‰è£…äº†Scrapyï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy startproject yybkSpider</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ yybkSpiderä¸ºé¡¹ç›®åç§°ï¼Œå¯ä»¥çœ‹åˆ°å°†ä¼šåˆ›å»ºä¸€ä¸ªyybkSpideræ–‡ä»¶å¤¹ï¼Œç›®å½•ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><p>ä¸‹é¢æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å„ä¸ªä¸»è¦æ–‡ä»¶çš„ä½œç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yybkSpider/</span><br><span class="line">    scrapy.cfg</span><br><span class="line">    yybkSpider/</span><br><span class="line">        __init__.py</span><br><span class="line">        items.py</span><br><span class="line">        pipelines.py</span><br><span class="line">        settings.py</span><br><span class="line">        spiders/</span><br><span class="line">            __init__.py</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»‹ç»æˆ‘è®¤ä¸ºæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼š</p><ul><li>settings.py: é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤ä¸‹è½½çš„ç½‘é¡µæ˜¯Unicodeï¼Œéœ€è¦åœ¨è¿™é‡Œé…ç½®ä¸ºUTF-8ç¼–ç ã€‚</li><li>yybkSpider/: é¡¹ç›®çš„Pythonæ¨¡å—ï¼Œå°†ä¼šä»è¿™é‡Œå¼•ç”¨ä»£ç ã€‚</li><li>yybkSpider/items.py: ä¿å­˜æ•°æ®çš„å®ä½“ï¼Œæœ‰ç‚¹åƒJava Beanã€‚</li><li>yybkSpider/yybkSpider/: å­˜å‚¨çˆ¬è™«ä»£ç ç›®å½•ã€‚</li></ul><h3 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h3><p>è¿™é‡Œé»˜è®¤ä¸‹è½½çš„ç½‘é¡µä¸ºUTF-8ï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>settings.py</code>ä¸­å¢åŠ é…ç½®<code>FEED_EXPORT_ENCODING = &#39;utf-8&#39;</code></p><p>è¿˜å¯ä»¥ä¿®æ”¹ä¸‹è½½çš„çº¿ç¨‹æ•°ã€‚ä½†æ˜¯æˆ‘æŸ¥é˜…äº†ç½‘ä¸Šçš„ç›¸å…³èµ„æ–™ï¼Œå¥½åƒä½œç”¨å¹¶ä¸å¤§ã€‚ç”±äºå¯¹Pythonå’ŒScrapyä¸æ˜¯å¾ˆäº†è§£ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºè¿æ¥ï¼š</p><ul><li><a href="https://www.zhihu.com/question/23474039">ä¸ºä»€ä¹ˆæœ‰äººè¯´ Python çš„å¤šçº¿ç¨‹æ˜¯é¸¡è‚‹å‘¢ï¼Ÿ</a></li><li><a href="https://www.zhihu.com/question/26062225">scrapyåœ¨çˆ¬ç½‘é¡µçš„æ—¶å€™æ˜¯è‡ªåŠ¨é‡‡ç”¨å¤šçº¿ç¨‹çš„å—ï¼Ÿ</a></li></ul><h3 id="åˆ¶ä½œçˆ¬è™«"><a href="#åˆ¶ä½œçˆ¬è™«" class="headerlink" title="åˆ¶ä½œçˆ¬è™«"></a>åˆ¶ä½œçˆ¬è™«</h3><p>ç´§æ¥ç€ï¼Œåˆ¶ä½œä¸€ä¸ªçˆ¬è™«ï¼š</p><ul><li>Inputï¼šæ‰€æœ‰åˆ†ç±»é¦–é¡µ</li><li>Outputï¼š<ul><li>æ‰€æœ‰åˆ—è¡¨é¡µ</li><li>æ¯ä¸ªåˆ—è¡¨é¡µçš„è¯¦æƒ…URLå’Œå…¶ä»–ä¿¡æ¯ã€‚</li></ul></li></ul><p>è¿›å…¥<code>yybkSpider/</code>ç›®å½•ä¸‹ï¼Œè¾“å…¥å‘½ä»¤åˆ›å»ºçˆ¬è™«ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy genspider yybk_list &quot;yunyubaike.com&quot;</span><br></pre></td></tr></table></figure><ul><li><code>yybk_list</code>æ˜¯çˆ¬è™«çš„åç§°</li><li><code>&quot;yunyubaike.com&quot;</code>æŒ‡å‡ºè¯¥çˆ¬è™«çˆ¬å–çš„åŸŸåï¼Œè¶…å‡ºåŸŸåçš„ä¸ä¼šçˆ¬å–ã€‚</li></ul><p>ä¹‹åå¯ä»¥çœ‹åˆ°åœ¨<code>yybkSpider/yybkSpider/</code>ç”Ÿæˆäº†ä¸€ä¸ªæ–‡ä»¶<code>yybk_list.py</code>ï¼Œå®ƒé»˜è®¤å¢åŠ äº†ä¸‹åˆ—ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YybkListSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;yybk_list&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;yunyubaike.com&#x27;</span>]</span><br><span class="line">    start_urls = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>name = â€œâ€ ï¼šè¿™ä¸ªçˆ¬è™«çš„è¯†åˆ«åç§°ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œåœ¨ä¸åŒçš„çˆ¬è™«å¿…é¡»å®šä¹‰ä¸åŒçš„åå­—ã€‚</p><p>allow_domains = [] æ˜¯æœç´¢çš„åŸŸåèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯çˆ¬è™«çš„çº¦æŸåŒºåŸŸï¼Œè§„å®šçˆ¬è™«åªçˆ¬å–è¿™ä¸ªåŸŸåä¸‹çš„ç½‘é¡µï¼Œä¸å­˜åœ¨çš„URLä¼šè¢«å¿½ç•¥ã€‚</p><p>start_urls = [] ï¼šçˆ¬å–çš„URLåˆ—è¡¨ã€‚çˆ¬è™«ä»è¿™é‡Œå¼€å§‹æŠ“å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½çš„æ•°æ®å°†ä¼šä»è¿™äº›urlså¼€å§‹ã€‚å…¶ä»–å­URLå°†ä¼šä»è¿™äº›èµ·å§‹URLä¸­ç»§æ‰¿æ€§ç”Ÿæˆã€‚</p><p>parse(self, response) ï¼šè§£æçš„æ–¹æ³•ï¼Œæ¯ä¸ªåˆå§‹URLå®Œæˆä¸‹è½½åå°†è¢«è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥ä»æ¯ä¸€ä¸ªURLä¼ å›çš„Responseå¯¹è±¡æ¥ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li>è´Ÿè´£è§£æè¿”å›çš„ç½‘é¡µæ•°æ®(response.body)ï¼Œæå–ç»“æ„åŒ–æ•°æ®(ç”Ÿæˆitem)</li><li>ç”Ÿæˆéœ€è¦ä¸‹ä¸€é¡µçš„URLè¯·æ±‚ã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®Œæˆè¯¥çˆ¬è™«ã€‚é¦–å…ˆstart_urlsä¸æ˜¯ä¸€ä¸ªè€Œæ˜¯72ä¸ªåˆ†ç±»é¦–é¡µURLã€‚å†è€…æˆ‘ä»¬è¦åœ¨parseæ–¹æ³•ä¸­å®Œæˆä¸¤ä»¶äº‹ï¼š</p><ol><li>ä¸æ–­ç”Ÿæˆä¸‹ä¸€é¡µ</li><li>å¯¹äºæ¯ä¸ªåˆ—è¡¨é¡µè§£æå…¶ä¸­çš„æ•°æ®ã€‚</li></ol><p>ä¸‹é¢æ˜¯å®Œæ•´ä»£ç ï¼Œè¿™éƒ¨åˆ†å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.scrapy.org/en/latest/intro/overview.htmlã€‚">https://docs.scrapy.org/en/latest/intro/overview.htmlã€‚</a></p><p>è¿™é‡Œæœ‰å‡ ä¸ªåœ°æ–¹å€¼å¾—æ³¨æ„ï¼š</p><ol><li>é€šè¿‡<code>response.url</code>è·å¾—å½“å‰é‡‡é›†çš„URL</li><li><code>response.xpath(&#39;&#39;)</code>è¿”å›çš„æ˜¯ä¸€ç»„å…ƒç´ </li><li>æˆ‘æŠŠ<code>response.xpath(&#39;&#39;)[0].get()</code>éƒ½æ”¹å†™äº†ï¼ŒåŸå› æ˜¯å¦‚æœ<code>response.xpath(&#39;&#39;)</code>ä¸ºç©ºåœ¨æ‰§è¡Œ<code>[0]</code>æ“ä½œå°±ä¼šæŠ¥é”™ï¼Œå¯¼è‡´çˆ¬å–å¤±è´¥</li><li>ä½¿ç”¨<code>get()</code>è€Œä¸æ˜¯<code>exract()</code>ã€‚åŸå› å¦‚ä¸‹ï¼š </li></ol><blockquote><p>get() ã€getall() æ˜¯æ–°ç‰ˆæœ¬çš„æ–¹æ³•ï¼Œextract() ã€extract_first()æ˜¯æ—§ç‰ˆæœ¬çš„æ–¹æ³•ã€‚</p><p>å‰è€…æ›´å¥½ç”¨ï¼Œå–ä¸åˆ°å°±è¿”å›Noneï¼Œåè€…å–ä¸åˆ°å°±raiseä¸€ä¸ªé”™è¯¯ã€‚</p></blockquote><ol><li>æƒ³è¦åœ¨å½“å‰å…ƒç´ ä¸‹ç»§ç»­é€šè¿‡XPathé€‰å–å…ƒç´ ï¼Œéœ€è¦åœ¨XPathå¼€å¤´åŠ ä¸€ä¸ª<code>.</code></li><li>æ³¨æ„<code>yield</code>çš„ä½¿ç”¨</li><li>è¿™é‡Œé‡‡é›†äº†å¾ˆå¤šâ€œå¤šä½™â€çš„å­—æ®µï¼Œä¾‹å¦‚é¡µç ï¼Œæ€»æ•°ï¼Œå½“å‰urlã€‚è¿™æ˜¯ä¸ºäº†åç»­éªŒè¯é‡‡é›†çš„æ•°æ®æ˜¯å¦å®Œæ•´æ­£ç¡®è€Œå¢åŠ çš„å†—ä½™å­—æ®µã€‚</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YybkListSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;yybk_list&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;yunyubaike.com&#x27;</span>]</span><br><span class="line">    <span class="comment"># ä¸€å…±æ˜¯72ä¸ªURLï¼Œè¿™é‡Œæ²¡æœ‰åˆ—å…¨</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.yunyubaike.com/yunqi/&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;https://www.yunyubaike.com/yichuanyousheng/&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;https://www.yunyubaike.com/beiyun/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        domain_url = <span class="string">&quot;https://www.yunyubaike.com&quot;</span></span><br><span class="line">        <span class="comment"># items = []</span></span><br><span class="line">        this_url = response.url</span><br><span class="line">        page_nums = response.xpath(<span class="string">&quot;//div[@class=&#x27;pagebar&#x27;]/b/text()&quot;</span>)</span><br><span class="line">        page_num = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> page_nums:</span><br><span class="line">            page_num = page_nums[<span class="number">0</span>].get()</span><br><span class="line">        <span class="comment"># page_num = response.xpath(&quot;//div[@class=&#x27;pagebar&#x27;]/b/text()&quot;)[0].get()</span></span><br><span class="line">        counts = response.xpath(<span class="string">&quot;//div[@class=&#x27;pagebar&#x27;]/a[@title]/b/text()&quot;</span>)</span><br><span class="line">        count=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> counts:</span><br><span class="line">            count = counts[<span class="number">0</span>].get()</span><br><span class="line">        <span class="comment"># count = response.xpath(&quot;//div[@class=&#x27;pagebar&#x27;]/a[@title]/b/text()&quot;)[0].get()</span></span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> response.xpath(<span class="string">&quot;//div[@class=&#x27;list&#x27;]/ul/li&quot;</span>):</span><br><span class="line">            titles = li.xpath(<span class="string">&#x27;.//h2/a/text()&#x27;</span>)</span><br><span class="line">            title = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> titles:</span><br><span class="line">                title = titles[<span class="number">0</span>].get()</span><br><span class="line">            detail_urls = li.xpath(<span class="string">&#x27;.//h2/a/@href&#x27;</span>)</span><br><span class="line">            detail_url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> detail_urls:</span><br><span class="line">                detail_url = detail_urls[<span class="number">0</span>].get()</span><br><span class="line">            <span class="comment"># detail_url = li.xpath(&#x27;.//h2/a/@href&#x27;)[0].get()</span></span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">&#x27;this_url&#x27;</span>: this_url,  <span class="comment"># å½“å‰é‡‡é›†çš„URL</span></span><br><span class="line">                <span class="string">&#x27;page_num&#x27;</span>: page_num,  <span class="comment"># ç¬¬å‡ é¡µ</span></span><br><span class="line">                <span class="string">&#x27;count&#x27;</span>: count,  <span class="comment"># è¯¥åˆ†ç±»ä¸‹çš„é—®ç­”æ€»æ•°</span></span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: title,  <span class="comment"># é—®ç­”æ ‡é¢˜</span></span><br><span class="line">                <span class="string">&#x27;detail_url&#x27;</span>: domain_url + detail_url  <span class="comment"># è¯¦æƒ…URL</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸‹ä¸€é¡µ</span></span><br><span class="line">        next_pages = response.xpath(<span class="string">&quot;//a[text()=&#x27;ä¸‹ä¸€é¡µ&#x27;]/@href&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> next_pages:</span><br><span class="line">            next_page = next_pages[<span class="number">0</span>].get()</span><br><span class="line">            <span class="comment"># next_page = response.xpath(&quot;//a[text()=&#x27;ä¸‹ä¸€é¡µ&#x27;]/@href&quot;)[0].get()</span></span><br><span class="line">            <span class="keyword">if</span> next_page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">yield</span> response.follow(domain_url + next_page, self.parse)  <span class="comment"># å°†ä¸‹ä¸€é¡µçš„è¿æ¥ä¼ é€’ç»™çˆ¬è™«ç»§ç»­è§£æã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨çˆ¬è™«"><a href="#å¯åŠ¨çˆ¬è™«" class="headerlink" title="å¯åŠ¨çˆ¬è™«"></a>å¯åŠ¨çˆ¬è™«</h3><p>æœ€åå¯åŠ¨çˆ¬è™«ï¼Œä¿å­˜æ•°æ®ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy crawl yybk_list -o urls.json</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•å¤šå‡ºäº†urls.jsonæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æˆ‘ä»¬ä¿å­˜çš„æ‰€æœ‰åˆ—è¡¨æ•°æ®ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿å­˜ä¸ºå…¶ä»–æ ¼å¼ã€‚è¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†å¤§çº¦27Wçš„è¯¦æƒ…è¿æ¥ã€‚ä¸‹é¢æˆ‘ä»¬æŠŠè¿™äº›è¿æ¥å¯¹åº”çš„HTMLä¿å­˜åˆ°æœ¬åœ°ã€‚</p><h2 id="ä¸‹è½½è¯¦æƒ…ç½‘é¡µæºç "><a href="#ä¸‹è½½è¯¦æƒ…ç½‘é¡µæºç " class="headerlink" title="ä¸‹è½½è¯¦æƒ…ç½‘é¡µæºç "></a>ä¸‹è½½è¯¦æƒ…ç½‘é¡µæºç </h2><h3 id="åˆ¶ä½œçˆ¬è™«-1"><a href="#åˆ¶ä½œçˆ¬è™«-1" class="headerlink" title="åˆ¶ä½œçˆ¬è™«"></a>åˆ¶ä½œçˆ¬è™«</h3><p>è¿›å…¥<code>yybkSpider/</code>ç›®å½•ä¸‹ï¼Œè¾“å…¥å‘½ä»¤åˆ›å»ºçˆ¬è™«ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy genspider yybk_detail_down &quot;yunyubaike.com&quot;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢ç±»ä¼¼ï¼Œåœ¨<code>yybkSpider/yybkSpider/yybk_detail_down.py</code>å†™å…¥ä»£ç ï¼š</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼š</p><ol><li>start_urlsæ˜¯éœ€è¦ä»æ–‡ä»¶ä¸­è¯»å–çš„</li><li>ä¸ºäº†è¯»æ•°æ®ã€å–æ•°æ®æ–¹ä¾¿ï¼Œæˆ‘ä½¿ç”¨äº†pands</li><li>è·å¾—ç½‘é¡µæºç ï¼Œä½¿ç”¨<code>response.text</code></li><li>è¿™é‡Œæ²¡æœ‰å¯¹ç½‘é¡µæºç ç›´æ¥è§£æï¼Œè€Œæ˜¯å…ˆä¿å­˜ï¼Œå†åœ¨åç»­è§£æã€‚æé«˜å®¹é”™ã€‚</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YybkDetailDownSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;yybk_detail_down&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;yunyubaike.com&#x27;</span>]</span><br><span class="line">    df = pd.read_json(<span class="string">&quot;yybkSpider/urls.json&quot;</span>)</span><br><span class="line">    <span class="comment"># 273179æ¡æ•°æ®</span></span><br><span class="line">    <span class="comment"># å–detail_urlåˆ—ï¼Œå»é‡ï¼Œè½¬æ¢æˆlist</span></span><br><span class="line">    start_urls = df[<span class="string">&#x27;detail_url&#x27;</span>].drop_duplicates().tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        url = response.url</span><br><span class="line">        <span class="comment"># è·å¾—ç½‘é¡µæºç </span></span><br><span class="line">        content = response.text</span><br><span class="line"></span><br><span class="line">        file_name = url.replace(<span class="string">&quot;https://www.yunyubaike.com/&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        file_name = <span class="string">&#x27;html/&#x27;</span> + file_name.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>)   <span class="comment"># html/huaiyun_wiki_270163.html</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ä¿å­˜æ–‡ä»¶ï¼š&quot;</span> + file_name)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œæˆ‘æ‹…å¿ƒdetail_urlæ ¼å¼æ˜¯å¦ä¸€è‡´ï¼Œæ‰€ä»¥åœ¨Python Shellä¸­æ‰§è¡Œäº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.read_json(<span class="string">&quot;yybkSpider/urls.json&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df[df[<span class="string">&#x27;detail_url&#x27;</span>].<span class="built_in">str</span>.match(<span class="string">r&#x27;https://www.yunyubaike.com/\w+/\d+\.html&#x27;</span>) == <span class="literal">False</span>]</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸ºç©ºï¼Œè¿™è¯æ˜detail_urlæ ¼å¼ä¸€è‡´ã€‚</p><h3 id="å¯åŠ¨çˆ¬è™«-1"><a href="#å¯åŠ¨çˆ¬è™«-1" class="headerlink" title="å¯åŠ¨çˆ¬è™«"></a>å¯åŠ¨çˆ¬è™«</h3><p>ç´§æ¥ç€å¯åŠ¨çˆ¬è™«ï¼Œå’Œä¸Šé¢ç±»ä¼¼ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy crawl yybk_detail_down</span><br></pre></td></tr></table></figure><p>ç”±äºè¿™é‡Œä¸éœ€è¦ç”Ÿæˆæ–‡ä»¶ï¼Œæ‰€ä»¥æ²¡æœ‰<code>-o</code></p><p>ç­‰å¾…ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œå¯ä»¥å‘ç°åœ¨é¡¹ç›®æ ¹ç›®å½•äº§ç”Ÿäº†ä¸€ä¸ª<code>html/</code>æ–‡ä»¶å¤¹ï¼Œä¸‹é¢ä¿å­˜äº†æ‰€æœ‰è¯¦æƒ…é¡µçš„ç½‘é¡µæºç ã€‚</p><h2 id="è§£æè¯¦æƒ…é¡µ"><a href="#è§£æè¯¦æƒ…é¡µ" class="headerlink" title="è§£æè¯¦æƒ…é¡µ"></a>è§£æè¯¦æƒ…é¡µ</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ‰“å¼€ä¸€ä¸ªè¯¦æƒ…é¡µï¼š</p><p><img src="image-20220109124722467.png" alt="è¯¦æƒ…é¡µ"></p><p>å¯ä»¥å®šä½åˆ°ï¼šåœ¨<code>&lt;div class=&#39;article_content&#39; /&gt;</code>æ ‡ç­¾ä¸‹ï¼Œæ‰€æœ‰çš„å¸¦æ–‡å­—çš„pæ ‡ç­¾æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚æ¯ä¸ªpæ ‡ç­¾æ˜¯ä¸€ä¸ªæ®µè½ï¼Œåœ¨ä¿å­˜çš„æ—¶å€™ï¼Œæ®µè½ä¿¡æ¯æ˜¯ä¸èƒ½ä¸¢å¤±çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ¢è¡Œç¬¦æ˜¯éœ€è¦çš„ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>è¿™ä¸€æ­¥æ˜¯è„±ç¦»äºScrapyæ¡†æ¶çš„ã€‚</p><p>è‡ªå®šä¹‰ä¸€ä¸ªPythonè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">input_dir = <span class="string">&#x27;html/&#x27;</span>  <span class="comment"># ä¸Šä¸€æ­¥ä¿å­˜æºç çš„æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class="line">output_file_base_name = <span class="string">&#x27;yybkSpider/output/yybk_&#123;&#125;.csv&#x27;</span>  <span class="comment"># ç”Ÿæˆçš„CSVæ–‡ä»¶çš„ä¿å­˜è·¯å¾„</span></span><br><span class="line">MAX_ROWS = <span class="number">50000</span>    <span class="comment"># å•ä¸ªcsvæ–‡ä»¶å†™å…¥çš„æœ€å¤§è¡Œæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è§£ææ–¹æ³•ï¼Œä¼ å…¥æ–‡ä»¶å</span></span><br><span class="line"><span class="string">è¿”å›éœ€è¦çš„å­—æ®µ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">file_name</span>):</span><br><span class="line">    soup = BeautifulSoup(<span class="built_in">open</span>(file_name, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="comment"># titleè§£æ</span></span><br><span class="line">    title = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    h1 = soup.find_all(<span class="string">&quot;h1&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> h1:</span><br><span class="line">        title = h1[<span class="number">0</span>].get_text()</span><br><span class="line">    <span class="comment"># contentè§£æ</span></span><br><span class="line">    p_list = soup.select(<span class="string">&quot;div.article_content &gt; p&quot;</span>)</span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> p_list:</span><br><span class="line">        p_text = p.get_text()</span><br><span class="line">        <span class="keyword">if</span> p_text != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="comment"># ä¸ºäº†é¿å…csvè§£æå¤±è´¥</span></span><br><span class="line">            p_text = p_text.replace(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;ï¼Œ&quot;</span>).replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            content += p_text + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    content = content.rstrip().lstrip()</span><br><span class="line">    <span class="keyword">return</span> title, content</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    htmls = os.listdir(input_dir)</span><br><span class="line">    <span class="comment"># è®¡ç®—æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶ä¸ªæ•°</span></span><br><span class="line">    file_num = (<span class="built_in">len</span>(htmls) + MAX_ROWS - <span class="number">1</span>) // MAX_ROWS</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(file_num):</span><br><span class="line">        <span class="comment"># iä»0å¼€å§‹</span></span><br><span class="line">        <span class="comment"># ç¬¬iä¸ªæ–‡ä»¶ä¿å­˜ i*MAX_ROWS[ä¸‹æ ‡] åˆ° (i+1)*MAX_ROWS - 1</span></span><br><span class="line">        start_index = i*MAX_ROWS</span><br><span class="line">        end_index = (i+<span class="number">1</span>)*MAX_ROWS - <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> end_index &gt; <span class="built_in">len</span>(htmls):</span><br><span class="line">            end_index = <span class="built_in">len</span>(htmls)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(output_file_base_name.<span class="built_in">format</span>(i), <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;parsing :start_index:&#123;&#125;, end_index:&#123;&#125;; saving as &#123;&#125;&quot;</span></span><br><span class="line">                  .<span class="built_in">format</span>(start_index, end_index, output_file_base_name.<span class="built_in">format</span>(i)))</span><br><span class="line">            f.write(<span class="string">&quot;article_id,content,title\n&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> html_name <span class="keyword">in</span> htmls[start_index: end_index]:</span><br><span class="line">                title, content = parse(os.path.join(input_dir, html_name))</span><br><span class="line">                f.write(html_name + <span class="string">&#x27;,&quot;&#x27;</span> + content + <span class="string">&#x27;&quot;,&#x27;</span> + title + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨<code>parse</code>æ–¹æ³•ä¸­éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><code>soup.select(&quot;div.article_content &gt; p&quot;)</code>è¿™é‡Œä½¿ç”¨äº†CSSé€‰æ‹©å™¨ï¼Œåˆ¶å®šäº†divä¸‹çš„ç›´æ¥å­æ ‡ç­¾ï¼›</li><li><code>p.get_text()</code>è·å¾—pæ ‡ç­¾ä¸‹çš„æ‰€æœ‰æ–‡å­—ï¼›</li><li>ä¸ºäº†é¿å…CSVè§£æå¤±è´¥ï¼Œè¿™é‡ŒæŠŠè‹±æ–‡é€—å·æ¢æˆä¸­æ–‡é€—å·ï¼ŒæŠŠè‹±æ–‡çš„å¼•å·å…¨éƒ¨å»æ‰ã€‚ï¼ˆCSVæ–‡ä»¶ç”¨è‹±æ–‡é€—å·åšå­—æ®µåˆ†å‰²ï¼›å½“æˆ‘ä»¬éœ€è¦æŠŠå¤šè¡Œæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªå­—æ®µä¸­æ—¶ï¼Œéœ€è¦æŠŠå¤šè¡Œæ•°æ®ç”¨è‹±æ–‡å¼•å·åŒ…èµ·æ¥ï¼‰ï¼›</li><li>ä½¿ç”¨BeautifulSoupè§£æHTMLã€‚</li></ol><p>åœ¨<code>main</code>æ–¹æ³•ä¸­éœ€è¦æ³¨æ„ï¼š</p><ol><li>27Wè¡Œä¿å­˜åˆ°ä¸€ä¸ªCSVæ–‡ä»¶ä¸­ï¼Œæˆ‘æ‹…å¿ƒä¸å¥½æŠŠæ§ï¼Œæ‰€ä»¥æˆ‘å°†27Wè¡Œæ•°æ®æ¯5Wè¡Œä¿å­˜ä¸ºä¸€ä¸ªCSV</li><li>å½“éœ€è¦å¯¹é™¤æ³•ç»“æœå››èˆäº”å…¥æ—¶ï¼Œè¿™æ ·åšæ¯”è¾ƒç®€å•ï¼š<code>(è¢«é™¤æ•°+é™¤æ•°-1)/é™¤æ•°</code></li></ol><h3 id="è¿è¡Œè„šæœ¬"><a href="#è¿è¡Œè„šæœ¬" class="headerlink" title="è¿è¡Œè„šæœ¬"></a>è¿è¡Œè„šæœ¬</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python xxx.py</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¯¼å‡º6ä¸ªCSVæ–‡ä»¶ã€‚ä»»åŠ¡å®Œæˆã€‚</p><h1 id="æºç ä¸‹è½½"><a href="#æºç ä¸‹è½½" class="headerlink" title="æºç ä¸‹è½½"></a>æºç ä¸‹è½½</h1><p><a href="https://github.com/guoyujian/blog-resource/tree/main/yybkSpider">https://github.com/guoyujian/blog-resource/tree/main/yybkSpider</a></p><h1 id="æ­¤å¤–â€¦"><a href="#æ­¤å¤–â€¦" class="headerlink" title="æ­¤å¤–â€¦"></a>æ­¤å¤–â€¦</h1><h2 id="Scrapy-Shellå¿«é€Ÿæµ‹è¯•"><a href="#Scrapy-Shellå¿«é€Ÿæµ‹è¯•" class="headerlink" title="Scrapy Shellå¿«é€Ÿæµ‹è¯•"></a>Scrapy Shellå¿«é€Ÿæµ‹è¯•</h2><p>åœ¨ä½¿ç”¨Scrapyçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒ³å…ˆä¼ å…¥ä¸€æ¡URLæµ‹è¯•è¿”å›çš„resonpseã€‚ç»è¿‡æŸ¥é˜…ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scrapy shell &lt;url&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œè¿›å…¥Python Consoleï¼Œå†…ç½®çš„responseå¯¹è±¡å³æ˜¯\<url\>çš„response</p><h2 id="åœ¨æœåŠ¡å™¨è¿è¡Œ"><a href="#åœ¨æœåŠ¡å™¨è¿è¡Œ" class="headerlink" title="åœ¨æœåŠ¡å™¨è¿è¡Œ"></a>åœ¨æœåŠ¡å™¨è¿è¡Œ</h2><p>å¦‚æœåœ¨æœ¬æœºæ‰§è¡Œçˆ¬è™«ä»£ç ï¼Œä¼šå ç”¨è¾ƒå¤šçš„èµ„æºï¼Œä¹Ÿä¸æ–¹ä¾¿ã€‚æ­¤æ—¶å¯ä»¥æŠŠçˆ¬è™«ä»£ç åŒæ­¥åˆ°æœåŠ¡å™¨è¿è¡Œã€‚æˆ‘ä½¿ç”¨PyChramè¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œåœ¨æœ¬æœºç¼–å†™çˆ¬è™«ä»£ç ï¼Œç„¶ååŒæ­¥åˆ°æœåŠ¡å™¨ä¸­æ‰§è¡Œã€‚ï¼ˆå…·ä½“è¯·è‡ªè¡Œç™¾åº¦ï¼‰</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://docs.scrapy.org/en/latest/intro/overview.html">Scrapy at a glance</a></li><li><a href="https://www.runoob.com/w3cnote/scrapy-detail.html">Scrapy å…¥é—¨æ•™ç¨‹</a></li><li><a href="https://www.runoob.com/cssref/css-selectors.html">CSSé€‰æ‹©å™¨</a></li><li><a href="https://scrapy-chs.readthedocs.io/zh_CN/1.0/topics/shell.html">Scrapy shell</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œçˆ¬è™« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œçˆ¬è™« </tag>
            
            <tag> Scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¦è§£HTTPåè®®</title>
      <link href="/2022/01/05/%E8%AF%A6%E8%A7%A3HTTP%E5%8D%8F%E8%AE%AE/"/>
      <url>/2022/01/05/%E8%AF%A6%E8%A7%A3HTTP%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h1><p><strong>è¶…æ–‡æœ¬ä¼ è¾“åè®®</strong>ï¼ˆHTTPï¼ŒHyperText Transfer Protocolï¼‰æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„WWWæ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚1960å¹´ç¾å›½äººTed Nelsonæ„æ€äº†ä¸€ç§é€šè¿‡è®¡ç®—æœºå¤„ç†æ–‡æœ¬ä¿¡æ¯çš„æ–¹æ³•ï¼Œå¹¶ç§°ä¹‹ä¸ºè¶…æ–‡æœ¬ï¼ˆhypertextï¼‰,è¿™æˆä¸ºäº†HTTPè¶…æ–‡æœ¬ä¼ è¾“åè®®æ ‡å‡†æ¶æ„çš„å‘å±•æ ¹åŸºã€‚Ted Nelsonç»„ç»‡åè°ƒä¸‡ç»´ç½‘åä¼šï¼ˆWorld Wide Web Consortiumï¼‰å’Œäº’è”ç½‘å·¥ç¨‹å·¥ä½œå°ç»„ï¼ˆInternet Engineering Task Force ï¼‰å…±åŒåˆä½œç ”ç©¶ï¼Œæœ€ç»ˆå‘å¸ƒäº†ä¸€ç³»åˆ—çš„RFCï¼Œå…¶ä¸­è‘—åçš„RFC 2616å®šä¹‰äº†HTTP 1.1ã€‚</p><h1 id="HTTPåè®®çš„ä½œç”¨åŠç‰¹ç‚¹"><a href="#HTTPåè®®çš„ä½œç”¨åŠç‰¹ç‚¹" class="headerlink" title="HTTPåè®®çš„ä½œç”¨åŠç‰¹ç‚¹"></a>HTTPåè®®çš„ä½œç”¨åŠç‰¹ç‚¹</h1><p>HTTPæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰ã€‚å®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ç”¨æˆ·ï¼ŒæœåŠ¡å™¨ç«¯æ˜¯ç½‘ç«™ã€‚</p><p>é€šè¿‡ä½¿ç”¨Webæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶å®ƒçš„å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£ï¼ˆ<strong>é»˜è®¤ç«¯å£ä¸º80</strong>ï¼‰çš„HTTPè¯·æ±‚ã€‚ï¼ˆæˆ‘ä»¬ç§°è¿™ä¸ªå®¢æˆ·ç«¯ï¼‰å«<strong>ç”¨æˆ·ä»£ç†ï¼ˆuser agentï¼‰</strong>ã€‚åº”ç­”çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨ç€ï¼ˆä¸€äº›ï¼‰èµ„æºï¼Œæ¯”å¦‚HTMLæ–‡ä»¶å’Œå›¾åƒã€‚ï¼ˆæˆ‘ä»¬ç§°ï¼‰è¿™ä¸ªåº”ç­”æœåŠ¡å™¨ä¸ºæºæœåŠ¡å™¨ï¼ˆorigin serverï¼‰ã€‚åœ¨ç”¨æˆ·ä»£ç†å’ŒæºæœåŠ¡å™¨ä¸­é—´å¯èƒ½å­˜åœ¨å¤šä¸ªä¸­é—´å±‚ï¼Œæ¯”å¦‚ä»£ç†ï¼Œç½‘å…³ï¼Œæˆ–è€…éš§é“ï¼ˆtunnelsï¼‰ã€‚å°½ç®¡TCP/IPåè®®æ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„åº”ç”¨ï¼ŒHTTPåè®®å¹¶æ²¡æœ‰è§„å®šå¿…é¡»ä½¿ç”¨å®ƒå’Œï¼ˆåŸºäºï¼‰å®ƒæ”¯æŒçš„å±‚ã€‚ äº‹å®ä¸Šï¼ŒHTTPå¯ä»¥åœ¨ä»»ä½•å…¶ä»–äº’è”ç½‘åè®®ä¸Šï¼Œæˆ–è€…åœ¨å…¶ä»–ç½‘ç»œä¸Šå®ç°ã€‚HTTPåªå‡å®šï¼ˆå…¶ä¸‹å±‚åè®®æä¾›ï¼‰å¯é çš„ä¼ è¾“ï¼Œä»»ä½•èƒ½å¤Ÿæä¾›è¿™ç§ä¿è¯çš„åè®®éƒ½å¯ä»¥è¢«å…¶ä½¿ç”¨ã€‚</p><p>é€šå¸¸ï¼Œç”±HTTPå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤æ˜¯80ç«¯å£ï¼‰çš„TCPè¿æ¥ã€‚HTTPæœåŠ¡å™¨åˆ™åœ¨é‚£ä¸ªç«¯å£ç›‘å¬å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨ï¼ˆå‘å®¢æˆ·ç«¯ï¼‰å‘å›ä¸€ä¸ªçŠ¶æ€è¡Œï¼Œæ¯”å¦‚â€HTTP/1.1 200 OKâ€ï¼Œå’Œï¼ˆå“åº”çš„ï¼‰æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„æ¶ˆæ¯ä½“å¯èƒ½æ˜¯è¯·æ±‚çš„æ–‡ä»¶ã€é”™è¯¯æ¶ˆæ¯ã€æˆ–è€…å…¶å®ƒä¸€äº›ä¿¡æ¯ã€‚<strong>HTTPä½¿ç”¨TCPè€Œä¸æ˜¯UDPçš„åŸå› åœ¨äºï¼ˆæ‰“å¼€ï¼‰ä¸€ä¸ªç½‘é¡µå¿…é¡»ä¼ é€å¾ˆå¤šæ•°æ®ï¼Œè€ŒTCPåè®®æä¾›ä¼ è¾“æ§åˆ¶ï¼ŒæŒ‰é¡ºåºç»„ç»‡æ•°æ®ï¼Œå’Œé”™è¯¯çº æ­£ã€‚</strong></p><p>é€šè¿‡HTTPæˆ–è€…HTTPSåè®®è¯·æ±‚çš„èµ„æºç”±<strong>ç»Ÿä¸€èµ„æºæ ‡ç¤ºç¬¦</strong>ï¼ˆUniform Resource Identifiersï¼‰ï¼ˆæˆ–è€…ï¼Œæ›´å‡†ç¡®ä¸€äº›ï¼ŒURLsï¼‰æ¥æ ‡è¯†ã€‚</p><ol><li>åŸºäºè¯·æ±‚/å“åº”æ¨¡å‹çš„åè®®ã€‚è¯·æ±‚å’Œå“åº”å¿…é¡»æˆå¯¹ï¼Œå…ˆæœ‰è¯·æ±‚åæœ‰å“åº”</li><li>HTTPåè®®é»˜è®¤ç«¯å£:80</li><li>ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚è¯·æ±‚æ–¹æ³•å¸¸ç”¨çš„æœ‰GETã€HEADã€POSTç­‰ã€‚æ¯ç§æ–¹æ³•è§„å®šäº†å®¢æˆ·ä¸æœåŠ¡å™¨è”ç³»çš„ç±»å‹ä¸åŒã€‚ç”±äºHTTPåè®®ç®€å•ï¼Œä½¿å¾—HTTPæœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚</li><li>çµæ´»ï¼š<strong>HTTPå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚</strong>æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”±Content-TypeåŠ ä»¥æ ‡è®°ã€‚</li><li><strong>æ— è¿æ¥</strong>ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ã€‚</li><li><strong>æ— çŠ¶æ€</strong>ï¼šHTTPåè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«ã€‚</li></ol><h1 id="åè®®åŠŸèƒ½"><a href="#åè®®åŠŸèƒ½" class="headerlink" title="åè®®åŠŸèƒ½"></a>åè®®åŠŸèƒ½</h1><p>HTTPåè®®æ˜¯ç”¨äºä»WWWæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ è¾“åè®®ã€‚å®ƒå¯ä»¥ä½¿æµè§ˆå™¨æ›´åŠ é«˜æ•ˆï¼Œä½¿ç½‘ç»œä¼ è¾“å‡å°‘ã€‚å®ƒä¸ä»…ä¿è¯è®¡ç®—æœºæ­£ç¡®å¿«é€Ÿåœ°ä¼ è¾“è¶…æ–‡æœ¬æ–‡æ¡£ï¼Œè¿˜ç¡®å®šä¼ è¾“æ–‡æ¡£ä¸­çš„å“ªä¸€éƒ¨åˆ†ï¼Œä»¥åŠå“ªéƒ¨åˆ†å†…å®¹é¦–å…ˆæ˜¾ç¤º(å¦‚æ–‡æœ¬å…ˆäºå›¾å½¢)ç­‰ã€‚</p><p>HTTPæ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨æˆ–å…¶ä»–ç¨‹åºä¸WebæœåŠ¡å™¨ä¹‹é—´çš„<strong>åº”ç”¨å±‚é€šä¿¡åè®®</strong>ã€‚åœ¨Internetä¸Šçš„WebæœåŠ¡å™¨ä¸Šå­˜æ”¾çš„éƒ½æ˜¯è¶…æ–‡æœ¬ä¿¡æ¯ï¼Œå®¢æˆ·æœºéœ€è¦é€šè¿‡HTTPåè®®ä¼ è¾“æ‰€è¦è®¿é—®çš„è¶…æ–‡æœ¬ä¿¡æ¯ã€‚HTTPåŒ…å«å‘½ä»¤å’Œä¼ è¾“ä¿¡æ¯ï¼Œä¸ä»…å¯ç”¨äºWebè®¿é—®ï¼Œä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–å› ç‰¹ç½‘/å†…è”ç½‘åº”ç”¨ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ï¼Œä»è€Œå®ç°å„ç±»åº”ç”¨èµ„æºè¶…åª’ä½“è®¿é—®çš„é›†æˆã€‚</p><p>æˆ‘ä»¬åœ¨æµè§ˆå™¨çš„åœ°å€æ é‡Œè¾“å…¥çš„ç½‘ç«™åœ°å€å«åšURL (Uniform Resource Locatorï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦)ã€‚å°±åƒæ¯å®¶æ¯æˆ·éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œåœ°å€ä¸€æ ·ï¼Œæ¯ä¸ªç½‘é¡µä¹Ÿéƒ½æœ‰ä¸€ä¸ªInternetåœ°å€ã€‚å½“ä½ åœ¨æµè§ˆå™¨çš„åœ°å€æ¡†ä¸­è¾“å…¥ä¸€ä¸ªURLæˆ–æ˜¯å•å‡»ä¸€ä¸ªè¶…çº§é“¾æ¥æ—¶ï¼ŒURLå°±ç¡®å®šäº†è¦æµè§ˆçš„åœ°å€ã€‚æµè§ˆå™¨é€šè¿‡è¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP)ï¼Œå°†WebæœåŠ¡å™¨ä¸Šç«™ç‚¹çš„ç½‘é¡µä»£ç æå–å‡ºæ¥ï¼Œå¹¶ç¿»è¯‘æˆæ¼‚äº®çš„ç½‘é¡µã€‚</p><h1 id="HTTPåè®®çš„ç‰ˆæœ¬"><a href="#HTTPåè®®çš„ç‰ˆæœ¬" class="headerlink" title="HTTPåè®®çš„ç‰ˆæœ¬"></a>HTTPåè®®çš„ç‰ˆæœ¬</h1><p>HTTP/1.0ï¼Œå‘é€è¯·æ±‚ï¼Œåˆ›å»ºä¸€æ¬¡è¿æ¥ï¼Œè·å¾—<strong>ä¸€ä¸ª</strong>webèµ„æºï¼Œè¿æ¥æ–­å¼€</p><p>HTTP/1.1ï¼Œå‘é€è¯·æ±‚ï¼Œåˆ›å»ºä¸€æ¬¡è¿æ¥ï¼Œè·å¾—<strong>å¤šä¸ª</strong>webèµ„æºï¼Œè¿æ¥æ–­å¼€</p><p>HTTP/2.0</p><h1 id="HTTPåè®®çš„ç»„æˆ"><a href="#HTTPåè®®çš„ç»„æˆ" class="headerlink" title="HTTPåè®®çš„ç»„æˆ"></a>HTTPåè®®çš„ç»„æˆ</h1><p>HTTPåè®®ç”±<strong>HTTPè¯·æ±‚</strong>å’Œ<strong>HTTPå“åº”</strong>ç»„æˆï¼Œå½“åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€è®¿é—®æŸä¸ªç½‘ç«™æ—¶ï¼Œ ä½ çš„æµè§ˆå™¨ä¼šå°†ä½ çš„è¯·æ±‚å°è£…æˆä¸€ä¸ªHTTPè¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ç«™ç‚¹ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·  æ±‚åä¼šç»„ç»‡å“åº”æ•°æ®å°è£…æˆä¸€ä¸ªHTTPå“åº”è¿”å›ç»™æµè§ˆå™¨ã€‚å³æ²¡æœ‰è¯·æ±‚å°±æ²¡æœ‰å“åº”ã€‚</p><p><strong>HTTPè¯·æ±‚åŒ…æ‹¬ï¼šè¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“</strong></p><p><strong>HTTPå“åº”åŒ…æ‹¬ï¼šå“åº”è¡Œã€å“åº”å¤´ã€å“åº”ä½“</strong></p><h1 id="HTTPè¯·æ±‚æŠ¥æ–‡"><a href="#HTTPè¯·æ±‚æŠ¥æ–‡" class="headerlink" title="HTTPè¯·æ±‚æŠ¥æ–‡"></a>HTTPè¯·æ±‚æŠ¥æ–‡</h1><p>HTTPè¯·æ±‚æŠ¥æ–‡ç”±3éƒ¨åˆ†ç»„æˆï¼ˆè¯·æ±‚è¡Œ+è¯·æ±‚å¤´+è¯·æ±‚ä½“ï¼‰ï¼š</p><p><img src="HTTPè¯·æ±‚æŠ¥æ–‡.png" alt="HTTPè¯·æ±‚æŠ¥æ–‡"></p><h2 id="è¯·æ±‚è¡Œ"><a href="#è¯·æ±‚è¡Œ" class="headerlink" title="è¯·æ±‚è¡Œ"></a>è¯·æ±‚è¡Œ</h2><p>ä¾‹å¦‚ï¼š<code>POST /chapter17/user.html HTTP/1.1</code></p><p>æ ¼å¼ï¼š<code>è¯·æ±‚æ–¹å¼ èµ„æºè·¯å¾„ åè®®/ç‰ˆæœ¬</code></p><p>è¯·æ±‚è¡Œå¿…é¡»åœ¨HTTPè¯·æ±‚æ ¼å¼çš„ç¬¬ä¸€è¡Œã€‚</p><blockquote><p>GETè¯·æ±‚</p></blockquote><ul><li>å°†è¯·æ±‚å‚æ•°è¿½åŠ åœ¨URLåé¢ï¼Œä¸å®‰å…¨</li><li>URLé•¿åº¦é™åˆ¶GETè¯·æ±‚æ–¹å¼æ•°æ®çš„å¤§å°</li><li>æ²¡æœ‰è¯·æ±‚ä½“</li><li>ä¸€èˆ¬çš„HTTPè¯·æ±‚å¤§å¤šéƒ½æ˜¯GETã€‚</li><li>å¸¸è§GETè¯·æ±‚ï¼šåœ°å€æ ç›´æ¥è®¿é—®ã€<code>&lt;a href=&quot;&quot;&gt;</code>ã€<code>&lt;img src=&quot;&quot;&gt;</code>ç­‰</li></ul><blockquote><p>POSTè¯·æ±‚</p></blockquote><p>è¯·æ±‚å‚æ•°åœ¨è¯·æ±‚ä½“å¤„ï¼Œè¾ƒå®‰å…¨ã€‚</p><p>è¯·æ±‚æ•°æ®å¤§å°æ²¡æœ‰é™åˆ¶</p><p>åªæœ‰è¡¨å•è®¾ç½®ä¸ºmethod=â€œpostâ€æ‰æ˜¯POSTè¯·æ±‚ï¼Œå…¶ä»–éƒ½æ˜¯GETè¯·æ±‚</p><blockquote><p>HEADè¯·æ±‚</p></blockquote><p>HEADè·ŸGETç›¸ä¼¼ï¼Œä¸è¿‡æœåŠ¡ç«¯æ¥æ”¶åˆ°HEADè¯·æ±‚æ—¶<strong>åªè¿”å›å“åº”å¤´</strong>ï¼Œä¸å‘é€å“åº”å†…å®¹ã€‚æ‰€ä»¥ï¼Œå¦‚æœåªéœ€è¦æŸ¥çœ‹æŸä¸ªé¡µé¢çš„çŠ¶æ€æ—¶ï¼Œç”¨HEADæ›´é«˜æ•ˆï¼Œå› ä¸ºçœå»äº†ä¼ è¾“é¡µé¢å†…å®¹çš„æ—¶é—´ã€‚</p><blockquote><p>DELETEè¯·æ±‚</p></blockquote><p>åˆ é™¤æŸä¸€ä¸ªèµ„æºã€‚</p><blockquote><p>OPTIONSè¯·æ±‚</p></blockquote><p>ç”¨äºè·å–å½“å‰URLæ‰€æ”¯æŒçš„æ–¹æ³•ã€‚è‹¥è¯·æ±‚æˆåŠŸï¼Œä¼šåœ¨HTTPå¤´ä¸­åŒ…å«ä¸€ä¸ªåä¸ºâ€œAllowâ€çš„å¤´ï¼Œå€¼æ˜¯æ‰€æ”¯æŒçš„æ–¹æ³•ï¼Œå¦‚â€GET, POSTâ€ã€‚</p><blockquote><p>PUTè¯·æ±‚</p></blockquote><p>æŠŠä¸€ä¸ªèµ„æºå­˜æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šã€‚</p><p>æœ¬è´¨ä¸Šæ¥è®²ï¼Œ PUTå’ŒPOSTæä¸ºç›¸ä¼¼ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼ŒPUTé€šå¸¸æŒ‡å®šäº†èµ„æºçš„å­˜æ”¾ä½ç½®ï¼Œè€ŒPOSTåˆ™æ²¡æœ‰ï¼ŒPOSTçš„æ•°æ®å­˜æ”¾ä½ç½®ç”±æœåŠ¡å™¨è‡ªå·±å†³å®šã€‚</p><blockquote><p>TRACEè¯·æ±‚</p></blockquote><p>å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚</p><blockquote><p>CONNECTè¯·æ±‚</p></blockquote><p>CONNECTæ–¹æ³•æ˜¯HTTP/1.1åè®®é¢„ç•™çš„ï¼Œèƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºSSLåŠ å¯†æœåŠ¡å™¨çš„é“¾æ¥ä¸éåŠ å¯†çš„HTTPä»£ç†æœåŠ¡å™¨çš„é€šä¿¡ã€‚</p><p><strong>åœ¨ REST æ¶æ„é£æ ¼ä¸­ï¼Œæœ‰ä¸¥æ ¼è§„å®šå¯¹äºä¸åŒçš„è¯·æ±‚ç±»å‹è¦è®¾ç½®åˆé€‚çš„è¯·æ±‚æ–¹æ³•ã€‚</strong></p><p>ä¹Ÿæ˜¯é¿å…å‡ºç°å› ä¸ºä¹±ç”¨å¯¼è‡´æ··ä¹±çš„é—®é¢˜ã€‚è¿™é‡Œæåˆ°äº†RESTæ¶æ„ï¼Œç°åœ¨å¾ˆå¤šåŒå­¦éƒ½åœ¨å†™RESTï¼Œæœ‰æ²¡æœ‰äººèƒ½å¤Ÿæ˜ç™½ä¸ºä»€ä¹ˆè¦å®šä¹‰RESTè¿™ä¸ªæ¶æ„é£æ ¼ï¼Ÿï¼ˆä½¿ç”¨RESTï¼‰</p><ol><li>éšç€æœåŠ¡åŒ–æ¶æ„çš„æ™®åŠï¼ŒHTTPåè®®çš„ä½¿ç”¨é¢‘ç‡è¶Šæ¥è¶Šé«˜</li><li>å¾ˆå¤šäººåœ¨é”™è¯¯çš„ä½¿ç”¨HTTPåè®®å®šä¹‰æ¥å£ï¼Œæ¯”å¦‚å„ç§å„æ ·çš„å‘½åï¼Œä»€ä¹ˆ getUserInfoByIdï¼Œ deleteById ä¹‹ç±»çš„ã€<strong>æœ‰çŠ¶æ€å’Œæ— çŠ¶æ€è¯·æ±‚æ··ç”¨ã€‚</strong></li><li>å¯¹äº http åè®®æœ¬èº«æä¾›çš„è§„åˆ™å¹¶æ²¡æœ‰å¾ˆå¥½çš„åˆ©ç”¨</li></ol><p>æ‰€ä»¥ï¼Œä¸ºäº†æ›´å¥½çš„è§£å†³è¿™äº›é—®é¢˜ï¼Œå¹²è„†å°±å®šä¹‰ä¸€å¥—è§„åˆ™ï¼Œè¿™å¥—è§„åˆ™å¹¶æ²¡æœ‰å¼•å…¥æ–°çš„ä¸œè¥¿ï¼Œæ— éå°±æ˜¯å¯¹ http åè®®æœ¬èº«çš„ä½¿ç”¨åšäº†ä¸€äº›çº¦æŸï¼Œæ¯”å¦‚è¯´</p><ol><li><strong>RESTæ˜¯é¢å‘èµ„æº</strong>ï¼Œæ¯ä¸€ä¸ª URI ä»£è¡¨ä¸€ä¸ªèµ„æº</li><li>å¼ºè°ƒ<strong>æ— çŠ¶æ€åŒ–</strong>ï¼ŒæœåŠ¡å™¨ç«¯ä¸èƒ½å­˜å‚¨æ¥è‡ªæŸä¸ªå®¢æˆ·çš„æŸä¸ªè¯·æ±‚ä¸­çš„ä¿¡æ¯ï¼Œå¹¶åœ¨è¯¥å®¢æˆ·çš„å…¶ä»– è¯·æ±‚ä¸­ä½¿ç”¨</li><li>å¼ºè°ƒ URL æš´éœ²èµ„æºæ—¶ï¼Œ<strong>ä¸è¦åœ¨ URI ä¸­å‡ºç°åŠ¨è¯</strong></li><li>åˆç†çš„åˆ©ç”¨ http çŠ¶æ€ç ã€è¯·æ±‚æ–¹æ³•ã€‚</li></ol><p>å› æ­¤å¤§å®¶åœ¨å‚ç…§è¿™ç§æ ‡å‡†å»ä½¿ç”¨ REST é£æ ¼æ—¶ï¼Œè¦æ˜ç™½ä½ éµå¾ªçš„æ˜¯ä»€ä¹ˆä»¥åŠè¦è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚</p><h2 id="è¯·æ±‚å¤´"><a href="#è¯·æ±‚å¤´" class="headerlink" title="è¯·æ±‚å¤´"></a>è¯·æ±‚å¤´</h2><p>ä¾‹å¦‚ï¼šHost: 39.108.107.149:8080</p><p>è¯·æ±‚å¤´ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œåˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼ç»“æŸã€‚è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¹‹é—´å­˜åœ¨ä¸€ä¸ªç©ºæ ¼(å¦‚ä¸‹)</p><p>ä¾‹å¦‚ï¼šHost: 39.108.107.149:8080</p><p>è¯·æ±‚å¤´ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œåˆ°ç¬¬ä¸€ä¸ªç©ºæ ¼ç»“æŸã€‚è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¹‹é—´å­˜åœ¨ä¸€ä¸ªç©ºæ ¼(å¦‚ä¸‹)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST http://39.108.107.149:8080/vk/app/rest/ddp/iModelServiceImpl/findModelByType HTTP/1.1</span><br><span class="line">User-Agent: Fiddler</span><br><span class="line">Host: 39.108.107.149:8080</span><br><span class="line">Content-Length: 11</span><br><span class="line"> </span><br><span class="line">name=åŸå¸‚</span><br></pre></td></tr></table></figure><p>è¯·æ±‚å¤´é€šå¸¸ä»¥é”®å€¼å¯¹{key:value}æ–¹å¼ä¼ é€’æ•°æ®ã€‚</p><p>keyä¸ºè§„èŒƒçš„å›ºå®šå€¼</p><p>valueä¸ºkeyå¯¹åº”çš„å–å€¼ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå€¼ï¼Œå¯èƒ½æ˜¯ä¸€ç»„ã€‚</p><h3 id="å¸¸è§çš„è¯·æ±‚å¤´å±æ€§"><a href="#å¸¸è§çš„è¯·æ±‚å¤´å±æ€§" class="headerlink" title="å¸¸è§çš„è¯·æ±‚å¤´å±æ€§"></a>å¸¸è§çš„è¯·æ±‚å¤´å±æ€§</h3><p><strong>Referer:</strong> è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ä»å“ªä¸ªurlè·³è¿‡æ¥çš„ï¼Œé€šè¿‡ç™¾åº¦æ¥æœç´¢æ·˜å®ç½‘,é‚£ä¹ˆåœ¨è¿›å…¥æ·˜å®ç½‘çš„è¯·æ±‚æŠ¥æ–‡ä¸­ï¼ŒRefererçš„å€¼å°±æ˜¯:www.baidu.comã€‚ å¦‚æœæ˜¯ç›´æ¥è®¿é—®å°±ä¸ä¼šæœ‰è¿™ä¸ªå¤´ã€‚</p><p>å¸¸ç”¨äºï¼šé˜²ç›—é“¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Referer: no-referrer-when-downgrade</span><br></pre></td></tr></table></figure><p><strong>Accept:</strong> å‘Šè¯‰æœåŠ¡ç«¯ï¼Œè¯¥è¯·æ±‚æ‰€èƒ½æ”¯æŒçš„å“åº”æ•°æ®ç±»å‹ï¼Œä¸“ä¸šæœ¯è¯­ç§°ä¸ºMIME ç±»å‹(æ–‡ä»¶ç±»å‹çš„ä¸€ç§æè¿°æ–¹å¼)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br></pre></td></tr></table></figure><p>MIMEæ ¼å¼ï¼šå¤§ç±»å‹/å°ç±»å‹[;å‚æ•°]</p><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8</p><p>ä¾‹å¦‚:</p><p>text/html,htmlæ–‡ä»¶</p><p>text/css,cssæ–‡ä»¶</p><p>text/javascript,jsæ–‡ä»¶</p><p>image/*ï¼Œæ‰€æœ‰å›¾ç‰‡æ–‡ä»¶</p><p><strong>Cookie:</strong> å®¢æˆ·ç«¯çš„Cookieå°±æ˜¯é€šè¿‡è¿™ä¸ªæŠ¥æ–‡å¤´å±æ€§ä¼ ç»™æœåŠ¡ç«¯çš„å“¦ï¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cookie: JSESSIONID=15982C27F7507C7FDAF0F97161F634B5</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å‡ºäº†ä¸€ä¸ªé—®é¢˜,ç½‘ç«™Aæ€ä¹ˆä¿è¯è‡ªå·±è¯·æ±‚ä½“ä¸­ä¿å­˜çš„cookieå°±æ˜¯ç½‘ç«™Açš„cookieè€Œä¸æ˜¯ç½‘ç«™Bçš„cookieå‘¢,è¿™å°±å’Œcookieé‡Œé¢çš„jsessionidæœ‰å…³ç³»äº†ï¼Œå…³äºcookie,session,sessionid,jsessionidçš„åŒºåˆ«è”ç³»ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªåšæ–‡:</p><p><a href="http://www.cnblogs.com/fnng/archive/2012/08/14/2637279.html">http://www.cnblogs.com/fnng/archive/2012/08/14/2637279.html</a></p><p><strong>User-Agent:</strong> æµè§ˆå™¨é€šçŸ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨ä¸æ“ä½œç³»ç»Ÿç›¸å…³ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36</span><br></pre></td></tr></table></figure><p><strong>Connection:</strong> è¡¨ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡è¿æ¥ç±»å‹ï¼›Keep-Aliveè¡¨ç¤ºæŒä¹…è¿æ¥ï¼Œcloseå·²å…³é—­</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure><p><strong>Host:</strong> è¯·æ±‚çš„æœåŠ¡å™¨ä¸»æœºå</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Host: sczpkj.f3322.net:3000</span><br></pre></td></tr></table></figure><p><strong>Content-Length:</strong> è¯·æ±‚ä½“çš„é•¿åº¦</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST http://39.108.107.149:8080/vk/app/rest/ddp/iModelServiceImpl/findModelByType HTTP/1.1</span><br><span class="line">User-Agent: Fiddler</span><br><span class="line">Host: 39.108.107.149:8080</span><br><span class="line">Content-Length: 11</span><br><span class="line"> </span><br><span class="line">name=åŸå¸‚</span><br></pre></td></tr></table></figure><p><strong>Content-Type:</strong> è¯·æ±‚çš„ä¸å®ä½“å¯¹åº”çš„MIMEä¿¡æ¯ã€‚å¦‚æœæ˜¯POSTè¯·æ±‚,ä¼šæœ‰è¿™ä¸ªå¤´,é»˜è®¤å€¼ä¸ºapplication/x-www-form-urlencodedï¼Œè¡¨ç¤ºè¯·æ±‚ä½“å†…å®¹ä½¿ç”¨urlç¼–ç </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Content-Type: application/x-www-form-urlencoded</span><br></pre></td></tr></table></figure><blockquote><h4 id="Content-Typeè¯¦è§£"><a href="#Content-Typeè¯¦è§£" class="headerlink" title="Content-Typeè¯¦è§£"></a>Content-Typeè¯¦è§£</h4><p>å¸¸è§çš„Content-Typeï¼š</p><div class="table-container"><table><thead><tr><th>Content-Type</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>text/html</td><td>htmlæ ¼å¼</td></tr><tr><td>text/plain</td><td>çº¯æ–‡æœ¬æ ¼å¼</td></tr><tr><td>text/css</td><td>CSSæ ¼å¼</td></tr><tr><td>text/javascript</td><td>jsæ ¼å¼</td></tr><tr><td>image/gif</td><td>gifå›¾ç‰‡æ ¼å¼</td></tr><tr><td>image/jpeg</td><td>jpgå›¾ç‰‡æ ¼å¼</td></tr><tr><td>image/png</td><td>pngå›¾ç‰‡æ ¼å¼</td></tr><tr><td>application/x-www-form-urlencoded</td><td>POSTä¸“ç”¨ï¼šæ™®é€šçš„è¡¨å•æäº¤é»˜è®¤æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ã€‚formè¡¨å•æ•°æ®è¢«ç¼–ç ä¸ºkey/valueæ ¼å¼å‘é€åˆ°æœåŠ¡å™¨ã€‚</td></tr><tr><td>application/json</td><td>POSTä¸“ç”¨ï¼šç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯æ¶ˆæ¯ä¸»ä½“æ˜¯åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²</td></tr><tr><td>text/xml</td><td>POSTä¸“ç”¨ï¼šå‘é€xmlæ•°æ®</td></tr><tr><td>multipart/form-data</td><td>POSTä¸“ç”¨ï¼šä¸‹é¢è®²è§£</td></tr></tbody></table></div><p><strong>application/x-www-form-urlencoded</strong> </p><p>æœ€å¸¸è§çš„postæäº¤æ•°æ®çš„æ–¹å¼ã€‚æµè§ˆå™¨åŸç”Ÿçš„formè¡¨å•ï¼Œå¦‚æœä¸è®¾ç½®<strong>enctypeå±æ€§</strong>ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šä»¥application/x-www-form-urlencoded æ–¹å¼æäº¤æ•°æ®</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST http://39.108.107.149:8080/vk/app/rest/ddp/iModelServiceImpl/findModelByType HTTP/1.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Postman-Token: 8e602802-b4f5-4d05-96d7-e1c7a1951719</span><br><span class="line">User-Agent: PostmanRuntime/7.1.1</span><br><span class="line">Accept: */*</span><br><span class="line">Host: 39.108.107.149:8080</span><br><span class="line">cookie: JSESSIONID=6CD80B7028062D9190717CEE001C3194</span><br><span class="line">accept-encoding: gzip, deflate</span><br><span class="line">content-length: 32</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">name=%E5%9F%8E%E5%B8%82&amp;status=1</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼ŒContent-Type è¢«æŒ‡å®šä¸º application/x-www-form-urlencodedï¼›å…¶æ¬¡ï¼Œæäº¤çš„æ•°æ®æŒ‰ç…§ key1=val1&amp;key2=val2 çš„æ–¹å¼è¿›è¡Œç¼–ç ï¼Œkey å’Œ val éƒ½è¿›è¡Œäº† URL è½¬ç ã€‚å¤§éƒ¨åˆ†æœåŠ¡ç«¯è¯­è¨€éƒ½å¯¹è¿™ç§æ–¹å¼æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç”¨ Ajax æäº¤æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä¾‹å¦‚ JQuery å’Œ QWrap çš„ Ajaxï¼ŒContent-Type é»˜è®¤ã€Œapplication/x-www-form-urlencoded;charset=utf-8ã€ã€‚ </p><p><strong>multipart/form-data</strong> </p><p>è¿™åˆæ˜¯ä¸€ä¸ªå¸¸è§çš„ POST æ•°æ®æäº¤çš„æ–¹å¼ã€‚æˆ‘ä»¬<strong>ä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶</strong>æ—¶ï¼Œå¿…é¡»è®© form çš„ enctyped ç­‰äºè¿™ä¸ªå€¼ã€‚</p><p>æ­¤æ—¶ï¼ˆå½“ä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶ï¼‰ï¼ŒHTTPè¯·æ±‚æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST http://39.108.107.149:8080/vk/app/rest/ddp/iDataSourcesBaseService/file HTTP/1.1</span><br><span class="line">Content-Type: multipart/form-data; boundary=--------------------------629236571647111133881449</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Postman-Token: 2146b4b3-2d30-469c-bbcd-fbc4693934d9</span><br><span class="line">User-Agent: PostmanRuntime/7.1.1</span><br><span class="line">Accept: */*</span><br><span class="line">Host: 39.108.107.149:8080</span><br><span class="line">cookie: JSESSIONID=6CD80B7028062D9190717CEE001C3194</span><br><span class="line">accept-encoding: gzip, deflate</span><br><span class="line">content-length: 435</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">----------------------------629236571647111133881449</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.txt&quot;</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">test upload</span><br><span class="line">----------------------------629236571647111133881449</span><br><span class="line">Content-Disposition: form-data; name=&quot;extCode&quot;</span><br><span class="line"></span><br><span class="line">test</span><br><span class="line">----------------------------629236571647111133881449</span><br><span class="line">Content-Disposition: form-data; name=&quot;extId&quot;</span><br><span class="line"></span><br><span class="line">3306</span><br><span class="line">----------------------------629236571647111133881449--  //ç»“æŸæ ‡è¯†</span><br></pre></td></tr></table></figure><p>é¦–å…ˆç”Ÿæˆäº†ä¸€ä¸ª boundary ç”¨äºåˆ†å‰²ä¸åŒçš„å­—æ®µï¼Œä¸ºäº†é¿å…ä¸æ­£æ–‡å†…å®¹é‡å¤ï¼Œboundary å¾ˆé•¿å¾ˆå¤æ‚ã€‚ç„¶å Content-Type é‡ŒæŒ‡æ˜äº†æ•°æ®æ˜¯ä»¥ mutipart/form-data æ¥ç¼–ç ï¼Œæœ¬æ¬¡è¯·æ±‚çš„ boundary æ˜¯ä»€ä¹ˆå†…å®¹ã€‚</p><p>æ¶ˆæ¯ä¸»ä½“é‡ŒæŒ‰ç…§å­—æ®µä¸ªæ•°åˆåˆ†ä¸ºå¤šä¸ªç»“æ„ç±»ä¼¼çš„éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æ˜¯<strong>ä»¥â€”boundaryå¼€å§‹</strong>ï¼Œç´§æ¥ç€å†…å®¹æè¿°ä¿¡æ¯ï¼Œç„¶åæ˜¯å›è½¦ï¼Œæœ€åæ˜¯æœ€åæ˜¯å­—æ®µå…·ä½“å†…å®¹ï¼ˆæ–‡æœ¬æˆ–äºŒè¿›åˆ¶ï¼‰ï¼Œå¦‚æœä¼ è¾“çš„æ˜¯æ–‡ä»¶ï¼Œè¿˜è¦åŒ…å«æ–‡ä»¶åå’Œæ–‡ä»¶ç±»å‹ä¿¡æ¯ã€‚æ¶ˆæ¯ä¸»ä½“æœ€å<strong>ä»¥â€”boundaryâ€”æ ‡ç¤ºç»“æŸ</strong>ã€‚</p><p>ä¸Šé¢æåˆ°çš„è¿™ä¸¤ç§ POST æ•°æ®çš„æ–¹å¼ï¼Œéƒ½æ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„ï¼Œè€Œä¸”ç°é˜¶æ®µåŸç”Ÿ form è¡¨å•ä¹Ÿåªæ”¯æŒè¿™ä¸¤ç§æ–¹å¼ã€‚ä½†æ˜¯éšç€è¶Šæ¥è¶Šå¤šçš„ Web ç«™ç‚¹ï¼Œå°¤å…¶æ˜¯ WebAppï¼Œå…¨éƒ¨ä½¿ç”¨ Ajax è¿›è¡Œæ•°æ®äº¤äº’ä¹‹åï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®æäº¤æ–¹å¼ï¼Œç»™å¼€å‘å¸¦æ¥æ›´å¤šä¾¿åˆ©ã€‚ </p><p><strong>application/json</strong></p><p>application/json è¿™ä¸ª Content-Type ä½œä¸ºå“åº”å¤´å¤§å®¶è‚¯å®šä¸é™Œç”Ÿã€‚å®é™…ä¸Šï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„äººæŠŠå®ƒä½œä¸ºè¯·æ±‚å¤´ï¼Œç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯æ¶ˆæ¯ä¸»ä½“æ˜¯åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²ã€‚ç”±äº JSON è§„èŒƒçš„æµè¡Œï¼Œé™¤äº†ä½ç‰ˆæœ¬ IE ä¹‹å¤–çš„å„å¤§æµè§ˆå™¨éƒ½åŸç”Ÿæ”¯æŒ JSON.stringifyï¼ŒæœåŠ¡ç«¯è¯­è¨€ä¹Ÿéƒ½æœ‰å¤„ç† JSON çš„å‡½æ•°ï¼Œä½¿ç”¨ JSON ä¸ä¼šé‡ä¸Šä»€ä¹ˆéº»çƒ¦ã€‚ <strong>JSON æ ¼å¼æ”¯æŒæ¯”é”®å€¼å¯¹å¤æ‚å¾—å¤šçš„ç»“æ„åŒ–æ•°æ®ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</strong></p><p>å½“<code>Content-Type: application/json</code>æ—¶è¯·æ±‚æŠ¥æ–‡å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST http://39.108.107.149:8080/vk/app/rest/ddp/vkIndexsService/queryVkIndxs HTTP/1.1</span><br><span class="line">Content-Type: application/json</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Postman-Token: 5014bc39-0777-49d5-bb8a-73db9a981e49</span><br><span class="line">User-Agent: PostmanRuntime/7.1.1</span><br><span class="line">Accept: */*</span><br><span class="line">Host: 39.108.107.149:8080</span><br><span class="line">cookie: JSESSIONID=6CD80B7028062D9190717CEE001C3194</span><br><span class="line">accept-encoding: gzip, deflate</span><br><span class="line">content-length: 132</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> &quot;name&quot;:&quot;828éªŒè¯ç»§æ‰¿&quot;,</span><br><span class="line"> &quot;getresultType&quot;:&quot;2&quot;,</span><br><span class="line"> &quot;createTime&quot;:&quot;Tue Sep 11 2018 00:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ¡ˆï¼Œå¯ä»¥æ–¹ä¾¿çš„æäº¤å¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œç‰¹åˆ«é€‚åˆ RESTful çš„æ¥å£ã€‚å„å¤§æŠ“åŒ…å·¥å…·å¦‚ Chrome è‡ªå¸¦çš„å¼€å‘è€…å·¥å…·ã€Firebugã€Fiddlerï¼Œéƒ½ä¼šä»¥æ ‘å½¢ç»“æ„å±•ç¤º JSON æ•°æ®ï¼Œéå¸¸å‹å¥½ã€‚</p></blockquote><p><strong>Accept-Encoding:</strong> æµè§ˆå™¨é€šçŸ¥æœåŠ¡å™¨ï¼Œæµè§ˆå™¨æ”¯æŒçš„æ•°æ®å‹ç¼©æ ¼å¼ã€‚å¦‚GZIPå‹ç¼©</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure><p><strong>Accept-Language:</strong> æµè§ˆå™¨é€šçŸ¥æœåŠ¡å™¨ï¼Œæµè§ˆå™¨æ”¯æŒçš„è¯­è¨€ã€‚å„å›½è¯­è¨€(å›½é™…åŒ–i18n)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br></pre></td></tr></table></figure><p><strong>Cache-Control:</strong> æŒ‡å®šè¯·æ±‚å’Œå“åº”éµå¾ªçš„ç¼“å­˜æœºåˆ¶</p><p>å¯¹ç¼“å­˜è¿›è¡Œæ§åˆ¶ï¼Œå¦‚ä¸€ä¸ªè¯·æ±‚å¸Œæœ›å“åº”è¿”å›çš„å†…å®¹åœ¨å®¢æˆ·ç«¯è¦è¢«ç¼“å­˜ä¸€å¹´ï¼Œæˆ–ä¸å¸Œæœ›è¢«ç¼“å­˜å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæŠ¥æ–‡å¤´è¾¾åˆ°ç›®çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cache-Control: no-cache</span><br></pre></td></tr></table></figure><p>æ›´å¤šè¯·æ±‚å¤´å±æ€§å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« :<a href = "http://tools.jb51.net/table/http_header">HTTPå“åº”å¤´å’Œè¯·æ±‚å¤´ä¿¡æ¯å¯¹ç…§è¡¨</a></p><h2 id="è¯·æ±‚ä½“"><a href="#è¯·æ±‚ä½“" class="headerlink" title="è¯·æ±‚ä½“"></a>è¯·æ±‚ä½“</h2><p>å½“è¯·æ±‚æ–¹å¼æ˜¯postçš„æ—¶ï¼Œè¯·æ±‚ä½“ä¼šæœ‰è¯·æ±‚çš„å‚æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p>username=zhangsan&amp;password=123</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST http://39.108.107.149:8080/vk/app/rest/ddp/iModelServiceImpl/findModelByType HTTP/1.1</span><br><span class="line">User-Agent: Fiddler</span><br><span class="line">Host: 39.108.107.149:8080</span><br><span class="line">Content-Length: 20</span><br><span class="line"> </span><br><span class="line">name=åŸå¸‚&amp;status=1</span><br></pre></td></tr></table></figure><h1 id="HTTPå“åº”æŠ¥æ–‡"><a href="#HTTPå“åº”æŠ¥æ–‡" class="headerlink" title="HTTPå“åº”æŠ¥æ–‡"></a>HTTPå“åº”æŠ¥æ–‡</h1><p>HTTPçš„å“åº”æŠ¥æ–‡ä¹Ÿç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ˆå“åº”è¡Œ+å“åº”å¤´+å“åº”ä½“ï¼‰</p><p><img src="HTTPå“åº”æŠ¥æ–‡.png" alt="HTTPå“åº”æŠ¥æ–‡"></p><h2 id="å“åº”è¡Œ"><a href="#å“åº”è¡Œ" class="headerlink" title="å“åº”è¡Œ"></a>å“åº”è¡Œ</h2><p>ä¾‹å¦‚ï¼š<code>HTTP/1.1 200 OK</code></p><p>æ ¼å¼ï¼š<code>æŠ¥æ–‡åè®®åŠç‰ˆæœ¬ çŠ¶æ€ç åŠçŠ¶æ€æè¿°</code></p><h3 id="å¸¸è§çš„çŠ¶æ€ç "><a href="#å¸¸è§çš„çŠ¶æ€ç " class="headerlink" title="å¸¸è§çš„çŠ¶æ€ç "></a>å¸¸è§çš„çŠ¶æ€ç </h3><p>çŠ¶æ€ç ï¼šç”±3ä½æ•°å­—ç»„æˆï¼Œç¬¬ä¸€ä¸ªæ•°å­—å®šä¹‰äº†å“åº”çš„ç±»åˆ«</p><p>1xxï¼šæŒ‡ç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</p><p>2xxï¼šæˆåŠŸï¼Œè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥å—ï¼Œå¤„ç†ã€‚</p><ul><li>200 OKï¼šå®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸ</li><li>204 No Contentï¼šæ— å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†ï¼Œä½†æœªè¿”å›å†…å®¹ã€‚ä¸€èˆ¬ç”¨åœ¨åªæ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€ŒæœåŠ¡å™¨ä¸ç”¨å‘å®¢æˆ·ç«¯è¿”å›ä»€ä¹ˆä¿¡æ¯çš„æƒ…å†µã€‚ä¸ä¼šåˆ·æ–°é¡µé¢ã€‚</li><li>206 Partial Contentï¼šæœåŠ¡å™¨å·²ç»å®Œæˆäº†éƒ¨åˆ†GETè¯·æ±‚ï¼ˆå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼‰ã€‚å“åº”æŠ¥æ–‡ä¸­åŒ…å«Content-RangeæŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹</li></ul><p>3xxï¼šé‡å®šå‘</p><ul><li>301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²ç»æ°¸ä¹…çš„æ¬åˆ°äº†å…¶ä»–ä½ç½®ã€‚</li><li>302 Foundï¼šä¸´æ—¶é‡å®šå‘ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸´æ—¶æ¬åˆ°äº†å…¶ä»–ä½ç½®</li><li>303 See Otherï¼šä¸´æ—¶é‡å®šå‘ï¼Œåº”ä½¿ç”¨GETå®šå‘è·å–è¯·æ±‚èµ„æºã€‚303åŠŸèƒ½ä¸302ä¸€æ ·ï¼ŒåŒºåˆ«åªæ˜¯303æ˜ç¡®å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨GETè®¿é—®</li><li>307 Temporary Redirectï¼šä¸´æ—¶é‡å®šå‘ï¼Œå’Œ302æœ‰ç€ç›¸åŒå«ä¹‰ã€‚POSTä¸ä¼šå˜æˆGET</li><li>304 Not Modifiedï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å‘é€é™„å¸¦æ¡ä»¶çš„è¯·æ±‚ï¼ˆGETæ–¹æ³•è¯·æ±‚æŠ¥æ–‡ä¸­çš„IFâ€¦ï¼‰æ—¶ï¼Œæ¡ä»¶ä¸æ»¡è¶³ã€‚è¿”å›304æ—¶ï¼Œä¸åŒ…å«ä»»ä½•å“åº”ä¸»ä½“ã€‚è™½ç„¶304è¢«åˆ’åˆ†åœ¨3XXï¼Œä½†å’Œé‡å®šå‘ä¸€æ¯›é’±å…³ç³»éƒ½æ²¡æœ‰</li></ul><p>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯</p><ul><li>400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ã€‚</li><li>401 Unauthorizedï¼šè¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’ŒWWW-AuthenticateæŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ã€‚</li><li>403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡</li><li>404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼Œè¾“å…¥äº†é”™è¯¯çš„url</li><li>415 Unsupported media typeï¼šä¸æ”¯æŒçš„åª’ä½“ç±»å‹</li></ul><p>5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯ï¼ŒæœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚</p><ul><li>500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚</li><li>503 Server Unavailableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸ï¼Œ</li></ul><h2 id="å“åº”å¤´"><a href="#å“åº”å¤´" class="headerlink" title="å“åº”å¤´"></a>å“åº”å¤´</h2><p>å“åº”æŠ¥æ–‡å¤´ï¼Œä¹Ÿæ˜¯ç”±å¤šä¸ªå±æ€§ç»„æˆï¼›</p><p>å“åº”å¤´ä¹Ÿæ˜¯ç”¨é”®å€¼å¯¹ï¼›</p><p>æœåŠ¡å™¨é€šè¿‡å“åº”å¤´æ¥æ§åˆ¶æµè§ˆå™¨çš„è¡Œä¸ºï¼Œä¸åŒçš„å¤´æµè§ˆå™¨æ“ä½œä¸åŒ</p><div class="table-container"><table><thead><tr><th>å¸¸è§è¯·æ±‚å¤´</th><th>æè¿°</th></tr></thead><tbody><tr><td>Location</td><td>æŒ‡å®šå“åº”çš„è·¯å¾„ï¼Œéœ€è¦ä¸çŠ¶æ€ç 302é…åˆä½¿ç”¨ï¼Œå®Œæˆè·³è½¬ã€‚</td></tr><tr><td>Content-Type</td><td>å“åº”æ­£æ–‡çš„ç±»å‹ï¼ˆMIMEç±»å‹ï¼‰ï¼›å–å€¼ï¼štext/html;charset=UTF-8</td></tr><tr><td>Content-Disposition</td><td>é€šè¿‡æµè§ˆå™¨ä»¥ä¸‹è½½æ–¹å¼è§£ææ­£æ–‡ï¼›  å–å€¼ï¼šattachment;filename=xx.zip</td></tr><tr><td>Set-Cookie</td><td>ä¸ä¼šè¯ç›¸å…³æŠ€æœ¯ã€‚æœåŠ¡å™¨å‘æµè§ˆå™¨å†™å…¥Cookie</td></tr><tr><td>Content-Encoding</td><td>æœåŠ¡å™¨ä½¿ç”¨çš„å‹ç¼©æ ¼å¼ï¼›å–å€¼ï¼šgzip</td></tr><tr><td>Content-length</td><td>å“åº”æ­£æ–‡çš„é•¿åº¦</td></tr><tr><td>Refresh</td><td>å®šæ—¶åˆ·æ–°ï¼Œæ ¼å¼ï¼šç§’æ•°;url=è·¯å¾„ã€‚urlå¯çœç•¥ï¼Œé»˜è®¤å€¼ä¸ºå½“å‰é¡µã€‚å–å€¼ï¼š3;url=www.itcast.cn    //ä¸‰ç§’åˆ·æ–°é¡µé¢åˆ°www.itcast.cn</td></tr><tr><td>Server</td><td>æŒ‡çš„æ˜¯æœåŠ¡å™¨åç§°ï¼Œé»˜è®¤å€¼ï¼šApache-Coyote/1.1ã€‚å¯ä»¥é€šè¿‡conf/server.xmlé…ç½®è¿›è¡Œä¿®æ”¹ã€‚<Connector port="8080" ... server="itcast"/></td></tr><tr><td>Last-Modified</td><td>æœåŠ¡å™¨é€šçŸ¥æµè§ˆå™¨ï¼Œæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚ä¸If-Modified-Sinceä¸€èµ·ä½¿ç”¨ã€‚</td></tr><tr><td>Cache-Control</td><td>å“åº”è¾“å‡ºåˆ°å®¢æˆ·ç«¯åï¼ŒæœåŠ¡ç«¯é€šè¿‡è¯¥æŠ¥æ–‡å¤´å±å‘Šè¯‰å®¢æˆ·ç«¯å¦‚ä½•æ§åˆ¶å“åº”å†…å®¹çš„ç¼“å­˜ã€‚å¸¸è§çš„å–å€¼æœ‰å¸¸è§çš„å–å€¼æœ‰privateã€publicã€no-cacheã€max-ageï¼Œno-storeï¼Œé»˜è®¤ä¸ºprivateã€‚ç¼“å­˜æ—¶é—´ä¸º31536000ç§’ï¼ˆ365å¤©ï¼‰</td></tr></tbody></table></div><p>æ›´å¤šè¯·æ±‚å¤´å±æ€§å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="http://tools.jb51.net/table/http_header">HTTPå“åº”å¤´å’Œè¯·æ±‚å¤´ä¿¡æ¯å¯¹ç…§è¡¨</a></p><h2 id="å“åº”ä½“"><a href="#å“åº”ä½“" class="headerlink" title="å“åº”ä½“"></a>å“åº”ä½“</h2><p>å“åº”æŠ¥æ–‡ä½“ï¼ŒæœåŠ¡å™¨å‘é€ç»™æµè§ˆå™¨çš„æ­£æ–‡ï¼Œå³æˆ‘ä»¬çœŸæ­£è¦çš„â€œå¹²è´§â€ ï¼›</p><p>å“åº”ä½“ï¼Œå“åº”ä½“æ˜¯æœåŠ¡å™¨å›å†™ç»™å®¢æˆ·ç«¯çš„é¡µé¢æ­£æ–‡ï¼Œæµè§ˆå™¨å°†æ­£æ–‡åŠ è½½åˆ°å†…å­˜ï¼Œç„¶åè§£ææ¸²æŸ“ï¼Œæ˜¾ç¤ºé¡µé¢å†…å®¹ã€‚</p><h1 id="HTTPåè®®æ‰©å±•"><a href="#HTTPåè®®æ‰©å±•" class="headerlink" title="HTTPåè®®æ‰©å±•"></a>HTTPåè®®æ‰©å±•</h1><blockquote><p><strong>å¦‚æœä¼ è¾“çš„æ–‡ä»¶è¿‡å¤§æ€ä¹ˆåŠ</strong></p></blockquote><p>æœåŠ¡å™¨ä¸Šè¿”å›çš„èµ„æºæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œæ¯”å¦‚æœ‰äº› js æ–‡ä»¶å¤§å°å¯èƒ½å°±æœ‰å‡ å…†ã€‚æ–‡ä»¶è¿‡å¤§å°±ä¼šå½±å“ä¼  è¾“çš„æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿä¼šå¸¦æ¥å¸¦å®½çš„æ¶ˆè€—ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><ol><li>å¸¸è§çš„æ‰‹æ®µæ˜¯ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œ<strong>å‹ç¼©</strong>ï¼Œå‡å°‘æ–‡ä»¶å¤§å°ã€‚é‚£å‹ç¼©å’Œè§£å‹ç¼©çš„æµç¨‹æ€ä¹ˆå®ç°å‘¢ï¼Ÿ é¦–å…ˆæœåŠ¡ç«¯éœ€è¦èƒ½æ”¯æŒæ–‡ä»¶çš„å‹ç¼©åŠŸèƒ½ï¼Œå…¶æ¬¡æµè§ˆå™¨èƒ½å¤Ÿé’ˆå¯¹è¢«å‹ç¼©çš„æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©ã€‚æµè§ˆå™¨å¯ä»¥æŒ‡å®š Accept-Encoding æ¥é«˜é€ŸæœåŠ¡å™¨æˆ‘å½“å‰æ”¯æŒçš„ç¼–ç ç±»å‹ Accept-Encoding:gzip,deflate é‚£æœåŠ¡ç«¯ä¼šæ ¹æ®æ”¯æŒçš„ç¼–ç ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„ç±»å‹è¿›è¡Œå‹ç¼©ã€‚å¸¸è§çš„ç¼–ç æ–¹å¼æœ‰ï¼šgzip/deflate</li><li><strong>åˆ†å‰²</strong>ä¼ è¾“ åœ¨ä¼ è¾“å¤§å®¹é‡æ•°æ®æ—¶ï¼Œé€šè¿‡æŠŠæ•°æ®åˆ†å‰²æˆå¤šå—ï¼Œèƒ½å¤Ÿè®©æµè§ˆå™¨é€æ­¥æ˜¾ç¤ºé¡µé¢ã€‚è¿™ç§æŠŠå®ä½“ä¸»ä½“åˆ†å—çš„åŠŸèƒ½ç§°ä¸ºåˆ†å—ä¼ è¾“ç¼–ç ï¼ˆChunked Transfer Codingï¼‰ã€‚</li></ol><blockquote><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½è¦å»ºç«‹è¿æ¥å—ï¼Ÿ</strong></p></blockquote><p>åœ¨æœ€æ—©çš„ HTTP åè®®ä¸­ï¼Œæ¯è¿›è¡Œä¸€æ¬¡ HTTP é€šä¿¡ï¼Œå°±éœ€è¦åšä¸€æ¬¡ TCP çš„è¿æ¥ã€‚è€Œä¸€æ¬¡è¿æ¥éœ€è¦è¿›è¡Œ 3 æ¬¡æ¡æ‰‹ï¼Œè¿™ç§é€šä¿¡æ–¹å¼ä¼šå¢åŠ é€šä¿¡é‡çš„å¼€é”€ã€‚</p><p><img src="HTTPä¸€æ¬¡é€šä¿¡.png" alt="HTTPä¸€æ¬¡é€šä¿¡"></p><p>æ‰€ä»¥åœ¨ <strong>HTTP/1.1 ä¸­æ”¹ç”¨äº†æŒä¹…è¿æ¥</strong>ï¼Œå°±æ˜¯åœ¨ä¸€æ¬¡è¿æ¥å»ºç«‹ä¹‹åï¼Œåªè¦å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯æ²¡æœ‰ æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œé‚£ä¹ˆè¿™ä¸ª tcp è¿æ¥ä¼šä¸€ç›´ä¿æŒè¿æ¥çŠ¶æ€ æŒä¹…è¿æ¥çš„ä¸€ä¸ªæœ€å¤§çš„å¥½å¤„æ˜¯ï¼šå¤§å¤§å‡å°‘äº†è¿æ¥çš„å»ºç«‹ä»¥åŠå…³é—­æ—¶å»¶ã€‚ HTTP1.1 ä¸­æœ‰ä¸€ä¸ª Transport æ®µã€‚ä¼šæºå¸¦ä¸€ä¸ª <strong>Connection:Keep-Alive</strong>ï¼Œè¡¨ç¤ºå¸Œæœ›å°†æ­¤æ¡è¿æ¥ ä½œä¸ºæŒä¹…è¿æ¥ã€‚</p><p>HTTP/1.1 æŒä¹…è¿æ¥åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ¿€æ´»çš„ï¼Œé™¤éç‰¹åˆ«æŒ‡æ˜ï¼Œå¦åˆ™ HTTP/1.1 å‡å®šæ‰€æœ‰çš„è¿æ¥éƒ½ æ˜¯æŒä¹…çš„ï¼Œè¦åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åå°†è¿æ¥å…³é—­ï¼ŒHTTP/1.1 åº”ç”¨ç¨‹åºå¿…é¡»å‘æŠ¥æ–‡ä¸­æ˜¾ç¤ºåœ°æ·»åŠ  ä¸€ä¸ª Connectionï¼šclose é¦–éƒ¨ã€‚</p><p>HTTP1.1 å®¢æˆ·ç«¯åŠ è½½åœ¨æ”¶åˆ°å“åº”åï¼Œé™¤éå“åº”ä¸­åŒ…å«äº† Connectionï¼šclose é¦–éƒ¨ï¼Œä¸ç„¶ HTTP/1.1 è¿æ¥å°±ä»ç„¶ç»´æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ä½†æ˜¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»ç„¶å¯ä»¥éšæ—¶å…³é—­ç©ºé—²çš„è¿æ¥ã€‚ä¸å‘é€ Connectionï¼šclose å¹¶ä¸æ„å‘³è¿™æœåŠ¡å™¨æ‰¿è¯ºæ°¸è¿œå°†è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚</p><p><strong>ç®¡é“åŒ–è¿æ¥</strong>ï¼šhttp/1.1 å…è®¸åœ¨æŒä¹…è¿æ¥ä¸Šä½¿ç”¨è¯·æ±‚ç®¡é“ã€‚ä»¥å‰å‘é€è¯·æ±‚åéœ€ç­‰å¾…å¹¶æ”¶åˆ°å“åº”ï¼Œ æ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ç®¡çº¿åŒ–æŠ€æœ¯å‡ºç°åï¼Œä¸ç”¨ç­‰å¾…å“åº”äº¦å¯ç›´æ¥å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è¿™æ ·å°± èƒ½å¤Ÿåšåˆ°åŒæ—¶å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ç­‰å¾…å“åº”äº†ã€‚</p><p><img src="ç®¡é“åŒ–è¿æ¥.png" alt="ç®¡é“åŒ–è¿æ¥"></p><blockquote><p><strong>HTTPåè®®å¦‚ä½•è§£å†³æ— çŠ¶æ€é—®é¢˜</strong></p></blockquote><p>HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä»€ä¹ˆæ˜¯æ— çŠ¶æ€å‘¢ï¼Ÿå°±æ˜¯è¯´ HTTP åè®®æœ¬èº«ä¸ä¼šå¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„ é€šä¿¡çŠ¶æ€åšä¿å­˜ã€‚ ä½†æ˜¯ç°åœ¨çš„åº”ç”¨éƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¦‚æœæ˜¯æ— çŠ¶æ€ï¼Œé‚£è¿™äº›åº”ç”¨åŸºæœ¬æ²¡äººç”¨ï¼Œä½ æƒ³æƒ³ï¼Œè®¿é—®ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œå…ˆç™»å½•ï¼Œç„¶åå»é€‰è´­å•†å“ï¼Œå½“ç‚¹å‡»ä¸€ä¸ªå•†å“åŠ å…¥è´­ç‰©è½¦ä»¥ååˆæç¤ºä½ ç™»å½•ã€‚è¿™ç§ç”¨æˆ·ä½“éªŒæ ¹æœ¬ä¸ä¼šæœ‰äººå»ä½¿ç”¨ã€‚é‚£æˆ‘ä»¬æ˜¯å¦‚ä½•å®ç°å¸¦çŠ¶æ€çš„åè®®å‘¢ï¼Ÿ</p><ol><li><strong>å®¢æˆ·ç«¯æ”¯æŒçš„ cookie</strong></li></ol><p>HTTP åè®®ä¸­å¼•å…¥äº† Cookie æŠ€æœ¯ï¼Œç”¨æ¥è§£å†³HTTPåè®®æ— çŠ¶æ€çš„é—®é¢˜ã€‚é€šè¿‡åœ¨è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¸­å†™å…¥ Cookie ä¿¡æ¯æ¥æ§åˆ¶å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼›Cookie ä¼šæ ¹æ®ä»æœåŠ¡å™¨ç«¯å‘é€çš„å“åº”æŠ¥æ–‡å†…çš„ä¸€ä¸ªå«åš Set-Cookie çš„é¦–éƒ¨å­—æ®µä¿¡æ¯ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ä¿å­˜ Cookieã€‚å½“ä¸‹æ¬¡å®¢æˆ·ç«¯å†å¾€è¯¥æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­åŠ å…¥ Cookie å€¼åå‘é€å‡ºå»ã€‚</p><ol><li><strong>æœåŠ¡ç«¯æ”¯æŒçš„ session</strong></li></ol><p>æœåŠ¡ç«¯æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥ä¿å­˜çŠ¶æ€çš„å‘¢ï¼Ÿ åœ¨åŸºäº tomcat è¿™ç±»çš„ jsp/servlet å®¹å™¨ä¸­ï¼Œä¼šæä¾› session è¿™æ ·çš„æœºåˆ¶æ¥ä¿å­˜æœåŠ¡ç«¯çš„å¯¹è±¡çŠ¶æ€ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ä¸€ç§ç±»ä¼¼äºæ•£åˆ—è¡¨çš„ç»“æ„æ¥ä¿å­˜ä¿¡æ¯ï¼Œå½“ç¨‹åºéœ€è¦ä¸ºæŸä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ›å»ºä¸€ä¸ª session çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥è¿™ä¸ªå®¢æˆ·ç«¯ çš„è¯·æ±‚æ˜¯å¦åŒ…å«äº†ä¸€ä¸ª session æ ‡è¯†- session idï¼› å¦‚æœå·²åŒ…å«ä¸€ä¸ª session id åˆ™è¯´æ˜ä»¥å‰å·²ç»ä¸ºå®¢æˆ·ç«¯åˆ›å»ºè¿‡ sessionï¼ŒæœåŠ¡å™¨å°±æŒ‰ç…§ session id æŠŠè¿™ä¸ª session æ£€ç´¢å‡ºæ¥ä½¿ç”¨ï¼ˆå¦‚æœæ£€ç´¢ä¸åˆ°ï¼Œä¼šæ–°å»ºä¸€ä¸ªï¼‰ï¼› å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ä¸åŒ…å« sessionidï¼Œåˆ™ä¸ºæ­¤å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª session å¹¶ä¸”ç”Ÿæˆä¸€ä¸ªä¸æ­¤ session ç›¸å…³è”çš„ session idï¼Œ session id çš„å€¼æ˜¯ä¸€ä¸ªæ—¢ä¸ä¼šé‡å¤ï¼Œåˆä¸å®¹æ˜“è¢«æ‰¾åˆ°è§„å¾‹çš„ä»¿é€ å­—ç¬¦ ä¸²ï¼Œè¿™ä¸ª session id å°†ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ä¿å­˜</p><p><img src="Sessionå®ç°åŸç†.png" alt="Sessionå®ç°åŸç†"></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/weixin_38087538/article/details/82838762">Httpåè®®è¯¦è§£(æ·±å…¥ç†è§£)</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
          <category> HTTPåè®® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
            <tag> HTTPåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»å †æ’åºåˆ°ä¼˜å…ˆçº§é˜Ÿåˆ—</title>
      <link href="/2021/12/29/%E4%BB%8E%E5%A0%86%E6%8E%92%E5%BA%8F%E5%88%B0%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97/"/>
      <url>/2021/12/29/%E4%BB%8E%E5%A0%86%E6%8E%92%E5%BA%8F%E5%88%B0%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡åŒ…å«ä»¥ä¸‹å‡ éƒ¨åˆ†å†…å®¹</p><ul><li>[x] äºŒå‰å †</li><li>[x] å †æ’åº</li><li>[x] äºŒå‰å †åº”ç”¨ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—</li><li>[x] Java PriorityQueue</li></ul><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><h2 id="äºŒå‰å †"><a href="#äºŒå‰å †" class="headerlink" title="äºŒå‰å †"></a>äºŒå‰å †</h2><p>äºŒå‰å †æ˜¯å †æ’åºå®ç°çš„åº•å±‚é€»è¾‘ç»“æ„ã€‚äºŒå‰å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼ˆå®Œå…¨äºŒå‰æ ‘ï¼‰ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚</p><p>å¯¹äºé“¾è¡¨äºŒå‰æ ‘ï¼Œä¸€èˆ¬æ˜¯æ“ä½œèŠ‚ç‚¹æŒ‡é’ˆï¼Œè€Œå¯¹äºäºŒå‰å †ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„ç´¢å¼•ä½œä¸ºæŒ‡é’ˆã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">parent</span><span class="params">(<span class="type">int</span> root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> root / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·¦å­©å­çš„ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">left</span><span class="params">(<span class="type">int</span> root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> root * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å³å­©å­çš„ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">right</span><span class="params">(<span class="type">int</span> root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> root * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯äºŒå‰å †ç‰©ç†å­˜å‚¨ç»“æ„ç¤ºæ„å›¾ï¼Œæ³¨æ„è¿™é‡Œç´¢å¼•0ç©ºç€ä¸ç”¨ã€‚</p><p><img src="1.png" alt="äºŒå‰å †ç¤ºæ„å›¾"></p><p>äºŒå‰å †è®¾è®¡çš„å·§å¦™ä¹‹å¤„å°±åœ¨äºï¼Œå¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œåªéœ€è¦é€šè¿‡ç®€å•çš„è¿ç®—å°±å¯ä»¥å¾—åˆ°å…¶çˆ¶ã€å·¦å³å­©å­èŠ‚ç‚¹ã€‚</p><p>äºŒå‰å †åˆ†ä¸ºå¤§é¡¶å †å’Œå°é¡¶å †ã€‚å¤§é¡¶å †çš„æ€§è´¨æ˜¯<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¤§äºç­‰äºä»–çš„ä¸¤ä¸ªå­èŠ‚ç‚¹</strong>ï¼Œå°é¡¶å †çš„æ€§è´¨ç›¸åã€‚</p><p>æœ¬æ–‡ä»¥å¤§é¡¶å †ä¸ºä¾‹ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œä¸‹é¢ä¼šç”»çš„å›¾éƒ½æ˜¯äºŒå‰æ ‘ç»“æ„ã€‚ç”±äºå¤§é¡¶å †çš„æ€§è´¨ï¼Œå †é¡¶å…ƒç´ arr[1]ä¸€å®šæ˜¯æ‰€æœ‰å…ƒç´ ä¸­æœ€å¤§çš„å…ƒç´ ã€‚</p><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p>å †æ’åºå°±æ˜¯åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚</p><blockquote><p><strong>å †æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå°†å¾…æ’åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ï¼Œæ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æ ¹èŠ‚ç‚¹ã€‚å°†å…¶ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å°±ä¸ºæœ€å¤§å€¼ã€‚ç„¶åå°†å‰©ä½™n-1ä¸ªå…ƒç´ é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·ä¼šå¾—åˆ°nä¸ªå…ƒç´ çš„æ¬¡å°å€¼ã€‚å¦‚æ­¤åå¤æ‰§è¡Œï¼Œä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—äº†</strong></p></blockquote><p>å †æ’åºæ˜¯ä¸€ç§<strong>é€‰æ‹©æ’åºï¼Œ</strong>å®ƒçš„æœ€åï¼Œæœ€å¥½ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å‡ä¸º<strong>O(nlogn)</strong>ï¼Œå®ƒæ˜¯<a href="https://baike.baidu.com/item/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E7%A8%B3%E5%AE%9A%E6%80%A7/9763250"><strong>ä¸ç¨³å®šæ’åº</strong></a>ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥äº†è§£å †æ’åºçš„è¿‡ç¨‹ã€‚</p><p>åºåˆ—ï¼š4ï¼Œ6ï¼Œ8ï¼Œ5ï¼Œ9ã€‚</p><p><strong>æ­¥éª¤ä¸€</strong>ï¼š æ„é€ åˆå§‹å †ã€‚</p><p><img src="2.png" alt="åˆå§‹å †"></p><p><strong>æ­¥éª¤äºŒ</strong>ï¼šç”±<strong>ä¸‹å‘ä¸Šï¼Œç”±å³å‘å·¦</strong>ä¸æ–­è°ƒæ•´ï¼Œä½¿å…¶æ»¡è¶³å¤§é¡¶å †çš„è¦æ±‚ã€‚</p><p><img src="3.png" alt="æ„é€ å¤§é¡¶å †çš„è¿‡ç¨‹ç¤ºæ„"></p><ol><li>å…ˆçœ‹ã€6ï¼Œ5ï¼Œ9ã€‘ï¼Œ9ä¸ºè¿™æ£µæ ‘çš„æœ€å¤§å€¼èŠ‚ç‚¹ï¼Œå› æ­¤å°†9å’Œæ ¹èŠ‚ç‚¹6äº’æ¢ï¼›</li><li>å†çœ‹ã€4ï¼Œ9ï¼Œ8ã€‘ï¼Œ9ä¸ºè¿™æ£µæ ‘çš„æœ€å¤§å€¼èŠ‚ç‚¹ï¼Œå› æ­¤å°†9å’Œæ ¹èŠ‚ç‚¹4äº’æ¢ï¼›</li><li>ç”±äºåˆšæ‰çš„äº¤æ¢ï¼Œã€4ï¼Œ5ï¼Œ6ã€‘ä¸å†æ»¡è¶³å¤§é¡¶å †çš„æ€§è´¨ï¼Œ6ä¸ºè¿™æ£µæ ‘çš„æœ€å¤§å€¼èŠ‚ç‚¹ï¼Œå› æ­¤å°†4å’Œæ ¹èŠ‚ç‚¹6äº’æ¢ã€‚</li><li>æ­¤æ—¶æ•´æ£µæ ‘éƒ½æ»¡è¶³äº†å¤§é¡¶å †çš„æ€§è´¨ã€‚</li></ol><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šå°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œä½¿æœ«å°¾å…ƒç´ æœ€å¤§ã€‚å¼¹å‡ºæœ«å°¾æœ€å¤§å…ƒç´ ã€‚é‡å¤<strong>æ­¥éª¤äºŒ</strong>ä½¿å…¶æ»¡è¶³å¤§é¡¶å †ã€‚å¦‚æ­¤åå¤è¿›è¡Œäº¤æ¢ã€é‡å»ºã€äº¤æ¢â€¦â€¦ç›´åˆ°å †ç©ºï¼Œå…ƒç´ å¼¹å‡ºå †çš„é¡ºåºå³ä¸ºæ’åºåçš„é¡ºåºã€‚</p><p><img src="4.png" alt="æ­¥éª¤ä¸‰ç¤ºæ„"></p><p>æ€»ç»“å †æ’åºç®—æ³•æ­¥éª¤ï¼š</p><ol><li>å°†æ— éœ€åºåˆ—æ„å»ºæˆä¸€ä¸ªå †ï¼Œæ ¹æ®å‡åºé™åºéœ€æ±‚é€‰æ‹©å¤§é¡¶å †æˆ–å°é¡¶å †ï¼›</li><li>ç”±ä¸‹å‘ä¸Šï¼Œç”±å³å‘å·¦ä¸æ–­è°ƒæ•´ï¼Œä½¿åˆå§‹å †æ»¡è¶³å¤§é¡¶å †çš„è¦æ±‚ã€‚</li><li>å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œä½¿æœ«å°¾å…ƒç´ æœ€å¤§ã€‚å¼¹å‡ºæœ«å°¾æœ€å¤§å…ƒç´ ã€‚é‡å¤<strong>æ­¥éª¤äºŒ</strong>ä½¿å…¶æ»¡è¶³å¤§é¡¶å †ã€‚å¦‚æ­¤åå¤è¿›è¡Œäº¤æ¢ã€é‡å»ºã€äº¤æ¢â€¦â€¦ç›´åˆ°å †ç©ºã€‚å…ƒç´ å¼¹å‡ºå †çš„é¡ºåºå³ä¸ºæ’åºåçš„é¡ºåºã€‚</li></ol><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>//TODO</p><h2 id="ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>ä¼˜å…ˆçº§é˜Ÿåˆ—</h2><p>ä¼˜å…ˆçº§é˜Ÿåˆ—çš„æ€§è´¨æ˜¯ï¼Œå‡ºé˜Ÿå…ƒç´ æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚ä¼˜å…ˆçº§é˜Ÿåˆ—çš„åº•å±‚å°±æ˜¯ä½¿ç”¨äºŒå‰å †å’Œå †æ’åºå®ç°äº†è¿™ä¸€æ€§è´¨ã€‚å½“å…ƒç´ æ’å…¥/åˆ é™¤æ—¶ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—çš„å…ƒç´ ä¼šè‡ªåŠ¨æ’åºã€‚</p><h3 id="ä»£ç æ¡†æ¶"><a href="#ä»£ç æ¡†æ¶" class="headerlink" title="ä»£ç æ¡†æ¶"></a>ä»£ç æ¡†æ¶</h3><p>ä¼˜å…ˆçº§é˜Ÿåˆ—æœ‰ä¸¤ä¸ªä¸»è¦ APIï¼Œåˆ†åˆ«æ˜¯<code>insert</code>æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œ<code>delMax</code>åˆ é™¤æœ€å¤§å…ƒç´ ã€‚</p><p>ä¸‹é¢ç»™å‡ºä¼˜å…ˆçº§é˜Ÿåˆ—çš„ä»£ç æ¡†æ¶ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MaxPQ</span> &lt;Key <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;Key&gt;&gt; &#123; <span class="comment">//Keyæ˜¯å¯æ¯”è¾ƒå¤§å°çš„æ³›å‹</span></span><br><span class="line">    <span class="comment">//äºŒå‰å †ï¼Œå¤§é¡¶å †</span></span><br><span class="line">    <span class="keyword">private</span> Key[] pq;</span><br><span class="line">    <span class="comment">//å½“å‰priority queueä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MaxPQ</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">        <span class="comment">//ç´¢å¼•0ä¸ç”¨ï¼Œæ‰€ä»¥å¤šä¸€ä¸ªåˆ†é…ç©ºé—´</span></span><br><span class="line">        pq = (Key[]) <span class="keyword">new</span> <span class="title class_">Comparable</span>[cap + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿”å›å½“å‰é˜Ÿåˆ—ä¸­çš„æœ€å¤§å…ƒç´ </span></span><br><span class="line">    <span class="keyword">public</span> Key <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pq[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ’å…¥å…ƒç´ e</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span> <span class="params">(Key e)</span> &#123;</span><br><span class="line">        <span class="comment">//TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ é™¤å¹¶è¿”å›å½“å‰é˜Ÿåˆ—ä¸­çš„æœ€å¤§å…ƒç´ </span></span><br><span class="line">    <span class="keyword">public</span> Key <span class="title function_">delMax</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸Šæµ®ç¬¬kä¸ªå…ƒç´ ï¼Œä»¥ç»´æŠ¤æœ€å¤§å †çš„æ€§è´¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="comment">//TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸‹æ²‰ç¬¬kä¸ªå…ƒç´ ï¼Œä»¥ç»´æŠ¤æœ€å¤§å †çš„æ€§è´¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="comment">//TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//äº¤æ¢æ•°ç»„çš„ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">exch</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="type">Key</span> <span class="variable">tmp</span> <span class="operator">=</span> pq[i];</span><br><span class="line">        pq[i] = pq[j];</span><br><span class="line">        pq[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//pq[i]æ˜¯å¦æ¯”pq[j]å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">less</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pq[i].compareTo(pq[j]) &lt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°swimå’Œsink"><a href="#å®ç°swimå’Œsink" class="headerlink" title="å®ç°swimå’Œsink"></a>å®ç°swimå’Œsink</h3><p>å…ƒç´ çš„swimï¼ˆä¸Šæµ®ï¼‰å’Œsinkï¼ˆä¸‹æ²‰ï¼‰éƒ½æ˜¯ä¸ºäº†ç»´æŠ¤å †çš„æ€§è´¨ã€‚</p><p>æˆ‘ä»¬è¦è®²çš„æ˜¯æœ€å¤§å †ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ¯”å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹å¤§ï¼Œä½†æ˜¯åœ¨æ’å…¥å…ƒç´ å’Œåˆ é™¤å…ƒç´ æ—¶ï¼Œéš¾å…ç ´åå †çš„æ€§è´¨ï¼Œè¿™å°±éœ€è¦é€šè¿‡è¿™ä¸¤ä¸ªæ“ä½œæ¥æ¢å¤å †çš„æ€§è´¨äº†ã€‚</p><p>å¯¹äºæœ€å¤§å †ï¼Œä¼šç ´åå †æ€§è´¨çš„æœ‰æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å¦‚æœæŸä¸ªèŠ‚ç‚¹ A æ¯”å®ƒçš„å­èŠ‚ç‚¹ï¼ˆä¸­çš„ä¸€ä¸ªï¼‰å°ï¼Œé‚£ä¹ˆ A å°±ä¸é…åšçˆ¶èŠ‚ç‚¹ï¼Œåº”è¯¥ä¸‹å»ï¼Œä¸‹é¢é‚£ä¸ªæ›´å¤§çš„èŠ‚ç‚¹ä¸Šæ¥åšçˆ¶èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯å¯¹ A è¿›è¡Œ<strong>ä¸‹æ²‰</strong>ã€‚</li><li>å¦‚æœæŸä¸ªèŠ‚ç‚¹ A æ¯”å®ƒçš„çˆ¶èŠ‚ç‚¹å¤§ï¼Œé‚£ä¹ˆ A ä¸åº”è¯¥åšå­èŠ‚ç‚¹ï¼Œåº”è¯¥æŠŠçˆ¶èŠ‚ç‚¹æ¢ä¸‹æ¥ï¼Œè‡ªå·±å»åšçˆ¶èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯å¯¹ A çš„<strong>ä¸Šæµ®</strong>ã€‚</li></ol><p>swimä»£ç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæµ®åˆ°äº†å †é¡¶ï¼Œå°±ä¸éœ€è¦å†ä¸Šæµ®äº†</span></span><br><span class="line">    <span class="keyword">while</span>(k &gt; <span class="number">1</span> &amp;&amp; less(parent(k), k)) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœç¬¬kä¸ªå…ƒç´ æ¯”ä¸Šå±‚å¤§ï¼Œå°±å°†kæ¢ä¸Šå»</span></span><br><span class="line">        exch(parent(k), k);</span><br><span class="line">        k = parent(k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sinkä»£ç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸‹æ²‰ç¬¬kä¸ªå…ƒç´ ï¼Œä»¥ç»´æŠ¤æœ€å¤§å †æ€§è´¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæ²‰åˆ°å †åº•ï¼Œå°±æ²‰ä¸ä¸‹å»äº†</span></span><br><span class="line">    <span class="keyword">while</span>(left(k) &lt;= N) &#123;</span><br><span class="line">        <span class="comment">//å‡è®¾å·¦è¾¹èŠ‚ç‚¹æ¯”è¾ƒå¤§</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">older</span> <span class="operator">=</span> left(k);</span><br><span class="line">        <span class="comment">//å¦‚æœå³è¾¹èŠ‚ç‚¹å­˜åœ¨ï¼Œåˆ™å·¦å³èŠ‚ç‚¹æ¯”ä¸€ä¸‹å¤§å°</span></span><br><span class="line">        <span class="keyword">if</span>(right(k) &lt;= N &amp;&amp; less(older, right(k))) &#123;</span><br><span class="line">            older = right(k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//èŠ‚ç‚¹kæ¯”å·¦å³å­©å­éƒ½å¤§ï¼Œå°±ä¸å¿…ä¸‹æ²‰äº†</span></span><br><span class="line">        <span class="keyword">if</span>(less(older, k))  <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//å¦åˆ™ï¼Œä¸ç¬¦åˆå¤§é¡¶å †æ€§è´¨ï¼Œä¸‹æ²‰kèŠ‚ç‚¹</span></span><br><span class="line">        exch(k, older);</span><br><span class="line">        k = older;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°delMaxå’Œinsert"><a href="#å®ç°delMaxå’Œinsert" class="headerlink" title="å®ç°delMaxå’Œinsert"></a>å®ç°delMaxå’Œinsert</h3><p>delMaxå’Œinsertå°±æ˜¯å»ºç«‹åœ¨swimå’ŒsinkåŸºç¡€ä¸Šã€‚</p><p><code>insert</code>æ–¹æ³•å…ˆæŠŠè¦æ’å…¥çš„å…ƒç´ æ·»åŠ åˆ°å †åº•çš„æœ€åï¼Œç„¶åè®©å…¶ä¸Šæµ®åˆ°æ­£ç¡®ä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Key e)</span> &#123;</span><br><span class="line">    N++;</span><br><span class="line">    <span class="comment">// å…ˆæŠŠæ–°å…ƒç´ åŠ åˆ°æœ€å</span></span><br><span class="line">    pq[N] = e;</span><br><span class="line">    <span class="comment">// ç„¶åè®©å®ƒä¸Šæµ®åˆ°æ­£ç¡®çš„ä½ç½®</span></span><br><span class="line">    swim(N);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>delMax</code>æ–¹æ³•å…ˆæŠŠå †é¡¶å…ƒç´  A å’Œå †åº•æœ€åçš„å…ƒç´  B å¯¹è°ƒï¼Œç„¶ååˆ é™¤ Aï¼Œæœ€åè®© B ä¸‹æ²‰åˆ°æ­£ç¡®ä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Key <span class="title function_">delMax</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æœ€å¤§å †çš„å †é¡¶å°±æ˜¯æœ€å¤§å…ƒç´ </span></span><br><span class="line">    <span class="type">Key</span> <span class="variable">max</span> <span class="operator">=</span> pq[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// æŠŠè¿™ä¸ªæœ€å¤§å…ƒç´ æ¢åˆ°æœ€åï¼Œåˆ é™¤ä¹‹</span></span><br><span class="line">    exch(<span class="number">1</span>, N);</span><br><span class="line">    pq[N] = <span class="literal">null</span>;</span><br><span class="line">    N--;</span><br><span class="line">    <span class="comment">// è®© pq[1] ä¸‹æ²‰åˆ°æ­£ç¡®ä½ç½®</span></span><br><span class="line">    sink(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—å°±å®ç°äº†ï¼Œæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸º <em>O(logK)</em>ï¼ŒKä¸ºå½“å‰äºŒå‰å †ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰ä¸­çš„å…ƒç´ æ€»æ•°ã€‚å› ä¸ºæˆ‘ä»¬æ—¶é—´å¤æ‚åº¦ä¸»è¦èŠ±è´¹åœ¨<code>sink</code>æˆ–è€…<code>swim</code>ä¸Šï¼Œè€Œä¸ç®¡ä¸Šæµ®è¿˜æ˜¯ä¸‹æ²‰ï¼Œæœ€å¤šä¹Ÿå°±æ ‘ï¼ˆå †ï¼‰çš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯ log çº§åˆ«ã€‚</p><h2 id="Java-PriorityQueue"><a href="#Java-PriorityQueue" class="headerlink" title="Java PriorityQueue"></a>Java PriorityQueue</h2><p>Java PriorityQueueçš„ä»‹ç»è¯·çœ‹æˆ‘çš„å¦ä¸€ç¯‡åšå®¢<a href="https://gmet233.gitee.io/2021/12/19/PriorityQueue-%E6%A6%82%E8%BF%B0/#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">PriorityQueue æ¦‚è¿°</a></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://mp.weixin.qq.com/s/o7tdyLiYm668dpUWd-x7Lg">labuladong: å›¾æ–‡è¯¦è§£äºŒå‰å †ï¼Œå®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—</a></li><li>ã€Šç®—æ³•ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹</li><li><a href="https://www.cnblogs.com/chengxiao/p/6129630.html">å›¾è§£æ’åºç®—æ³•(ä¸‰)ä¹‹å †æ’åº</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> æ’åº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
            <tag> æ’åº </tag>
            
            <tag> é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»Ÿè®¡æ–‡ä»¶å¤¹ä¸‹å„ç§åç¼€åçš„æ–‡ä»¶ä¸ªæ•°</title>
      <link href="/2021/12/29/%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E5%90%84%E7%A7%8D%E5%90%8E%E7%BC%80%E5%90%8D%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%AA%E6%95%B0/"/>
      <url>/2021/12/29/%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E5%90%84%E7%A7%8D%E5%90%8E%E7%BC%80%E5%90%8D%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%AA%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>testæ–‡ä»¶å¤¹ç»„ç»‡ç»“æ„å¦‚ä¸‹ï¼š</p><blockquote><p>test/<br>   -1.jpg<br>   -dd/<br>       -2.jpg<br>       -e/<br>           -3.jpg<br>           -4.jpg<br>           -5.txt<br>   -ll.dir/<br>       -5.rar</p></blockquote><p>ç°åœ¨æƒ³ç»Ÿè®¡testç›®å½•ä¸‹ä¸åŒ<strong>æ–‡ä»¶</strong>åç¼€åçš„ä¸ªæ•°ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸¤ç§æ–¹æ¡ˆè§£å†³ã€‚</p><h1 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h1><p>shellä¸€è¡Œå‘½ä»¤æå®šï¼Œ<strong>ä½†å¯¹äºå¸¦ç‚¹å·çš„ç›®å½•ï¼Œè¿™ç§æ–¹æ³•ä¼šå‡ºBug</strong>ã€‚åº”è¯¥å¯ä»¥å¯¹æ­¤æ”¹è¿›ï¼Œä½†åé¢æ‰¾åˆ°äº†Pythonçš„æ–¹å¼ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find -type f -name &quot;*.*&quot; | cut -f3 -d&#x27;.&#x27; | sort | uniq -c -i  (é€’å½’æŸ¥æ‰¾å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¯¹è¯¥å‘½ä»¤è¿›è¡Œåˆ†è§£è§£é‡Šã€‚</p><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>findå‘½ä»¤å‚æ•°è¯´æ˜</p><blockquote><p>  -type c<br>        File is of type c:<br>            d      directory<br>            f      regular file<br>  -name pattern<br>        Base of file name (the path with the leading directories  removed)  matches  shell  pattern  pattern.  </p></blockquote><ul><li>åªæŸ¥æ‰¾æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦å…³å¿ƒæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥ä½¿ç”¨-type få‚æ•°(æ³¨æ„ï¼Œåœ¨linuxä¸Šä¼šæœ‰é“¾æ¥æ–‡ä»¶ã€å—æ–‡ä»¶ç­‰å…¶å®ƒæ ¼å¼çš„æ–‡ä»¶ç±»å‹ï¼Œè€Œä¸”Windowç³»ç»Ÿä¸Šçš„å¿«æ·æ–¹å¼å…¶æ ¼å¼ä¹Ÿæ˜¯ä¸€èˆ¬æ–‡ä»¶)</li><li>åªè¿‡æ»¤å‡ºæœ‰åç¼€åçš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä½¿ç”¨-name â€œ<em>.</em>â€œå‚æ•°(æ³¨æ„ï¼Œä½¿ç”¨-name â€œ<em>.</em>â€œå‚æ•°ä¹Ÿä¼šè¿‡æ»¤å‡º.nameå’Œname.è¿™æ ·çš„æ–‡ä»¶ï¼Œå› æ­¤è¦ä¸¥æ ¼è¿‡æ»¤å‡º<em>.</em>ä¸”â€.â€å‰åéƒ½æœ‰å­—ç¬¦çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨-regex â€œ./.+..+â€å‚æ•°ï¼Œå…·ä½“ä½œç”¨è¯·ç™¾åº¦â€œfindæ­£åˆ™è¡¨è¾¾å¼â€)</li></ul><h2 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h2><p>cutå‘½ä»¤å‚æ•°è¯´æ˜</p><blockquote><p>   -f, â€”fields=LIST<br>          select  only  these fields;  also print any line that contains no delimiter character, unless the -s option is specified<br>   -d, â€”delimiter=DELIM<br>          use DELIM instead of TAB for field delimiter</p></blockquote><ul><li>-f3è¡¨ç¤ºæˆªå–ç¬¬ä¸‰éƒ¨åˆ†</li></ul><h2 id="sortå’Œuniq"><a href="#sortå’Œuniq" class="headerlink" title="sortå’Œuniq"></a>sortå’Œuniq</h2><p>sortå‘½ä»¤å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å¯¹å‰é¢çš„è¾“å‡ºè¿›è¡Œä¸€ä¸‹æ’åºï¼Œä»¥ä¾¿ä¸uniqå‘½ä»¤æ“ä½œã€‚</p><p>uniqå‘½ä»¤è¯´æ˜</p><blockquote><p>uniq - report or omit repeated lines</p><p>-c, â€”count<br>   prefix lines by the number of occurrences<br>-i, â€”ignore-case<br>   ignore differences in case when comparing</p></blockquote><ul><li>uniqçš„ä½œç”¨å°±æ˜¯æ‰¾åˆ°<strong>è¿ç»­é‡å¤çš„è¡Œ</strong></li><li>-c ç»Ÿè®¡æ¬¡æ•°</li><li>-i å¿½ç•¥å¤§å°å†™</li></ul><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">&quot;count suffix from dir&quot;</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®è„šæœ¬ä¼ å‚ï¼Œä¼ å…¥éœ€è¦ç»Ÿè®¡åç¼€åçš„æ–‡ä»¶å¤¹</span></span><br><span class="line">parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--directory&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;need a full path&#x27;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">directory = args.directory</span><br><span class="line"><span class="comment"># ç»“æœdict</span></span><br><span class="line">res = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;suffix : count&quot;</span>)</span><br><span class="line"><span class="comment"># print(directory)</span></span><br><span class="line"><span class="comment"># å¦‚æœç›®å½•ä¸å­˜åœ¨åˆ™é€€å‡º</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;dir does not exist&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># å¦‚æœä¼ é€’çš„ä¸æ˜¯ç›®å½•åˆ™é€€å‡º</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(directory):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;need a dir not a file&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">os.walkå¾—åˆ°çš„ä¸‰å…ƒç»„åˆ—è¡¨ï¼šåˆ†åˆ«æŒ‡å‡ºäº†ç›®å½•ï¼Œç›®å½•ä¸‹ç›®å½•åˆ—è¡¨ï¼Œç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"><span class="string">(&#x27;.&#x27;, [&#x27;dd&#x27;, &#x27;ll.dir&#x27;], [&#x27;1.jpg&#x27;])</span></span><br><span class="line"><span class="string">(&#x27;./dd&#x27;, [&#x27;e&#x27;], [&#x27;2.jpg&#x27;])</span></span><br><span class="line"><span class="string">(&#x27;./dd/e&#x27;, [], [&#x27;3.jpg&#x27;, &#x27;4.jpg&#x27;, &#x27;5.txt&#x27;])</span></span><br><span class="line"><span class="string">(&#x27;./ll.dir&#x27;, [], [&#x27;5.rar&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> path, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">    <span class="comment"># print(str(files))</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        file = file.lower()  <span class="comment"># éƒ½ç»Ÿä¸€è½¬æ¢æˆå°å†™</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ²¡æœ‰åç¼€ååˆ™ä¸çº³å…¥ç»Ÿè®¡èŒƒå›´</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.match(<span class="string">r&#x27;[\s\S]*\.[\s\S]*&#x27;</span>, file):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># å¾—åˆ°åç¼€å­—ç¬¦ä¸²</span></span><br><span class="line">        suffix = file.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># ä»å­—å…¸ä¸­å–å‡ºåç¼€å¯¹åº”çš„countï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä¸º0</span></span><br><span class="line">        count = res.setdefault(suffix, <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># count ++</span></span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="comment"># å°†æ›´æ–°çš„countæ”¾å›å­—å…¸</span></span><br><span class="line">        res[suffix] = count</span><br><span class="line"></span><br><span class="line"><span class="comment"># print</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> res.keys():</span><br><span class="line">    <span class="built_in">print</span>(key + <span class="string">&quot; : &quot;</span> + <span class="built_in">str</span>(res[key]))</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º<code>.py</code>æ–‡ä»¶ï¼Œç„¶åå‘½ä»¤è¡Œæ‰§è¡Œ<code>python xxx.py -d &lt;ç›®å½•&gt;</code></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼š</p><ul><li>Shell<ul><li>findå‘½ä»¤ï¼ŒæŸ¥è¯¢ç›®å½•/æ–‡ä»¶</li><li>cutå‘½ä»¤ï¼Œåˆ†å‰²å­—ç¬¦ä¸²</li><li>sortå‘½ä»¤ï¼Œæ’åº</li><li>uniqå‘½ä»¤ï¼Œæ‰¾åˆ°è¿ç»­é‡å¤çš„è¡Œ</li></ul></li><li>Python<ul><li>dict åŸºæœ¬æ“ä½œ</li><li>argparseåº“ï¼Œè„šæœ¬ä¼ å‚</li><li>osåº“ï¼Œè¯»ç›®å½•/æ–‡ä»¶</li><li>reåº“ï¼Œæ­£åˆ™åŒ¹é…</li></ul></li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://blog.csdn.net/nfer_zhuang/article/details/42582425">ä¸€å¥è¯è„šæœ¬ç³»åˆ—ä¹‹ç»Ÿè®¡æ–‡ä»¶å¤¹ä¸‹å„ç§åç¼€åçš„æ–‡ä»¶ä¸ªæ•°</a></li><li><a href="https://www.runoob.com/python/os-walk.html">Python os.walk() æ–¹æ³•</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Scripts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python dict ç¬”è®°</title>
      <link href="/2021/12/28/Python-dict-%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/12/28/Python-dict-%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>å­—å…¸ï¼ˆdictï¼‰æ˜¯Pythonå†…ç½®æä¾›çš„ä¸€ç§å¸¸ç”¨æ•°æ®ç»“æ„ï¼Œä»–ç”¨äºå­˜æ”¾å…·æœ‰æ˜ å°„ï¼ˆmappingï¼‰å…³ç³»çš„æ•°æ®ã€‚</p><p>å¯å˜å¯¹è±¡ã€‚</p><h1 id="dict-å¸¸ç”¨æ“ä½œ"><a href="#dict-å¸¸ç”¨æ“ä½œ" class="headerlink" title="dict å¸¸ç”¨æ“ä½œ"></a>dict å¸¸ç”¨æ“ä½œ</h1><h2 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h2><p>ä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨dict()å‡½æ•°åˆ›å»ºå­—å…¸ï¼›ä½¿ç”¨èŠ±æ‹¬å·è¯­æ³•åˆ›å»ºå­—å…¸ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;&#125;</span><br><span class="line">dict2 = <span class="built_in">dict</span>()  <span class="comment"># åˆ›å»ºäº†ä¸€ä¸ªç©ºå­—å…¸</span></span><br></pre></td></tr></table></figure><blockquote><p>dictçš„keyå¿…é¡»ä¸ºä¸å¯å˜ç±»å‹ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ã€å…ƒç»„ç­‰ç±»å‹å¯ä»¥ä½œä¸ºdictçš„keyï¼Œä½†åƒåˆ—è¡¨è¿™ç§å¯å˜ç±»å‹ï¼Œä¸èƒ½ä½œä¸ºdictçš„key</p></blockquote><p>åœ¨ä½¿ç”¨ dict() å‡½æ•°åˆ›å»ºå­—å…¸æ—¶ï¼Œå¯ä»¥ä¼ å…¥å¤šä¸ªåˆ—è¡¨æˆ–å…ƒç»„å‚æ•°ä½œä¸º key-value å¯¹ï¼Œæ¯ä¸ªåˆ—è¡¨æˆ–å…ƒç»„å°†è¢«å½“æˆä¸€ä¸ª key-value å¯¹ï¼Œå› æ­¤è¿™äº›åˆ—è¡¨æˆ–å…ƒç»„éƒ½åªèƒ½åŒ…å«ä¸¤ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>person = [(<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>), (<span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;male&#x27;</span>), (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;gyj&#x27;</span>)]  <span class="comment"># è¿™é‡Œæ¢æˆperson = [[&#x27;age&#x27;, 18], [&#x27;sex&#x27;, &#x27;male&#x27;], [&#x27;name&#x27;, &#x27;gyj&#x27;]]ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict3 = <span class="built_in">dict</span>(person)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict3</span><br><span class="line">&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;sex&#x27;</span>: <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;gyj&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡keyè®¿é—®value"><a href="#é€šè¿‡keyè®¿é—®value" class="headerlink" title="é€šè¿‡keyè®¿é—®value"></a>é€šè¿‡keyè®¿é—®value</h2><p>ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>é€šè¿‡æ–¹æ‹¬å·è¯­æ³•è®¿é—®</li><li>ä½¿ç”¨getæ–¹æ³•</li><li>ä½¿ç”¨setdefault()æ–¹æ³•</li></ul><p>è¿™ä¸‰è€…ä¸åŒçš„åœ°æ–¹åœ¨äºï¼š</p><ul><li>ä½¿ç”¨æ–¹æ‹¬å·è¯­æ³•è®¿é—®å¹¶ä¸å­˜åœ¨çš„keyæ—¶ï¼Œå­—å…¸ä¼šå¼•å‘KeyErroré”™è¯¯</li><li>ä½†å¦‚æœä½¿ç”¨get()æ–¹æ³•è®¿é—®ä¸å­˜åœ¨çš„keyï¼Œè¯¥æ–¹æ³•ä¼šç®€å•åœ°è¿”å›Noneï¼Œä¸ä¼šå¯¼è‡´é”™è¯¯</li><li>ä½¿ç”¨setdefault()ï¼Œå½“ç¨‹åºè¦è·å–çš„ key åœ¨å­—å…¸ä¸­ä¸å­˜åœ¨æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆä¸ºè¿™ä¸ªä¸å­˜åœ¨çš„ key è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ valueï¼Œç„¶åå†è¿”å›è¯¥ key å¯¹åº”çš„ valueã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">scores = &#123;<span class="string">&#x27;è¯­æ–‡&#x27;</span>: <span class="number">89</span>&#125;</span><br><span class="line"><span class="comment"># é€šè¿‡keyè®¿é—®value</span></span><br><span class="line">scores.get(<span class="string">&#x27;è¯­æ–‡&#x27;</span>) <span class="comment"># 89</span></span><br><span class="line">scores.get(<span class="string">&#x27;æ•°å­¦&#x27;</span>) <span class="comment"># None</span></span><br><span class="line">scores[<span class="string">&#x27;æ•°å­¦&#x27;</span>] <span class="comment"># KeyError</span></span><br><span class="line">scores.setdefault(<span class="string">&#x27;æ•°å­¦&#x27;</span>, <span class="number">0</span>)  <span class="comment"># 0</span></span><br><span class="line">scores.setdefault(<span class="string">&#x27;è¯­æ–‡&#x27;</span>, <span class="number">0</span>)  <span class="comment"># 89</span></span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡keyæ·»åŠ k-vå¯¹"><a href="#é€šè¿‡keyæ·»åŠ k-vå¯¹" class="headerlink" title="é€šè¿‡keyæ·»åŠ k-vå¯¹"></a>é€šè¿‡keyæ·»åŠ k-vå¯¹</h2><p>ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">scores[<span class="string">&#x27;æ•°å­¦&#x27;</span>] = <span class="number">93</span></span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡keyåˆ é™¤k-vå¯¹"><a href="#é€šè¿‡keyåˆ é™¤k-vå¯¹" class="headerlink" title="é€šè¿‡keyåˆ é™¤k-vå¯¹"></a>é€šè¿‡keyåˆ é™¤k-vå¯¹</h2><p>ä½¿ç”¨delè¯­å¥åˆ é™¤k-vå¯¹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> scores[<span class="string">&#x27;è¯­æ–‡&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡keyä¿®æ”¹k-vå¯¹"><a href="#é€šè¿‡keyä¿®æ”¹k-vå¯¹" class="headerlink" title="é€šè¿‡keyä¿®æ”¹k-vå¯¹"></a>é€šè¿‡keyä¿®æ”¹k-vå¯¹</h2><p>ä¸¤ç§æ–¹å¼ï¼šå¯¹å­˜åœ¨çš„key-valueå¯¹èµ‹å€¼ï¼Œæ”¹å˜key-valueå¯¹ï¼›ä½¿ç”¨updateæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">scores[<span class="string">&#x27;æ•°å­¦&#x27;</span>] = <span class="number">95</span></span><br><span class="line">scores.update(&#123;<span class="string">&#x27;æ•°å­¦&#x27;</span>:<span class="number">100</span>&#125;)  <span class="comment"># å¦‚æœupdateçš„keyä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šå¢åŠ ä¸€ä¸ªæ–°çš„k-vå¯¹</span></span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­æŒ‡å®škeyæ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­æŒ‡å®škeyæ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­æŒ‡å®škeyæ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­æŒ‡å®škeyæ˜¯å¦å­˜åœ¨</h2><p>ä½¿ç”¨inæˆ–not in è¿ç®—ç¬¦åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;æ•°å­¦&#x27;</span> <span class="keyword">in</span> scores  <span class="comment"># True</span></span><br><span class="line"><span class="string">&#x27;æ•°å­¦&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> scores    <span class="comment"># False</span></span><br></pre></td></tr></table></figure><h2 id="æ¸…ç©ºå­—å…¸ä¸­æ‰€æœ‰çš„k-vå¯¹"><a href="#æ¸…ç©ºå­—å…¸ä¸­æ‰€æœ‰çš„k-vå¯¹" class="headerlink" title="æ¸…ç©ºå­—å…¸ä¸­æ‰€æœ‰çš„k-vå¯¹"></a>æ¸…ç©ºå­—å…¸ä¸­æ‰€æœ‰çš„k-vå¯¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">scores.clear()</span><br></pre></td></tr></table></figure><h2 id="è·å–dictæ‰€æœ‰k-vå¯¹ï¼Œæ‰€æœ‰keyï¼Œæ‰€æœ‰value"><a href="#è·å–dictæ‰€æœ‰k-vå¯¹ï¼Œæ‰€æœ‰keyï¼Œæ‰€æœ‰value" class="headerlink" title="è·å–dictæ‰€æœ‰k-vå¯¹ï¼Œæ‰€æœ‰keyï¼Œæ‰€æœ‰value"></a>è·å–dictæ‰€æœ‰k-vå¯¹ï¼Œæ‰€æœ‰keyï¼Œæ‰€æœ‰value</h2><p>items()ï¼šè·å–å­—å…¸ä¸­çš„æ‰€æœ‰ key-value å¯¹</p><p>keys()ï¼šè·å–å­—å…¸ä¸­çš„æ‰€æœ‰ key</p><p>values()ï¼šè·å–å­—å…¸ä¸­çš„æ‰€æœ‰ value</p><p>è¿™ä¸‰ä¸ªæ–¹æ³•ä¾æ¬¡è¿”å› dict_itemsã€dict_keys å’Œ dict_values å¯¹è±¡ï¼ŒPython ä¸å¸Œæœ›ç”¨æˆ·ç›´æ¥æ“ä½œè¿™å‡ ä¸ªæ–¹æ³•ï¼Œä½†å¯é€šè¿‡ list() å‡½æ•°æŠŠå®ƒä»¬è½¬æ¢æˆåˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>scores = &#123;<span class="string">&#x27;æ•°å­¦&#x27;</span>: <span class="number">96</span>, <span class="string">&#x27;è‹±è¯­&#x27;</span>: <span class="number">88</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>scores.items()</span><br><span class="line">dict_items([(<span class="string">&#x27;æ•°å­¦&#x27;</span>, <span class="number">96</span>), (<span class="string">&#x27;è‹±è¯­&#x27;</span>, <span class="number">88</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(scores.items())</span><br><span class="line">[(<span class="string">&#x27;æ•°å­¦&#x27;</span>, <span class="number">96</span>), (<span class="string">&#x27;è‹±è¯­&#x27;</span>, <span class="number">88</span>)]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¼¹å‡ºæŒ‡å®škeyçš„k-vå¯¹"><a href="#å¼¹å‡ºæŒ‡å®škeyçš„k-vå¯¹" class="headerlink" title="å¼¹å‡ºæŒ‡å®škeyçš„k-vå¯¹"></a>å¼¹å‡ºæŒ‡å®škeyçš„k-vå¯¹</h2><p>pop() æ–¹æ³•ç”¨äºè·å–æŒ‡å®š key å¯¹åº”çš„ valueï¼Œå¹¶åˆ é™¤è¿™ä¸ª key-value å¯¹ã€‚ä¾‹å¦‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">math_score = scores.pop(<span class="string">&#x27;æ•°å­¦&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="éšæœºå¼¹å‡ºk-vå¯¹"><a href="#éšæœºå¼¹å‡ºk-vå¯¹" class="headerlink" title="éšæœºå¼¹å‡ºk-vå¯¹"></a>éšæœºå¼¹å‡ºk-vå¯¹</h2><p>popitem() æ–¹æ³•ç”¨äºéšæœºå¼¹å‡ºå­—å…¸ä¸­çš„ä¸€ä¸ª key-value å¯¹ã€‚</p><blockquote><p>æ­¤å¤„çš„éšæœºå…¶å®æ˜¯å‡çš„ï¼Œæ­£å¦‚åˆ—è¡¨çš„ pop() æ–¹æ³•æ€»æ˜¯å¼¹å‡ºåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šå­—å…¸çš„ popitem() å…¶å®ä¹Ÿæ˜¯å¼¹å‡ºå­—å…¸ä¸­æœ€åä¸€ä¸ª key-value å¯¹ã€‚ç”±äºå­—å…¸å­˜å‚¨ key-value å¯¹çš„é¡ºåºæ˜¯ä¸å¯çŸ¥çš„ï¼Œå› æ­¤å¼€å‘è€…æ„Ÿè§‰å­—å…¸çš„ popitem() æ–¹æ³•æ˜¯â€œéšæœºâ€å¼¹å‡ºçš„ï¼Œä½†å®é™…ä¸Šå­—å…¸çš„ popitem() æ–¹æ³•æ€»æ˜¯å¼¹å‡ºåº•å±‚å­˜å‚¨çš„æœ€åä¸€ä¸ª key-value å¯¹ã€‚</p></blockquote><h2 id="æ ¹æ®ç»™å®šçš„å¤šä¸ªkeyåˆ›å»ºå­—å…¸"><a href="#æ ¹æ®ç»™å®šçš„å¤šä¸ªkeyåˆ›å»ºå­—å…¸" class="headerlink" title="æ ¹æ®ç»™å®šçš„å¤šä¸ªkeyåˆ›å»ºå­—å…¸"></a>æ ¹æ®ç»™å®šçš„å¤šä¸ªkeyåˆ›å»ºå­—å…¸</h2><p>fromkeys() æ–¹æ³•ä½¿ç”¨ç»™å®šçš„å¤šä¸ª key åˆ›å»ºå­—å…¸ï¼Œå‚æ•°å¯ä»¥æ˜¯listä¹Ÿå¯ä»¥æ˜¯tupleï¼Œè¿™äº› key å¯¹åº”çš„ value é»˜è®¤éƒ½æ˜¯ Noneï¼›ä¹Ÿå¯ä»¥é¢å¤–ä¼ å…¥ä¸€ä¸ªå‚æ•°ä½œä¸ºé»˜è®¤çš„ valueã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨åˆ—è¡¨åˆ›å»ºåŒ…å«2ä¸ªkeyçš„å­—å…¸</span></span><br><span class="line">a_dict = <span class="built_in">dict</span>.fromkeys([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(a_dict) <span class="comment"># &#123;&#x27;a&#x27;: None, &#x27;b&#x27;: None&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å…ƒç»„åˆ›å»ºåŒ…å«2ä¸ªkeyçš„å­—å…¸ï¼ŒæŒ‡å®šé»˜è®¤çš„value</span></span><br><span class="line">c_dict = <span class="built_in">dict</span>.fromkeys((<span class="number">13</span>, <span class="number">17</span>), <span class="string">&#x27;good&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(c_dict) <span class="comment"># &#123;13: &#x27;good&#x27;, 17: &#x27;good&#x27;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å­—å…¸æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#ä½¿ç”¨å­—å…¸æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="ä½¿ç”¨å­—å…¸æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>ä½¿ç”¨å­—å…¸æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­—ç¬¦ä¸²æ¨¡æ¿ä¸­ä½¿ç”¨key</span></span><br><span class="line">temp = <span class="string">&#x27;æ•™ç¨‹æ˜¯:%(name)s, ä»·æ ¼æ˜¯:%(price)010.2f, å‡ºç‰ˆç¤¾æ˜¯:%(publish)s&#x27;</span></span><br><span class="line">book = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;PythonåŸºç¡€æ•™ç¨‹&#x27;</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">99</span>, <span class="string">&#x27;publish&#x27;</span>: <span class="string">&#x27;Cè¯­è¨€ä¸­æ–‡ç½‘&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># ä½¿ç”¨å­—å…¸ä¸ºå­—ç¬¦ä¸²æ¨¡æ¿ä¸­çš„keyä¼ å…¥å€¼</span></span><br><span class="line"><span class="built_in">print</span>(temp % book)</span><br><span class="line">book = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;Cè¯­è¨€å°ç™½å˜æ€ªå…½&#x27;</span>, <span class="string">&#x27;price&#x27;</span>:<span class="number">159</span>, <span class="string">&#x27;publish&#x27;</span>: <span class="string">&#x27;Cè¯­è¨€ä¸­æ–‡ç½‘&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># ä½¿ç”¨å­—å…¸ä¸ºå­—ç¬¦ä¸²æ¨¡æ¿ä¸­çš„keyä¼ å…¥å€¼</span></span><br><span class="line"><span class="built_in">print</span>(temp % book)</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="http://c.biancheng.net/view/2212.html">Pythonå­—å…¸åŠåŸºæœ¬æ“ä½œï¼ˆè¶…çº§è¯¦ç»†ï¼‰</a></li><li>ã€ŠPython å­¦ä¹ æ‰‹å†Œï¼ˆç¬¬å››ç‰ˆï¼‰ã€‹</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LRU: ç¼“å­˜æ·˜æ±°ç®—æ³•</title>
      <link href="/2021/12/26/LRU-%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/"/>
      <url>/2021/12/26/LRU-%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œç”±äºç¼“å­˜å®¹é‡æœ‰é™ï¼Œå½“ç¼“å­˜å®¹é‡åˆ°è¾¾ä¸Šé™ï¼Œå°±éœ€è¦åˆ é™¤éƒ¨åˆ†æ•°æ®æŒªå‡ºç©ºé—´ã€‚ä½†æ˜¯ç¼“å­˜æ•°æ®ä¸èƒ½éšæœºåˆ é™¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦æ ¹æ®æŸç§ç®—æ³•åˆ é™¤ç¼“å­˜æ•°æ®ã€‚</p><p>å¸¸ç”¨çš„æ·˜æ±°ç®—æ³•æœ‰LRU, LFU, FIFOï¼Œæœ¬ç¯‡ä»‹ç»LRUç®—æ³•å¹¶é‡ç‚¹è®²è¿°LRUçš„å®ç°ã€‚å®Œæ•´ä»£ç ä¹Ÿæ˜¯<a href="https://leetcode-cn.com/problems/lru-cache/">LeetCode 146. LRUç¼“å­˜</a>çš„ç­”æ¡ˆã€‚</p><h1 id="LRU-ç®€ä»‹"><a href="#LRU-ç®€ä»‹" class="headerlink" title="LRU ç®€ä»‹"></a>LRU ç®€ä»‹</h1><p>LRUæ˜¯Least recently usedçš„ç¼©å†™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ã€‚å½“ç¼“å­˜å®¹é‡æ»¡çš„æ—¶å€™ï¼Œä¼˜å…ˆæ·˜æ±°æœ€è¿‘æœ€å°‘è¢«ä½¿ç”¨çš„æ•°æ®ã€‚</p><p>æ ¹æ®ä»¥ä¸Šç­–ç•¥ï¼Œç»™å‡ºä½¿ç”¨LRUæ·˜æ±°ç®—æ³•æ—¶çš„ç¤ºä¾‹ã€‚</p><p><img src="LRUæ·˜æ±°ç®—æ³•ç¤ºä¾‹.jpg" alt="LRUæ·˜æ±°ç®—æ³•ç¤ºä¾‹"></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°LRUç®—æ³•çš„å…·ä½“æ­¥éª¤æ˜¯ï¼š</p><ol><li>æ–°æ•°æ®ç›´æ¥æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</li><li>ç¼“å­˜æ•°æ®è¢«å‘½ä¸­ï¼Œå°†æ•°æ®ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨</li><li>ç¼“å­˜å·²æ»¡ï¼Œç§»é™¤åˆ—è¡¨å°¾éƒ¨æ•°æ®ã€‚</li></ol><h1 id="LRU-ç®—æ³•å®ç°"><a href="#LRU-ç®—æ³•å®ç°" class="headerlink" title="LRU ç®—æ³•å®ç°"></a>LRU ç®—æ³•å®ç°</h1><p>ä¸Šé¢çœ‹åˆ°LRUç®—æ³•éœ€è¦æ·»åŠ å¤´èŠ‚ç‚¹ï¼Œåˆ é™¤å°¾èŠ‚ç‚¹ã€‚è€Œé“¾è¡¨æ·»åŠ /åˆ é™¤èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä½†è¿™é‡Œä¸èƒ½ä½¿ç”¨æ™®é€šçš„å•å‘é“¾è¡¨ï¼ŒåŸå› åœ¨äºï¼š</p><ul><li>è™½ç„¶å•å‘é“¾è¡¨æ·»åŠ /åˆ é™¤/ç§»åŠ¨å…ƒç´ æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯å†æŸ¥è¯¢å…ƒç´ æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N)</li><li>ç§»åŠ¨ä¸­é—´èŠ‚ç‚¹åˆ°å¤´èŠ‚ç‚¹éœ€è¦çŸ¥é“å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå•å‘é“¾è¡¨å°±ä¸å¾—ä¸å†æ¬¡éå†è·å–ä¿¡æ¯ã€‚</li></ul><p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p><ul><li>ä½¿ç”¨æ•£åˆ—è¡¨å­˜å‚¨èŠ‚ç‚¹ï¼Œè·å–èŠ‚ç‚¹çš„å¤æ‚åº¦å°†ä¸ºO(1)ï¼Œ</li><li>ä½¿ç”¨åŒå‘é“¾è¡¨ç”¨æ¥è·å¾—å‰é©±èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</li></ul><p><img src="LRUæ•°æ®ç»“æ„.png" alt="LRUæ•°æ®ç»“æ„"></p><p>åœ¨è¿™é‡Œï¼Œå¢åŠ äº†ä¸¤ä¸ªã€å“¨å…µã€‘èŠ‚ç‚¹ï¼Œä¸ç”¨æ¥å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œç›®çš„æ˜¯å†å¢åŠ ã€åˆ é™¤ç»“ç‚¹çš„æ—¶å€™ä¸ç”¨è€ƒè™‘èŠ‚ç‚¹ä¸å­˜åœ¨çš„æƒ…å†µã€‚ç®€åŒ–ç¼–ç¨‹éš¾åº¦ã€‚</p><p>åœ¨ç®—æ³•å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°LeetCode 146æ˜¯ç±»ä¼¼çš„é¢˜ç›®ï¼Œæ•…æŠŠè¯¥é¢˜ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚</p><p>è¯¥é¢˜çš„ç®—æ³•ç­¾åæ˜¯</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your LRUCache object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * LRUCache obj = new LRUCache(capacity);</span></span><br><span class="line"><span class="comment"> * int param_1 = obj.get(key);</span></span><br><span class="line"><span class="comment"> * obj.put(key,value);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨put\getæ–¹æ³•å®ç°å­˜å–ç¼“å­˜çš„ç›®çš„ã€‚ä¸‹é¢æ˜¯å¯¹ä»£ç çš„é€æ­¥åˆ†æã€‚</p><h2 id="åŒå‘é“¾è¡¨æ•°æ®ç»“æ„"><a href="#åŒå‘é“¾è¡¨æ•°æ®ç»“æ„" class="headerlink" title="åŒå‘é“¾è¡¨æ•°æ®ç»“æ„"></a>åŒå‘é“¾è¡¨æ•°æ®ç»“æ„</h2><p>è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå†…éƒ¨ç±»ä½œä¸ºåŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ç»™å‡ºä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">//å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä½œä¸ºç¼“å­˜åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span>&#123;</span><br><span class="line">       <span class="keyword">public</span> Entry pre; <span class="comment">//æŒ‡å‘å‰é©±çš„æŒ‡é’ˆ</span></span><br><span class="line">       <span class="keyword">public</span> Entry next; <span class="comment">//æŒ‡å‘åç»§çš„æŒ‡é’ˆ</span></span><br><span class="line">       <span class="keyword">public</span> <span class="type">int</span> key; <span class="comment">//ç¼“å­˜çš„key</span></span><br><span class="line">       <span class="keyword">public</span> <span class="type">int</span> value; <span class="comment">//ç¼“å­˜çš„value</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">           <span class="built_in">this</span>.key = key;</span><br><span class="line">           <span class="built_in">this</span>.value = value;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">()</span> &#123;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°"><a href="#å®šä¹‰æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°" class="headerlink" title="å®šä¹‰æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°"></a>å®šä¹‰æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Entry head, tail; <span class="comment">//å¤´å°¾ä¸¤ä¸ªå“¨å…µèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> capacity; <span class="comment">// å®¹é‡</span></span><br><span class="line"><span class="type">int</span> size; <span class="comment">//å½“å‰ç¼“å­˜å¤§å°</span></span><br><span class="line">Map&lt;Integer, Entry&gt; cache; <span class="comment">//ç¼“å­˜æ•£åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">    initLinkedList();</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ“ä½œå‡½æ•°<code>initLinkedList()</code>çš„å®ç°æ˜¯å°†headå’Œtailé€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initLinkedList</span><span class="params">()</span> &#123;</span><br><span class="line">       head = <span class="keyword">new</span> <span class="title class_">Entry</span>();</span><br><span class="line">       tail = <span class="keyword">new</span> <span class="title class_">Entry</span>();</span><br><span class="line"></span><br><span class="line">       head.next = tail;</span><br><span class="line">       tail.pre = head;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="putæ“ä½œ"><a href="#putæ“ä½œ" class="headerlink" title="putæ“ä½œ"></a>putæ“ä½œ</h2><p>putæ“ä½œå¯ä»¥åˆ†ä¸‰ç§æƒ…å†µï¼š</p><ol><li>å¦‚æœkeyå·²ç»å­˜åœ¨ä¸ç¼“å­˜ä¸­ï¼Œåˆ™å°†keyå¯¹åº”çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå¹¶é‡è®¾value</li><li>å¦‚æœkeyåœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ£€æŸ¥ç¼“å­˜æ˜¯å¦å·²æ»¡<ol><li>å¦‚æœæœªæ»¡ï¼Œå°±ç›´æ¥å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é“¾è¡¨å¤´éƒ¨</li><li>å¦‚æœå·²æ»¡ï¼Œå°±å…ˆåˆ é™¤å°¾èŠ‚ç‚¹ï¼Œå†å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é“¾è¡¨å¤´éƒ¨</li></ol></li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">    <span class="type">Entry</span> <span class="variable">node</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">    <span class="comment">//å¦‚æœkeyåœ¨ç¼“å­˜ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™ç§»åŠ¨åˆ°å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">if</span>(node != <span class="literal">null</span>) &#123;</span><br><span class="line">        node.value = value;</span><br><span class="line">        move2Head(node);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å®¹é‡å·²æ»¡å…ˆåˆ é™¤å°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span>(size == capacity) &#123;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">lastNode</span> <span class="operator">=</span> tail.pre;</span><br><span class="line">        deleteNode(lastNode);</span><br><span class="line">        cache.remove(lastNode.key);</span><br><span class="line">        size --;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//add new Node</span></span><br><span class="line">    <span class="type">Entry</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entry</span>();</span><br><span class="line">    newNode.key = key;</span><br><span class="line">    newNode.value = value;</span><br><span class="line">    addNode(newNode);</span><br><span class="line">    cache.put(key, newNode);</span><br><span class="line">    size ++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<code>move2Head</code>æ“ä½œï¼Œæ— éæ˜¯å…ˆåˆ é™¤åŸæ¥çš„èŠ‚ç‚¹å…³ç³»<code>deleteNode</code>ï¼Œå†æ·»åŠ åˆ°é˜Ÿåˆ—å¤´éƒ¨<code>addNode</code></p><p>è€Œ<code>deleteNode</code>å’Œ<code>addNode</code>æ˜¯æ¯”è¾ƒåŸºç¡€çš„åŒå‘é“¾è¡¨æ“ä½œï¼Œè¿™é‡Œå°±ä¸å†åšè¿‡å¤šè§£é‡Šã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addNode</span><span class="params">(Entry node)</span> &#123;</span><br><span class="line">    head.next.pre = node;</span><br><span class="line">    node.next = head.next;</span><br><span class="line"></span><br><span class="line">    node.pre = head;</span><br><span class="line">    head.next = node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">deleteNode</span><span class="params">(Entry node)</span> &#123;</span><br><span class="line">    node.pre.next = node.next;</span><br><span class="line">    node.next.pre = node.pre;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">move2Head</span><span class="params">(Entry node)</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ é™¤åŸæ¥çš„èŠ‚ç‚¹å…³ç³»</span></span><br><span class="line">    deleteNode(node);</span><br><span class="line">    addNode(node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="get-æ“ä½œ"><a href="#get-æ“ä½œ" class="headerlink" title="get æ“ä½œ"></a>get æ“ä½œ</h2><p>å½“keyä¸åœ¨ç¼“å­˜ä¸­ï¼Œè¿”å›-1ï¼Œå½“keyå­˜åœ¨äºç¼“å­˜æ—¶ï¼Œå°±å°†è¯¥å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå¹¶è¿”å›å¯¹åº”çš„valueã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">       <span class="type">Entry</span> <span class="variable">node</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">       <span class="keyword">if</span>(node == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       move2Head(node);</span><br><span class="line">       <span class="keyword">return</span> node.value;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Entry head, tail;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity; <span class="comment">// å®¹é‡</span></span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    Map&lt;Integer, Entry&gt; cache;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">        initLinkedList();</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(capacity + <span class="number">2</span>); <span class="comment">//è¿™é‡Œä¸ºä»€ä¹ˆè¦+2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initLinkedList</span><span class="params">()</span> &#123;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">Entry</span>();</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">Entry</span>();</span><br><span class="line"></span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.pre = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">node</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        move2Head(node);</span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†èŠ‚ç‚¹æ’å…¥åˆ°å¤´èŠ‚ç‚¹ï¼Œå¦‚æœå®¹é‡å·²æ»¡ï¼Œåˆ™ä¼šåˆ é™¤å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">node</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        <span class="comment">//å¦‚æœkeyåœ¨ç¼“å­˜ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™ç§»åŠ¨åˆ°å¤´éƒ¨</span></span><br><span class="line">        <span class="keyword">if</span>(node != <span class="literal">null</span>) &#123;</span><br><span class="line">            node.value = value;</span><br><span class="line">            move2Head(node);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å®¹é‡å·²æ»¡å…ˆåˆ é™¤å°¾èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(size == capacity) &#123;</span><br><span class="line">            <span class="type">Entry</span> <span class="variable">lastNode</span> <span class="operator">=</span> tail.pre;</span><br><span class="line">            deleteNode(lastNode);</span><br><span class="line">            cache.remove(lastNode.key);</span><br><span class="line">            size --;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//add new Node</span></span><br><span class="line">        <span class="type">Entry</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entry</span>();</span><br><span class="line">        newNode.key = key;</span><br><span class="line">        newNode.value = value;</span><br><span class="line">        addNode(newNode);</span><br><span class="line">        cache.put(key, newNode);</span><br><span class="line">        size ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addNode</span><span class="params">(Entry node)</span> &#123;</span><br><span class="line">        head.next.pre = node;</span><br><span class="line">        node.next = head.next;</span><br><span class="line"></span><br><span class="line">        node.pre = head;</span><br><span class="line">        head.next = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">deleteNode</span><span class="params">(Entry node)</span> &#123;</span><br><span class="line">        node.pre.next = node.next;</span><br><span class="line">        node.next.pre = node.pre;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">move2Head</span><span class="params">(Entry node)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ é™¤åŸæ¥çš„èŠ‚ç‚¹å…³ç³»</span></span><br><span class="line">        deleteNode(node);</span><br><span class="line">        addNode(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä½œä¸ºç¼“å­˜é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> Entry pre; <span class="comment">//æŒ‡å‘å‰é©±çš„æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">public</span> Entry next; <span class="comment">//æŒ‡å‘åç»§çš„æŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> key; <span class="comment">//ç¼“å­˜çš„key</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> value; <span class="comment">//ç¼“å­˜çš„value</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.bilibili.com/video/BV1Va411677h">æ‰‹å†™LRUç®—æ³• - ITè€å“¥</a></li><li><a href="https://zhuanlan.zhihu.com/p/34133067">LRUåŸç†å’ŒRediså®ç°â€”â€”ä¸€ä¸ªä»Šæ—¥å¤´æ¡çš„é¢è¯•é¢˜</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ“ä½œç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tmux ç®€ä»‹</title>
      <link href="/2021/12/26/Tmux-%E7%AE%80%E4%BB%8B/"/>
      <url>/2021/12/26/Tmux-%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯Tmux"><a href="#ä»€ä¹ˆæ˜¯Tmux" class="headerlink" title="ä»€ä¹ˆæ˜¯Tmux"></a>ä»€ä¹ˆæ˜¯Tmux</h1><p>æ‰“å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼ˆterminal windowï¼Œä»¥ä¸‹ç®€ç§°â€çª—å£â€ï¼‰ï¼Œåœ¨é‡Œé¢è¾“å…¥å‘½ä»¤ã€‚</p><p>ç”¨æˆ·ä¸è®¡ç®—æœºçš„è¿™ç§ä¸´æ—¶çš„äº¤äº’ï¼Œç§°ä¸ºä¸€æ¬¡â€ä¼šè¯â€ï¼ˆsessionï¼‰ ã€‚</p><p>ä¼šè¯çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯ï¼Œçª—å£ä¸å…¶ä¸­å¯åŠ¨çš„è¿›ç¨‹æ˜¯<a href="https://www.ruanyifeng.com/blog/2016/02/linux-daemon.html">è¿åœ¨ä¸€èµ·</a>çš„ã€‚æ‰“å¼€çª—å£ï¼Œä¼šè¯å¼€å§‹ï¼›å…³é—­çª—å£ï¼Œä¼šè¯ç»“æŸã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œæ‰“å¼€ä¸€ä¸ªè¿œç¨‹çª—å£æ‰§è¡Œå‘½ä»¤ï¼Œè¿™æ—¶å…³é—­çª—å£ï¼Œé‚£ä¹ˆä¼šè¯ä¹Ÿå°±ç»ˆæ­¢ï¼Œé‡Œé¢çš„è¿›ç¨‹ä¹Ÿéšä¹‹ç»ˆæ­¢ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¼šè¯ä¸çª—å£å¯ä»¥â€è§£ç»‘â€ï¼šçª—å£å…³é—­æ—¶ï¼Œä¼šè¯å¹¶ä¸ç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­è¿è¡Œï¼Œç­‰åˆ°ä»¥åéœ€è¦çš„æ—¶å€™ï¼Œå†è®©ä¼šè¯â€ç»‘å®šâ€å…¶ä»–çª—å£ã€‚</p><p><strong>Tmux å°±æ˜¯ä¼šè¯ä¸çª—å£çš„â€è§£ç»‘â€å·¥å…·</strong>ã€‚</p><h1 id="ä½¿ç”¨Tmux"><a href="#ä½¿ç”¨Tmux" class="headerlink" title="ä½¿ç”¨Tmux"></a>ä½¿ç”¨Tmux</h1><h2 id="å®‰è£…Tmux"><a href="#å®‰è£…Tmux" class="headerlink" title="å®‰è£…Tmux"></a>å®‰è£…Tmux</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu æˆ– Debian</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get install tmux</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CentOS æˆ– Fedora</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo yum install tmux</span></span><br></pre></td></tr></table></figure><h2 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h2><p>ç›´æ¥ç»™å‡ºæœ€å¸¸ç”¨çš„æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ–°å»ºä¼šè¯<code>tmux new -s &lt;session_name&gt;</code>ã€‚ï¼ˆç¬¬ä¸€ä¸ªå¯åŠ¨çš„ Tmux çª—å£ï¼Œç¼–å·æ˜¯0ï¼Œç¬¬äºŒä¸ªçª—å£çš„ç¼–å·æ˜¯1ï¼Œä»¥æ­¤ç±»æ¨ã€‚ï¼‰</li><li>åœ¨ Tmux çª—å£è¿è¡Œæ‰€éœ€çš„ç¨‹åºã€‚</li><li>æŒ‰ä¸‹å¿«æ·é”®<code>Ctrl+b d</code>å°†ä¼šè¯åˆ†ç¦»ã€‚</li><li>ä¸‹æ¬¡ä½¿ç”¨æ—¶ï¼Œé‡æ–°è¿æ¥åˆ°ä¼šè¯<code>tmux a -t &lt;session_name&gt;</code>ã€‚</li></ul><h2 id="å…¶ä»–Tricks"><a href="#å…¶ä»–Tricks" class="headerlink" title="å…¶ä»–Tricks"></a>å…¶ä»–Tricks</h2><ul><li><code>Ctrl+b s</code>ï¼šåˆ—å‡ºæ‰€æœ‰ä¼šè¯ã€‚</li><li><code>tmux rename-session -t 0 &lt;new-name&gt;</code>ï¼šé‡å‘½åä¼šè¯ã€‚</li><li><code>tmux kill-session -t &lt;session-name&gt;</code>ï¼šæ€æ­»ä¼šè¯ã€‚</li><li><code>Ctrl+b [</code>ï¼šè¿›å…¥ä¼šè¯åï¼Œä½¿ç”¨è¯¥å¿«æ·å‘½ä»¤æŸ¥çœ‹æ§åˆ¶å°å†å²æ¶ˆæ¯ï¼Œå¯é€šè¿‡é”®ç›˜ä¸Šçš„ä¸Šä¸‹å·¦å³é”®æ¥æ»šåŠ¨å†å²è¾“å‡ºä¿¡æ¯ã€‚å¦‚æœè¦é€€å‡ºæŸ¥çœ‹æ¨¡å¼ï¼ŒæŒ‰ä¸‹qå³å¯ã€‚</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmux ä½¿ç”¨æ•™ç¨‹</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> å¼€å‘å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç«è½¦ç«™å°æ•°é‡é—®é¢˜</title>
      <link href="/2021/12/25/%E7%81%AB%E8%BD%A6%E7%AB%99%E5%8F%B0%E6%95%B0%E9%87%8F%E9%97%AE%E9%A2%98/"/>
      <url>/2021/12/25/%E7%81%AB%E8%BD%A6%E7%AB%99%E5%8F%B0%E6%95%B0%E9%87%8F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜å¹²"><a href="#é¢˜å¹²" class="headerlink" title="é¢˜å¹²"></a>é¢˜å¹²</h1><p>å‡è®¾å·²çŸ¥æŸä¸ªç«è½¦ç«™çš„æ‰€æœ‰è¿‡å¾€åˆ—è½¦çš„åˆ°è¾¾arrivalå’Œç¦»å¼€departureæ—¶é—´ï¼ˆåŒä¸€å¤©ï¼‰ï¼Œå¦‚æœè¦æ±‚æ‰€æœ‰åˆ—è½¦éƒ½ä¸ç­‰å¾…ç›´æ¥è¿›ç«™ï¼Œé—®è‡³å°‘éœ€è¦å¤šå°‘ä¸ªç«™å°ã€‚æ— éœ€è€ƒè™‘æ™šç‚¹ç­‰ç‰¹æ®Šæƒ…å†µã€‚</p><p>ä¾‹å¦‚ï¼Œ<br> Inputï¼š<br> åˆ°è¾¾æ—¶é—´ï¼š  arr[]  = {9:00,  9:40, 9:50,  11:00, 15:00, 18:00}<br> ç¦»å¼€æ—¶é—´ï¼š  dep[]  = {9:10, 12:00, 11:20, 11:30, 19:00, 20:00}</p><p><em>æ³¨ï¼šæ–¹ä¾¿èµ·è§ï¼Œè¾“å…¥ä¸ºintï¼Œä¾‹å¦‚ï¼š9:00çš„è¾“å…¥æ˜¯900</em></p><p>Outputï¼š<br> 3  ï¼ˆæœ€å¤šæœ‰3è¾†åˆ—è½¦åŒæ—¶è¿›ç«™ï¼ˆåœ¨11:00åˆ°11:20ä¹‹é—´ï¼‰ï¼‰</p><h1 id="è§£æ³•1"><a href="#è§£æ³•1" class="headerlink" title="è§£æ³•1"></a>è§£æ³•1</h1><p>æš´åŠ›è§£æ³•ã€‚é€ä¸ªæ£€æŸ¥æ¯ä¸ªè½¦è¾†çš„<strong>åœå‘æ—¶é—´æ®µ</strong>ï¼Œç„¶åçœ‹æœ‰å¤šå°‘ä¸ªæ—¶é—´æ®µåŒºé—´ä¸å…¶æœ‰é‡åˆï¼Œè®°å½•æœ€å¤šçš„é‡åˆåŒºé—´æ•°ç›®ï¼Œå³ä¸ºå¾…æ±‚è§£çš„ç­”æ¡ˆã€‚æ˜“çŸ¥ï¼Œæ­¤æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚</p><p>ä¸‹é¢ç»™å‡ºä»£ç ï¼Œ<em>ä»£ç åªç»è¿‡ç®€å•æµ‹è¯•ï¼Œå¦‚æœ‰è¯¯è¯·é€šè¿‡é‚®ç®±è”ç³»æˆ‘</em></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> traitlets <span class="keyword">import</span> Int</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maxPlatform</span>(<span class="params">self, arr: <span class="type">List</span>[Int], dep: <span class="type">List</span>[Int]</span>) -&gt; Int:</span><br><span class="line">        n = <span class="built_in">len</span>(arr)</span><br><span class="line">        max_platform = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            now_platform = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, n):</span><br><span class="line">                <span class="keyword">if</span> dep[i] &gt; arr[j]:</span><br><span class="line">                    now_platform += <span class="number">1</span></span><br><span class="line">                max_platform = <span class="built_in">max</span>(max_platform, now_platform)</span><br><span class="line">        <span class="keyword">return</span> max_platform</span><br></pre></td></tr></table></figure><h1 id="è§£æ³•2"><a href="#è§£æ³•2" class="headerlink" title="è§£æ³•2"></a>è§£æ³•2</h1><p>å°†æ‰€æœ‰çš„<strong>äº‹ä»¶</strong> (åˆ°è¾¾æˆ–ç¦»å¼€)æŒ‰æ—¶é—´é¡ºåºæ’åºï¼Œç„¶ååªè®°å½•å½“å‰è¿˜åœ¨è½¦ç«™ï¼ˆæœªç¦»å¼€çš„ï¼‰åˆ—è½¦ã€‚æ‰€æœ‰æ—¶é—´ç‚¹ä¸­æœ€å¤šæ•°é‡åˆ—è½¦å³å¾…æ±‚è§£çš„ç­”æ¡ˆã€‚è¯¥è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nÂ·logn)</p><p>ä¾‹å¦‚ä¸Šè¿°å‡ºå‘åˆ°è¾¾æ—¶é—´æ’åºå¾—åˆ°ä¸‹è¡¨ï¼š</p><div class="table-container"><table><thead><tr><th>æ—¶é—´</th><th>äº‹ä»¶</th><th>ç«™å°æ•°</th></tr></thead><tbody><tr><td>9:00</td><td>Arrival</td><td>1</td></tr><tr><td>9:10</td><td>Departure</td><td>0</td></tr><tr><td>9:40</td><td>Arrival</td><td>1</td></tr><tr><td>9:50</td><td>Arrival</td><td>2</td></tr><tr><td>11:00</td><td>Arrival</td><td><strong>3</strong></td></tr><tr><td>11:20</td><td>Departure</td><td>2</td></tr><tr><td>11:30</td><td>Departure</td><td>1</td></tr><tr><td>12:00</td><td>Departure</td><td>0</td></tr><tr><td>15:00</td><td>Arrival</td><td>1</td></tr><tr><td>18:00</td><td>Arrival</td><td>2</td></tr><tr><td>19:00</td><td>Departure</td><td>1</td></tr><tr><td>20:00</td><td>Departure</td><td>0</td></tr></tbody></table></div><p>æœ€å¤šéœ€è¦3ç«™å°ã€‚</p><p>åœ¨ç®—æ³•å®ç°æ—¶ï¼Œåªéœ€è¦å¯¹arrã€depæ•°ç»„å•ç‹¬æ’åºï¼Œç„¶ååœ¨è¿›è¡Œæœ‰åºæ•°ç»„çš„å½’å¹¶æ’åºã€‚ä¸‹é¢ç»™å‡ºä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxPlatform</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span>[] dep)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">        Arrays.sort(dep); <span class="comment">//åˆ†åˆ«å¯¹åˆ°è¾¾å’Œç¦»å¼€æ’åº</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">numPlatform</span> <span class="operator">=</span> <span class="number">0</span>, maxPlatform = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; <span class="comment">//ä¸¤ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; n || j &lt; n) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; n &amp;&amp; j &lt; n) &#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[i] &lt; dep[j]) &#123;</span><br><span class="line">                    numPlatform++;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(arr[i] &gt; dep[j])&#123;</span><br><span class="line">                    numPlatform--;</span><br><span class="line">                    j++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    i++;</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(j&gt;=n) &#123; <span class="comment">// æ­¤æ—¶è¿˜å°†ç»§ç»­æœ‰ç«è½¦è¿›ç«™</span></span><br><span class="line">                numPlatform++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// æ­¤æ—¶åªæœ‰ç«è½¦å‡ºç«™</span></span><br><span class="line">                numPlatform--;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            maxPlatform = Math.max(maxPlatform, numPlatform);</span><br><span class="line"><span class="comment">//            System.out.println(numPlatform);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxPlatform;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æ˜¯ä¹‹å‰é‡åˆ°çš„ä¸€é“é¢è¯•é¢˜ï¼ŒæŒºå·§å¦™çš„ã€‚å½“æ—¶æ²¡åšå‡ºæ¥ï¼Œæ•…åšä¸€ä¸ªå°ç»“ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.jianshu.com/p/3948fda91d3d">ç«è½¦ç«™å°æ•°é‡é—®é¢˜</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-åˆè¯†æ³¨è§£</title>
      <link href="/2021/12/23/Java-%E5%88%9D%E8%AF%86%E6%B3%A8%E8%A7%A3/"/>
      <url>/2021/12/23/Java-%E5%88%9D%E8%AF%86%E6%B3%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆè¯†æ³¨è§£"><a href="#åˆè¯†æ³¨è§£" class="headerlink" title="åˆè¯†æ³¨è§£"></a>åˆè¯†æ³¨è§£</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul><li>Annotationæä¾›äº†ä¸€ç§ä¸ºæ’æ—­å…ƒç´ è®¾ç½®å…ƒæ•°æ®çš„æ–¹æ³•ã€‚</li><li>ç±»ä¼¼äºä¿®é¥°ç¬¦ï¼Œå¯ç”¨äºä¿®é¥°åŒ…ã€ç±»ã€æ„é€ å™¨ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ã€å‚æ•°ã€å±€éƒ¨å˜é‡çš„å£°æ˜ã€‚</li><li>Annotationæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥è·å–æŒ‡å®šç¨‹åºå…ƒç´ çš„Annotationå¯¹è±¡ã€‚</li><li>Annotationä¸å½±å“ç¨‹åºä»£ç çš„è¿è¡Œã€‚</li><li>å¦‚æœå¸Œæœ›Annotationåœ¨ç¨‹åºè¿è¡Œæ—¶èµ·ä½œç”¨ï¼Œåªæœ‰é€šè¿‡æŸç§é…å¥—å·¥å…·å¯¹Annotationçš„ä¿¡æ¯è¿›è¡Œè®¿é—®å’Œå¤„ç†ã€‚è®¿é—®å’Œå¤„ç†Annotationçš„å·¥å…·ç»Ÿç§°ä¸ºAPTã€‚</li></ul><h2 id="å†…ç½®æ³¨è§£"><a href="#å†…ç½®æ³¨è§£" class="headerlink" title="å†…ç½®æ³¨è§£"></a>å†…ç½®æ³¨è§£</h2><p>Javaå®šä¹‰äº†ä¸€å¥—æ³¨è§£å¦‚ä¸‹ã€‚</p><ul><li>ä»¥ä¸‹æ³¨è§£åœ¨java.langä¸­ï¼š<ul><li><strong>@Override</strong> - æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ˜¯é‡å†™æ–¹æ³•ã€‚å¦‚æœå‘ç°å…¶çˆ¶ç±»ï¼Œæˆ–è€…æ˜¯å¼•ç”¨çš„æ¥å£ä¸­å¹¶æ²¡æœ‰è¯¥æ–¹æ³•æ—¶ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚</li><li><strong>@Deprecated</strong> - æ ‡è®°è¿‡æ—¶æ–¹æ³•ã€‚å¦‚æœä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä¼šæŠ¥ç¼–è¯‘è­¦å‘Šã€‚</li><li><strong>@SuppressWarnings</strong> - æŒ‡ç¤ºç¼–è¯‘å™¨å»å¿½ç•¥æ³¨è§£ä¸­å£°æ˜çš„è­¦å‘Šã€‚</li><li>@SafeVarargs - Java 7 å¼€å§‹æ”¯æŒï¼Œå¿½ç•¥ä»»ä½•ä½¿ç”¨å‚æ•°ä¸ºæ³›å‹å˜é‡çš„æ–¹æ³•æˆ–æ„é€ å‡½æ•°è°ƒç”¨äº§ç”Ÿçš„è­¦å‘Šã€‚</li><li><strong>@FunctionalInterface</strong> - Java 8 å¼€å§‹æ”¯æŒï¼Œæ ‡è¯†ä¸€ä¸ªåŒ¿åå‡½æ•°æˆ–å‡½æ•°å¼æ¥å£ã€‚</li></ul></li><li>ä»¥ä¸‹æ³¨è§£åœ¨java.lang.annotationä¸­ï¼Œä»–ä»¬ä½œç”¨åœ¨å…¶ä»–æ³¨è§£ä¸­ï¼Œä¹Ÿæˆä¸º<strong>å…ƒæ³¨è§£</strong>ï¼š<ul><li><strong>@Retention</strong> - æ ‡è¯†è¿™ä¸ªæ³¨è§£æ€ä¹ˆä¿å­˜ï¼Œæ˜¯åªåœ¨ä»£ç ä¸­ï¼Œè¿˜æ˜¯ç¼–å…¥classæ–‡ä»¶ä¸­ï¼Œæˆ–è€…æ˜¯åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è®¿é—®ã€‚</li><li>@Documented - æ ‡è®°è¿™äº›æ³¨è§£æ˜¯å¦åŒ…å«åœ¨ç”¨æˆ·æ–‡æ¡£ä¸­ã€‚</li><li><strong>@Target</strong> - æ ‡è®°è¿™ä¸ªæ³¨è§£åº”è¯¥æ˜¯å“ªç§ Java æˆå‘˜ã€‚</li><li><strong>@Inherited</strong> - æ ‡è®°è¿™ä¸ªæ³¨è§£æ˜¯ç»§æ‰¿äºå“ªä¸ªæ³¨è§£ç±»(é»˜è®¤ æ³¨è§£å¹¶æ²¡æœ‰ç»§æ‰¿äºä»»ä½•å­ç±»)<ul><li>è¯¦è§£ï¼šå‡è®¾ï¼Œæˆ‘ä»¬å®šä¹‰äº†æŸä¸ª Annotaionï¼Œå®ƒçš„åç§°æ˜¯ MyAnnotationï¼Œå¹¶ä¸” MyAnnotation è¢«æ ‡æ³¨ä¸º @Inheritedã€‚ç°åœ¨ï¼ŒæŸä¸ªç±» Base ä½¿ç”¨äº†MyAnnotationï¼Œåˆ™ Base â€œå…·æœ‰äº†æ³¨è§£ MyAnnotationâ€ï¼›ç°åœ¨ï¼ŒSub ç»§æ‰¿äº† Baseï¼Œç”±äº MyAnnotation æ˜¯ @Inheritedçš„(å…·æœ‰ç»§æ‰¿æ€§)ï¼Œæ‰€ä»¥ï¼ŒSub ä¹Ÿ â€œå…·æœ‰äº†æ³¨è§£ MyAnnotationâ€ã€‚</li></ul></li><li>@Repeatable - Java 8 å¼€å§‹æ”¯æŒï¼Œæ ‡è¯†æŸæ³¨è§£å¯ä»¥åœ¨åŒä¸€ä¸ªå£°æ˜ä¸Šä½¿ç”¨å¤šæ¬¡ã€‚</li></ul></li></ul><h2 id="Annotationæ¶æ„"><a href="#Annotationæ¶æ„" class="headerlink" title="Annotationæ¶æ„"></a>Annotationæ¶æ„</h2><p><img src="1.jpg" alt="Annotationæ¶æ„"></p><p>ä»ä¸­å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>1ä¸ªAnnotationå¯¹è±¡ï¼Œéƒ½ä¼šæœ‰å”¯ä¸€çš„RetentionPolicyå±æ€§ã€‚</li><li>1 ä¸ª Annotation å¯¹è±¡ï¼Œå¯ä»¥æœ‰è‹¥å¹²ä¸ª ElementType å±æ€§ã€‚</li><li>Annotation æœ‰è®¸å¤šå®ç°ç±»ï¼ŒåŒ…æ‹¬ï¼šDeprecated, Documented, Inherited, Override ç­‰ç­‰ã€‚</li></ol><p>ä¸‹é¢ä»‹ç»ï¼Œåœ¨java Annotationçš„ç»„æˆä¸­ï¼Œæœ‰ä¸‰ä¸ªé‡è¦çš„ä¸»å¹²ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Annotation.java</span></span><br><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Annotation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">toString</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationType();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ElementType.java</span></span><br><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ElementType</span> &#123;</span><br><span class="line">    TYPE,               <span class="comment">/* ç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨é‡Šç±»å‹ï¼‰æˆ–æšä¸¾å£°æ˜  */</span></span><br><span class="line"></span><br><span class="line">    FIELD,              <span class="comment">/* å­—æ®µå£°æ˜ï¼ˆåŒ…æ‹¬æšä¸¾å¸¸é‡ï¼‰  */</span></span><br><span class="line"></span><br><span class="line">    METHOD,             <span class="comment">/* æ–¹æ³•å£°æ˜  */</span></span><br><span class="line"></span><br><span class="line">    PARAMETER,          <span class="comment">/* å‚æ•°å£°æ˜  */</span></span><br><span class="line"></span><br><span class="line">    CONSTRUCTOR,        <span class="comment">/* æ„é€ æ–¹æ³•å£°æ˜  */</span></span><br><span class="line"></span><br><span class="line">    LOCAL_VARIABLE,     <span class="comment">/* å±€éƒ¨å˜é‡å£°æ˜  */</span></span><br><span class="line"></span><br><span class="line">    ANNOTATION_TYPE,    <span class="comment">/* æ³¨é‡Šç±»å‹å£°æ˜  */</span></span><br><span class="line"></span><br><span class="line">    PACKAGE             <span class="comment">/* åŒ…å£°æ˜  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//RetentionPolicy.java</span></span><br><span class="line"><span class="keyword">package</span> java.lang.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RetentionPolicy</span> &#123;</span><br><span class="line">    SOURCE,            <span class="comment">/* Annotationä¿¡æ¯ä»…å­˜åœ¨äºç¼–è¯‘å™¨å¤„ç†æœŸé—´ï¼Œç¼–è¯‘å™¨å¤„ç†å®Œä¹‹åå°±æ²¡æœ‰è¯¥Annotationä¿¡æ¯äº†  */</span></span><br><span class="line"></span><br><span class="line">    CLASS,             <span class="comment">/* ç¼–è¯‘å™¨å°†Annotationå­˜å‚¨äºç±»å¯¹åº”çš„.classæ–‡ä»¶ä¸­ã€‚é»˜è®¤è¡Œä¸º  */</span></span><br><span class="line"></span><br><span class="line">    RUNTIME            <span class="comment">/* ç¼–è¯‘å™¨å°†Annotationå­˜å‚¨äºclassæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯ç”±JVMè¯»å…¥ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li>Annotationæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿è¿™ä¸ªæ¥å£çš„å°±æ˜¯æ³¨è§£ã€‚</li><li><strong>ElementType æ˜¯ Enum æšä¸¾ç±»å‹ï¼Œå®ƒç”¨æ¥æŒ‡å®š Annotation çš„ç±»å‹ã€‚</strong><ol><li>ä¾‹å¦‚ï¼Œè‹¥ä¸€ä¸ª Annotation å¯¹è±¡æ˜¯ METHOD ç±»å‹ï¼Œåˆ™è¯¥ Annotation åªèƒ½ç”¨æ¥ä¿®é¥°æ–¹æ³•ã€‚</li></ol></li><li><strong>RetentionPolicy æ˜¯ Enum æšä¸¾ç±»å‹ï¼Œå®ƒç”¨æ¥æŒ‡å®š Annotation çš„ç­–ç•¥ã€‚é€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯ä¸åŒ RetentionPolicy ç±»å‹çš„ Annotation çš„ä½œç”¨åŸŸä¸åŒã€‚</strong><ol><li>è‹¥ Annotation çš„ç±»å‹ä¸º SOURCEï¼Œåˆ™æ„å‘³ç€ï¼šAnnotation ä»…å­˜åœ¨äºç¼–è¯‘å™¨å¤„ç†æœŸé—´ï¼Œç¼–è¯‘å™¨å¤„ç†å®Œä¹‹åï¼Œè¯¥ Annotation å°±æ²¡ç”¨äº†ã€‚ ä¾‹å¦‚ï¼Œâ€ @Overrideâ€ æ ‡å¿—å°±æ˜¯ä¸€ä¸ª Annotationã€‚å½“å®ƒä¿®é¥°ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå°±æ„å‘³ç€è¯¥æ–¹æ³•è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼›å¹¶ä¸”åœ¨ç¼–è¯‘æœŸé—´ä¼šè¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼ç¼–è¯‘å™¨å¤„ç†å®Œåï¼Œâ€@Overrideâ€ å°±æ²¡æœ‰ä»»ä½•ä½œç”¨äº†ã€‚</li><li>è‹¥ Annotation çš„ç±»å‹ä¸º CLASSï¼Œåˆ™æ„å‘³ç€ï¼šç¼–è¯‘å™¨å°† Annotation å­˜å‚¨äºç±»å¯¹åº”çš„ .class æ–‡ä»¶ä¸­ï¼Œå®ƒæ˜¯ Annotation çš„é»˜è®¤è¡Œä¸ºã€‚</li><li>è‹¥ Annotation çš„ç±»å‹ä¸º RUNTIMEï¼Œåˆ™æ„å‘³ç€ï¼šç¼–è¯‘å™¨å°† Annotation å­˜å‚¨äº class æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¯ç”±JVMè¯»å…¥ã€‚</li></ol></li></ol><h2 id="æ³¨è§£é€šç”¨å®šä¹‰"><a href="#æ³¨è§£é€šç”¨å®šä¹‰" class="headerlink" title="æ³¨è§£é€šç”¨å®šä¹‰"></a>æ³¨è§£é€šç”¨å®šä¹‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation1 &#123;</span><br><span class="line">    <span class="comment">//å±æ€§åˆ—è¡¨</span></span><br><span class="line">    <span class="comment">//Annotationçš„æˆå‘˜å˜é‡åœ¨Annotationå®šä¹‰ä¸­ä»¥æ— å½¢å‚æ–¹æ³•å½¢å¼æ¥å£°æ˜ï¼Œå…¶æ–¹æ³•åå’Œè¿”å›å€¼å®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„åå­—å’Œç±»å‹ã€‚</span></span><br><span class="line">    <span class="comment">//æ³¨è§£å…ƒç´ çš„ç±»å‹å¯ä»¥ä¸ºï¼šåŸºæœ¬ç±»å‹ï¼ŒStringï¼ŒClassï¼Œæšä¸¾ç±»å‹ï¼Œæ³¨è§£ç±»å‹ï¼Œä»¥åŠå‰é¢æ‰€è¿°ç±»å‹ç»„æˆçš„æ•°ç»„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šä¸Šé¢çš„ä½œç”¨æ˜¯å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ï¼Œåä¸ºMyAnnotation1ã€‚å®šä¹‰äº†MyAnnotation1ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡@MyAnnotation1ä½¿ç”¨å®ƒã€‚å…¶ä»–çš„ï¼Œ@Documented, @Target, @Retention, @interfaceéƒ½æ˜¯æ¥ä¿®é¥°MyAnnotation1çš„ã€‚</p><ul><li><p><strong>@interface</strong>ï¼šä½¿ç”¨ @interface <strong>å…³é”®å­—</strong>å®šä¹‰æ³¨è§£æ—¶ï¼Œæ„å‘³ç€å®ƒå®ç°äº†java.lang.annotation.Annotation æ¥å£ï¼Œå³è¯¥æ³¨è§£å°±æ˜¯ä¸€ä¸ªAnnotationã€‚</p></li><li><p><strong>@Documented</strong>ï¼šç±»å’Œæ–¹æ³•çš„ Annotation åœ¨ç¼ºçœæƒ…å†µä¸‹æ˜¯ä¸å‡ºç°åœ¨ javadoc ä¸­çš„ã€‚å¦‚æœä½¿ç”¨ @Documented ä¿®é¥°è¯¥ Annotationï¼Œåˆ™è¡¨ç¤ºå®ƒå¯ä»¥å‡ºç°åœ¨ javadoc ä¸­ã€‚å®šä¹‰ Annotation æ—¶ï¼Œ@Documented å¯æœ‰å¯æ— ï¼›è‹¥æ²¡æœ‰å®šä¹‰ï¼Œåˆ™ Annotation ä¸ä¼šå‡ºç°åœ¨ javadoc ä¸­ã€‚</p></li><li><p><strong>@Target(ElementType.TYPE)</strong>ï¼šElementType æ˜¯ Annotation çš„ç±»å‹å±æ€§ã€‚è€Œ @Target çš„ä½œç”¨ï¼Œå°±æ˜¯æ¥æŒ‡å®š Annotation çš„ç±»å‹å±æ€§ã€‚</p><p>@Target(ElementType.TYPE) çš„æ„æ€å°±æ˜¯æŒ‡å®šè¯¥ Annotation çš„ç±»å‹æ˜¯ ElementType.TYPEã€‚è¿™å°±æ„å‘³ç€ï¼ŒMyAnnotation1 æ˜¯æ¥ä¿®é¥°â€ç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨é‡Šç±»å‹ï¼‰æˆ–æšä¸¾å£°æ˜â€çš„æ³¨è§£ã€‚</p><p>å®šä¹‰ Annotation æ—¶ï¼Œ@Target å¯æœ‰å¯æ— ã€‚è‹¥æœ‰ @Targetï¼Œåˆ™è¯¥ Annotation åªèƒ½ç”¨äºå®ƒæ‰€æŒ‡å®šçš„åœ°æ–¹ï¼›è‹¥æ²¡æœ‰ @Targetï¼Œåˆ™è¯¥ Annotation å¯ä»¥ç”¨äºä»»ä½•åœ°æ–¹ã€‚</p></li><li><p><strong>@Retention(RetentionPolicy.RUNTIME)</strong>ï¼šå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒRetentionPolicy æ˜¯ Annotation çš„ç­–ç•¥å±æ€§ï¼Œè€Œ @Retention çš„ä½œç”¨ï¼Œå°±æ˜¯æŒ‡å®š Annotation çš„ç­–ç•¥å±æ€§ã€‚</p><p>@Retention(RetentionPolicy.RUNTIME) çš„æ„æ€å°±æ˜¯æŒ‡å®šè¯¥ Annotation çš„ç­–ç•¥æ˜¯ RetentionPolicy.RUNTIMEã€‚è¿™å°±æ„å‘³ç€ï¼Œç¼–è¯‘å™¨ä¼šå°†è¯¥ Annotation ä¿¡æ¯ä¿ç•™åœ¨ .class æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”èƒ½è¢«è™šæ‹Ÿæœºè¯»å–ã€‚</p><p>å®šä¹‰ Annotation æ—¶ï¼Œ@Retention å¯æœ‰å¯æ— ã€‚è‹¥æ²¡æœ‰ @Retentionï¼Œåˆ™é»˜è®¤æ˜¯ RetentionPolicy.CLASSã€‚</p></li></ul><p>æ ¹æ®æ³¨è§£æ˜¯å¦åŒ…å«æˆå‘˜å˜é‡ï¼Œå¯ä»¥æŠŠæ³¨è§£åˆ†ä¸º</p><ul><li>æ ‡è®°æ³¨è§£ï¼šæ²¡æœ‰æˆå‘˜å˜é‡çš„æ³¨è§£ï¼Œè¿™ç§æ³¨è§£ä»…åˆ©ç”¨è‡ªèº«æ˜¯å¦å­˜åœ¨æ¥æä¾›ä¿¡æ¯ã€‚</li><li>å…ƒæ•°æ®æ³¨è§£ï¼šåŒ…å«æˆå‘˜å˜é‡çš„æ³¨è§£ï¼Œå› ä¸ºå®ƒå¯ä»¥æ¥å—æ›´å¤šçš„å…ƒæ•°æ®ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸ºå…ƒæ•°æ®æ³¨è§£ã€‚</li></ul><h2 id="Annotationä½œç”¨"><a href="#Annotationä½œç”¨" class="headerlink" title="Annotationä½œç”¨"></a>Annotationä½œç”¨</h2><h3 id="ç¼–è¯‘æ£€æŸ¥"><a href="#ç¼–è¯‘æ£€æŸ¥" class="headerlink" title="ç¼–è¯‘æ£€æŸ¥"></a>ç¼–è¯‘æ£€æŸ¥</h3><p>Annotation å…·æœ‰â€è®©ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ£€æŸ¥çš„ä½œç”¨â€ã€‚@SuppressWarnings, @Deprecated å’Œ @Override éƒ½å…·æœ‰ç¼–è¯‘æ£€æŸ¥ä½œç”¨ã€‚</p><h3 id="â˜†åœ¨åå°„ä¸­è§£æå¹¶ä½¿ç”¨-Annotation"><a href="#â˜†åœ¨åå°„ä¸­è§£æå¹¶ä½¿ç”¨-Annotation" class="headerlink" title="â˜†åœ¨åå°„ä¸­è§£æå¹¶ä½¿ç”¨ Annotation"></a>â˜†åœ¨åå°„ä¸­è§£æå¹¶ä½¿ç”¨ Annotation</h3><p>ç¨‹åºé€šè¿‡åå°„æœºåˆ¶å¯ä»¥è§£æè¢«ä¿®é¥°çš„æ–¹æ³•ä¸­çš„æ³¨è§£æ•°æ®ï¼Œå½“ç¨‹åºè·å–ç‰¹æ®Šæ ‡è®°åï¼Œå¯ä»¥åšå‡ºç›¸åº”çš„å¤„ç†ã€‚è¿™åœ¨Springç­‰æ¡†æ¶ä¸­ç»å¸¸ä½¿ç”¨ã€‚è¯¦è§ä¸‹é¢ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//AnnotationTest.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotationåœ¨åå°„å‡½æ•°ä¸­çš„ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@interface</span> MyAnnotation &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * è¯´æ˜ï¼šåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠvalue()çœ‹æˆä¸€ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒåçš„å˜é‡</span></span><br><span class="line"><span class="comment">     * åœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥é€šè¿‡@MyAnnotation(value=&#123;&quot;a&quot;,&quot;b&quot;&#125;æ¥èµ‹å€¼</span></span><br><span class="line"><span class="comment">     * default ç»™valueåˆ¶å®šäº†é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ³¨è§£çš„å±æ€§åªæœ‰ä¸€ä¸ªï¼Œä¸”å«valueï¼Œé‚£ä¹ˆä½¿ç”¨è¯¥æ³¨è§£æ—¶ï¼Œå¯ä»¥ä¸ç”¨æŒ‡å®šå±æ€§åï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯ç»™valueèµ‹å€¼ï¼š</span></span><br><span class="line"><span class="comment">     * @MyAnnotation(&#123;&quot;a&quot;,&quot;b&quot;&#125;) //è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">    String[] value() default &quot;unknown&quot;;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Personç±»ã€‚å®ƒä¼šä½¿ç”¨MyAnnotationæ³¨è§£ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * empty()æ–¹æ³•åŒæ—¶è¢« &quot;<span class="doctag">@Deprecated</span>&quot; å’Œ &quot;<span class="doctag">@MyAnnotation</span>(value=&#123;&quot;a&quot;,&quot;b&quot;&#125;)&quot;æ‰€æ ‡æ³¨</span></span><br><span class="line"><span class="comment">     * (01) <span class="doctag">@Deprecated</span>ï¼Œæ„å‘³ç€empty()æ–¹æ³•ï¼Œä¸å†è¢«å»ºè®®ä½¿ç”¨</span></span><br><span class="line"><span class="comment">     * (02) <span class="doctag">@MyAnnotation</span>, æ„å‘³ç€empty() æ–¹æ³•å¯¹åº”çš„MyAnnotationçš„valueå€¼æ˜¯é»˜è®¤å€¼&quot;unknown&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MyAnnotation</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">empty</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\nempty&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * sombody() è¢« <span class="doctag">@MyAnnotation</span>(value=&#123;&quot;girl&quot;,&quot;boy&quot;&#125;) æ‰€æ ‡æ³¨ï¼Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MyAnnotation</span>(value=&#123;&quot;girl&quot;,&quot;boy&quot;&#125;), æ„å‘³ç€MyAnnotationçš„valueå€¼æ˜¯&#123;&quot;girl&quot;,&quot;boy&quot;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@MyAnnotation(value=&#123;&quot;girl&quot;,&quot;boy&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">somebody</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\nsomebody: &quot;</span>+name+<span class="string">&quot;, &quot;</span>+age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// æ–°å»ºPerson</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="comment">// è·å–Personçš„Classå®ä¾‹</span></span><br><span class="line">        Class&lt;Person&gt; c = Person.class;</span><br><span class="line">        <span class="comment">// è·å– somebody() æ–¹æ³•çš„Methodå®ä¾‹</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">mSomebody</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;somebody&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, <span class="type">int</span>.class&#125;);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">        mSomebody.invoke(person, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;lily&quot;</span>, <span class="number">18</span>&#125;);</span><br><span class="line">        iteratorAnnotations(mSomebody);</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å– somebody() æ–¹æ³•çš„Methodå®ä¾‹</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">mEmpty</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;empty&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">        mEmpty.invoke(person, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);        </span><br><span class="line">        iteratorAnnotations(mEmpty);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">iteratorAnnotations</span><span class="params">(Method method)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­ somebody() æ–¹æ³•æ˜¯å¦åŒ…å«MyAnnotationæ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span>(method.isAnnotationPresent(MyAnnotation.class))&#123;</span><br><span class="line">            <span class="comment">// è·å–è¯¥æ–¹æ³•çš„MyAnnotationæ³¨è§£å®ä¾‹</span></span><br><span class="line">            <span class="type">MyAnnotation</span> <span class="variable">myAnnotation</span> <span class="operator">=</span> method.getAnnotation(MyAnnotation.class);</span><br><span class="line">            <span class="comment">// è·å– myAnnotationçš„å€¼ï¼Œå¹¶æ‰“å°å‡ºæ¥</span></span><br><span class="line">            String[] values = myAnnotation.value();</span><br><span class="line">            <span class="keyword">for</span> (String str:values)</span><br><span class="line">                System.out.printf(str+<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// è·å–æ–¹æ³•ä¸Šçš„æ‰€æœ‰æ³¨è§£ï¼Œå¹¶æ‰“å°å‡ºæ¥</span></span><br><span class="line">        Annotation[] annotations = method.getAnnotations();</span><br><span class="line">        <span class="keyword">for</span>(Annotation annotation : annotations)&#123;</span><br><span class="line">            System.out.println(annotation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">somebody: lily, 18</span><br><span class="line">girl, boy, </span><br><span class="line">@com.skywang.annotation.MyAnnotation(value=[girl, boy])</span><br><span class="line"></span><br><span class="line">empty</span><br><span class="line">unknown, </span><br><span class="line">@com.skywang.annotation.MyAnnotation(value=[unknown])</span><br><span class="line">@java.lang.Deprecated()</span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®Annotationç”Ÿæˆå¸®åŠ©æ–‡æ¡£"><a href="#æ ¹æ®Annotationç”Ÿæˆå¸®åŠ©æ–‡æ¡£" class="headerlink" title="æ ¹æ®Annotationç”Ÿæˆå¸®åŠ©æ–‡æ¡£"></a>æ ¹æ®Annotationç”Ÿæˆå¸®åŠ©æ–‡æ¡£</h3><p>@Documented</p><h3 id="å¸®å¿™æŸ¥çœ‹ä»£ç "><a href="#å¸®å¿™æŸ¥çœ‹ä»£ç " class="headerlink" title="å¸®å¿™æŸ¥çœ‹ä»£ç "></a>å¸®å¿™æŸ¥çœ‹ä»£ç </h3><p>é€šè¿‡ @Override, @Deprecated ç­‰ï¼Œæˆ‘ä»¬èƒ½å¾ˆæ–¹ä¾¿çš„äº†è§£ç¨‹åºçš„å¤§è‡´ç»“æ„ã€‚</p><h3 id="é™„å±æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆ"><a href="#é™„å±æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="é™„å±æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆ"></a>é™„å±æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆ</h3><p>ä¾‹å¦‚éƒ¨ç½²æè¿°ç¬¦æˆ–è€…beanä¿¡æ¯ç±»ã€‚</p><h3 id="æµ‹è¯•ã€æ—¥å¿—ç­‰ä»£ç çš„è‡ªåŠ¨ç”Ÿæˆ"><a href="#æµ‹è¯•ã€æ—¥å¿—ç­‰ä»£ç çš„è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="æµ‹è¯•ã€æ—¥å¿—ç­‰ä»£ç çš„è‡ªåŠ¨ç”Ÿæˆ"></a>æµ‹è¯•ã€æ—¥å¿—ç­‰ä»£ç çš„è‡ªåŠ¨ç”Ÿæˆ</h3><p>//TODO</p><h2 id="æ¡†æ¶ä¸­å¸¸ç”¨çš„æ³¨è§£"><a href="#æ¡†æ¶ä¸­å¸¸ç”¨çš„æ³¨è§£" class="headerlink" title="æ¡†æ¶ä¸­å¸¸ç”¨çš„æ³¨è§£"></a>æ¡†æ¶ä¸­å¸¸ç”¨çš„æ³¨è§£</h2><h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><p>//TODO</p><h3 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h3><p>//TODO</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul><li><p>æ³¨è§£å°±åƒæ ‡ç­¾ï¼Œæ˜¯ç¨‹åºåˆ¤æ–­æ‰§è¡Œçš„ä¾æ®ã€‚æ¯”å¦‚ï¼Œç¨‹åºè¯»åˆ°@Testå°±çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯å¾…æµ‹è¯•æ–¹æ³•ï¼Œè€Œ@Beforeçš„æ–¹æ³•è¦åœ¨æµ‹è¯•æ–¹æ³•ä¹‹å‰æ‰§è¡Œ</p></li><li><p>æ³¨è§£éœ€è¦ä¸‰è¦ç´ ï¼šå®šä¹‰ã€ä½¿ç”¨ã€<strong>è¯»å–å¹¶æ‰§è¡Œ</strong></p></li><li>æ³¨è§£åˆ†ä¸ºè‡ªå®šä¹‰æ³¨è§£ã€JDKå†…ç½®æ³¨è§£å’Œç¬¬ä¸‰æ–¹æ³¨è§£ï¼ˆæ¡†æ¶ï¼‰ã€‚è‡ªå®šä¹‰æ³¨è§£ä¸€èˆ¬è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰ã€ä½¿ç”¨ã€å¹¶å†™ç¨‹åºè¯»å–ï¼Œè€ŒJDKå†…ç½®æ³¨è§£å’Œç¬¬ä¸‰æ–¹æ³¨è§£æˆ‘ä»¬åªè¦ä½¿ç”¨ï¼Œå®šä¹‰å’Œè¯»å–éƒ½äº¤ç»™å®ƒä»¬</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸‰è§’å…³ç³»ä¸­æˆ‘ä»¬åªè´Ÿè´£ä½¿ç”¨æ³¨è§£ï¼Œæ— éœ€å®šä¹‰å’Œæ‰§è¡Œï¼Œæ¡†æ¶ä¼šå°†æ³¨è§£ç±»å’Œè¯»å–æ³¨è§£çš„ç¨‹åºéšè—èµ·æ¥ï¼Œé™¤éé˜…è¯»æºç ï¼Œå¦åˆ™æ ¹æœ¬çœ‹ä¸åˆ°ã€‚å¹³æ—¶è§ä¸åˆ°å®šä¹‰å’Œè¯»å–çš„è¿‡ç¨‹ï¼Œå…‰é¡¾ç€ä½¿ç”¨æ³¨è§£ï¼Œä¹…è€Œä¹…ä¹‹å¾ˆå¤šäººå°±å¿˜äº†æ³¨è§£å¦‚ä½•èµ·ä½œç”¨äº†ï¼</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.zhihu.com/question/47449512/answer/658228092">æ€æ ·ç†è§£ Java æ³¨è§£å’Œè¿ç”¨æ³¨è§£ç¼–ç¨‹ï¼Ÿ</a></li><li><a href="https://www.runoob.com/w3cnote/java-annotation.html">èœé¸Ÿæ•™ç¨‹-Java æ³¨è§£ï¼ˆAnnotationï¼‰</a></li><li>ã€ŠJavaç–¯ç‹‚è®²ä¹‰ ç¬¬åå››ç«  æ³¨è§£ã€‹</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–å†™è„šæœ¬è¯»å–æ–‡ä»¶å¹¶æ‰§è¡Œå‘½ä»¤</title>
      <link href="/2021/12/21/%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%B9%B6%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/"/>
      <url>/2021/12/21/%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%B9%B6%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°å¦‚ä¸‹éœ€æ±‚ï¼š</p><blockquote><p>æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼å¤§æ¦‚æ˜¯è¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;filename1&gt;\t&lt;download_url1&gt;</span><br><span class="line"></span><br><span class="line">&lt;filename2&gt;\t&lt;download_url2&gt;</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªè„šæœ¬å¾ªç¯è¯»å–è¯¥æ–‡ä»¶çš„æ¯ä¸€è¡Œï¼Œä½¿ç”¨<code>axel</code>å‘½ä»¤å°†<code>download_url</code>ä¸‹è½½ä¸‹æ¥ï¼Œä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶<code>filename</code></p></blockquote><h1 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h1><p>å…ˆç»™å‡ºCodeï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ./download.sh &lt;filename&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$1</span> | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="comment"># echo $&#123;line&#125;</span></span><br><span class="line">    array=(<span class="variable">$&#123;line// / &#125;</span>) <span class="comment"># array=($&#123;line//\t/ &#125;) ä¸ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="comment"># echo $&#123;array[0]&#125; + &quot;;&quot; + $&#123;array[1]&#125; </span></span><br><span class="line">    cmd=<span class="string">&#x27;axel -o &#x27;</span><span class="variable">$&#123;array[0]&#125;</span><span class="string">&#x27; &quot;&#x27;</span><span class="variable">$&#123;array[1]&#125;</span><span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$cmd</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¯¹codeé€ä¸€è§£é‡Š</p><h2 id="bin-bash"><a href="#bin-bash" class="headerlink" title="#! /bin/bash"></a>#! /bin/bash</h2><p><strong>#!/bin/bash</strong>æ˜¯æŒ‡æ­¤è„šæœ¬ä½¿ç”¨<strong>/bin/bash</strong>æ¥è§£é‡Šæ‰§è¡Œï¼ŒBashè„šæœ¬é¦–è¡Œå›ºå®šå†™æ³•ã€‚</p><h2 id="Bashæ³¨é‡Š"><a href="#Bashæ³¨é‡Š" class="headerlink" title="Bashæ³¨é‡Š"></a>Bashæ³¨é‡Š</h2><p>Bashä¸­ä½¿ç”¨<code>#</code>è¿›è¡Œå•è¡Œæ³¨é‡Šï¼Œè§å¦‚ä¸Šä»£ç ç¬¬ä¸‰è¡Œ</p><h2 id="Bash-æ¥æ”¶å¤–éƒ¨å‚æ•°"><a href="#Bash-æ¥æ”¶å¤–éƒ¨å‚æ•°" class="headerlink" title="Bash æ¥æ”¶å¤–éƒ¨å‚æ•°"></a>Bash æ¥æ”¶å¤–éƒ¨å‚æ•°</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œ Shell è„šæœ¬æ—¶ï¼Œå‘è„šæœ¬ä¼ é€’å‚æ•°ï¼Œè„šæœ¬å†…è·å–å‚æ•°çš„æ ¼å¼ä¸ºï¼š<strong>$n</strong>ã€‚<strong>n</strong> ä»£è¡¨ä¸€ä¸ªæ•°å­—ï¼Œ1 ä¸ºæ‰§è¡Œè„šæœ¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ2 ä¸ºæ‰§è¡Œè„šæœ¬çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦</p><p>ç‰¹æ®Šçš„ ï¼Œ<strong>$0</strong> è¡¨ç¤ºè„šæœ¬åç§°ï¼ˆå«è·¯å¾„ï¼‰ã€‚</p><p>å¦å¤–ï¼Œ<strong>$#</strong> è¡¨ç¤ºä¼ é€’å‚æ•°çš„ä¸ªæ•°ã€‚</p><p>ä¸Šé¢ä»£ç ä¸­<code>cat $1 |</code>å°±æ˜¯å°†ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ–‡ä»¶åï¼Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œé€šè¿‡ç®¡é“å‘½ä»¤<code>|</code>å°†æ–‡ä»¶å†…å®¹ä¼ ç»™whileå¾ªç¯</p><h2 id="Bash-å¾ªç¯è¯»å–æ¯ä¸€è¡Œ"><a href="#Bash-å¾ªç¯è¯»å–æ¯ä¸€è¡Œ" class="headerlink" title="Bash å¾ªç¯è¯»å–æ¯ä¸€è¡Œ"></a>Bash å¾ªç¯è¯»å–æ¯ä¸€è¡Œ</h2><p>æœ€ç®€å•çš„</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨forå¾ªç¯ç­‰ï¼Œè¯¦ç»†å¯å‚è§å‚è€ƒèµ„æ–™1ã€‚</p><h2 id="BashæŒ‰æŒ‡å®šå­—ç¬¦åˆ†å‰²å­—ç¬¦ä¸²"><a href="#BashæŒ‰æŒ‡å®šå­—ç¬¦åˆ†å‰²å­—ç¬¦ä¸²" class="headerlink" title="BashæŒ‰æŒ‡å®šå­—ç¬¦åˆ†å‰²å­—ç¬¦ä¸²"></a>BashæŒ‰æŒ‡å®šå­—ç¬¦åˆ†å‰²å­—ç¬¦ä¸²</h2><p>æ¥ä¸Šæ–‡ï¼Œlineæ˜¯å¾…å¤„ç†çš„å­—ç¬¦ä¸²ï¼Œåˆ™æŒ‡å®šåˆ†éš”ç¬¦<code>\t</code>å°†lineåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„å­˜æ”¾åˆ°arrayï¼Œ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">array=(<span class="variable">$&#123;line// / &#125;</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œ<code>//</code>å’Œ<code>/</code>ä¹‹é—´æ˜¯ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼Œè€Œä¸æ˜¯ç©ºæ ¼ã€‚</p><p>æˆ‘ä¹Ÿæ›¾ä½¿ç”¨<code>array=($&#123;line//\t/ &#125;)</code>æ¥è¿›è¡Œåˆ†å‰²ï¼Œä½†æ˜¯æµ‹è¯•åå‘ç°å®ƒä¼šæŒ‰ç…§å­—ç¬¦<code>t</code>å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²ã€‚</p><p><em>è¿˜æ²¡å¼„æ˜ç™½è¯­æ³•è§„åˆ™</em></p><h2 id="Bashå­—ç¬¦ä¸²æ‹¼æ¥"><a href="#Bashå­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="Bashå­—ç¬¦ä¸²æ‹¼æ¥"></a>Bashå­—ç¬¦ä¸²æ‹¼æ¥</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmd=<span class="string">&#x27;axel -o &#x27;</span><span class="variable">$&#123;array[0]&#125;</span><span class="string">&#x27; &quot;&#x27;</span><span class="variable">$&#123;array[1]&#125;</span><span class="string">&#x27;&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€è¡Œå°±æ˜¯å–arrayä¸­çš„å€¼è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæ³¨æ„å–å€¼çš„è¯­æ³•<code>$&#123;&#125;</code></p><ul><li><p>Bashä¸­å¯¹å­—ç¬¦ä¸²æ‹¼æ¥ä¸éœ€è¦ä½¿ç”¨<code>+</code>è¿›è¡Œè¿æ¥</p></li><li><p>è¿™é‡Œä½¿ç”¨å•å¼•å·æ˜¯ä¸ºäº†é¿å…å¯¹åŒå¼•å·è½¬ä¹‰</p></li></ul><h2 id="Bashæ‰§è¡Œcmd"><a href="#Bashæ‰§è¡Œcmd" class="headerlink" title="Bashæ‰§è¡Œcmd"></a>Bashæ‰§è¡Œcmd</h2><p><code>eval $cmd</code>æ˜¯è¯»å–å˜é‡cmdçš„å€¼å½“ä½œä¸€æ¡Shellå‘½ä»¤è¿›è¡Œæ‰§è¡Œ</p><h2 id="æ”¹è¿›"><a href="#æ”¹è¿›" class="headerlink" title="æ”¹è¿›"></a>æ”¹è¿›</h2><p>ä¸Šé¢çš„ä»£ç å…ˆè¯»å–æ¯ä¸€è¡Œï¼Œåœ¨å¯¹è¡ŒæŒ‰ç…§åˆ¶è¡¨ç¬¦è¿›è¡Œåˆ†å‰²ã€‚å…¶å®å¯ä»¥æ›´ç®€æ´ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> filenameurl</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment">#echo $filename</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>åŒæ ·çš„éœ€è¦æ³¨æ„<code>filename</code>ï¼Œ<code>url</code>ä¹‹é—´æ˜¯ä¸€ä¸ªåˆ¶è¡¨ç¬¦è€Œä¸æ˜¯ç©ºæ ¼ã€‚</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å½“urlè¿‡é•¿æ—¶ï¼Œè¯¥è„šæœ¬å¹¶ä¸èƒ½å®Œæ•´çš„è¯»å–urlã€‚ä¾‹å¦‚ï¼Œå½“æ–‡ä»¶å¦‚ä¸‹æ—¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">covid19-image-dataset-collection-volumes-folder.ziphttps://storage.googleapis.com/kaggle-data-sets/862993/1470970/bundle/archive.zip?X-Goog-Algorithm=GOOG4-RSA-SHA256&amp;X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com%2F20211221%2Fauto%2Fstorage%2Fgoog4_request&amp;X-Goog-Date=20211221T052609Z&amp;X-Goog-Expires=259199&amp;X-Goog-SignedHeaders=host&amp;X-Goog-Signature=6549111df89ca0440058e7061ba9a13d72ea22ed7bcfdbcfc56ddadaf7a54ec4d3285487b269808d60cf0568264db1803899989475d8ca0aeec0777891f54df612a6a8f7ba808c8df3899feda1a94ca0507a580e407c0e42371d97e3ce1c75d598bed1f693bf841f7d4660294488e99fc944d6e1498c5ec38b431b969e5f13eda5f2d8029e855ea368c57eab60897a32f7556df116a96bfd321dd4d214dfe847d4c8ca11fdb7c3472ebac9f7a9eb20b44a148df51ecb2f93acdc5459800a894cdc2d62a0cc2c2e42e6711e568827f44b82d6faaa02aa1357c8d93140eb2c72bde9b8c1716e565800ac3ff812df304ce7a54c2a83896696ac5fa935329afa66ef</span><br></pre></td></tr></table></figure><p>è¯»å–å¹¶æ‹¼æ¥åçš„å‘½ä»¤å­—ç¬¦ä¸²å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">axel -o covid19-image-dataset-collection-volumes-folder.zip &quot;https://storage.googleapis.com/kaggle-data-sets/862993/1470970/bundle/archive.zip?X-Goog-Algorithm=GOOG4-RSA-SHA256&amp;X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com%2F20211221%2Fauto%2Fstorage%2Fgoog4_request&amp;X-Goog-Date=20211221T052609Z&amp;X-Goog-Expires=259199&amp;X-Goog-SignedHeaders=host&amp;X-Goog-Signature=6549111df89ca0440058e7061ba9a13d72ea22ed7bcfdbcfc56ddadaf7a54ec4d3285487b269808d60cf0568264db1803899989475d8ca0aeec0777891f54df612a6a8f7ba808c8df3899feda1a94ca0507a580e407c0e42371d97e3ce1c75d598bed1f693bf841f7d4660294488e99fc944d6e1498c5ec38b431b969e5f13eda5f2d8029e855ea368c57eab60897a32f7556df116a96bfd321dd4d214dfe847d4c8ca11fdb7c3472ebac9f7a9eb20b44a148df51ecb2f93acdc5459800a894cdc2d62a0cc2c2e42e6711e568827f44b82d6faaa02aa1357c8d93140eb2c72bde9b8c1716e565800ac3ff812df304ce7a54c2a83896696ac5fa9353&quot;9afa66ef</span><br></pre></td></tr></table></figure><p>æ³¨æ„å¼•å·å¤–é¢è¿˜æœ‰æ•°æ®ï¼Œè¿™æ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ã€‚</p><p><em>ç›®å‰è¿˜æ²¡æœ‰è§£å†³è¯¥é—®é¢˜</em></p><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>ç”±äºæœ¬äººå¯¹Bashä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥æ”¹ç”¨Pythonæ¥å®Œæˆè¿™ä¸€éœ€æ±‚ã€‚</p><p>ä¸‹é¢ç»™å‡ºå®Œæ•´ä»£ç </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#python download.py -f list</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;download kaggle dataset according to file&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-f&#x27;</span>, <span class="string">&#x27;--filename&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    filename = args.filename</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.readlines()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        arr = line.split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        save_name = arr[<span class="number">0</span>]</span><br><span class="line">        url = arr[<span class="number">1</span>].replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        cmd = <span class="string">&#x27;axel -o &#x27;</span> + save_name + <span class="string">&#x27; &quot;&#x27;</span> + url + <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">        <span class="comment"># print(cmd)</span></span><br><span class="line">        res_f = os.popen(cmd)  <span class="comment"># è¿”å›çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">        <span class="built_in">print</span>(res_f.read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="Python-mainå‡½æ•°"><a href="#Python-mainå‡½æ•°" class="headerlink" title="Python mainå‡½æ•°"></a>Python mainå‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯Pythonçš„mainå‡½æ•°ï¼ŒPythonè„šæœ¬æ€»ä¼šä»è¯¥â€œå‡½æ•°â€œè¿›å…¥ã€‚</p><h2 id="Python-æ¥æ”¶å¤–éƒ¨å‚æ•°"><a href="#Python-æ¥æ”¶å¤–éƒ¨å‚æ•°" class="headerlink" title="Python æ¥æ”¶å¤–éƒ¨å‚æ•°"></a>Python æ¥æ”¶å¤–éƒ¨å‚æ•°</h2><p>ä½¿ç”¨ç±»åº“<code>argparse</code>æ¥è¯»å–å¤–éƒ¨å‚æ•°ã€‚ä¸Šè¿°ä»£ç ç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">parser = argparse.ArgumentParser(description=<span class="string">&quot;download kaggle dataset according to file&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ç¬¬ä¸€ã€äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šå‚æ•°åï¼Œç¬¬ä¸€ä¸ªæ˜¯ç®€å†™å½¢å¼</span></span><br><span class="line"><span class="string">åœ¨è°ƒç”¨å‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨python script.py -f &lt;param&gt;æˆ–è€…python script.py --filename &lt;param&gt;</span></span><br><span class="line"><span class="string">required=True è¡¨ç¤ºè¯¥å‚æ•°å¿…å¡«</span></span><br><span class="line"><span class="string">type=str æŒ‡å®šå‚æ•°ç±»å‹</span></span><br><span class="line"><span class="string">help=&#x27;filename&#x27; æŒ‡å®šæç¤ºè¯­</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">parser.add_argument(<span class="string">&#x27;-f&#x27;</span>, <span class="string">&#x27;--filename&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;filename&#x27;</span> æŒ‡å®šæç¤ºè¯­)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">filename = args.filename  <span class="comment"># filenameå­˜æ”¾äº†å¤–éƒ¨å‚æ•°çš„å€¼</span></span><br></pre></td></tr></table></figure><p>è¯¦ç»†è¯·å‚è§<code>å‚è€ƒèµ„æ–™2</code></p><h2 id="Pythonæ–‡ä»¶ã€å­—ç¬¦ä¸²æ“ä½œ"><a href="#Pythonæ–‡ä»¶ã€å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="Pythonæ–‡ä»¶ã€å­—ç¬¦ä¸²æ“ä½œ"></a>Pythonæ–‡ä»¶ã€å­—ç¬¦ä¸²æ“ä½œ</h2><p>ç•¥</p><h2 id="åœ¨Pythonä¸­æ‰§è¡ŒShellå‘½ä»¤"><a href="#åœ¨Pythonä¸­æ‰§è¡ŒShellå‘½ä»¤" class="headerlink" title="åœ¨Pythonä¸­æ‰§è¡ŒShellå‘½ä»¤"></a>åœ¨Pythonä¸­æ‰§è¡ŒShellå‘½ä»¤</h2><p>æœ‰ä¸¤ç§æ–¹å¼ã€‚ä½¿ç”¨<code>os.system(&quot;command&quot;)</code>æ‰§è¡Œæ— è¿”å›å€¼çš„Shellå‘½ä»¤ï¼›ä½¿ç”¨<code>f = os.popen(&quot;command&quot;)</code>æ‰§è¡Œæœ‰è¾“å‡ºçš„Shellå‘½ä»¤ï¼Œå…¶è¿”å›å€¼<code>f</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œé€šè¿‡<code>f.read()</code>æ¥è¯»å–å‘½ä»¤è¾“å‡ºå†…å®¹ã€‚</p><hr><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="http://c.biancheng.net/shell/">Shell è„šæœ¬å­¦ä¹ æŒ‡å—</a></li><li><a href="https://docs.python.org/zh-cn/3/howto/argparse.html">Python Argparse æ•™ç¨‹</a></li><li><a href="https://blog.csdn.net/qq_27825451/article/details/102909772">pythonæ‰§è¡Œshellè„šæœ¬çš„å‡ ç§æ–¹æ³•</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Scripts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Linux Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”°å¿Œèµ›é©¬ä¸è´ªå¿ƒæ³•åˆ™</title>
      <link href="/2021/12/20/%E7%94%B0%E5%BF%8C%E8%B5%9B%E9%A9%AC%E4%B8%8E%E8%B4%AA%E5%BF%83%E6%B3%95%E5%88%99/"/>
      <url>/2021/12/20/%E7%94%B0%E5%BF%8C%E8%B5%9B%E9%A9%AC%E4%B8%8E%E8%B4%AA%E5%BF%83%E6%B3%95%E5%88%99/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ¶‰åŠ<em><a href="https://leetcode-cn.com/problems/advantage-shuffle/">LeetCode 870. ä¼˜åŠ¿æ´—ç‰Œ</a></em></p><blockquote><p>ç»™å®šä¸¤ä¸ªå¤§å°ç›¸ç­‰çš„æ•°ç»„ A å’Œ Bï¼ŒA ç›¸å¯¹äº B çš„ä¼˜åŠ¿å¯ä»¥ç”¨æ»¡è¶³ A[i] &gt; B[i] çš„ç´¢å¼• i çš„æ•°ç›®æ¥æè¿°ã€‚è¿”å› A çš„ä»»æ„æ’åˆ—ï¼Œä½¿å…¶ç›¸å¯¹äº B çš„ä¼˜åŠ¿æœ€å¤§åŒ–ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šA = [2,7,11,15], B = [1,10,4,11]<br>è¾“å‡ºï¼š[2,11,7,15]<br>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šA = [12,24,8,32], B = [13,25,32,11]<br>è¾“å‡ºï¼š[24,32,8,12]</p></blockquote><p>è¿™å°±åƒâ½¥å¿Œèµ›â»¢çš„æƒ…æ™¯ï¼Œnums1 å°±æ˜¯â½¥å¿Œçš„â»¢ï¼Œnums2 å°±æ˜¯â»¬ç‹çš„â»¢ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å°±æ˜¯â»¢çš„æˆ˜â½ƒâ¼’ï¼š</p><p>ç®—æ³•ç­–ç•¥æ˜¯ï¼š<strong>å°†â»¬ç‹å’Œâ½¥å¿Œçš„â»¢æŒ‰ç…§æˆ˜â½ƒâ¼’æ’åºï¼Œç„¶åæŒ‰ç…§æ’åâ¼€â¼€å¯¹â½ã€‚å¦‚æœâ½¥å¿Œçš„â»¢èƒ½èµ¢ï¼Œé‚£å°±â½èµ›ï¼Œå¦‚æœèµ¢ä¸äº†ï¼Œé‚£å°±æ¢ä¸ªå«åº•çš„æ¥é€â¼ˆå¤´ï¼Œä¿å­˜å®â¼’ã€‚</strong></p><p>è¿™é‡Œè¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯å¦éœ€è¦ä¿å­˜å®åŠ›ï¼Œå³å¦‚æœâ½¥å¿Œçš„â¼†å·é€‰â¼¿ä¹Ÿèƒ½â¼²å¾—è¿‡â»¬ç‹çš„â¼€å·é€‰â¼¿ï¼Œæ­¤æ—¶è®©â¼†å·é€‰â¼¿å»å¯¹å†³â»¬ç‹çš„â¼€å·é€‰â¼¿ï¼Œä¸æ˜¯æ›´èŠ‚çº¦ï¼Ÿ</p><p>è¿™ç§èŠ‚çº¦çš„ç­–ç•¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯<strong>æ²¡æœ‰å¿…è¦</strong>ã€‚</p><p>æˆ‘ä»¬æš‚ä¸”æŠŠâ½¥å¿Œçš„â¼€å·é€‰â¼¿ç§°ä¸º T1ï¼Œâ¼†å·é€‰â¼¿ç§°ä¸º T2ï¼Œâ»¬ç‹çš„â¼€å·é€‰â¼¿ç§°ä¸º Q1ã€‚å¦‚æœ T2 èƒ½èµ¢ Q1ï¼Œä½ è¯•å›¾ä¿å­˜â¼°â½…å®â¼’ï¼Œè®© T2 å»æˆ˜ Q1ï¼ŒæŠŠ T1 ç•™ç€æ˜¯ä¸ºäº†å¯¹ä»˜è°ï¼Ÿæ˜¾ç„¶ï¼Œä½ æ‹…â¼¼â»¬ç‹è¿˜æœ‰æˆ˜â¼’â¼¤äº T2 çš„â»¢ï¼Œå¯ä»¥è®© T1 å»å¯¹ä»˜ã€‚ä½†æ˜¯ä½ ä»”ç»†æƒ³æƒ³ï¼Œç°åœ¨ T2 å·²ç»æ˜¯å¯ä»¥æˆ˜èƒœ Q1 çš„ï¼ŒQ1 å¯æ˜¯â»¬ç‹çš„æœ€å¿«çš„â»¢ï¼Œâ»¬ç‹å‰©ä¸‹çš„é‚£äº›â»¢â¾¥ï¼Œæ€ä¹ˆå¯èƒ½è¿˜æœ‰â½ T2 æ›´å¼ºçš„â»¢ï¼Ÿ</p><p>æ‰€ä»¥æ²¡å¿…è¦èŠ‚çº¦ã€‚</p><p>æ ¹æ®ä¸Šè¿°æ€è·¯å¾—åˆ°çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹ä¸¤ä¸ªæ•°ç»„nums1å’Œnums2æ’åº</span><br><span class="line">å¯¹ä¸¤ä¸ªæ•°ç»„çš„å…ƒç´ æŒ¨ä¸ªæ¯”è¾ƒï¼Œå¦‚æœnums1[i]&gt;nums2[i]é‚£å°±æ¯”ï¼Œå¦åˆ™å°±æ¢ä¸Šnums1æœ€å°çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</span><br></pre></td></tr></table></figure><p>ç”±äºéœ€è¦å¯¹ä¸¤ä¸ªæ•°ç»„æ’åºï¼Œä½†æ˜¯è¿”å›ç»“æœä¾èµ–nums2çš„é¡ºåºï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å¯¹nums2è¿›è¡Œæ’åºï¼Œè€Œæ˜¯åˆ©ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ï¼ˆå°†(index, nums2[index]æ”¾å…¥ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå‡ºé˜Ÿä¼˜å…ˆçº§æŒ‰ç…§nums2[index]å¤§å°ï¼Œindexè®°å½•ç´¢å¼•å€¼ï¼‰</p><p>æ­¤å¤–ï¼Œè§£æ³•è¿˜æ˜¯ç”¨åˆ°åŒæŒ‡é’ˆæŠ€å·§ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] advantageCount(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums1.length;</span><br><span class="line">    <span class="comment">// ç»™ nums2 é™åºæ’åº</span></span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; maxpq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(</span><br><span class="line">        (<span class="type">int</span>[] pair1, <span class="type">int</span>[] pair2) -&gt; &#123; </span><br><span class="line">            <span class="keyword">return</span> pair2[<span class="number">1</span>] - pair1[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        maxpq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i, nums2[i]&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»™ nums1 å‡åºæ’åº</span></span><br><span class="line">    Arrays.sort(nums1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// nums1[left] æ˜¯æœ€å°å€¼ï¼Œnums1[right] æ˜¯æœ€å¤§å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = n - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!maxpq.isEmpty()) &#123;</span><br><span class="line">        <span class="type">int</span>[] pair = maxpq.poll();</span><br><span class="line">        <span class="comment">// maxval æ˜¯ nums2 ä¸­çš„æœ€å¤§å€¼ï¼Œi æ˜¯å¯¹åº”ç´¢å¼•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> pair[<span class="number">0</span>], maxval = pair[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (maxval &lt; nums1[right]) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ nums1[right] èƒ½èƒœè¿‡ maxvalï¼Œé‚£å°±è‡ªå·±ä¸Š</span></span><br><span class="line">            res[i] = nums1[right];</span><br><span class="line">            right--;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦åˆ™ç”¨æœ€å°å€¼å»æ¢nums2çš„æœ€å¤§å€¼</span></span><br><span class="line">            res[i] = nums1[left];</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://mp.weixin.qq.com/s?__biz=MzAxODQxMDM0Mw==&amp;mid=2247491139&amp;idx=1&amp;sn=10cb35e0056ac8f8c540fccd0156f333&amp;scene=21&amp;ascene=7&amp;devicetype=iOS15.2&amp;version=1800103a&amp;nettype=WIFI&amp;abtest_cookie=AAACAA%3D%3D&amp;lang=zh_CN&amp;fontScale=100&amp;exportkey=A2t5E2fVKmwEJxWEKsScbfU%3D&amp;pass_ticket=n3zshxiiR8IMf1IfoZgzB%2BPSm6RatluaPa8vtuS3bDtR2ttHhdhxmZkQCXMUyC9L&amp;wx_header=1">labuladong: ç®—æ³•å¤§å¸ˆâ€”â€”å­™è†‘</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> æ•°ç»„/é“¾è¡¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PriorityQueue æ¦‚è¿°</title>
      <link href="/2021/12/19/PriorityQueue-%E6%A6%82%E8%BF%B0/"/>
      <url>/2021/12/19/PriorityQueue-%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h1><p><code>Queue</code>æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—ã€‚</p><p>ä½†æœ‰æ—¶å€™è¿™å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å½“æˆ‘ä»¬éœ€è¦å¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ é‡æ’ï¼ŒæŒ‰ç…§é‡æ’åçš„å…ƒç´ é¡ºåºå‡ºé˜Ÿæ—¶ï¼Œè¿™æ—¶å€™å°±éœ€è¦<code>PriorityQueue</code>ã€‚</p><p><code>PriorityQueue</code>å’Œ<code>Queue</code>çš„åŒºåˆ«åœ¨äºï¼Œå®ƒçš„å‡ºé˜Ÿé¡ºåºä¸å…ƒç´ çš„ä¼˜å…ˆçº§æœ‰å…³ï¼Œå¯¹<code>PriorityQueue</code>è°ƒç”¨<code>remove()</code>æˆ–<code>poll()</code>æ–¹æ³•ï¼Œè¿”å›çš„æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚</p><p>è¦ä½¿ç”¨<code>PriorityQueue</code>ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç»™æ¯ä¸ªå…ƒç´ å®šä¹‰â€œä¼˜å…ˆçº§â€ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPriorityQueue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Queue&lt;User&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(</span><br><span class="line">                (User user1, User user2) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> user2.getLevel() - user1.getLevel();</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        queue.offer(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;sb_1&quot;</span>, <span class="number">1</span>)); <span class="comment">//ä¼˜å…ˆçº§ä½</span></span><br><span class="line">        queue.offer(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;vip_1&quot;</span>, <span class="number">2</span>)); <span class="comment">//ä¼˜å…ˆçº§é«˜</span></span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            System.out.println(user.getName());</span><br><span class="line">        &#125; <span class="comment">//å‡ºé˜Ÿçš„é¡ºåºæ˜¯vip_1, sb_1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> level;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, <span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getterã€setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨lambdaè¡¨è¾¾å¼å®ç°äº†æ’åºã€‚ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ’åºå™¨ï¼ˆå®ç°Comparableæ¥å£ï¼‰ï¼Œç„¶åå°†æ’åºå™¨å¯¹è±¡ä¼ é€’ç»™<code>PriorityQueue</code>æ„é€ å™¨ã€‚æ„é€ å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š</p><p><code>public PriorityQueue(Comparator&lt;? super E&gt; comparator)</code></p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>é€šè¿‡å †å®ç°ï¼Œå…·ä½“è¯´æ˜¯é€šè¿‡å®Œå…¨äºŒå‰æ ‘ï¼ˆ<em>complete binary tree</em>ï¼‰å®ç°çš„<strong>å°é¡¶å †</strong>ï¼ˆä»»æ„ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„æƒå€¼ï¼Œéƒ½ä¸å¤§äºå…¶å·¦å³å­èŠ‚ç‚¹çš„æƒå€¼ï¼‰ã€‚</p><p>å…·ä½“è¯·å‚è€ƒ<strong>å †æ’åº</strong>ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1265120632401152">https://www.liaoxuefeng.com/wiki/1252599548343744/1265120632401152</a></li><li><a href="https://www.cnblogs.com/CarpenterLee/p/5488070.html">https://www.cnblogs.com/CarpenterLee/p/5488070.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> é›†åˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ä¾‹è®¾è®¡æ¨¡å¼</title>
      <link href="/2021/12/16/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2021/12/16/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</p><h1 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h1><p>çº¿ç¨‹æ± ï¼Œæ•°æ®åº“è¿æ¥å¯¹è±¡ã€‚</p><h1 id="ç»å…¸å•ä¾‹æ¨¡å¼"><a href="#ç»å…¸å•ä¾‹æ¨¡å¼" class="headerlink" title="ç»å…¸å•ä¾‹æ¨¡å¼"></a>ç»å…¸å•ä¾‹æ¨¡å¼</h1><p>ä¸€ä¸ªç»å…¸çš„å•ä¾‹æ¨¡å¼å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> This is not thread safe!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (uniqueInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">uniqueInstance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> uniqueInstance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å®ç°æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚å¯ä»¥æƒ³è±¡æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥äº†getInstance()æ–¹æ³•ã€‚</p><h1 id="è§£å†³ç»å…¸å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#è§£å†³ç»å…¸å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="è§£å†³ç»å…¸å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>è§£å†³ç»å…¸å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨é—®é¢˜</h1><p>è§£å†³æ–¹æ¡ˆï¼Œç»™getInstanceæ–¹æ³•åŠ ä¸Šsynchronizedå…³é”®å­—ï¼Œè¿«ä½¿æ¯ä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•å‰éƒ½éœ€è¦ç­‰å¾…åˆ«çš„çº¿ç¨‹ç¦»å¼€è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (uniqueInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">uniqueInstance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> uniqueInstance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥è§£å†³æ–¹æ¡ˆå¾—ç¼ºç‚¹å°±æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•æ‰çœŸæ­£éœ€è¦çº¿ç¨‹åŒæ­¥ã€‚</p><h1 id="æ›´è¿›ä¸€æ­¥â€¦"><a href="#æ›´è¿›ä¸€æ­¥â€¦" class="headerlink" title="æ›´è¿›ä¸€æ­¥â€¦"></a>æ›´è¿›ä¸€æ­¥â€¦</h1><p>è¿™é‡Œç»™å‡ºä¸‰ç§æ”¹å–„æ–¹æ¡ˆï¼š</p><ol><li>å¦‚æœgetInstanceå¾—æ€§èƒ½å¯¹äºåº”ç”¨ç¨‹åºä¸æ˜¯å¾ˆå…³é”®ï¼Œå°±ä»€ä¹ˆä¹Ÿåˆ«åšã€‚</li><li>ä½¿ç”¨â€œæ€¥åˆ‡â€åˆ›å»ºå®ä¾‹ï¼Œè€Œä¸ç”¨å»¶è¿Ÿå®ä¾‹åŒ–çš„åšæ³•ã€‚</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨<strong>åŒé‡æ£€æŸ¥åŠ é”</strong>ï¼Œåœ¨getInstanceä¸­å‡å°‘ä½¿ç”¨åŒæ­¥ã€‚</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼š</p><ul><li>é¦–å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å†è¿›å…¥åŒæ­¥ä»£ç å—ã€‚</li><li>è¿›å…¥åŒºå—ååœ¨æ£€æŸ¥ä¸€æ¬¡ï¼Œå¦‚æœä»ç„¶æ˜¯nullåˆ™åˆ›å»ºå®ä¾‹ã€‚</li><li>volatileå…³é”®å­—ç¡®ä¿ï¼šå½“instanceå˜é‡åˆå§‹åŒ–åï¼Œå¤šä¸ªçº¿ç¨‹æ­£ç¡®çš„å¤„ç†instanceå˜é‡ã€‚</li></ul><h1 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h1><blockquote><p>ä¸¤ä¸ªç±»åŠ è½½å™¨å¯èƒ½æœ‰æœºä¼šåˆ›å»ºè‡ªå·±çš„å•ä¾‹å®ä¾‹ï¼Ÿ</p></blockquote><p>æ˜¯çš„ã€‚æ‰€ä»¥å¦‚æœä½ çš„ç¨‹åºæœ‰å¤šä¸ªç±»åŠ è½½å™¨åˆåŒæ—¶ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼ï¼Œè¯·å°å¿ƒã€‚è§£å†³æ–¹æ³•æ˜¯è‡ªè¡ŒæŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šåŒä¸€ä¸ªç±»åŠ è½½å™¨ã€‚</p><blockquote><p>ç±»å¦‚æœèƒ½åšä¸¤ä»¶äº‹ï¼Œå°±è¿åäº†OOè®¾è®¡ã€‚å•ä¾‹æ¨¡å¼æ˜¯å¦è¿åäº†è¿™æ ·çš„è§‚å¿µå‘¢ï¼Ÿ</p></blockquote><p>å•ä¾‹ç±»ä¸æ­¢è´Ÿè´£ç®¡ç†è‡ªå·±çš„å®ä¾‹ï¼Œè¿˜åœ¨åº”ç”¨ç¨‹åºä¸­æ‹…ä»»è§’è‰²ï¼Œæ‰€ä»¥å¯ä»¥è§†ä¸ºæ˜¯ä¸¤ä¸ªè´£ä»»ã€‚ä½†æ˜¯ç”±ç±»ç®¡ç†è‡ªå·±çš„å®ä¾‹çš„åšæ³•å¹¶ä¸å°‘è§ï¼Œä¹Ÿå¯ä»¥è®©è®¾è®¡æ›´ç®€å•ã€‚</p><blockquote><p>æˆ‘æƒ³æŠŠå•ä¾‹ç±»å½“æˆè¶…ç±»ï¼Œè®¾è®¡å‡ºå­ç±»ã€‚ç©¶ç«Ÿå¯ä¸å¯ä»¥ç»§æ‰¿å•ä¾‹ç±»ã€‚</p></blockquote><p>ä¸èƒ½ã€‚ç»§æ‰¿å•ä¾‹ç±»é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ„é€ å™¨æ˜¯ç§æœ‰çš„ã€‚ä½ ä¸èƒ½ç”¨ç§æœ‰æ„é€ å™¨æ¥æ‰©å±•ç±»ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li>ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹(ä¸­æ–‡ç‰ˆ)</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
